var siteSurvey=function(){"use strict";var e=function(e){return-1!==e.hostname.indexOf("mirror")},n=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),i=function(){function e(){n(this,e)}return t(e,null,[{key:"addProperties",value:function(e,n,t){var i=!1;for(var o in n)o.substr(0,t.length)===t&&(e[o.slice(t.length)]=n[o],i=!0);return i}}]),e}(),o=function(e,n){return void 0===n?e:n},r=function e(t,r){var a=this;n(this,e),t.forEach(function(e){a[e]=""}),this.feedbackType=o(this.feedbackType,r),window.OpinionLabs&&(this.customerId=o(this.customerId,window.OpinionLabs.id),this.idHash=o(this.idHash,window.OpinionLabs.idHash),this.customerSegment=o(this.customerSegment,window.OpinionLabs.segment),this.secondaryId=o(this.secondaryId,window.OpinionLabs.secondaryId),this.secondaryIdHash=o(this.secondaryIdHash,window.OpinionLabs.secondaryIdHash));var s=document.getElementsByClassName("site-survey-context");[].forEach.call(s,function(e){i.addProperties(a,e.dataset,"customVariables_")})},a=null,c=function(){var e="undefined"!=typeof s;return e?null==a&&(a=s.pageName):console.warn("No analytics object detected"),e},u=function(e,n){return e&&e.length?e.split(n):[]},l=function(e,n){if(c()&&e&&e.length){var t=function(e){var n=[];return u(e,",").forEach(function(e){var t=u(e,"=");n.push({name:t[0].trim(),value:2===t.length?t[1]:null})}),n}(e);n&&(s.linkTrackVars=s.linkTrackVars||"",t.forEach(function(e){-1===s.linkTrackVars.indexOf(e.name)&&(s.linkTrackVars+=","+e.name)})),t.forEach(function(e){s[e.name]=e.value})}},f=function(e,n,t){s.clearVars(),s.usePlugins=!1,function(e,n){if(e&&e.length){var t=u(e,",");n&&(s.linkTrackEvents=s.linkTrackEvents||"",t.forEach(function(e){-1===s.linkTrackEvents.indexOf(e)&&(s.linkTrackEvents+=","+e)})),s.events=s.events||"",s.events.length&&(s.events+=","),s.events+=t}}(e,t),l(n,t)},d=function(){s.usePlugins=!0,s.clearVars()},p=function(e,n,t){c()&&(f(n,t),s.pageName=e,function(e){var n=e;if(n&&n.length){var t=(n=n.toLowerCase().replace(/\s/g,"")).split(":");t.length>0&&(s.channel=t[0]),t.length>1?s.prop1=s.channel+": "+t[1]:s.prop1=s.channel,t.length>2?s.prop2=s.prop1+": "+t[2]:s.prop2=s.prop1,t.length>3?s.prop3=s.prop2+": "+t[3]:s.prop3=s.prop2,t.length>4?s.prop4=s.prop3+": "+t[4]:s.prop4=s.prop3}}(e),s.t(),d())},h=function(){if(c())return a},v=function(){function e(){n(this,e),this.context={}}return t(e,[{key:"addContext",value:function(e){return i.addProperties(this.context,e,"siteSurveyContext_")}},{key:"generate",value:function(e){var n=this,t=Object.keys(this.context);if(!t.length)return e;var i=[];return t.forEach(function(e){i.push("ol-"+encodeURIComponent(e)+"="+encodeURIComponent(n.context[e]))}),""+e+function(e){return-1===e.indexOf("?")?"?":"&"}(e)+i.join("&")}}],[{key:"fromPage",value:function(){var n=new e,t=document.getElementsByClassName("site-survey-context");return[].forEach.call(t,function(e){n.addContext(e.dataset)}),n}},{key:"fromLink",value:function(n){for(var t=e.fromPage(),i=n;i;){if(t.addContext(i.dataset))return t;i=i.parentElement}return t}}]),e}(),m=function(n,t){if(e(window.location))console.warn("Supress invite feature while mirroring.");else{var i=document.getElementById("oo_invitation_prompt");null!==i?t.inviteResponseRate<=0||(i.parentNode.removeChild(i),function(e,n,t){return new e.Invitation({pathToAssets:n.pathToAssets,companyLogo:n.companyLogo,companySlogan:n.companySlogan,responseRate:n.inviteResponseRate,repromptTime:n.inviteRepromptTime,pagesHit:n.invitePagesHit,promptDelay:n.invitePromptDelay,referrerRewrite:{replacePattern:v.fromPage().generate(window.location.href.replace(/:\/\/[^\/]*/,"://invite.huntington.com"))},customVariables:new r(n.customVariableNames.split(","),"invite"),callBacks:{prompt:function(){p("pub: global: survey: invite prompt window","event40","eVar53="+h())},yesClick:function(){p("pub: global: survey: monitor window")}},inviteMarkup:t})}(n,t,i.outerHTML)):console.warn("Skipping invite, no modal div present.")}},g=function(){function e(t,i,o){n(this,e);var r=t.dataset;t.appendChild(e.wrapAnchor(e.createAnchor(o,e.iconPath(i,r.feedbackLinkIconId),r.feedbackLinkType,r.feedbackLinkClass),r.feedbackLinkWrapper)),this.parentElement=t}return t(e,null,[{key:"createAnchor",value:function(e,n,t,i){var o=document.createElement("a"),r=document.createTextNode(e);o.href="#",o.title=e+" (opens in a new window)",o.setAttribute("data-site-survey-link",t),i&&(o.className=i);var a=document.createElement("img");return a.alt="",a.className="oo_inline_img",a.src=n,a.height=18,a.width=18,o.appendChild(a),o.appendChild(r),o}},{key:"wrapAnchor",value:function(e,n){if(!n)return e;var t=document.createDocumentFragment(),i=document.createElement("div");return i.innerHTML=n,t.appendChild(i.firstChild),t.firstChild.appendChild(e),t}},{key:"iconPath",value:function(e,n){return e+"oo_icon_retina"+(n?"_"+n:"")+".gif"}}]),e}(),y=[],k=function(e){for(var n=0;n<y.length;++n)if(e===y[n].parentElement)return!0;return!1},w=function(e,n,t){if(t)for(var i=document.getElementsByClassName(n),o=0;o<i.length;++o){var r=i[o];k(r)||y.push(new g(r,e,t))}},b=function(){function e(){n(this,e)}return t(e,null,[{key:"matches",value:function(e){return e.hasAttribute("data-site-survey-link")}},{key:"bind",value:function(n){document.body.addEventListener("click",function(t){return e.matches(t.target)?n(t,t.target):e.matches(t.target.parentNode)?n(t,t.target.parentNode):void 0})}}]),e}(),L=function(){function i(e,t){n(this,i),this.o=e,this.config=t}return t(i,[{key:"injectSurveyLinks",value:function(){w(this.config.pathToAssets,"feedback-footer-parent",this.config.footerFeedbackText),w(this.config.pathToAssets,"feedback-fab-parent",this.config.fabFeedbackText)}},{key:"launchOpinionLab",value:function(n,t){if(e(window.location))return console.warn("Survey links will not be functional when mirroring a user."),void alert("This action cannot be performed when mirroring a user");new this.o.Ocode({referrerRewrite:{replacePattern:v.fromLink(t).generate(window.location.href)},customVariables:new r(this.config.customVariableNames.split(","),t.dataset.siteSurveyLink)}).show(n)}},{key:"bindSurveyLinks",value:function(){var e=this;b.bind(function(n,t){e.launchOpinionLab(n,t)})}}]),i}(),E=function(e,n){var t=new L(e,n);t.bindSurveyLinks(),t.injectSurveyLinks()};new function e(){var t=this;n(this,e);var i=document.getElementById("site-survey");i?function(e,n,t,i){if(document.head&&e){var o=document.createElement("link");o.rel="stylesheet",o.href=e.getAttribute("data-css-url"),o.onload=function(){n&&n(),i&&e.removeAttribute("hidden")},t&&(o.onerror=t),document.head.appendChild(o)}}(i,function(){t.config=i.dataset,function(e,n,t){if(e&&e.length){var i=document.createElement("script");i.src=e,"function"==typeof n&&(i.onload=n),"function"==typeof t&&(i.onerror=t),document.head.appendChild(i)}}(t.config.surveyEngineScript,function(){t.opinionLab=window.OOo,void 0!==t.opinionLab?(m(t.opinionLab,t.config),E(t.opinionLab,t.config)):console.warn("Surveys disabled: OpinionLab engine script not present.")})},function(){console.error("Cannot configure survey: unable to load stylesheet")},!1):console.warn("Surveys disabled: No survey configuration present.")};return{}}();
//# sourceMappingURL=site-survey.js.map
