var chatFab=function(){"use strict";var t=null;function e(){var e="undefined"!=typeof s;return e?null==t&&(t=s.pageName):console.warn("No analytics object detected"),e}function n(t,e){return t&&t.length?t.split(e):[]}function a(t,a){if(e()&&t&&t.length){var i=function(t){var e=[];return n(t,",").forEach(function(t){var a=n(t,"=");e.push({name:a[0].trim(),value:2===a.length?a[1]:null})}),e}(t);!0===a&&(s.linkTrackVars=s.linkTrackVars||"",i.forEach(function(t){-1===s.linkTrackVars.indexOf(t.name)&&(s.linkTrackVars+=","+t.name)})),i.forEach(function(t){s[t.name]=t.value})}}function i(t,e,i){s.clearVars(),s.usePlugins=!1,function(t,e){if(t&&t.length){var a=n(t,",");!0===e&&(s.linkTrackEvents=s.linkTrackEvents||"",a.forEach(function(t){-1===s.linkTrackEvents.indexOf(t)&&(s.linkTrackEvents+=","+t)})),s.events=s.events||"",s.events.length&&(s.events+=","),s.events+=a}}(t,i),a(e,i)}function o(){s.usePlugins=!0,s.clearVars()}var c={registerPageView:function(t,n,a){e()&&(i(n,a),s.pageName=t,function(t){if(t&&t.length){var e=t.toLowerCase().replace(/\s/g,"").split(":");e.length>0&&(s.channel=e[0]),e.length>1?s.prop1=s.channel+": "+e[1]:s.prop1=s.channel,e.length>2?s.prop2=s.prop1+": "+e[2]:s.prop2=s.prop1,e.length>3?s.prop3=s.prop2+": "+e[3]:s.prop3=s.prop2,e.length>4?s.prop4=s.prop3+": "+e[4]:s.prop4=s.prop3}}(t),s.t(),o())},registerLinkClick:function(n,a,c){if(e()){i(a,c,!0);var r=-1===n.indexOf("|")?n+"|"+t:n;s.tl(!0,"o",r),o()}},getOriginatingPageName:function(){if(e())return t}},r=function(t){var e=t.split(":");if(2!==e.length)throw"Time value is incorrect format:"+t;var n=parseInt(e[0],10),a=parseInt(e[1],10);if(!function(t){return!isNaN(t)&&t>=0&&t<24}(n)||!function(t){return!isNaN(t)&&t>=0&&t<60}(a))throw"Time value is incorrect format:"+t;return[n,a]},l=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;if(!t)throw"dataset must be defined";var n=parseInt(t.timeZoneOffset,10);if(isNaN(n))throw"data-time-zone-offset is missing/invalid";var a=n+e.getTimezoneOffset();return function(t,e){var n=e.getDay(),a=t["chatHoursOpen"+n];if(!a)return!1;var i=r(a);if(i[0]>e.getHours())return!1;if(i[0]===e.getHours()&&i[1]>e.getMinutes())return!1;var o=t["chatHoursClose"+n];if(!o)return!0;var c=r(o);return c[0]>e.getHours()||c[0]===e.getHours()&&c[1]>e.getMinutes()}(t,new Date(e.getTime()+6e4*a))};var u=("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{}).CustomEvent;var d=function(){try{var t=new u("cat",{detail:{foo:"bar"}});return"cat"===t.type&&"bar"===t.detail.foo}catch(t){}return!1}()?u:"undefined"!=typeof document&&"function"==typeof document.createEvent?function(t,e){var n=document.createEvent("CustomEvent");return e?n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail):n.initCustomEvent(t,!1,!1,void 0),n}:function(t,e){var n=document.createEventObject();return n.type=t,e?(n.bubbles=Boolean(e.bubbles),n.cancelable=Boolean(e.cancelable),n.detail=e.detail):(n.bubbles=!1,n.cancelable=!1,n.detail=void 0),n};function f(t,e,n){var a=this;function i(e,n){for(var a=t.querySelectorAll("[data-"+e+"]"),i=0;i<a.length;i++){var o=a[i],c=o.getAttribute("data-"+e),r=o.classList;r&&(n?r.add(c):r.remove(c))}}function o(e,n){for(var i=t.querySelectorAll("[data-"+e+"]"),o=0;o<i.length;o++){var c=i[o].classList;c&&(n?c.remove(a.hiddenClass):c.add(a.hiddenClass))}}function r(){try{return!l(a.elm.dataset)}catch(t){return console.warn(t),!0}}a.api=e,a.options=n,a.elm=t,a.hiddenClass="t-chat-hidden",a.flag={open:!1},a.chat={timeout:0,status:"",transitionDelay:1e3,popup:{width:320,height:568}},a.raft={timeout:0,open:!1,transitionDelay:500},a.inviteAccepted=!1,a.stateChangeRegistered=!1;var s=t.querySelector(".c-chat-raft__link");s&&s.addEventListener("click",function(){c.registerLinkClick("contact us")});for(var u=t.querySelectorAll("[data-fab-click]"),f=function(e){this.classList.contains("o-chat-fab__flag-close")?c.registerLinkClick("help widget invitation dismissed"):this.classList.contains("o-chat-fab__flag-text")&&(a.inviteAccepted=!0),e.preventDefault(),t.dispatchEvent(new d(this.getAttribute("data-fab-click")))},h=function(e){"Enter"===e.key&&(e.preventDefault(),t.dispatchEvent(new d(this.getAttribute("data-fab-click"))))},p=0;p<u.length;p++)u[p].addEventListener("click",f),u[p].addEventListener("keydown",h);t.addEventListener("keydown",function(e){"Escape"!==e.key&&"Esc"!==e.key||(e.preventDefault(),t.dispatchEvent(new d("fab:raft:close")))});var v=t.querySelector(".o-chat-fab__toggle");function g(t,e){for(var n=0;n<t.length;n++){var a=t[n],i=a.getAttribute("class");i?-1===i.indexOf(e)&&a.setAttribute("class",i+" "+e):a.setAttribute("class",e)}}function m(t,e){for(var n=0;n<t.length;n++){var a=t[n],i=a.getAttribute("class");i&&i.length&&a.setAttribute("class",i.replace(e,""))}}return v&&v.addEventListener("keydown",function(e){" "!==e.key&&"Spacebar"!==e.key||(e.preventDefault(),t.dispatchEvent(new d("fab:raft:toggle")))}),t.addEventListener("fab:flag:open",function(){if(r()){var e=t.querySelector(".c-chat-launcher__hours");e&&e.classList.add("c-chat-launcher__hours--visible")}else c.registerLinkClick("help widget invitation","event25"),a.flag.open=!0,o("flag-visibility",a.flag.open),t.dispatchEvent(new d("fab:flag:change"))}),t.addEventListener("fab:flag:close",function(){a.flag.open=!1,t.dispatchEvent(new d("fab:flag:change",{detail:function(){o("flag-visibility",a.flag.open)}}))}),t.addEventListener("fab:flag:change",function(t){i("flag-open-class",a.flag.open),"function"==typeof t.detail&&t.detail()}),t.addEventListener("fab:chat:online",function(){r()||"online"!==a.chat.status&&(o("chat-online-visibility",!0),t.dispatchEvent(new d("fab:chat:change",{detail:{status:"online",callback:function(){o("chat-offline-visibility",!1),o("chat-error-visibility",!1);var e=t.getElementsByClassName("c-chat-status-icon");g(e,"c-chat-status-icon--online"),m(e,"c-chat-status-icon--offline")}}})))}),t.addEventListener("fab:chat:offline",function(){"offline"!==a.chat.status&&(o("chat-offline-visibility",!0),t.dispatchEvent(new d("fab:chat:change",{detail:{status:"offline",callback:function(){o("chat-online-visibility",!1),o("chat-error-visibility",!1);var e=t.getElementsByClassName("c-chat-status-icon");g(e,"c-chat-status-icon--offline"),m(e,"c-chat-status-icon--online")}}})))}),t.addEventListener("fab:chat:error",function(){"error"!==a.chat.status&&(""===a.chat.status&&(a.chat.status="error"),o("chat-error-visibility",!0),t.dispatchEvent(new d("fab:chat:change",{detail:{status:"error",callback:function(){o("chat-online-visibility",!1),o("chat-offline-visibility",!1)}}})))}),t.addEventListener("fab:chat:change",function(t){var e=t.detail||{};!a.stateChangeRegistered&&a.raft.open&&(c.registerLinkClick("help widget status change"),a.stateChangeRegistered=!0),clearTimeout(a.chat.timeout),i("chat-online-class",!1),i("chat-offline-class",!1),i("chat-error-class",!1),i("chat-transitioning-class",!0),a.chat.timeout=setTimeout(function(){i("chat-transitioning-class",!1),i("chat-"+e.status+"-class",!0),i("chat-online-class-delayed","online"===e.status),i("chat-offline-class-delayed","offline"===e.status),i("chat-error-class-delayed","error"===e.status),a.chat.status=e.status,"function"==typeof e.callback&&e.callback()},a.chat.transitionDelay)}),t.addEventListener("fab:chat:popup",function(){"online"===a.chat.status&&(a.inviteAccepted?(c.registerLinkClick("help widget - chat accept after invite","event26"),a.inviteAccepted=!1):c.registerLinkClick("help widget - chat initiated - no invite","event27"),a.api.startChat())}),t.addEventListener("fab:raft:open",function(){var e=r();if(e){var n=t.querySelector(".c-chat-launcher__hours");n&&n.classList.add("c-chat-launcher__hours--visible"),t.dispatchEvent(new d("fab:chat:offline"))}c.registerPageView("pub: global: help widget",function(e){var n=[];return e?n.push("event603"):"online"===a.chat.status?n.push("event601"):"offline"===a.chat.status&&n.push("event602"),t.querySelector("a.c-chat-feedback")&&n.push("event605"),t.querySelector(".c-chat-launcher")||n.push("event621"),t.querySelector(".c-chat-search")||n.push("event622"),n.join(",")}(e),"eVar61="+c.getOriginatingPageName()),clearTimeout(a.flag.timeout),a.raft.open=!0,t.dispatchEvent(new d("fab:flag:close")),o("raft-visibility",a.raft.open),t.dispatchEvent(new d("fab:raft:change"))}),t.addEventListener("fab:raft:close",function(){a.raft.open=!1,t.dispatchEvent(new d("fab:raft:change",{detail:function(){a.raft.timeout=setTimeout(function(){o("raft-visibility",a.raft.open)},a.raft.transitionDelay)}}))}),t.addEventListener("fab:raft:toggle",function(){a.raft.open?t.dispatchEvent(new d("fab:raft:close")):t.dispatchEvent(new d("fab:raft:open"))}),t.addEventListener("fab:raft:change",function(e){clearTimeout(a.raft.timeout),i("raft-open-class",a.raft.open),function(e,n){for(var a=t.querySelectorAll("[data-"+e+"]"),i=0;i<a.length;i++)a[i].setAttribute("aria-expanded",n+"")}("raft-toggle",a.raft.open),"function"==typeof e.detail&&e.detail()}),i("chat-online-class",!1),i("chat-offline-class",!1),i("chat-error-class",!1),i("chat-transitioning-class",!0),a}var h=function(t,e,n){if(t&&t.length){var a=document.createElement("script");a.src=t,"function"==typeof e&&(a.onload=e),"function"==typeof n&&(a.onerror=n),document.head.appendChild(a)}},p={style:{display:"foo"}};var v={isMirroring:function(){return-1!==window.location.hostname.indexOf("mirror")}};var g={register:function(){Element.prototype.matches=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Element.prototype.closest||(Element.prototype.closest=function(t){var e=this;do{if(e.matches(t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null})}};g.register();var m={initProxy:function(t,e){var n=document.querySelectorAll(t);Array.prototype.forEach.call(n,function(t){t.setAttribute("role","button"),t.removeAttribute("data-overlay")}),document.addEventListener("click",function(n){if(n.target.closest(t)){var a=document.querySelector(e);null!==a&&a.click(),n.preventDefault()}})}},b=null,y=null,E=0,w=0,k="fabInviteShown=true";var C,L=null,I={setAvailability:function(t){L!==t&&(L=t,t?b.elm.dispatchEvent(new d("fab:chat:online")):b.elm.dispatchEvent(new d("fab:chat:offline")))}},A={startChat:function(){v.isMirroring()?window.alert("This action cannot be performed when mirroring a user."):y.startChat()}},S={init:function(t,e){null!==t&&void 0!==t?null!==e&&void 0!==e?(this.config=e,function(t,e,n){if(document.head&&t){var a=document.createElement("link");a.rel="stylesheet",a.href=t.getAttribute("data-css-url"),a.onload=function(){e&&e(),t.removeAttribute("hidden")},n&&(a.onerror=n),document.head.appendChild(a)}}(t,function(){document.addEventListener("fab:chat:resetInviteTimer",function(){S.chatInvite(e.chatInviteDelay)}),document.addEventListener("fab:chat:cancelInviteTimer",function(){S.chatInvite(0)}),b=new f(t,A,e),y=new function(t,e,n){var a=this;function i(t){a.callbacks.setAvailability("BUTTON_AVAILABLE"===t||"BUTTON_ACCEPTED"===t)}a.config=t,a.callbacks=e,h(t.chatDeploymentScript,function(){a._LiveAgent=window.liveagent,a._Enabled=void 0!==a._LiveAgent,a._Enabled?(t.chatLoggingEnabled&&a._LiveAgent.enableLogging(),a._LiveAgent.showWhenOnline(t.chatSkill,p),a._LiveAgent.init(t.chatApiEndpoint,t.chatDeploymentId,t.chatOrgId),a._LiveAgent.addButtonEventHandler(t.chatSkill,i)):(console.error("LiveAgent not enabled"),n())},n),this.startChat=function(){a._Enabled&&a._LiveAgent.startChatWithWindow(a.config.chatSkill,"FAB")}}(e,I,function(){console.error("Could not load LiveAgent script"),S.chatError()}),e.chatInviteDelay&&0!==e.chatInviteDelay&&S.chatInvite(e.chatInviteDelay),document.dispatchEvent(new d("fab:chat:loaded")),m.initProxy(".fab-launcher","#ChatFloatingActionButton a.o-chat-fab__toggle")},function(){console.error("Cannot display chat fab: unable to load stylesheet")})):console.warn("invalid config passed"):console.warn("invalid element passed")},chatOffline:function(){L=!1,b.elm.dispatchEvent(new d("fab:chat:offline"))},chatOnline:function(){L=!0,b.elm.dispatchEvent(new d("fab:chat:online"))},chatError:function(){b.elm.dispatchEvent(new d("fab:chat:error"))},chatInvite:function(t){if(-1===document.cookie.indexOf(k)){if(0!==E&&clearTimeout(E),t&&t>0){E=setTimeout(function t(){++w<=2?L?(document.cookie=k+";path=/;domain=.huntington.com",b.elm.dispatchEvent(new d("fab:flag:open"))):(clearTimeout(E),E=setTimeout(t,15e3)):console.warn("Suppress invite attempts")},1e3*t)}}else console.info("Invite already shown, supressing")}},_=(function(t,e){e.defaults={},e.set=function(t,n,a){var i=a||{},o=e.defaults,c=i.expires||o.expires,r=i.domain||o.domain,s=void 0!==i.path?i.path:void 0!==o.path?o.path:"/",l=void 0!==i.secure?i.secure:o.secure,u=void 0!==i.httponly?i.httponly:o.httponly,d=void 0!==i.samesite?i.samesite:o.samesite,f=c?new Date("number"==typeof c?(new Date).getTime()+864e5*c:c):0;document.cookie=t.replace(/[^+#$&^`|]/g,encodeURIComponent).replace("(","%28").replace(")","%29")+"="+n.replace(/[^+#$&/:<-\[\]-}]/g,encodeURIComponent)+(f&&f.getTime()>=0?";expires="+f.toUTCString():"")+(r?";domain="+r:"")+(s?";path="+s:"")+(l?";secure":"")+(u?";httponly":"")+(d?";samesite="+d:"")},e.get=function(t){for(var e=document.cookie.split(";");e.length;){var n=e.pop(),a=n.indexOf("=");if(a=a<0?n.length:a,decodeURIComponent(n.slice(0,a).replace(/^\s+/,""))===t)return decodeURIComponent(n.slice(a+1))}return null},e.erase=function(t,n){e.set(t,"",{expires:-1,domain:n&&n.domain,path:n&&n.path,secure:0,httponly:0})},e.all=function(){for(var t={},e=document.cookie.split(";");e.length;){var n=e.pop(),a=n.indexOf("=");a=a<0?n.length:a,t[decodeURIComponent(n.slice(0,a).replace(/^\s+/,""))]=decodeURIComponent(n.slice(a+1))}return t}}(C={exports:{}},C.exports),C.exports),D=(_.defaults,_.set,_.get,_.erase,_.all,{None:0,OptedIn:1,RandomIn:2});Object.freeze(D);var T={CookieName:"ChatbotPilot",ExpireDays:45};function O(t){var e=".huntington.com",n=document.domain;n&&-1!==n.toLowerCase().indexOf(e)&&(n=e),_.set(T.CookieName,t.toString(),{expires:T.ExpireDays,domain:n,path:"/",secure:!0})}function R(){return _.get(T.CookieName)}Object.freeze(T);var N={isInPilot:function(){var t=R();if(!t||0===t.length)return!1;var e=parseInt(t);return isNaN(e)?(console.error("CHATBOT: Raw cookie value:"+t),!1):(O(e.toString()),0!=(e&D.OptedIn)||0!=(e&D.RandomIn))},addToPilot:function(){O(D.RandomIn)},getWaveId:R},x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function P(t){if(void 0===t)return"true"===_.get("CHATBOT_MESSAGE_SENT");if(!0===t||!1===t){var e=".huntington.com",n=document.domain;n&&-1!==n.toLowerCase().indexOf(e)&&(n=e),_.set("CHATBOT_MESSAGE_SENT",t.toString(),{domain:n,secure:!0})}else console.error("Ignoring invalid cookie value:"+t)}function q(t){void 0!==("undefined"==typeof Inq?"undefined":x(Inq))&&"function"==typeof Inq.fireCustomEvent&&Inq.fireCustomEvent("closeActiveChat")}function B(){!1===P()&&(P(!0),c.registerLinkClick("send message to chatbot|pub: global: chatbot")),function(){var t=null,e=document.querySelector(".session-handler[data-system=Retail]");e?t=e.dataset.keepAliveUrl:dataLayer&&dataLayer.user&&(t="/rol/RemoteKeepAlive.aspx","undefined"!=typeof SessionManager&&"function"==typeof SessionManager.resetClientSide&&SessionManager.resetClientSide());if(t){var n=document.createElement("img");n.hidden=!0,n.alt="",n.height=n.width=1,n.src=t+(t.indexOf("?")>=0?"&":"?")+"noCache="+Math.random(),document.body.appendChild(n)}}()}g.register();var H={init:function(t,e){void 0!==t&&null!==t?void 0!==e&&null!==e?(function(t){var e=window.dataLayer;window.nuanceData=window.nuanceData||{},void 0!==e&&null!==e&&void 0!==e.user&&null!==e.user&&(nuanceData.cust_perm_id=e.user.chatSystemId,nuanceData.cust_perm_id_hash=e.user.idHash,nuanceData.cust_name=e.user.preferredName),nuanceData.guid=void 0!==window.s?window.s.marketingCloudVisitorID:"",nuanceData.wave_id=N.getWaveId(),nuanceData.rol_domain=t.chatbotRolRoot||"https://onlinebanking.huntington.com",nuanceData.usc_domain=t.chatbotUscRoot||"https://selfservice.huntington.com",nuanceData.hcom_domain=t.chatbotHcomRoot||"https://www.huntington.com",nuanceData.oao_domain=t.chatbotOaoRoot||"https://apply.huntington.com"}(e),h(e.chatbotDeploymentScript,function(){var t,e;t={onC2CDisplayed:function(t){if(v.isMirroring()){console.warn("mirroring environment detected");var e=document.getElementById(t.c2c.pageElementID),n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("click",function(t){window.alert("This action cannot be performed when mirroring a user.")})}}},e={onC2CClicked:function(t){P(!1),window.nuanceData.guid=void 0!==window.s?window.s.marketingCloudVisitorID:"";var e="event50";N.isInPilot()||(console.info("adding user to randomized pilot group"),N.addToPilot(),e+=",event997"),c.registerPageView("pub: global: chatbot",e)}},window.InqRegistry={chatListeners:[],listeners:[e,t],saleListeners:[]},document.addEventListener("click",function(t){0===t.target.id.indexOf("tcChat_btnSend")&&B()},{passive:!0,capture:!0}),document.addEventListener("keydown",function(t){"Enter"===t.key&&0===t.target.id.indexOf("tcChat_")&&B()},{passive:!0,capture:!0}),document.addEventListener("huntington:logoff",function(t){return q()}),document.addEventListener("click",function(t){t.target.closest("#navigation_Logout, .logout, [data-session-logout]")&&q()},{passive:!0,capture:!0}),m.initProxy(".fab-launcher","#inqC2CImgContainer_Anchored button.HB-FAB-aval"),document.domain&&-1!==document.domain.indexOf("localhost")&&window.setTimeout(function(){Inq.reinitChat(38436650)},5e3)},function(){console.error("nuance script load error")})):console.warn("empty config passed to chatbot, bailing"):console.warn("invalid element passed to chatbot, bailing")}};var U={getConfig:function(t){return{cssUrl:t.dataset.cssUrl,chatSkill:t.dataset.chatSkill,chatInviteDelay:parseInt(t.dataset.chatInviteDelay),chatLoggingEnabled:!1,chatDeploymentScript:t.dataset.chatDeploymentScript,chatApiEndpoint:t.dataset.chatApiEndpoint,chatDeploymentId:t.dataset.chatDeploymentId,chatOrgId:t.dataset.chatOrganizationId,timezoneOffset:parseInt(t.dataset.timeZoneOffset),chatbotDeploymentScript:t.dataset.chatbotDeploymentScript,chatbotEnabled:"true"==t.dataset.chatbotEnabled||"True"==t.dataset.chatbotEnabled,chatbotHcomRoot:t.dataset.chatbotHcomRoot,chatbotOaoRoot:t.dataset.chatbotOaoRoot,chatbotUscRoot:t.dataset.chatbotUscRoot,chatbotRolRoot:t.dataset.chatbotRolRoot,chatbotPilotPercentage:parseInt(t.dataset.chatbotPilotPercentage)}}};var M={init:function(){var t=document.getElementById("ChatFloatingActionButton");if(t){var e=U.getConfig(t);!0===function(t){var e=document.domain?document.domain.toLowerCase():"";return!1===t.chatbotEnabled?(console.warn("chatbot killswitch is enabled"),!1):function(t){return/eas-|tul-|-validate|dc\d-/i.test(t)}(e)?(console.info("EXPERIENCE: disable chatbot in validation domains"),!1):N.isInPilot()?(console.info("EXPERIENCE: pilot participant"),!0):t.chatbotPilotPercentage<=0?(console.warn("chatbot pilot percentage is zero"),!1):100*Math.random()<t.chatbotPilotPercentage?(console.info("EXPERIENCE: pilot eligible"),!0):(console.info("EXPERIENCE: not pilot eligible"),!1)}(e)?(console.info("starting in chatbot mode"),H.init(t,e)):(console.info("starting in live agent mode"),S.init(t,e))}else console.warn("No fab target")}};return M.init(),{chatController:M}}();
//# sourceMappingURL=chat-fab.js.map
