window.O365=window.O365||{},O365.ProductKeyControl=function(n,t,i){var r={Empty:{imgSrc:null,imgAlt:null},Incomplete:{imgSrc:null,imgAlt:null},Complete:{imgSrc:null,imgAlt:null},Validating:{imgSrc:'https://prod.msocdn.com/16.00.1670.006/en-US/webcontrols/Images/spinner_16x16.gif',imgAlt:'Validating product key'},Valid:{imgSrc:'https://prod.msocdn.com/16.00.1670.006/en-US/Images/GreenCheck_default_16x16_metro.png',imgAlt:'Valid product key'},Invalid:{imgSrc:'https://prod.msocdn.com/16.00.1670.006/en-US/Images/Alert_High_default_16x16_metro.png',imgAlt:'Invalid product key'}},ut=function(n){var a="ValFieldError",e=!0,f="",y=$(n),p=y.parent(),o=y.attr("id"),i=o+"_v",u=i+"_val",s=i+"_err",r=i+"_err_ClientState",h=i+"_f",c=document.createElement("div"),l,t;c.innerHTML="<span id='"+u+"' style='display:none;'></span><input type='hidden' name='"+r+"' id='"+r+"' />",p[0].appendChild(c),l=$("#"+u),t=l[0],t.enabled=!0,t.controltovalidate=o,t.display="None",t.isvalid=!0,t.errormessage=" ",t.evaluationfunction=window.CustomValidatorEvaluateIsValid,t.clientvalidationfunction=h,window.Page_Validators||(window.Page_Validators=[]),window.Page_Validators.push(t),window.Sys&&window.Sys.Application&&Sys.Application.add_init(function(){var n=$create(Sys.Extended.UI.ValidatorCalloutBehavior,{ClientStateFieldID:r,closeImageUrl:" ",id:s,warningIconImageUrl:" "},null,null,$get(u));window.Shared&&Shared.IsTextRightToLeft&&n.set_popupPosition(Sys.Extended.UI.ValidatorCalloutPosition.Left)});var v=function(){window.ValidatorValidate&&window.ValidatorValidate(t,null,null)},w=function(i){n.addClass(a),t.errormessage=i||"",e=!1,f=i||"",v();try{var r=$("#"+s+"_popupTable");r.css("padding","0 15px")}catch(u){}},b=function(){n.removeClass(a),e=!0,f="",v()};return window[h]=function(n,t){t.IsValid=e,n.errormessage=f},{showError:w,clear:b}},it=function(n,t,i){var d="PKC_img",ft="PKC_s",rt="PKC_m",c=29,b=6,l="",a=r.Empty,u=$(n).find("input[type='text']"),h=$(n).find("."+d),s=$(n).find("."+ft),g=$(n).find("."+rt),k=new ut(u),e=function(n,i){n!==a&&(a=n,n.imgSrc?(s.hide(),h.attr("src",n.imgSrc),h.attr("alt",n.imgAlt),h.attr("title",n.imgAlt),h.show()):(h.hide(),s.show()),n===r.Invalid?k.showError(i):(k.clear(),g.html(i||"")),t&&t(n))},et=function(n){var t=u.get(0),i;t.createTextRange?(i=t.createTextRange(),i.move('character',n),i.select()):t.selectionStart?(t.focus(),t.setSelectionRange(n,n)):t.focus()},w=function(){var t=0,n=u.get(0),r,i,f;if('selectionStart'in n)t=n.selectionStart;else if('selection'in document){r=$('*:focus');try{n.focus()}catch(e){}i=document.selection.createRange(),f=document.selection.createRange().text.length,i.moveStart('character',-n.value.length),t=i.text.length-f,r.focus()}return t},f=function(n){return n.charCodeAt(0)},v=function(n){return n>=f('A')&&n<=f('Z')},nt=function(n){return n>=f('0')&&n<=f('9')||n>=96&&n<=105},p=function(n){return n==35||n==36||n===37||n===39||n===9},it=function(n){return n===46},y=function(n){return n===8},tt=function(n){var t=n.which;if(n.ctrlKey){if(v(t)){setTimeout(o,0);return}n.preventDefault();return}if(n.shiftKey){if(p(t))return;if(!v(t)){n.preventDefault();return}}if(n.altKey){n.preventDefault();return}p(t)||(y(t)||it(t)||v(t)||nt(t)?y(t)&&u.val().charAt(w()-1)==='-'?setTimeout(function(){o({bdash:!0})},0):setTimeout(o,0):n.preventDefault())},o=function(n){var p=w(),v=u.val(),i,o,h,t,y,a;if(v===l)return!0;for(i=[],o=0,h=0;h<v.length;h++){if(n&&n.bdash&&h===p-1){o--;continue}if(t=v.charAt(h),t>='A'&&t<='Z'||t>='0'&&t<='9'?i.push(t):t>='a'&&t<='z'?i.push(String.fromCharCode(f("A")+f(t)-f("a"))):o--,i.length==c)break;y=i.length,y<c&&(y+1)%b==0&&(i.push('-'),o++)}a=i.join(""),u.val(a),et(p+o),l=a,a.length===0?(e(r.Empty),s.text("")):a.length===c?(e(r.Incomplete),e(r.Complete),s.text("")):(e(r.Incomplete),s.text(c-l.length-parseInt((c-l.length)/b)))};return u.keydown(tt),u.bind("paste",function(n){var t,i;try{t=window.clipboardData||n.clipboardData||n.originalEvent.clipboardData,t&&t.getData&&(i=t.getData('text'),t.setData('text',i.trim()))}catch(r){}setTimeout(o,0)}),i&&u.val(""),{getStatus:function(){return a},getKey:function(){return u.val()},setValidating:function(){e(r.Validating)},setValid:function(n){e(r.Valid,n)},setInvalid:function(n){e(r.Invalid,n)},disable:function(){u.attr("disabled","disabled")},enable:function(){u.removeAttr("disabled")},clear:function(){u.val(""),o()},onTextChange:o}},f=!1,u=[],o,e,w=0,p="",s=[],y=$("#"+n+"_h_val"),h=!1,v,a=!1,b=50,k=function(){return v},d=function(){var n,t;for(h=!0,n=0;n<u.length;n++)t=u[n],t.disable()},g=function(){var n,t;for(h=!1,n=0;n<u.length;n++)t=u[n],t.enable()},nt=function(){for(var t,n=0;n<u.length;n++)t=u[n],t.clear()},tt=function(n){a=n,l()},l=function(){for(var e=[],b="",c=a,k=!1,l=!0,d=[],v,o,h,n=0;n<u.length;n++)v=u[n],o=v.getStatus(),(o===r.Complete||o===r.Validating||o===r.Valid||o===r.Invalid)&&(b+=n.toString()+"_",e.push(v),l=!1),o===r.Valid?(d.push(v.getKey()),k=!0):o!==r.Empty&&(c=!1,l=!1);if(c=c&&k,c!==f?(f=c,f?y.val(d.join()):y.val(""),t&&(f?t({complete:!0}):t({complete:!1,allEmpty:l}))):t({complete:!1,allEmpty:l}),b!==p&&(p=b,e.length>0&&i)){for(h={},h.requestId=++w,h.keys=[],n=0;n<e.length;n++)h.keys.push(e[n].getKey());for(h.callback=rt,i(h),n=0;n<e.length;n++)e[n].setValidating();s=e}},rt=function(n){var t,i,u;if(n.requestId===w)for(v=n,tt(n.responseStatus[0],n.responseStatus[2]),t=0;t<s.length;t++)i=s[t],i.getStatus()===r.Validating&&(u=n.data[t],u[0]?i.setValid(u[2]):i.setInvalid(u[2]))},c=function(n,t){var i=new it(n,l,t);window.setTimeout(i.onTextChange,0),u.push(i)},ft=function(){var t,i,r,f;!h&&e&&u.length<b&&(t=$(e).clone(),o.append(t),i=n+"_tb"+u.length.toString(),r=$($(t).find("input[type='text']")[0]),r.attr("id",i),r.attr("name",i),f=$($(t).find("label")[0]),f.attr("for",i),c(t,!0),window.PageLayout&&PageLayout.ResizePanels&&PageLayout.ResizePanels())},et=function(){var t,i;o=$('#'+n+" .PKC_c"),t=o.children(".PKC_tb_c"),t.each(function(n,t){e||(e=$(t).clone()),c(t)}),i=$("#"+n+" .PKC_a"),i.click(ft)};return $(document).ready(function(){et()}),{getProductKeys:k,disable:d,enable:g,clear:nt}}