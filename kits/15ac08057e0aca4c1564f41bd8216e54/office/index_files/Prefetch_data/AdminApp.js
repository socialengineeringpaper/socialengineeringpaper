var O365;(function(n){animationTime=250,animationTimeExtended=400;var t=function(){function n(){}return n.showFlyout=function(n){this.ResizeFlyout(),$("#FlyoutContainer").trigger("EnableFlyout",[n,"30%"])},n.showFlyoutWithPost=function(n,t){this.ResizeFlyout(),$("#FlyoutContainer").trigger("EnableFlyoutPost",[n,t,"30%"])},n.startDeleteUserFlyout=function(n){var t="/usermanagement/deleteuser/",i=this.userPostData(n);this.showFlyoutWithPost(t,i)},n.startResetPasswordFlyout=function(n){var t="/usermanagement/resetuserpassword/",i=this.userPostData(n);this.showFlyoutWithPost(t,i)},n.startEditRolesFlyout=function(n){var t="/usermanagement/edituserroles/"+n;this.showFlyout(t)},n.startEditUserFlyout=function(n){var t="/usermanagement/UpdateUser/"+n;this.showFlyout(t)},n.startOfficeInstallsFlyout=function(n){var t="/usermanagement/ManageUserOfficeInstalls/"+n;this.showFlyout(t)},n.userPostData=function(n){var i,r,t,u;if(n==null)return null;for(i=[].concat(n),r={},t=0;t<i.length;t++)u="userIds["+t+"]",r[u]=i[t];return r},n.ResizeFlyout=function(){$("#FlyoutContainer").height(window.innerHeight-50),$("#FlyoutHtmlContent").height(window.innerHeight-124),$("#FlyoutContainer").width(window.innerWidth);var n=$("#ShellBodyAndFooterContainer").scrollTop();$("#FlyoutContainer").css({top:n})},n.HideFlyoutContent=function(){return $("#FlyoutArea").hide(),$("#FlyoutContainer").hide(),$("#FlyoutTitleLabel").empty(),$("#FlyoutTitleLine").hide(),$("#FlyoutHtmlContent iframe").empty(),$("#FlyoutHtmlContent iframe").hide(),!1},n.ResetFlyoutWithLoadingGif=function(){parent.$("#FlyoutLoadingGif").show(),$("#FlyoutHtmlContent iframe").empty(),$("#FlyoutTitleLabel").empty(),$("#FlyoutTitleLine").hide()},n.ShowFlyoutContent=function(n){$("#FlyoutArea").width(n),$("#FlyoutContainer").show(),$("#FlyoutArea").show(),$("#FlyoutArea").css("overflow","auto"),$("#FlyoutArea").hasClass("FlyoutAreaStyle-rtl")?$("#FlyoutArea").animate({left:"0",transition:animationTime},animationTimeExtended):$("#FlyoutArea").animate({right:"0",transition:animationTime},animationTimeExtended),window.scrollTo(0,0)},n}();n.AdminBaseControls=t,$(document).ready(function(){t.ResizeFlyout(),$("#FlyoutArea").click(function(n){n.stopPropagation()}),$("#FlyoutHtmlContent iframe").load(function(){return parent.$("#FlyoutLoadingGif").hide(),$("#FlyoutHtmlContent").fadeIn(animationTime),$("#FlyoutHtmlContent iframe").show(),$("#FlyoutTitleLabel").text($("#FlyoutHtmlContent iframe").contents().find("body #FlyoutTitle").text()),$("#FlyoutTitleLine").show(),!1}),$("#closeFlyout").click(function(n){var i="-"+$("#FlyoutArea").width();$("#FlyoutHtmlContent").fadeOut(animationTime),$("#FlyoutArea").hasClass("FlyoutAreaStyle-rtl")?$("#FlyoutArea").animate({left:i,transition:animationTime},animationTimeExtended,t.HideFlyoutContent()):$("#FlyoutArea").animate({right:i,transition:animationTime},animationTimeExtended,t.HideFlyoutContent()),document.getElementById("ShellBodyAndFooterContainer").style.overflow="auto",n.stopPropagation()});$("body").on("EnableFlyout",function(n,i,r){return t.ResetFlyoutWithLoadingGif(),$("#FlyoutHtmlContent iframe").attr('src',i),t.ShowFlyoutContent(r),document.getElementById("ShellBodyAndFooterContainer").style.overflow="hidden",!1});$("body").on("EnableFlyoutPost",function(n,i,r,u){return t.ResetFlyoutWithLoadingGif(),$('body').append('<form action="'+i+'" method="post" target="FlyoutIframe" id="postToIframe"></form>'),$('#postToIframe').append('<input type="hidden" name="AjaxSessionKey" value="'+Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')+'" />'),(r!=null||r!=undefined)&&$.each(r,function(n,t){$('#postToIframe').append('<input type="hidden" name="'+n+'" value="'+t+'" />')}),$('#postToIframe').submit().remove(),t.ShowFlyoutContent(u),document.getElementById("ShellBodyAndFooterContainer").style.overflow="hidden",!1});$(window).resize(function(){setTimeout(t.ResizeFlyout,animationTime)})})})(O365||(O365={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){var r=this;this.$scope=n,this.$timeout=t,this.PrivateCatalogService=i,this.inProgress=!1,this.finished=!1,this.warningMessages=null,this.additionalWarningMessages=null,this.errorMessages=null,this.timeoutPromise=null,n.$on('$destroy',function(){return t.cancel(r.timeoutPromise)})}return n.prototype.SetInProgress=function(n){n===void 0&&(n=null),this.inProgress=!0,this.finished=!1,this.errorMessages=null,this.SetFocus(n)},n.prototype.SetFinished=function(n,t){if(n===void 0&&(n=null),t===void 0&&(t=null),n&&n.ResponseResult!==0){this.SetError(n);return}this.inProgress=!1,this.finished=!0,this.SetFocus(t)},n.prototype.SetWarning=function(n,t,i){t===void 0&&(t=null),i===void 0&&(i=null),this.inProgress=!1,this.finished=!0,this.warningMessages=n,this.additionalWarningMessages=t,this.SetFocus(i)},n.prototype.SetError=function(n,t){var i,r;n===void 0&&(n=null),t===void 0&&(t=null),this.inProgress=!1,this.finished=!0,i=n===null?null:n.ErrorMessages,i&&i.length>0?this.errorMessages=i:(r=n===null?null:n.ResponseResult,this.errorMessages=[this.PrivateCatalogService.GetErrorMessage(r)]),this.SetFocus(t)},n.prototype.SetFocus=function(n){n&&(this.$timeout.cancel(this.timeoutPromise),this.timeoutPromise=this.$timeout(function(){return angular.element(n).focus()},500))},n}();n.PrivateCatalogStatusIndicator=t})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var e=function(){function n(){}return n.GetWidgetDataPropertiesConfig=function(){var n={};return n[t.RDWEmailTraffic]="EmailActivity",n[t.RDWOneDriveFilesV1]="OnedriveSiteUsage",n[t.RDWSharePointActivity]="SharepointActivity",n[t.RDWTotalActivations]="ProplusActivations",n[t.RDWYammerMessages]="YammerActivity",n[t.RDWSkypeActivity]="SkypeActivity",n[t.RDWActiveUsers]="",n},n.GetReportTileDataProperty=function(t){return n.GetWidgetDataPropertiesConfig()[t]},n.GetDonutHoleSize=function(){var n=$(".report-widget").innerHeight();return n/8},n.GetPageSizesForReport=function(){return{prefetch:100,initial:2e3,addMore:2e3}},n.IsBrowserEdgeIE=function(){var r,i,t;return kendo.support.browser.msie?!0:(r=navigator.appName,r==n.BrowserNameInternetExplorerPreVersion11)?!0:r==n.BrowserNameNetscape&&((i=navigator.userAgent,t=new RegExp(n.UserAgentTridentRegex),t.exec(i)!=null)||(t=new RegExp(n.UserAgentEdgeRegex),t.exec(i)!=null))?!0:!1},n.FormatBytes=function(n,t){var f=['B','KB','MB','GB','TB','PB','EB','ZB','YB'];if(n<=0)return n+'B';var i,r=1e3,u=Math.floor(Math.log(n)/Math.log(r)),e=n/Math.pow(r,u);return i=t&&t>0?"n"+t:'n0',kendo.toString(e,i)+f[u]},n.FormatLongNumber=function(n,t){if(t===void 0&&(t=0),n==0)return'0';var i=n,r='';return n<=999?i+r:(n>=1e3&&n<=999999?(i=n/1e3,r='K'):n>=1e6&&n<=999999999?(i=n/1e6,r='M'):n>=1e9&&n<=999999999999&&(i=n/1e9,r='B'),kendo.format('{0:n'+t+'}',i)+r)},n.ParseToFloat=function(n){return isNaN(n)?n:parseFloat(n)},n.ToUTCDateString=function(n){return n?n.replace("Z",""):n},n.ToUTCDateFormat=function(n){return n?kendo.parseDate(n,'yyyy-MM-dd'):n},n.ParseKendoDate=function(n){return!n||n.length==0?'':kendo.parseDate(n,'yyyy-MM-ddTHH:mm:ss')},n.ConvertToLocalizedDateString=function(t,i){var u,r,f,e;if(i===void 0&&(i=kendo.culture().calendar.patterns.D),t){if(u=n.ParseKendoDate(t),u!=null)return kendo.toString(u,i);if(r=Date.parse(t),!isNaN(r))return f=new Date(r),e=f.getTimezoneOffset(),new Date(r+e).toLocaleDateString()}return''},n.GetToolTipTemplate=function(t,i,r,u,f){var e,s,o;return i===void 0&&(i=!1),r===void 0&&(r=!1),u===void 0&&(u=!1),f===void 0&&(f=!1),e='',e=f?n.FormatBytes(t.value,1):u?n.FormatLongNumber(t.value):kendo.format('{0:n0}',t.value),s=t.series?t.series.color:t.color,r&&(o=i?'':'<span>'+t.series.name+' </span>','<span style="color:'+s+'">'+e+': </span>'+o),o=i?'':'<span>'+t.series.name+': </span>',o+'<span style="color:'+s+'">'+e+'</span>'},n.GetDateFilter=function(n){if(n){var t=n.getMonth()+1,i=n.getDate(),r=t+"",u=i+"";return t<10&&(r="0"+t),i<10&&(u="0"+i),"Date eq "+n.getFullYear()+"-"+r+"-"+u+"T00:00:00Z"}return""},n.CheckStaleData=function(t,i,r){var u;if(r===void 0&&(r=1),u=Date.parse(i),typeof u!='undefined'){var e=new Date,o=Math.abs(e.getTime()-u),f=Math.floor(o/864e5);typeof f!='undefined'&&f!==null&&f>r&&n.LogError(["CFRV3ModernError","Data is older than"+r+" day(s)"].join("##"),t,412658)}},n.LogInfo=function(t,i,r){i===void 0&&(i=''),r===void 0&&(r=0),r==0&&(r=412656),n.Log(r,ClientLogService.LogLevel.Info,t,i)},n.LogError=function(t,i,r){i===void 0&&(i=''),r===void 0&&(r=0),r==0&&(r=412655),n.Log(r,ClientLogService.LogLevel.Warning,t,i)},n.Log=function(n,t,i,r){i===void 0&&(i=''),r===void 0&&(r=''),t||(t=ClientLogService.LogLevel.Info),typeof ClientLogService!='undefined'&&ClientLogService.WriteLogWithTagId(n,ClientLogService.Destinations.Server,t,r&&r.length>0?r:i)},n.LogErrorCallbackNoOp=function(){},n.isTimeSelectorEnabled=function(n){return n&&n.type&&n.type==f.State?!1:!0},n.BrowserNameInternetExplorerPreVersion11="Microsoft Internet Explorer",n.BrowserNameNetscape="Netscape",n.UserAgentTridentRegex="Trident/.*rv:([0-9]{1,}[\.0-9]{0,})",n.UserAgentEdgeRegex="Edge/([0-9]{1,}[\.0-9]{0,})",n.GetODataQueryParam=function(n,t){var f=t.split('?'),u,r,i;if(f.length!=2)return t;for(u=f[1].split('&'),r=0;r<u.length;r++)if(i=u[r].split('='),i[0]===n||i[0]==='$'+n||i[0]==='%24'+n)return i[1];return''},n}(),i,r,u,t,o,f,s;n.ReportsUtils=e,i=function(){function n(){}return n.prototype.GetSelectedView=function(){return this.views.length==0||this.selectedViewIndex<0||this.selectedViewIndex>this.views.length-1?undefined:this.views[this.selectedViewIndex]},n.prototype.GetSelectedViewDataProperty=function(){var n=this.GetSelectedView();return n&&n.DataPropertyName&&n.DataPropertyName.length>0?n.DataPropertyName:undefined},n.prototype.GetSelectedViewYAxisFormatString=function(){var n=this.GetSelectedView();return n&&n.YAxis&&n.YAxis.AxisFormatType&&n.YAxis.AxisFormatType.length>0?n.YAxis.AxisFormatType:undefined},n.prototype.IsStorageView=function(){var n=this.GetSelectedViewYAxisFormatString();return n&&n===u.StorageViewConstant?!0:!1},n}(),n.ReportItem=i,r=function(){function n(){this.RsDashboardText='Select a report',this.RdwEmailTrafficReceived='Received',this.RdwEmailTrafficSent='Sent',this.RdwEmailTrafficRead='Read',this.RdwEmailTrafficFiltered='Filtered',this.RdwTotalActivationsDesktop='Desktops',this.RdwTotalActivationsDevices='Devices',this.RdwSpoActivityActiveLegendText='Viewed or edited',this.RdwSpoActivityFilesSyncdLegendText='Files synced',this.RdwSpoActivityFilesSharedInternallyLegendText='Shared internally',this.RdwSpoActivityFilesSharedExternallyLegendText='Shared externally',this.RdwOneDriveStorageUsed='Storage used',this.RdwSkypeP2PLegend='Peer-to-peer',this.RdwSkypeOrganizedLegend='Organized conferences',this.RdwSkypeParticipatedLegend='Participated-in conferences',this.RdWidgetUsed='used',this.RdwYammerPosted='Posted',this.RdwYammerRead='Read',this.RdwYammerLiked='Liked',this.RdwProPlusEnabledUserCount='Enabled users',this.RdwProPlusActivatedUserCount='Activated users',this.RdwProPlusPcMacCounter='Activations on computers',this.RdwProPlusDeviceCounter='Activations on phones and tablets',this.RdwHeroExchangeTitle='Exchange',this.RdwHeroSharePointTitle='SharePoint',this.RdwHeroYammerTitle='Yammer',this.RdwActiveEntityProgressFormat='\x7b0\x7d - \x7b1\x7d of \x7b2\x7d',this.RdwDataAsOfTextTitle='Data as of\x3a \x7b0\x7d \x28UTC\x29',this.RdwPercentIncrease='Increased\x3a',this.RdwPercentDecrease='Decreased\x3a',this.RdwPercent='percent',this.RdwNoUsageData='There is no information available for \x7b0\x7d.',this.RdwProductNotBeingUsed='Looks like no one is using this product yet',this.RdwProductNotAssigned='Looks like no one is assigned this product for use yet',this.RchUserId='User ID',this.RchUserPrincipalName='User name',this.RchUserDisplayName='Display name',this.RchIsDeleted='Deleted',this.RchDeletedDate='Deleted date',this.RchLastActivityDate='Last activity date \x28UTC\x29',this.RchMailsSent='Send actions',this.RchMailsDelivered='Receive actions',this.RchMailsRead='Read actions',this.RchLicenseType='Product assigned',this.RchLastActivatedDate='Last activated date \x28UTC\x29',this.RchServicePlanName='Product licenses',this.RchPcsActivated='Windows',this.RchMacsActivated='Mac',this.RchWinActivated='Windows 10 Mobile',this.RchIosActivated='iOS',this.RchAndroidActivated='Android',this.RltBelowWarning='Good \x28under limits\x29',this.RltAboveWarning='Warning issued',this.RltAboveSend='Send prohibited',this.RltAboveSendReceive='Send\x2freceive prohibited',this.RttBelowWarningQuota='Mailboxes that are under storage quota limits',this.RttAboveWarningQuota='Mailboxes being issued quota warnings, but not blocked from sending or receiving email',this.RttAboveSendQuota='Mailboxes blocked from sending email',this.RttAboveSendReceiveQuota='Mailboxes blocked from sending and receiving email',this.RcvUnknownVersion='Undetermined',this.RcvVersionsUsed='Versions used',this.RcvOutlook2007='Outlook 2007',this.RcvOutlook2010='Outlook 2010',this.RcvOutlook2013='Outlook 2013',this.RcvOutlook2016='Outlook 2016',this.RdExport='Export',this.RdLoading='Loading\u2026',this.RdLoadMore='Load more',this.RdManageColumns='Manage columns',this.RemNoDataMessage='There is no data for this report.',this.RemErrLoadMessage='We are having trouble loading report data. Please try again later.',this.RemMissingUserNamesPartOne='We are having trouble resolving user names and have removed the erroneous records \x28',this.RemMissingUserNamesPartTwo='\x29. We are aware of this and are working on a fix.',this.RsmRecordsLoadedFormat='\x7b0\x7d records \x7b1\x7d',this.RsmRecordsLoadedOfMany='of many',this.RfmAnd='And',this.RfmOr='Or',this.RfmFilter='Filter',this.RfmInfo='Show items with value that\x3a',this.RfmClear='Clear',this.RfmOpEq='Is equal to',this.RfmOpNeq='Is not equal to',this.RfmOpStartsWith='Starts with',this.RfmOpContains='Contains',this.RfmOpDoesNotContain='Does not contain',this.RfmOpEndsWith='Ends with',this.RfmOpDateGt='Is after',this.RfmOpDateGte='Is after or equal to',this.RfmOpDateLt='Is before',this.RfmOpDateLte='Is before or equal to',this.RfmOpNumGt='Is greater than',this.RfmOpNumGte='Is greater than or equal to',this.RfmOpNumLt='Is less than',this.RfmOpNumLte='Is less than or or equal to',this.RfmColumns='Columns',this.RfmSortAscending='Sort ascending',this.RfmSortDescending='Sort descending',this.PBIDescription='Power BI let you analyze and explore insights of the Office 365 adoption',this.PBIDataPreperation='Data preparation\x3a',this.PBILearnMore='Learn more',this.PBIGoToPowerBI='Go to Power BI',this.PBILastedUpdate='\x7b0\x7d \x28UTC\x29'}return n.GetInstance=function(){return n.instance||(n.instance=new n),n.instance},n.prototype.format=function(n){for(var u=[],r,i,f,t=1;t<arguments.length;t++)u[t-1]=arguments[t];for(r=n,i=0;i<u.length;i++)f=new RegExp("\\{"+i+"\\}","gi"),r=r.replace(f,u[i]);return r},n}(),n.ReportsLocStrings=r,function(n){n.BaseState="reportsUsage",n.HelpLinkId="ReportsHelpHyperLink",n.HelpLinkDashboardHelpId="ReportsUsageOverview",n.DetailsGridElement="reportdetailsgrid",n.StorageViewConstant="storage",n.FirstTimeRendered=!0,n.DefaultDecimalpoints=2,n.PBIUrl="https://powerbi.microsoft.com/",n.PBIHelpLink="https://support.office.com",n.PBIBackfillcompleted="completed",n.PBIDateFormat="MMM dd, yyyy"}(u=n.ReportConstants||(n.ReportConstants={})),function(n){n.RDWTotalSeats="RDWTotalSeats",n.RDWEmailTraffic="RDWEmailTraffic",n.RDWOneDriveFilesV1="RDWOneDriveFilesV1",n.RDWSharePointActivity="RDWSharePointActivity",n.RDWTotalActivations="RDWTotalActivations",n.RDWYammerMessages="RDWYammerMessages",n.RDWSkypeActivity="RDWSkypeActivity",n.RDWActiveUsers="RDWActiveUsers",n.RDWPowerBI="RDWPowerBI"}(t=n.WidgetIds||(n.WidgetIds={})),function(n){n.EmailActivityReportId="EmailActivityAggregateReport",n.SharePointSiteUsageReportId="SharePointSiteUsageReport",n.OneDriveSiteUsageReportId="OneDriveSiteUsageReport",n.ProPlusReportId="O365ProPlusActivationsReport",n.SkypeActivityReportId="SkypeActivityReport",n.SkypeP2PActivityReportId="SkypeP2PActivityReport",n.SkypeOrganizerActivityReportId="SkypeOrganizerActivityReport",n.SkypeParticipantActivityReportId="SkypeParticipantActivityReport",n.SkypeClientsUsedReportId="SkypeClientsUsedReport",n.YammerActivityReportId="YammerActivityReport",n.YammerClientsUsedReportId="YammerClientsUsedReport",n.EmailStorageReportId="EmailStorageReport",n.SharePointActivityReportId="SharePointActivityReport",n.OneDriveActivityReportId="OneDriveActivityReport",n.O365GroupsReportId="O365GroupsActivityReport",n.LicenseActivityReportId="LicenseActivityReport",n.EmailClientsUsedReportId="EmailClientsReport"}(o=n.ReportIds||(n.ReportIds={})),function(n){n.State="State",n.Activity="Activity",n.StateMetric="StateMetric"}(f=n.ReportProcessingTypes||(n.ReportProcessingTypes={})),function(n){n.FilterChangeBroadcastEventNeeded="ChangeReportFilterNeeded",n.FilterChangeBroadcastEvent="ChangeReportFilter",n.TimeSelectorChangeNeededEvent="TimeSelectorChangeNeeded",n.TimeSelectorChangeBroadcastEvent="TimeSelectorChange",n.SeriesClickBroadcastEvent="SeriesClick",n.ReportIdChanged="ReportidChangedEvent"}(s=n.ReportEventNames||(n.ReportEventNames={}))})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){this.$q=n,this.$http=t,this.HttpService=i}return n.prototype.GetApps=function(){var n="/admin/api/settings/services";return this.$http({url:n,method:'GET',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(n){return n})},n.prototype.GetSettingDetails=function(n){var t="/admin/api/settings/apps/"+n,i=[];return this.$http.get(t,i).success(function(n){return n}).error(function(n){return n})},n.prototype.GetMailSettings=function(){var n="/admin/api/settings/apps/mail",t=[];return this.$http.get(n,t).success(function(n){return n}).error(function(n){return n})},n.prototype.GetCalendarSettings=function(){var n="/admin/api/settings/apps/calendarsharing",t=[];return this.$http.get(n,t).success(function(n){return n}).error(function(n){return n})},n.prototype.UpdateSetting=function(n){var t="/admin/api/settings/apps/"+n.AppId;return this.$http({method:'POST',url:t,data:n,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(){console.log("Error saving setting"+n.AppName)})},n.prototype.GetSMBEntitledApps=function(){var i="/admin/api/tenant/getentitledapps",t=this.$q.defer(),n={};return this.HttpService.Get(i,[],!1).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,t.reject(n)}),t.promise},n.prototype.GetAppPermission=function(n){var r="/admin/api/tenant/userapppermission/"+n,i=this.$q.defer(),t={};return this.HttpService.Get(r,[],!1).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,i.reject(t)}),i.promise},n.prototype.UpdateSMBEntitledApps=function(n){var r="/admin/api/tenant/updateappsstatus",i=this.$q.defer(),t={},u=[];return this.HttpService.Post(r,n,u).success(function(n){t=n,i.resolve(t)}).error(function(n){t=n,i.reject(t)}),i.promise},n.prototype.UpdateUserAppAccess=function(n,t,i){return i?this.AddUserAppAccess(n,t):this.DeleteUserAppAccess(n,t)},n.prototype.AddUserAppAccess=function(n,t){var u="/admin/api/tenant/assignapppermission/"+n,r=this.$q.defer(),i={},f=[];return this.HttpService.Put(u,t,f).success(function(n){i=n,r.resolve(i)}).error(function(n){i=n,r.reject(i)}),r.promise},n.prototype.DeleteUserAppAccess=function(n,t){var u="/admin/api/tenant/assignapppermission/"+n,r=this.$q.defer(),i={},f=[];return this.HttpService.Delete(u,t,f).success(function(n){i=n,r.resolve(i)}).error(function(n){i=n,r.reject(i)}),r.promise},n.$inject=["$q","$http","HttpService"],n}();n.AppsService=t,AdminApp.service("AppsService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){this.$q=n,this.$http=t,this.HttpService=i,this.$cacheFactory=r,this.$rootScope=u,this.userDetails={ObjectId:null,FirstName:null,LastName:null,JobTitle:null,Department:null,Office:null,UserAlternateEmail:null,UserPrincipalName:null,DisplayName:null,OfficePhone:null,MobilePhone:null,FaxNumber:null,StreetAddress:null,City:null,StateProvince:null,PrimaryEmailAddress:null,ZipOrPostalCode:null,CountryRegion:null,ShowOfficeInstallsLink:!1,UpnEqualsSmtp:!0,SyncType:null,IsDirSyncEnabled:!1,HasExchangeSku:!1,HasExchangeLicense:!1,IsProvisioned:!1,IsAdminUser:!1,IsMailboxPermissionEnabled:!1,SignInStatus:!1,EmailAddresses:[],EmailAliases:[],Licenses:[],UserRoles:[],MailboxFullAccessMember:[],MailboxSendAsMember:[],MailboxSendOnBehalfMember:[],MailboxConnectivity:[],MailboxAutoReplyConfiguration:[],MailboxDeliverToMailboxAndForward:!1,MailboxForwardingSmtpAddress:null,MailboxForwardingAddress:null,MailboxForwardingEnabled:!1,DeletedTime:null,Devices:[]},this.activeUserData={SelectedUserDetails:this.userDetails,SelectedUserId:null,SelectedUsers:[],ListModel:[],ListContext:null,MailboxConnectivity:[],MailboxAutoReplyConfiguration:[]},this.guestUserView="04bb2711-a037-4460-a9f7-14c976060ae5"}return n.prototype.GetActiveUserData=function(){return this.activeUserData},n.prototype.GetSelectedUserDetails=function(){return this.userDetails},n.prototype.SearchUser=function(n,t,i,r,u,f){var e;return e=f?"/admin/api/Users/ListDeletedUsers":"/admin/api/Users/ListUsers",this.$http({method:'POST',url:e,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:{ListAction:-1,ListContext:null,SearchText:n,SelectedView:t,SelectedViewType:i,SortDirection:r,SortPropertyName:u}}).success(function(n){return n.Users}).error(function(){console.log("Error in ListView Search")})},n.prototype.GetUserDetails=function(n,t){t===void 0&&(t=!1);var r=this.$q.defer(),u="/admin/api/Users/"+n,f=!t,e=[],i={};return this.HttpService.Get(u,e,f).success(function(n){i.data=n,r.resolve(i)}).error(function(n){i.data=n,console.log("Error in Get User Details api call"),r.reject(i)}),r.promise},n.prototype.GetUserUsageLocation=function(n){var t="/admin/api/Users/getusagelocation/"+n,i=[];return this.HttpService.Get(t,i,!1)},n.prototype.GetUserMailboxInfo=function(n){var i=this.$q.defer(),r="/admin/api/Users/"+n+"/mailbox",u=[],t={};return this.HttpService.Get(r,u,!0).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in Get User mailbox info api call"),i.reject(t)}),i.promise},n.prototype.GetResolvedForwardAddress=function(n){var i=this.$q.defer(),r="/admin/api/users/getresolvedforwardaddress/"+n.ObjectId,u={name:n.MailboxForwardingAddress},t={};return this.HttpService.Get(r,u,!1).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in resolving mailbox forward address"),i.reject(t)}),i.promise},n.prototype.GetMailboxConnectivity=function(n){var i=this.$q.defer(),r="/admin/api/users/"+n+"/MailboxConnectivity",u=[],t={};return this.HttpService.Get(r,u,!0).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in Get User mailbox connectivity info api call"),i.reject(t)}),i.promise},n.prototype.SetMailboxConnectivity=function(n,t){var r=this.$q.defer(),u="/admin/api/users/MailboxConnectivity",f="/admin/api/users/"+n+"/MailboxConnectivity",i={};return this.HttpService.Put(u,t,f).success(function(n){i.data=n,r.resolve(i)}).error(function(t){i.data=t,console.log("Error in update mailbox connectivity"+n),r.reject(i)}),r.promise},n.prototype.GetMailboxAutoReplyConfiguration=function(n){var i=this.$q.defer(),r="/admin/api/users/"+n+"/MailboxAutoReplyConfiguration",u=[],t={};return this.HttpService.Get(r,u,!0).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in Get User mailbox AutoReplyConfiguration info api call"),i.reject(t)}),i.promise},n.prototype.SetMailboxAutoReplyConfiguration=function(n,t){var r=this.$q.defer(),u="/admin/api/users/MailboxAutoReplyConfiguration",f="/admin/api/users/"+n+"/MailboxAutoReplyConfiguration",i={};return this.HttpService.Put(u,t,f).success(function(n){i.data=n,r.resolve(i)}).error(function(t){i.data=t,console.log("Error in update mailbox AutoReplyConfiguration"+n),r.reject(i)}),r.promise},n.prototype.GetUserChangePasswordLink=function(){var t=this.$q.defer(),i="/admin/api/Users/ChangePasswordLink",r=[],n={};return this.HttpService.Get(i,r,!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,t.reject(n)}),t.promise},n.prototype.GetDeletedUserDetails=function(n,t){t===void 0&&(t=!1);var r=this.$q.defer(),u="/admin/api/Users/DeletedUser/"+n,f=!t,e=[],i={};return this.HttpService.Get(u,e,f).success(function(n){i.data=n,r.resolve(i)}).error(function(n){i.data=n,console.log("Error in Get Deleted User Email alias api call"),r.reject(i)}),r.promise},n.prototype.GetCurrentUser=function(){var i="/admin/api/Users/currentuser",r=[],t=this.$q.defer(),n={};return this.HttpService.Get(i,r,!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in Get Current User api call"),t.reject(n)}),t.promise},n.prototype.GetUserMailingAddress=function(n){var i="/admin/api/Users/"+n+"/usermailingaddress",r=[],t=this.$q.defer();return this.HttpService.Get(i,r,!0).success(function(n){t.resolve(n)}).error(function(n){console.log("Error in Get Current User api call"),t.reject(n)}),t.promise},n.prototype.GetDefaultUserList=function(n,t){var i="/admin/api/Users/ListUsers";return this.$http({method:'POST',url:i,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:{SortDirection:n,SortPropertyName:t}}).success(function(n){return n.Users}).error(function(){console.log("Error in ListView Init")})},n.prototype.GetUserListForSKU=function(n,t,i,r,u,f){var s={ListAction:u,ListContext:f,SelectedViewType:"9",SortDirection:n,SortPropertyName:t,SelectedView:i,SkuPartNumber:r},o=this.$q.defer(),h="/admin/api/Users/ListUsers",e={},c=[];return this.HttpService.Post(h,s,c).success(function(n){e=n,o.resolve(e)}).error(function(n){e=n,O365.Log.WriteLog(418332,O365.LogLevel.Error,O365.LogArea.UserManagement,O365.LogParameter.Empty,"Error in licensed user filter for a SKU"),console.log("Error in licensed user filter for a SKU"),o.reject(e)}),o.promise},n.prototype.GetDefaultDeletedUserList=function(n,t){var i="/admin/api/Users/ListDeletedUsers";return this.$http({method:'POST',url:i,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:{SortDirection:n,SortPropertyName:t}}).success(function(n){return n.Users}).error(function(){console.log("Error in ListView Init")})},n.prototype.GetGuestUsersList=function(){var i=[],n={},t=this.$q.defer(),r="/admin/api/Users/ListExternalGuestUsers",u={PageToken:null};return this.HttpService.Post(r,u,i).success(function(i){n=i,t.resolve(n)}).error(function(i){n=i,O365.Log.WriteLog(425838,O365.LogLevel.Error,O365.LogArea.UserManagement,O365.LogParameter.Empty,"Error in Guest User filter"),t.reject(n)}),t.promise},n.prototype.GetNextListUserPage=function(n,t,i,r){var s=[],u={},e=this.$q.defer(),f="",o={};return t==this.guestUserView?(f="/admin/api/Users/ListExternalGuestUsers",o={PageToken:r}):(f=n?"/admin/api/Users/ListDeletedUsers":"/admin/api/Users/ListUsers",o={ListAction:1,ListContext:r,SearchText:null,SelectedView:t,SelectedViewType:i,ServerContext:null}),this.HttpService.Post(f,o,s).success(function(n){u=n,e.resolve(u)}).error(function(n){u=n,O365.Log.WriteLog(418332,O365.LogLevel.Error,O365.LogArea.UserManagement,O365.LogParameter.Empty,"Error in Get Next Page"),e.reject(u)}),e.promise},n.prototype.RefreshUserList=function(n,t,i,r){var e=[],u={},f=this.$q.defer(),o,s,h,c;return n==this.guestUserView?(o="/admin/api/Users/ListExternalGuestUsers",s={PageToken:null},this.HttpService.Post(o,s,e).success(function(n){u=n,f.resolve(u)}).error(function(n){u=n,O365.Log.WriteLog(418332,O365.LogLevel.Error,O365.LogArea.UserManagement,O365.LogParameter.Empty,"Error in Guest User filter"),console.log("Error in Guest User filter"),f.reject(u)})):(h="/admin/api/Users/ListUsers",c={ListAction:-1,ListContext:null,SearchText:null,SelectedView:n,SelectedViewType:t,ServerContext:null,SortDirection:i,SortPropertyName:r},this.HttpService.Post(h,c,e).success(function(n){u=n,f.resolve(u)}).error(function(n){u=n,O365.Log.WriteLog(418332,O365.LogLevel.Error,O365.LogArea.UserManagement,O365.LogParameter.Empty,"Error in ListView"),console.log("Error in ListView "),f.reject(u)})),f.promise},n.prototype.GetBillingNotificationsUser=function(n,t,i,r){var u="/admin/api/Users/ListBillingNotificationsUsers";return this.$http({method:'POST',url:u,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:{ListAction:-1,ListContext:null,SearchText:null,SelectedView:n,SelectedViewType:t,ServerContext:null,SortDirection:i,SortPropertyName:r}}).success(function(n){return n}).error(function(){console.log("Error in ListView Search")})},n.prototype.GetNextBillingNotificationsUser=function(n,t,i){var r="/admin/api/Users/ListBillingNotificationsUsers";return this.$http({method:'POST',url:r,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:{ListAction:1,ListContext:i,SearchText:null,SelectedView:n,SelectedViewType:t,ServerContext:null}}).success(function(n){return n}).error(function(){console.log("Error in Get Next page")})},n.prototype.GetUserViews=function(){var i="/admin/api/tenant/getuserviews",r=[],t=this.$q.defer(),n={};return this.HttpService.Get(i,r,!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in Get User Views \ filters api call"),t.reject(n)}),t.promise},n.prototype.GetCurrentUserview=function(n){return this.$http.get("/admin/api/tenant/"+n+"/getcurrentuserview",[]).success(function(n){return n}).error(function(){console.log("Error in ListView Init")})},n.prototype.GetUserDomains=function(){var n="/admin/api/tenant/domains?includeFederatedDomains=true";return this.$http.get(n,[]).success(function(n){return n}).error(function(){console.log("Error in getting domains")})},n.prototype.GetAddUserPageDefaults=function(){var i="/admin/api/users/new/options",r=[],t=this.$q.defer(),n={};return this.HttpService.Get(i,r,!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in GetAddUserPageDefaults."),t.reject(n)}),t.promise},n.prototype.GetUserDomainInfo=function(){var i="/admin/api/users/new/domains",r=[],t=this.$q.defer(),n={};return this.HttpService.Get(i,r,!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in GetUserDomainInfo."),t.reject(n)}),t.promise},n.prototype.GetAdminRoles=function(){var i="/admin/api/roles",r=[],t=this.$q.defer(),n={};return this.HttpService.Get(i,r,!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in getting the Admin roles."),t.reject(n)}),t.promise},n.prototype.GetUserAdminRoles=function(n){var r="/admin/api/roles/"+n+"/roles",u=[],i=this.$q.defer(),t={};return this.HttpService.Get(r,u,!0).success(function(n){t.data=n,i.resolve(t)}).error(function(r){t.data=r,console.log("Error in getting the Admin roles for user with UID: "+n),i.reject(t)}),i.promise},n.prototype.RestoreUser=function(n){var i=this.$q.defer(),r=n.UserId,u="/admin/api/users/restore",f="/admin/api/Users/DeletedUser/"+r,t={};return this.HttpService.Post(u,n,f).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in Restore user"+r),i.reject(t)}),i.promise},n.prototype.UpdateAlias=function(n,t,i,r,u){var e=this.$q.defer(),o="/admin/api/users/"+n+"/updateAlias?userName="+i+"&newPrimaryEmailAddress="+t+"&hasExchangeLicense="+u,s="/admin/api/Users/"+n+"/mailbox",f={};return this.HttpService.Put(o,r,s).success(function(n){f.data=n,e.resolve(f)}).error(function(t){f.data=t,console.log("Error in update Alias"+n),e.reject(f)}),e.promise},n.prototype.ConvertUser=function(n){var i=this.$q.defer(),r="/admin/api/users/"+n+"/convert",f=null,u="/admin/api/Users/"+n+"/mailbox",t={};return this.HttpService.Put(r,null,u).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,i.reject(t)}),i.promise},n.prototype.UpdateContactInformation=function(n,t){var r=this.$q.defer(),u="/admin/api/users/"+n+"/contactInformation",f="/admin/api/Users/"+n,i={};return this.HttpService.Put(u,t,f).success(function(n){i.data=n,r.resolve(i)}).error(function(t){i.data=t,O365.Log.WriteLog(418324,O365.LogLevel.Error,O365.LogArea.UserManagement,O365.LogParameter.Empty,"Error in updating the contact information for user with UID: "+n),r.reject(i)}),r.promise},n.prototype.UpdateSigninStatus=function(n,t){var r=this.$q.defer(),u="/admin/api/users/"+n+"/signinstatus?isAllowed="+t,f="/admin/api/Users/"+n,i={};return this.HttpService.Put(u,null,f).success(function(n){i.data=n,r.resolve(i)}).error(function(t){i.data=t,O365.Log.WriteLog(423824,O365.LogLevel.Error,O365.LogArea.UserManagement,O365.LogParameter.Empty,"Error in updating the sign-in status of the user with UID: "+n+" result : "+t),r.reject(i)}),r.promise},n.prototype.UpdateUserRoles=function(n,t){var r=this.$q.defer(),u=["/admin/api/roles/"+n+"/roles","/admin/api/Users/"+n],f="/admin/api/users/"+n+"/userroles",i={};return this.HttpService.Put(f,t,u).success(function(n){i.data=n,r.resolve(i)}).error(function(t){i.data=t,console.log("Error in Update Roles for user with UID: "+n),r.reject(i)}),r.promise},n.prototype.UpdateBulkUserRoles=function(n){var i=this.$q.defer(),u="/admin/api/users/bulkupdateuserroles",t={},r=[];return angular.forEach(n.UserIds,function(n){r.push("/admin/api/Users/"+n)}),this.HttpService.Post(u,n,r).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,O365.Log.WriteLog(418332,O365.LogLevel.Error,O365.LogArea.UserManagement,O365.LogParameter.Empty,"Error while updating bulk user roles"),console.log("Error while updating bulk user roles"),i.reject(t)}),i.promise},n.prototype.GetTenantProducts=function(){return this.$http.get("/admin/api/users/products",[]).success(function(n){return n}).error(function(n){return n})},n.prototype.GetUserProducts=function(n){var r="/admin/api/users/"+n+"/assignedproducts",u=[],i=this.$q.defer(),t={};return this.HttpService.Get(r,u,!1).success(function(n){t.data=n,i.resolve(t)}).error(function(r){t.data=r,console.log("Error in getting the User Products for user with UID: "+n),i.reject(t)}),i.promise},n.prototype.GetMailboxPermissions=function(n){var i=this.$q.defer(),r="/admin/api/Users/"+n+"/mailboxpermissions",u=[],t={};return this.HttpService.Get(r,u,!0).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in Get User mailbox permission info api call"),i.reject(t)}),i.promise},n.prototype.UpdateMailboxMembers=function(n,t){var r=this.$q.defer(),u="/admin/api/users/mailboxMembers",f="/admin/api/Users/"+n+"/mailboxpermissions",i={};return this.HttpService.Put(u,t,f).success(function(n){i.data=n,r.resolve(i)}).error(function(t){i.data=t,console.log("Error in update mailbox permission"+n),r.reject(i)}),r.promise},n.prototype.UpdateMailboxMailForwarding=function(n,t){var r=this.$q.defer(),u="/admin/api/users/mailforwarding",f="/admin/api/Users/"+n+"/mailbox",i={};return this.HttpService.Put(u,t,f).success(function(n){i.data=n,r.resolve(i)}).error(function(t){i.data=t,console.log("Error in update forwarding"+n),r.reject(i)}),r.promise},n.prototype.UpdateEmailAddressesUPN=function(n,t){var r=this.$q.defer(),u="/admin/api/users/emailaddressesupn",f=["/admin/api/Users/"+n+"/mailbox","/admin/api/Users/"+n],i={};return this.HttpService.Put(u,t,f).success(function(n){i.data=n,r.resolve(i)}).error(function(t){i.data=t,console.log("Error in update email addresses or upn"+n),r.reject(i)}),r.promise},n.prototype.GetSubscriptions=function(n,t){var u="/admin/api/commerce/users/add/required-additional-licenses?productskuid="+n+"&numOfNewUser="+t,f=[],r=this.$q.defer(),i={};return this.HttpService.Get(u,f,!1).success(function(n){i.data=n,r.resolve(i)}).error(function(n){i.data=n,console.log("Error in getting the GetSubscriptions"),r.reject(i)}),r.promise},n.prototype.GetProductAppIcons=function(n){var r="/admin/api/commerce/products/"+n+"/appicons",u=[],i=this.$q.defer(),t={};return this.HttpService.Get(r,u,!0).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in getting the product app icons."),i.reject(t)}),i.promise},n.prototype.GetOfferUnitPrices=function(n){var r="/admin/api/commerce/products/"+n+"/unit-prices?countryCode=",u=[],i=this.$q.defer(),t={};return this.HttpService.Get(r,u,!1).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in getting the offer unit price."),i.reject(t)}),i.promise},n.prototype.GetSubscriptionPrice=function(n){var r="/admin/api/commerce/subscriptions/prices?ids="+n,u=[],i=this.$q.defer(),t={};return this.HttpService.Get(r,u,!1).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in GetSubscriptionPrice call"),i.reject(t)}),i.promise},n.prototype.GetLocations=function(){var i="/admin/api/locations",r=[],t=this.$q.defer(),n={};return this.HttpService.Get(i,r,!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in GetLocations call"),t.reject(n)}),t.promise},n.prototype.UpdateProducts=function(n,t,i){var u=this.$q.defer(),f=[],e,r;return angular.forEach(n,function(n){f.push("/admin/api/users/"+n.UserId+"/assignedproducts"),f.push("/admin/api/Users/"+n.UserId)}),e="/admin/api/users/setUserProducts?countryCode="+t+"&mode="+i,r={},this.HttpService.Put(e,n,f).success(function(n){r.data=n,u.resolve(r)}).error(function(n){r.data=n,u.reject(r)}),u.promise},n.prototype.UpdateQuantity=function(n){var t="/admin/api/commerce/subscriptions/update-quantity";return this.$http({method:'POST',url:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:n}).success(function(n){return n}).error(function(n){return n})},n.prototype.IsAdditionalQuantityUpdated=function(n){var t="/admin/api/commerce/products/consumption?productSkuIds="+n;return this.$http.get(t,[]).success(function(n){return n}).error(function(n){return console.log("Error in getting IsAdditionalQuantityUpdated."),n})},n.prototype.CreateUser=function(n){var t="/admin/api/users";return this.$http({method:'POST',url:t,data:n,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(n){return n})},n.prototype.DeleteUsers=function(n){var r="/admin/api/users/delete",u=null,i=this.$q.defer(),t={};return this.HttpService.Delete(r,n,u).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in DeleteUsers"),i.reject(t)}),i.promise},n.prototype.GetUserOfficeInstalls=function(n){var r="/admin/api/users/"+n+"/officeInstalls",u=[],i=this.$q.defer(),t={};return this.HttpService.Get(r,u,!0).success(function(n){t.data=n,i.resolve(t)}).error(function(r){t.data=r,console.log("Error in getting the GetUserOfficeInstalls for user with UID: "+n),i.reject(t)}),i.promise},n.prototype.DeactivateOfficeInstall=function(n){var r="/admin/api/users/deactivateInstall",u="/admin/api/users/"+n.ObjectId+"/officeInstalls",i=this.$q.defer(),t={};return this.HttpService.Put(r,n,u).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in DeactivateOfficeInstall"),i.reject(t)}),i.promise},n.prototype.ResetUserPassword=function(n){var t="/admin/api/users/passwordreset";return this.$http({method:'PUT',url:t,data:n,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(n){return n})},n.prototype.SendSingleUserPasswordEmail=function(n){var i=this.$q.defer(),r="/admin/api/users/sendsingleuserpasswordemail",t={};return this.HttpService.Post(r,n,null).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,i.reject(t)}),i.promise},n.prototype.SendBulkUserPasswordEmail=function(n){var i=this.$q.defer(),r="/admin/api/users/sendbulkuserpasswordemail",t={};return this.HttpService.Post(r,n,null).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,i.reject(t)}),i.promise},n.prototype.IsSelfUser=function(n){return n===this.$rootScope.CurrentUserInfo.UserInfo.UserPrincipalName},n.prototype.GetCustomViewFilterDefaults=function(){var n="/admin/api/tenant/getcustomviewfilterdefaults";return this.$http({method:'GET',url:n}).success(function(n){return n}).error(function(n){return n})},n.prototype.AddCustomFilter=function(n){var i=this.$q.defer(),r="/admin/api/tenant/addcustomviewfilter",u="/admin/api/tenant/getuserviews",t={};return this.HttpService.Post(r,n,u).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in AddCustomFilter"),i.reject(t)}),i.promise},n.prototype.EditCustomFilter=function(n){var r="/admin/api/tenant/editcustomviewfilter",u="/admin/api/tenant/getuserviews",i=this.$q.defer(),t={};return this.HttpService.Put(r,n,u).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in EditCustomFilter"),i.reject(t)}),i.promise},n.prototype.DeleteView=function(n){var r="/admin/api/tenant/deletecustomviewfilter?objectId="+n,u="/admin/api/tenant/getuserviews",i=this.$q.defer(),t={};return this.HttpService.Delete(r,[],u).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in DeleteView"),i.reject(t)}),i.promise},n.prototype.GetUserGroups=function(n){var r="/admin/api/users/"+n+"/groups",u={searchText:null},i=this.$q.defer(),t={};return this.HttpService.Get(r,u,!1).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in get user groups"),i.reject(t)}),i.promise},n.prototype.UpdateUserGroups=function(n,t){var u="/admin/api/users/"+n+"/groups",f=["/admin/api/users/"+n+"/groups","/admin/api/Users/"+n],r=this.$q.defer(),i={};return this.HttpService.Put(u,t,f).success(function(n){i.data=n,r.resolve(i)}).error(function(n){i.data=n,console.log("Error in get user groups"),r.reject(i)}),r.promise},n.prototype.GetBulkAddUserTemplateAndSampleUrl=function(){var i="/admin/api/users/getbulkaddusertemplateandsampleurl",t=this.$q.defer(),n={};return this.HttpService.Get(i,[],!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,t.reject(n)}),t.promise},n.prototype.BulkAddUsers=function(n){var t="/admin/api/users/BulkAddUser";return this.$http({method:'POST',url:t,data:n,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(n){return n})},n.prototype.GetUserLight=function(n){var i=this.$q.defer(),r="/admin/api/users/"+n+"/userLight",t={};return this.$http({method:'GET',url:r,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){t.data=n,i.resolve(t)}).error(function(n){O365.Log.WriteLog(417548,O365.LogLevel.Error,O365.LogArea.ModernAdminPortal,O365.LogParameter.Empty),t.data=n,i.reject(t)})},n.prototype.SignOut=function(n){var i=this.$q.defer(),r="/admin/api/users/signout?returnFeature="+n,u=[],t={};return this.HttpService.Get(r,u,null).success(function(n){t.data=n,i.resolve(t)}).error(function(r){t.data=r,console.log("Error in get sign out url with return feature: "+n),i.reject(t)}),i.promise},n.prototype.BulkUpdateContactInformation=function(n){var i=this.$q.defer(),u="/admin/api/users/bulkupdatecontactinformation",r=[],t;return angular.forEach(n.UserObjectIds,function(n){r.push("/admin/api/Users/"+n)}),t={},this.HttpService.Put(u,n,r).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in bulk updating user contact information"),O365.Log.WriteLog(418324,O365.LogLevel.Error,O365.LogArea.UserManagement,O365.LogParameter.Empty,"Error in bulk updating user contact information"),i.reject(t)}),i.promise},n.prototype.BulkUpdateSignInStatus=function(n){var i=this.$q.defer(),u="/admin/api/users/bulkupdatesigninstatus",r=[],t;return angular.forEach(n.UserObjectIds,function(n){r.push("/admin/api/Users/"+n)}),t={},this.HttpService.Put(u,n,r).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,O365.Log.WriteLog(418324,O365.LogLevel.Error,O365.LogArea.UserManagement,O365.LogParameter.Empty,"Error in bulk updating user signin status"),i.reject(t)}),i.promise},n.prototype.UpdateUserDomain=function(n){var i=this.$q.defer(),u="/admin/api/users/bulkupdatedomaininformation",r=[],t;return angular.forEach(n.UserObjectIds,function(n){r.push("/admin/api/Users/"+n)}),t={},this.HttpService.Put(u,n,r).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in bulk updating user domain information"),i.reject(t)}),i.promise},n.prototype.GetContextMenuHelp=function(n){var i=this.$q.defer(),r=[],u="/admin/api/users/"+n+"/getcontexthelpmenu",t={};return this.HttpService.Get(u,r,!0).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,i.reject(t)}),i.promise},n.prototype.GetUserOneDriveSiteSettings=function(n){var r="/admin/api/users/"+n+"/sitesetting",i=this.$q.defer(),t={};return this.HttpService.Get(r,[],!1).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in get user oneDrive settings"),i.reject(t)}),i.promise},n.prototype.SignOutUserO365Sessions=function(n){var r="/admin/api/users/"+n+"/signoutOffice365",i=this.$q.defer(),t={};return this.HttpService.Get(r,[],!1).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in signing out user Office 365 sessions"),i.reject(t)}),i.promise},n.prototype.SetUserOneDriveSharingCapability=function(n,t){var u="/admin/api/users/"+n+"/odbsharing/"+t,r=this.$q.defer(),i={};return this.HttpService.Post(u,[],u).success(function(n){i.data=n,r.resolve(i)}).error(function(n){i.data=n,console.log("Error in set user oneDrive sharaing settings"),r.reject(i)}),r.promise},n.prototype.SetUserOneDriveGuestInviteCapability=function(n,t){var u="/admin/api/users/"+n+"/linksharing/"+t,r=this.$q.defer(),i={};return this.HttpService.Post(u,[],!1).success(function(n){i.data=n,r.resolve(i)}).error(function(n){i.data=n,console.log("Error in set user oneDrive gueest invite settings"),r.reject(i)}),r.promise},n.prototype.AccessUserOneDrive=function(n){var r="/admin/api/users/"+n+"/accessodb",i=this.$q.defer(),t={};return this.HttpService.Get(r,[],!1).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in access user oneDrive"),i.reject(t)}),i.promise},n.prototype.SetUserOneDriveStorage=function(n,t){var i="/admin/api/users/"+n+"/odbquota",r=this.$q.defer();this.HttpService.Put(i,t,i).success(function(n){r.resolve(n)}).error(function(n){console.log("Error in update user odb quota api call"),r.reject(n)})},n.prototype.GetUserDashboardPreferences=function(){var i="/admin/api/users/dashboardpreferences",t=this.$q.defer(),n={};return this.HttpService.Get(i,[],!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,t.reject(n)}),t.promise},n.prototype.SaveUserDashboardPreferences=function(n){var i="/admin/api/users/dashboardpreferences",r="/admin/api/users/dashboardpreferences",t=this.$q.defer();return this.HttpService.Post(i,n,r).success(function(n){t.resolve(n)}).error(function(n){t.reject(n)}),t.promise},n.prototype.InviteUser=function(n){var i="/admin/api/tenant/inviteuser",r={},t=this.$q.defer();return this.HttpService.Post(i,n,null).success(function(n){t.resolve(n)}).error(function(n){t.reject(n)}),t.promise},n.prototype.GetIntuneDevices=function(n){var i=this.$q.defer(),r="/admin/api/users/devices",t={};return this.HttpService.Post(r,n,null).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in get intune devices call"),i.reject(t)}),i.promise},n.$inject=["$q","$http","HttpService","$cacheFactory","$rootScope"],n}(),i;n.UserManagementService=t,AdminApp.service("UserManagementService",t),i=function(){function n(){}return n}(),n.DeleteUserModel=i})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){this.$q=n,this.$http=t,this.HttpService=i,this.$cacheFactory=r,this.$rootScope=u,this.cachedUrls={}}return n.prototype.GetSharedMailboxDetails=function(n){var t="/admin/api/SharedMailbox/"+n,i=[];return this.$http.get(t,i).success(function(n){return n.User}).error(function(){})},n.prototype.GetSharedMailboxes=function(n,t,i,r){var u="/admin/api/sharedmailbox/GetSharedMailboxes",f={SearchString:i,SortField:t,SortDirection:n,NextLink:r};return this.$http({url:u,data:f,method:'POST',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(){})},n.prototype.CheckSharedMailboxWasCreated=function(n){var t="/admin/api/sharedmailbox/sharedMailboxExist/"+n;return this.$http.get(t,[]).success(function(n){return n}).error(function(n){return console.log("Error in check SharedMailbox Creation."),n})},n.prototype.DeleteSharedMailbox=function(n){var t="/admin/api/sharedmailbox";return this.$http({method:'POST',url:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),'X-HTTP-Method-Override':'DELETE'},data:n}).success(function(n){return n}).error(function(){console.log("Error deleting shared mailbox")})},n.prototype.GetAddSharedMailboxDefaults=function(){return this.$http.get("/admin/api/sharedmailbox/new/options").success(function(n){return n}).error(function(){console.log("Error in getting Add Sharemailbox defaults")})},n.prototype.GetResolvedForwardAddress=function(n){var i=this.$q.defer(),r="/admin/api/sharedmailbox/getresolvedforwardaddress/"+n.SharedMailboxId,u={name:n.SharedMailboxForwardingAddress},t={};return this.HttpService.Get(r,u,!0).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in resolving Shared mailbox forward address"),i.reject(t)}),i.promise},n.prototype.SaveSharedMailbox=function(n){var t="/admin/api/sharedmailbox";return this.$http({method:'POST',url:t,data:n,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(){console.log("Error saving sharedmailbox")})},n.prototype.UpdateSharedMailboxInformation=function(n){var t="/admin/api/sharedmailbox";return this.$http({method:'POST',url:t,data:n,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),'X-HTTP-Method-Override':'PUT'}}).success(function(n){return n}).error(function(){})},n.prototype.UpdateSharedMailboxMailForwarding=function(n){var t="/admin/api/sharedmailbox/mailforwarding";return this.$http({method:'POST',url:t,data:n,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),'X-HTTP-Method-Override':'PUT'}}).success(function(n){return n}).error(function(){})},n.prototype.UpdateSharedMailboxSentItems=function(n){var t="/admin/api/sharedmailbox/sentitems";return this.$http({method:'POST',url:t,data:n,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),'X-HTTP-Method-Override':'PUT'}}).success(function(n){return n}).error(function(){})},n.prototype.UpdateSharedMailboxMembers=function(n,t){var u=this.$q.defer(),o="/admin/api/sharedmailbox/sharedMailboxMembers",i="/admin/api/sharedmailbox/sharedMailboxPermissions/"+n,r={},f=[],e=this;return this.cachedUrls[i]!==undefined&&(f=this.cachedUrls[i]),this.HttpService.Put(o,t,f).success(function(n){r.data=n,u.resolve(r),e.cachedUrls[i]!==undefined&&(e.cachedUrls[i]=[])}).error(function(t){r.data=t,console.log("Error in update shared mailbox members"+n),u.reject(r)}),u.promise},n.prototype.UpdateSharedMailboxPermissions=function(n,t){var u=this.$q.defer(),o="/admin/api/sharedmailbox/sharedMailboxPermissions",i="/admin/api/sharedmailbox/sharedMailboxPermissions/"+n,r={},f=[],e=this;return this.cachedUrls[i]!==undefined&&(f=this.cachedUrls[i]),this.HttpService.Put(o,t,f).success(function(n){r.data=n,u.resolve(r),e.cachedUrls[i]!==undefined&&(e.cachedUrls[i]=[])}).error(function(t){r.data=t,console.log("Error in update shared mailbox permission"+n),u.reject(r)}),u.promise},n.prototype.GetPermissions=function(n,t,i){t===void 0&&(t=null),i===void 0&&(i=!1);var f=this.$q.defer(),e="/admin/api/sharedmailbox/sharedMailboxPermissions/",o={sharedMailboxId:n,searchText:t},r={},u=this,s=!i;return this.HttpService.Get(e,o,s).success(function(i){var c,l,a;r.data=i,f.resolve(r),c="/admin/api/sharedmailbox/sharedMailboxPermissions/"+n,l="?sharedMailboxId="+n,t!==null&&(l="?searchText="+t+"&sharedMailboxId="+n),a=e+l,u.cachedUrls[c]===undefined&&(u.cachedUrls[c]=[]),-1===u.cachedUrls[c].indexOf(a)&&u.cachedUrls[c].push(a)}).error(function(n){r.data=n,console.log("Error in Get User shared mailbox permission info api call"),f.reject(r)}),f.promise},n.prototype.GetSharedMailboxConnectivity=function(n,t){t===void 0&&(t=!1);var r=this.$q.defer(),u="/admin/api/sharedmailbox/SharedMailboxConnectivity/"+n,f=[],i={},e=!t;return this.HttpService.Get(u,f,e).success(function(n){i.data=n,r.resolve(i)}).error(function(n){i.data=n,console.log("Error in Get User shared mailbox connectivity info api call"),r.reject(i)}),r.promise},n.prototype.SetSharedMailboxConnectivity=function(n,t){var r=this.$q.defer(),u="/admin/api/sharedmailbox/SetSharedMailboxConnectivity",f="/admin/api/sharedmailbox/SharedMailboxConnectivity/"+n,i={};return this.HttpService.Put(u,t,f).success(function(n){i.data=n,r.resolve(i)}).error(function(t){i.data=t,console.log("Error in update shared mailbox connectivity"+n),r.reject(i)}),r.promise},n.prototype.GetSharedMailboxAutoReplyConfiguration=function(n,t){t===void 0&&(t=!1);var r=this.$q.defer(),u="/admin/api/sharedmailbox/SharedMailboxAutoReplyConfiguration/"+n,f=[],i={},e=!t;return this.HttpService.Get(u,f,e).success(function(n){i.data=n,r.resolve(i)}).error(function(n){i.data=n,console.log("Error in Get User shared mailbox AutoReplyConfiguration info api call"),r.reject(i)}),r.promise},n.prototype.SetSharedMailboxAutoReplyConfiguration=function(n,t){var r=this.$q.defer(),u="/admin/api/sharedmailbox/SetSharedMailboxAutoReplyConfiguration",f="/admin/api/sharedmailbox/SharedMailboxAutoReplyConfiguration/"+n,i={};return this.HttpService.Put(u,t,f).success(function(n){i.data=n,r.resolve(i)}).error(function(t){i.data=t,console.log("Error in update shared mailbox AutoReplyConfiguration"+n),r.reject(i)}),r.promise},n.$inject=["$q","$http","HttpService","$cacheFactory","$rootScope"],n}();n.SharedMailboxService=t,AdminApp.service("SharedMailboxService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n){this.$http=n}return n.prototype.GetContactDetails=function(n){var t="/admin/api/Contact/"+n,i=[];return this.$http.get(t,i).success(function(n){return n.User}).error(function(){})},n.prototype.GetContacts=function(n,t,i,r){var u="/admin/api/Contact/GetContacts",f={SearchString:i,SortField:t,SortDirection:n,NextLink:r};return this.$http({url:u,data:f,method:'POST',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(){})},n.prototype.DeleteContact=function(n){var t="/admin/api/Contact";return this.$http({method:'POST',url:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),'X-HTTP-Method-Override':'DELETE'},data:n}).success(function(n){return n}).error(function(){console.log("Error deleting contact")})},n.prototype.SaveContact=function(n){var t="/admin/api/Contact";return this.$http({method:'POST',url:t,data:n,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(){console.log("Error saving Contact")})},n.prototype.GetContactCountryInfo=function(){return this.$http.get("/admin/api/contact/country").success(function(n){return n}).error(function(){console.log("Error in getting country info")})},n.prototype.UpdateContact=function(n){var t="/admin/api/Contact";return this.$http({method:'POST',url:t,data:n,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),'X-HTTP-Method-Override':'PUT'}}).success(function(n){return n}).error(function(){})},n.prototype.UpdateContactOptions=function(n){var t="/admin/api/Contact/options";return this.$http({method:'POST',url:t,data:n,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),'X-HTTP-Method-Override':'PUT'}}).success(function(n){return n}).error(function(){})},n.$inject=["$http"],n}();n.ContactService=t,AdminApp.service("ContactService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n){this.$http=n}return n.prototype.GetResourceMailboxList=function(n,t,i,r,u){var f="/admin/api/resourcemailbox/GetResourceMailboxList",e={SearchType:r,SearchString:i,SortField:t,SortDirection:n,NextLink:u};return this.$http({url:f,data:e,method:'POST',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(n){return n})},n.prototype.CheckResourceMailboxWasCreated=function(n){var t="/admin/api/resourcemailbox/ResourceMailboxExist/"+n;return this.$http.get(t,[]).success(function(n){return n}).error(function(n){return n})},n.prototype.NewResourceMailbox=function(n){var t="/admin/api/resourcemailbox/NewResourceMailbox";return this.$http({url:t,data:n,method:'POST',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(n){return n})},n.prototype.SetResourceMailboxCalendarProcessing=function(n){var t="/admin/api/resourcemailbox/SetResourceMailboxCalendarProcessing";return this.$http({url:t,data:n,method:'POST',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),'X-HTTP-Method-Override':'PUT'}}).success(function(n){return n}).error(function(n){return n})},n.prototype.GetResourceMailboxCalendarProcessing=function(n){var t="/admin/api/resourcemailbox/ResourceMailboxCalendarProcessing/"+n,i=[];return this.$http.get(t,i).success(function(n){return n}).error(function(n){return n})},n.prototype.SetResourceMailbox=function(n){var t="/admin/api/resourcemailbox/SetResourceMailbox";return this.$http({url:t,data:n,method:'POST',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),'X-HTTP-Method-Override':'PUT'}}).success(function(n){return n}).error(function(n){return n})},n.prototype.AddMorePropertyToNewResourceMailbox=function(n){var t="/admin/api/resourcemailbox/AddMorePropertyToNewResourceMailbox";return this.$http({url:t,data:n,method:'POST',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),'X-HTTP-Method-Override':'PUT'}}).success(function(n){return n}).error(function(n){return n})},n.prototype.RemoveResourceMailboxList=function(n){var t="/admin/api/resourcemailbox/RemoveResourceMailboxList";return this.$http({url:t,data:n,method:'POST',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),'X-HTTP-Method-Override':'DELETE'}}).success(function(n){return n}).error(function(n){return n})},n.prototype.GetAddResourceMailboxDefaults=function(){return this.$http.get("/admin/api/resourcemailbox/new/options").success(function(n){return n}).error(function(){console.log("Error in getting Add Sharemailbox defaults")})},n.$inject=["$http"],n}();n.ResourceMailboxService=t,AdminApp.service("ResourceMailboxService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){this.$http=n,this.$q=t,this.$cacheFactory=i,this.HttpService=r,this.imapCache=this.$cacheFactory("imapCache")}return n.prototype.ListUsers=function(n){n===void 0&&(n=null);var t="/admin/api/emailmigration/users";return this.$http({method:'PUT',url:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:n}).success(function(n){return n}).error(function(){console.log("Error in getting user list")})},n.prototype.GetDefaultUserList=function(n,t,i,r){var u="/admin/api/emailmigration/PagingUsers";return this.$http({method:'PUT',url:u,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:{SortDirection:n,SortPropertyName:t,FilterField:i,FilterValue:r}}).success(function(n){return n}).error(function(){console.log("Error in Get Default user list")})},n.prototype.GetNextListUserPage=function(n,t,i,r){var u="/admin/api/emailmigration/PagingUsers";return this.$http({method:'PUT',url:u,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:{ListAction:1,ListContext:i,SearchText:r,FilterField:n,FilterValue:t,ServerContext:null}}).success(function(n){return n}).error(function(){console.log("Error in Get Next page")})},n.prototype.SearchUser=function(n,t,i,r,u){var f="/admin/api/emailmigration/PagingUsers";return this.$http({method:'PUT',url:f,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:{ListAction:-1,ListContext:null,SearchText:n,FilterField:t,FilterValue:i,SortDirection:r,SortPropertyName:u}}).success(function(n){return n.Users}).error(function(){console.log("Error in ListView Search")})},n.prototype.ListUserMigrationStatus=function(n){var t=n?"/admin/api/emailmigration/statuslight":"/admin/api/emailmigration/status";return this.$http({method:'GET',url:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(){console.log("Error in getting user migration status")})},n.prototype.SaveUserCredentials=function(n,t,i){var r="/admin/api/emailmigration/SaveUserCredentials";return this.$http({method:'PUT',url:r,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:{ObjectId:n,SourceEmailAddress:t,SourceEmailPassword:i}}).success(function(n){return n}).error(function(){console.log("Error in saving user credentials")})},n.prototype.Start=function(n){var t="/admin/api/emailmigration/start";return this.$http({method:'POST',url:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:n}).success(function(n){return n}).error(function(){console.log("Error in starting migration")})},n.prototype.Stop=function(n){var t="/admin/api/emailmigration/stop";return this.$http({method:'POST',url:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:n}).success(function(n){return n}).error(function(){console.log("Error in stopping migration")})},n.prototype.CheckImapConfigurations=function(n){var t="/admin/api/emailmigration/CheckImapConfigurations";return this.$http({method:'POST',url:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:n}).success(function(n){return n}).error(function(){console.log("Error in checking IMAP configurations")})},n.prototype.GetImapServerConfiguration=function(n){var i=this.imapCache,r=i.get(n),t;return r?(t=this.$q.defer(),t.resolve(r),t.promise):this.$http({method:'GET',url:"/admin/api/emailmigration/ImapConfigs",headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},params:{"domains[]":n}}).then(function(n){var t=n.data[0];return t.ReadOnly===!0&&i.put(t.Domain,t),t},function(n){console.log("Error getting IMAP configurations. Response: "+JSON.stringify(n))})},n.prototype.SaveImapServerConfigurations=function(n){return this.$http({method:'PUT',url:"/admin/api/emailmigration/ImapConfigs",headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:JSON.stringify(n)}).success(function(n){return n}).error(function(){console.log("Error saving IMAP configurations.")})},n.prototype.SyncLegacyData=function(){return this.$http({method:'POST',url:"/admin/api/emailmigration/SyncLegacyData",headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(){console.log("Error syncing legacy data.")})},n.prototype.Exit=function(){return this.$http({method:'POST',url:"/admin/api/emailmigration/CloseCurrentSession",headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(){console.log("Error exiting migration.")})},n.prototype.CheckAndSaveCustomServerConfigs=function(n){return this.$http({method:'PUT',url:"/admin/api/emailmigration/CheckAndSaveCustomServerConfigs",headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:n}).success(function(n){return n}).error(function(){console.log("Error checking and saving custom server configs.")})},n.prototype.SetActiveDomain=function(n){return this.$http({method:'PUT',url:"/admin/api/emailmigration/ActiveDomain",headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:'"'+n+'"'}).success(function(n){return n}).error(function(){console.log("Error on saving the active migration domain name.")})},n.prototype.GetActiveDomain=function(){return this.$http({method:'GET',url:"/admin/api/emailmigration/ActiveDomain",headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(){console.log("Error on getting the active migration domain name.")})},n.prototype.GetLegacyMigrationData=function(){return this.$http({method:'GET',url:"/admin/api/emailmigration/LegacyMigration",headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(){console.log("Error on getting legacy migration info.")})},n.prototype.RemoveLegacyMigrationData=function(){return this.$http({method:'DELETE',url:"/admin/api/emailmigration/LegacyMigration",headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(){console.log("Error on removing legacy migration data.")})},n.$inject=["$http","$q","$cacheFactory","HttpService"],n}();n.EmailMigrationService=t,AdminApp.service("EmailMigrationService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){this.$http=n,this.$q=t,this.$cacheFactory=i,this.HttpService=r}return n.prototype.GetExchangeDefaultUserList=function(n,t,i,r){var u="/admin/api/exchangeemailmigration/ExchangePagingUsers";return this.$http({method:'PUT',url:u,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:{SortDirection:n,SortPropertyName:t,FilterField:i,FilterValue:r}}).success(function(n){return n}).error(function(){console.log("Error while getting the default exchange data migration user list")})},n.prototype.GetExchangeNextListUserPage=function(n,t,i,r){var u="/admin/api/exchangeemailmigration/ExchangePagingUsers";return this.$http({method:'PUT',url:u,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:{ListAction:1,ListContext:i,SearchText:r,FilterField:n,FilterValue:t,ServerContext:null}}).success(function(n){return n}).error(function(){console.log("Error while getting next set of exchange data migration users")})},n.prototype.SearchExchangeUser=function(n,t,i,r,u){var f="/admin/api/exchangeemailmigration/ExchangePagingUsers";return this.$http({method:'PUT',url:f,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:{ListAction:-1,ListContext:null,SearchText:n,FilterField:t,FilterValue:i,SortDirection:r,SortPropertyName:u}}).success(function(n){return n.Users}).error(function(){console.log("Error in Search Exchange User")})},n.prototype.ListExchangeUserMigrationStatus=function(){var t=this.$q.defer(),i="/admin/api/exchangeemailmigration/ExchangeStatus",r=[],n={};return this.HttpService.Get(i,r,!1).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in getting exchange user migration status"),t.reject(n)}),t.promise},n.prototype.ListExchangeOverallMigrationStatus=function(){var t=this.$q.defer(),i="/admin/api/exchangeemailmigration/ExchangeBatchStatus",r=[],n={};return this.HttpService.Get(i,r,!1).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in getting overall exchange migration status"),t.reject(n)}),t.promise},n.prototype.StartExchangeDataMigration=function(n){var t="/admin/api/exchangeemailmigration/ExchangeStart";return this.$http({method:'PUT',url:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:n}).success(function(n){return n}).error(function(){console.log("Error while starting exchange migration")})},n.prototype.StopExchangeDataMigration=function(n){var t="/admin/api/exchangeemailmigration/ExchangeStop";return this.$http({method:'PUT',url:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:n}).success(function(n){return n}).error(function(){console.log("Error while stopping exchange data migration")})},n.prototype.AddExchangeMigrationEndPoint=function(n){var t="/admin/api/exchangeemailmigration/AddExchangeMigrationEndPoint";return this.$http({method:'PUT',url:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:n}).success(function(n){return n}).error(function(){console.log("Error while adding new migration endpoint")})},n.prototype.CompleteExchangeDataMigration=function(){return this.$http({method:'POST',url:"/admin/api/exchangeemailmigration/ExchangeComplete",headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(){console.log("Error completing exchange data migration.")})},n.prototype.GetExchangeMigrationEndpoints=function(){var t=this.$q.defer(),i="/admin/api/exchangeemailmigration/ExchangeMigrationEndpoint",r=[],n={};return this.HttpService.Get(i,r,!1).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error on getting exchange migration endpoints."),t.reject(n)}),t.promise},n.prototype.GetIsExchangeMRSEnabled=function(){var t=this.$q.defer(),i="/admin/api/exchangeemailmigration/ExchangeMRSEnabled",r=[],n={};return this.HttpService.Get(i,r,!1).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error while getting if Exchange MRS is enabled"),t.reject(n)}),t.promise},n.prototype.GetDirsyncStatus=function(){var t=this.$q.defer(),i="/admin/api/exchangeemailmigration/DirSyncStatus",r=[],n={};return this.HttpService.Get(i,r,!1).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error while getting Dirsync status"),t.reject(n)}),t.promise},n.$inject=["$http","$q","$cacheFactory","HttpService"],n}(),r,u,i;n.ExchangeEmailMigrationService=t,AdminApp.service("ExchangeEmailMigrationService",t),function(n){n[n.autoDetect=0]="autoDetect",n[n.manualInput=1]="manualInput"}(n.EndpointType||(n.EndpointType={})),r=n.EndpointType,function(n){n[n.NotStarted=0]="NotStarted",n[n.Inprogress=1]="Inprogress",n[n.Synced=2]="Synced",n[n.Failed=3]="Failed",n[n.None=4]="None",n[n.Stopped=5]="Stopped"}(n.MigrationUIStatus||(n.MigrationUIStatus={})),u=n.MigrationUIStatus,i=function(){function n(){this.Autodiscover=!0}return n}(),n.AddEndpointModel=i})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(){this.EndsWith=function(n,t){return n.indexOf(t,n.length-t.length)!==-1}}return n.prototype.IsValid=function(n){return!(n===null||n===""||n===" "||n===undefined)},n.prototype.GenerateStatusText=function(n,t,i){var u=n,f='details',r;return t&&(r="GreenCheck_default_16x16.png",t=="error"?r="Alert_High_default_16x16.png":t=="inprogress"&&(r="spinner_16x16.gif"),u="<img src='/images/"+r+"' /> "+n),i&&(u+=" <a href='"+i+"' target='_blank' >"+f+"</a>"),u},n.$inject=[],n}();n.MigrationHelperService=t,AdminApp.service("MigrationHelperService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;(function(n){n[n.UnifiedGroup=0]="UnifiedGroup",n[n.SharePointSecurityGroup=1]="SharePointSecurityGroup",n[n.DistributionList=2]="DistributionList",n[n.SecurityEnabledDistributionGroup=3]="SecurityEnabledDistributionGroup"})(n.GroupType||(n.GroupType={}));var i=n.GroupType,t=function(){function n(n,t,i){this.$q=n,this.$http=t,this.HttpService=i,this._addGroupDefaultOptions=undefined}return n.prototype.getGroupInformationUrl=function(n,t,i){var u=encodeURIComponent(t),r="/admin/api/groups/";return r=r.concat(n,"/information?groupSmtp=",u,"&groupType=",i)},n.prototype.GetGroupDetails=function(n){var t="/admin/api/Groups/"+n,i=[];return this.$http.get(t,i)},n.prototype.GetGroupInformation=function(n,t,i){var u=this.$q.defer(),o=encodeURIComponent(t),f=this.getGroupInformationUrl(n,t,i),e=[],r={};return this.HttpService.Get(f,e,!0).success(function(n){r.data=n,u.resolve(r)}).error(function(n){r.data=n,u.reject(r)}),u.promise},n.prototype.GetGroups=function(n,t,i,r,u){var f="/admin/api/Groups/GetGroups",e={GroupTypes:r,SearchString:i,SortField:t,SortDirection:n,PageToken:u};return this.$http({url:f,data:e,method:'POST',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}})},n.prototype.DeleteGroups=function(n){var t="/admin/api/groups",i=[n];return this.$http({method:'POST',url:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),'X-HTTP-Method-Override':'DELETE'},data:i})},n.prototype.GetAddGroupDefaults=function(){return this.$http.get("/admin/api/groups/new/options")},n.prototype.SaveGroup=function(n){var t="/admin/api/groups";return this.$http({method:'POST',url:t,data:n,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}})},n.prototype.UpdateGroup=function(n){var i=this.$q.defer(),u="/admin/api/groups",r=[],t={};return r.push("/admin/api/groups/"+n.GroupId+"/information?groupSmtp="+n.GroupSmtp+"&groupType="+n.GroupType),this.HttpService.Put(u,n,r).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,i.reject(t)}),i.promise},n.prototype.UpdateGroupMembers=function(n){var i=this.$q.defer(),u="/admin/api/groups/members",r=[],t={};return r.push("/admin/api/groups/members?groupId="+n.ObjectId+"&groupSmtp="+n.SmtpAddress+"&groupType="+n.GroupType),angular.forEach(n.MembersToAdd,function(n){r.push("/admin/api/Users/"+n.ObjectId)}),this.HttpService.Put(u,n,r).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,i.reject(t)}),i.promise},n.prototype.UpdateGroupOwners=function(n){var i=this.$q.defer(),u="/admin/api/groups/owners",r=[],t={};return r.push("/admin/api/groups/owners?groupId="+n.ObjectId+"&groupSmtp="+n.SmtpAddress+"&groupType="+n.GroupType),angular.forEach(n.MembersToAdd,function(n){r.push("/admin/api/Users/"+n.ObjectId)}),this.HttpService.Put(u,n,r).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,i.reject(t)}),i.promise},n.prototype.ValidateGroupAlias=function(n,t){var i="/admin/api/groups/validateGroupAlias?groupAlias="+n+"&groupType="+t,r=[];return this.$http({url:i,params:r,method:'GET',header:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}})},n.prototype.GetGroupAdditionalDetails=function(n,t){var i="/admin/api/groups/"+n+"/details?groupType="+t,r=[];return this.$http.get(i,r)},n.prototype.GetGroupMembers=function(n,t,i,r,u){var f,e;return r===void 0&&(r=null),u===void 0&&(u=null),f="/admin/api/groups/listmembers",(i==null||i==undefined)&&(i=""),e={GroupType:n,GroupId:t,GroupSmtp:i,SearchText:r,PageToken:u},this.HttpService.Post(f,e)},n.prototype.GetGroupOwners=function(n,t,i,r,u){var f,e;return r===void 0&&(r=null),u===void 0&&(u=null),f="/admin/api/groups/listowners",(i==null||i==undefined)&&(i=""),e={GroupType:n,GroupId:t,GroupSmtp:i,SearchText:r,PageToken:u},this.HttpService.Post(f,e)},n.prototype.SetAddGroupDefaultOptions=function(n){this._addGroupDefaultOptions=n},n.prototype.GetAddGroupDefaultOptions=function(){return this._addGroupDefaultOptions},n.prototype.Invalidate=function(n,t,i){this.HttpService.Invalidate(this.getGroupInformationUrl(n,t,i))},n.prototype.IsO365GroupsEnabled=function(){var n="/admin/api/groups/isO365GroupsEnabled",t=[];return this.$http({url:n,params:t,method:'GET',header:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}})},n.$inject=["$q","$http","HttpService"],n}();n.GroupService=t,AdminApp.service("GroupService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n){this.HttpService=n}return n.prototype.GetSitesList=function(n,t){var i="/admin/api/SitesList",r={pageToken:n,searchText:t};return this.HttpService.Get(i,r,!1)},n.prototype.GetSitesListDefaults=function(){var n="/admin/api/siteslist/options",t=[];return this.HttpService.Get(n,t,!0)},n.prototype.GetSiteExternalUsers=function(n,t){var i="/admin/api/siteslist/siteexternalusers",r=t?t:"",u={identity:n,searchText:r};return this.HttpService.Get(i,u,!1)},n.prototype.SetSiteExternalUsers=function(n){var t="/admin/api/siteslist/siteexternalusers";return this.HttpService.Put(t,n)},n.prototype.SetSiteSharingSettings=function(n){var t="/admin/api/siteslist/siteexternalsharing";return this.HttpService.Put(t,n)},n.$inject=["HttpService"],n}();n.SitesService=t,AdminApp.service("SitesService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n){this.HelperService=n}return n.prototype.GetDisplayNameInitials=function(n){var t="N";return this.HelperService.IsValid(n)&&(t=this.HelperService.ContainsSurrogatePair(n)?n.substring(0,2):n.substring(0,1)),t.toUpperCase()},n.prototype.GetProfileImageColor=function(n){var t=["#FFB900","#D83B01","#E81123","#B4009E","#5C2D91","#0078D7","#008272","#107C10"],i,r;return n==null||typeof n===undefined||n===""?"#FF0000":(i=n.split('').map(function(n){return n.charCodeAt(0)}).reduce(function(n,t){return t+n}),r=i%t.length,t[r])},n.prototype.GetGroupInitials=function(n){return this.GetDisplayNameInitials(n)},n.prototype.GetSharedMailboxInitials=function(n){return this.GetDisplayNameInitials(n)},n.prototype.GetContactInitials=function(n){return this.GetDisplayNameInitials(n)},n.prototype.GetResourceMailboxInitials=function(n){return this.GetDisplayNameInitials(n)},n.prototype.GetUserInitials=function(n){var t="N";return this.HelperService.IsValid(n)&&(t=n.substring(0,n.length>1?2:n.length)),t.toUpperCase()},n.prototype.GetSitesInitials=function(n){var t="S";return this.HelperService.IsValid(n)&&(t=n.substring(0,n.length>1?2:n.length)),t.toUpperCase()},n.prototype.GetInitialsFromFirstAndLastName=function(n,t){var i="NU",r,u;return this.HelperService.IsValid(n)&&this.HelperService.IsValid(t)&&(r=this.HelperService.ContainsSurrogatePair(n)?n.substring(0,2):n.substring(0,1),u=this.HelperService.ContainsSurrogatePair(t)?t.substring(0,2):t.substring(0,1),i=r+u),i.toUpperCase()},n.$inject=["HelperService"],n}();n.ProfileService=t,AdminApp.service("ProfileService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r){this.$http=t,this.$q=i,this.$rootScope=r;var u=this;u.timeFilter={value:30},r.features.ReportingWidget?u.GetReportTileData():n.ReportsUtils.LogInfo("Report service initialized without loading tenant region or tile data as user lacks permissions to view reports")}return t.prototype.GetDaysBackFilter=function(){return this.timeFilter},t.prototype.SetDaysBackFilter=function(n){this.timeFilter.value=n},t.prototype.GetWidgetConfigData=function(){var n=this.$q.defer(),t=this;return t.widgetConfigData!=null?n.resolve(t.widgetConfigData):t.GetDashboardWidgets().then(function(i){t.widgetConfigData=i,n.resolve(i)},function(t){n.reject(t)}),n.promise},t.prototype.GetReportTileData=function(t){t===void 0&&(t='');var r=this.$q.defer(),i=this,u="/admin/api/reports/GetReportTileData",f=!this.reportTileData;return f?i.$http.get(u,i.GetDefaultHttpCacheConfig()).success(function(u){u.ErrorRecords!=null&&u.ErrorRecords.length>=1&&r.reject(u.ErrorRecords[0].Message);var f=i.GetOutputJson(u);f&&f.value&&f.value.length>0?(i.reportTileData=f.value[0],t&&i.reportTileData[t]?r.resolve(i.reportTileData[t]):r.resolve(i.reportTileData)):(n.ReportsUtils.LogError("Output value for report tiles is null or empty","GetReportTileData"),r.resolve(undefined))}).error(function(t){n.ReportsUtils.LogError("Error retrieving report tile data"+JSON.stringify(t),"GetReportTileData",415739),r.resolve(undefined)}):t&&i.reportTileData&&i.reportTileData[t]?r.resolve(i.reportTileData[t]):r.resolve(i.reportTileData),r.promise},t.prototype.GetDashboardWidgets=function(){var r="/admin/api/reports/GetReportsWidgetConfig?",u=[],t=this.$q.defer(),i=this,f=0,e=function(n){t.resolve(i.ProcessWidgetConfigData(n,t))},o=function(s){f<3?(i.QueryHttpGetWithParams(r,u,e,o),f++):(n.ReportsUtils.LogError("Error occurred server side call for 'GetReportsWidgetConfig'","GetReportsWidgetConfig",415739),t.reject(s))};return i.QueryHttpGetWithParams(r,u,e,o),t.promise},t.prototype.QueryHttpGetWithParams=function(n,t,i,r){this.$http.get(n,t).success(i).error(r)},t.prototype.ProcessWidgetConfigData=function(t,i){var r=[],u,f,e;if(t==null)return i.reject("Widget config is empty"),r;if(t.ErrorRecords!=null&&t.ErrorRecords.length>=1&&(n.ReportsUtils.LogError("There is an error retrieving widget config. Error: "+t.ErrorRecords[0].Message+"\tError Type: "+t.ErrorRecords[0].Type),i.reject(t.ErrorRecords[0].Message)),t.ReportWidgets!=null){u=t.ReportWidgets;for(f in u)e=u[f],r.push(e)}return r},t.prototype.GetOutputJson=function(t){try{if(t.Output)return JSON.parse(t.Output);n.ReportsUtils.LogError("Report data does not contain an 'Output' field","GetOutputJson")}catch(i){n.ReportsUtils.LogError("Error parsing JSON output: "+JSON.stringify(i),"JSONODataFormatError",415738)}return undefined},t.prototype.GetReportItemsFromResponse=function(t){var i=[];return t&&t.map(function(t){t.ReportInfoItems.map(function(r){if(!!r.ReportItemTitle){var u=new n.ReportItem;u.id=r.ReportId,u.name=r.ReportItemTitle,u.helpId=r.ReportItemHelpLinkId,u.workload=t.CategoryTitle,u.service=r.Service,u.url=r.ReportItemNavigationLink,u.externalUrl=r.ReportItemServiceUrl,u.info=r.ReportItemDescription,u.views=r.Charts,u.selectedViewIndex=r.Charts&&r.Charts.length>0?0:-1,u.columns=r.Columns,u.columnGroups=r.ColumnGroups,u.gridTitleText=r.ReportItemGridTitleText,u.type=r.ReportConfig!=null?r.ReportConfig.Type:"",i.push(u)}})}),i},t.prototype.GetExternalReportCategoryDetails=function(){var i="/admin/api/reports/GetExternalReportCategoryDetails",t=this.$q.defer(),r=this;return this.$http.get(i,r.GetDefaultHttpCacheConfig()).success(function(n){t.resolve(n)}).error(function(i,r){n.ReportsUtils.LogError("Error retrieving external category details"+r),t.reject(i)})},t.prototype.GetReportCategoryDetails=function(){var i=this.$q.defer(),t=this;return t.reportItems!=null?i.resolve(t.reportItems):this.LoadReportCategory().then(function(r){if(r.ReportCategories&&(t.reportItems=t.GetReportItemsFromResponse(r.ReportCategories)),t.reportItems.length==0)t.reportItems=undefined;else{var u=new n.ReportItem;u.id=n.ReportConstants.BaseState,u.name=n.ReportsLocStrings.GetInstance().RsDashboardText,u.helpId=n.ReportConstants.HelpLinkDashboardHelpId,t.reportItems.splice(0,0,u)}i.resolve(t.reportItems)},function(n){i.reject(n)}),i.promise},t.prototype.LoadReportCategory=function(){var t=this.$q.defer(),i="/admin/api/reports/GetReportCategoryDetails",r=[],u=this,f=0,e=function(n){t.resolve(n)},o=function(s){f<3?(u.QueryHttpGetWithParams(i,r,e,o),f++):(n.ReportsUtils.LogError("Error occurred server side call for 'GetReportCategoryDetails'","GetReportCategoryDetails",415739),t.reject("Error in retrieving the Reports category content: "+s))};return u.QueryHttpGetWithParams(i,r,e,o),t.promise},t.prototype.GetSummaryData=function(n){var t="/admin/api/reports/GetSummaryDataV3?"+this.ReplaceReportIdWithReport(n);return this.$http.get(t,this.GetDefaultHttpCacheConfig()).success(function(n){return n}).error(function(){console.log("Error in Get GetSummaryData call")})},t.prototype.GetSeriesFilterString=function(n){return n?n.Name+" "+n.Operator+" %27"+n.Value+"%27":undefined},t.prototype.GetDetailData=function(n,t,i,r,u){var o;u===void 0&&(u="2000");var f="/admin/api/reports/GetDetailDataV3?"+this.ReplaceReportIdWithReport(n),s=this.GetSeriesFilterString(i),e=[{name:"skiptoken",value:t},{name:"SeriesFilter",value:s},{name:"pagesize",value:u}];return r&&r.length>0&&e.push({name:"ClickThruBuiltinODataFilter",value:r}),f=this.AppendSecondQueryParameter(f,e),o=[],this.$http.get(f,o).success(function(n){return n}).error(function(){console.log("Error in Get GetDetailData call")})},t.prototype.ExportReportData=function(n,t,i,r){var u,f,e;n=this.ReplaceReportIdWithReport(n),u=[],i&&i.length>0&&u.push({name:"ClickThruBuiltinODataFilter",value:i}),u.push({name:"SeriesFilter",value:this.GetSeriesFilterString(t)}),n=this.AppendSecondQueryParameter(n,u),f='/CsvDownload.chart?cfrv31=true&'+n+'&aggregate=M'+r,e=window.open(f,"_blank"),e.focus()},t.prototype.ExportReportSummaryData=function(n,t,i){n=this.ReplaceReportIdWithReport(n);var r='/CsvDownload.chart?cfrv31=true&active_view='+t+'&'+n+'&aggregate=M'+i,u=window.open(r,"_blank");u.focus()},t.prototype.IsFeatureEnabled=function(t){var r="/admin/api/reports/IsFeatureEnabled?featureId="+t,i=this.$q.defer(),u=this;return this.$http.get(r,u.GetDefaultHttpCacheConfig()).success(function(n){i.resolve(n)}).error(function(t,r){n.ReportsUtils.LogError("Error retrieving external category details"+r),i.reject(t)}),i.promise},t.prototype.AppendSecondQueryParameter=function(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.value&&i.name&&i.name.length>0&&(n+='&'+i.name+'='+i.value);return n},t.prototype.GetDefaultHttpCacheConfig=function(){var n={};return n.cache=!0,n},t.prototype.ReplaceReportIdWithReport=function(n){return n.replace("ReportId","Report")},t.$inject=["$http","$q","$rootScope"],t}();n.ReportService=t,AdminApp.service("ReportService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n){this.$rootScope=n,this._selectedItemCount=0,this._selectedItem=undefined,this._broadcastEventName="selectedItemupdated",this._broadcastPanelReadyEvent="panelready",this._panelType=undefined,this._unselectonclose=undefined,this._unhighlightonclose=undefined,this._panelReady=!1}return n.prototype.GetSelectedItemCount=function(){return this._selectedItemCount},n.prototype.IncrementSelectedItemCount=function(){this._selectedItemCount++},n.prototype.DecrementSelectedItemCount=function(){this._selectedItemCount--},n.prototype.ResetSelectedItemCount=function(){this._selectedItemCount=0},n.prototype.GetBroadCastEventName=function(){return this._broadcastEventName},n.prototype.GetPanelReadyEventName=function(){return this._broadcastPanelReadyEvent},n.prototype.SetSelectedItem=function(n){this._selectedItem=n,this.$rootScope.$broadcast(this._broadcastEventName,this._selectedItem)},n.prototype.GetSelectedItem=function(){return this._selectedItem},n.prototype.IsPanelTypeSame=function(n){return this._panelType===n},n.prototype.SetPanelType=function(n){this._panelType=n},n.prototype.GetPanelType=function(){return this._panelType},n.prototype.SetUnselectUnhighlightOnclose=function(n,t){this._unhighlightonclose=t,this._unselectonclose=n},n.prototype.GetUnhighlightOnclose=function(){return this._unhighlightonclose},n.prototype.GetUnSelectOnclose=function(){return this._unselectonclose},n.prototype.SetPanelReady=function(n){this._panelReady=n,this.$rootScope.$broadcast(this._broadcastPanelReadyEvent)},n.prototype.GetPanelReady=function(){return this._panelReady},n.$inject=["$rootScope"],n}();n.PanelService=t,AdminApp.service("PanelService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var u=function(){function n(n,t,i){this.$rootScope=n,this.$http=t,this.$q=i,this.steps={Domain:{name:"Domain",ui:{title:'Personalize sign-in',visable:!0},substeps:[{tagId:414774,name:"SelectDomainType",template:"/AdminPortal/SetupWizard/Steps/SelectDomainType"},{tagId:414776,name:"VerifyDomain",template:"/AdminPortal/SetupWizard/Steps/VerifyDomain"},{tagId:414778,name:"VerifyDomainTxtRecord",template:"/AdminPortal/SetupWizard/Steps/VerifyDomainTxtRecord"},{tagId:421053,name:"ExternalTakeoverIntroduction",template:"/AdminPortal/SetupWizard/Steps/ExternalTakeoverIntroduction"},{tagId:421054,name:"ExternalTakeoverCompletion",template:"/AdminPortal/SetupWizard/Steps/ExternalTakeoverCompletion"},]},SmbDomain:{name:"SmbDomain",ui:{title:'Personalize sign-in',visable:!0},substeps:[{tagId:421972,name:"SmbChoice",template:"/AdminPortal/SetupWizard/Steps/SmbChoice"},{tagId:414774,name:"SelectDomainType",template:"/AdminPortal/SetupWizard/Steps/SelectDomainType"},{tagId:414776,name:"VerifyDomain",template:"/AdminPortal/SetupWizard/Steps/VerifyDomain"},{tagId:414778,name:"VerifyDomainTxtRecord",template:"/AdminPortal/SetupWizard/Steps/VerifyDomainTxtRecord"},{tagId:421053,name:"ExternalTakeoverIntroduction",template:"/AdminPortal/SetupWizard/Steps/ExternalTakeoverIntroduction"},{tagId:421054,name:"ExternalTakeoverCompletion",template:"/AdminPortal/SetupWizard/Steps/ExternalTakeoverCompletion"},]},E3Domain:{name:"E3Domain",ui:{title:'Personalize sign-in',visable:!0},substeps:[{tagId:423137,name:"E3Choice",template:"/AdminPortal/SetupWizard/Steps/E3Choice"},{tagId:414774,name:"SelectDomainType",template:"/AdminPortal/SetupWizard/Steps/SelectDomainType"},{tagId:414776,name:"VerifyDomain",template:"/AdminPortal/SetupWizard/Steps/VerifyDomain"},{tagId:414778,name:"VerifyDomainTxtRecord",template:"/AdminPortal/SetupWizard/Steps/VerifyDomainTxtRecord"},{tagId:421053,name:"ExternalTakeoverIntroduction",template:"/AdminPortal/SetupWizard/Steps/ExternalTakeoverIntroduction"},{tagId:421054,name:"ExternalTakeoverCompletion",template:"/AdminPortal/SetupWizard/Steps/ExternalTakeoverCompletion"},]},PurchaseDomain:{name:"PurchaseDomain",ui:{title:'Purchase domain',visable:!0},substeps:[{tagId:414780,name:"DomainContactInfo",template:"/AdminPortal/SetupWizard/Steps/DomainContactInfo"},{tagId:414785,name:"PurchaseDomainConfirmation",template:"/AdminPortal/SetupWizard/Steps/PurchaseDomainConfirmation"},{tagId:414789,name:"PurchaseDomainForm",template:"/AdminPortal/SetupWizard/Steps/PurchaseDomainForm"},]},Users:{name:"Users",ui:{title:'Add users',visable:!0},substeps:[{tagId:414792,name:"AddUser",template:"/AdminPortal/SetupWizard/Steps/AddUser"},{tagId:415793,name:"AssignLicenses",template:"/AdminPortal/SetupWizard/Steps/AssignLicenses"},{tagId:415642,name:"ShareCredentials",template:"/AdminPortal/SetupWizard/Steps/ShareCredentials"},{tagId:414796,name:"EmailMigration",template:"/AdminPortal/SetupWizard/Steps/EmailMigration"},]},Setup:{name:"Setup",ui:{title:'Connect domain',visable:!0},substeps:[{tagId:414798,name:"SelectSetupType",template:"/AdminPortal/SetupWizard/Steps/SelectSetupType"},{tagId:414800,name:"UpdateNameServers",template:"/AdminPortal/SetupWizard/Steps/UpdateNameServers"},{tagId:414801,name:"AddDnsRecords",template:"/AdminPortal/SetupWizard/Steps/AddDnsRecords"},{tagId:414803,name:"AddWebsiteRecords",template:"/AdminPortal/SetupWizard/Steps/AddWebsiteRecords"},]},BcsSetup:{name:"BcsSetup",ui:{title:'Devices setup',visable:!0},substeps:[{tagId:422947,name:"ProtectOfficeData",template:"/AdminPortal/SetupWizard/Steps/ProtectOfficeData"},{tagId:423074,name:"SecureWindowsDevices",template:"/AdminPortal/SetupWizard/Steps/SecureWindowsDevices"},]},Feedback:{name:"Feedback",ui:{title:'',visable:!1},substeps:[{tagId:414802,name:"Feedback",template:"/AdminPortal/SetupWizard/Steps/Feedback"},]}},this.stepsSet={owndomain:[this.steps.Domain,this.steps.Users,this.steps.Setup,this.steps.Feedback],buydomain:[this.steps.Domain,this.steps.PurchaseDomain,this.steps.Users,this.steps.Feedback],nodomain:[this.steps.Domain,this.steps.Users,this.steps.Feedback]},this.BootstrapData=new r,this.registrars=null,this.currentStepsSet=null,this.protectOfficeDataFormData=null,this.secureWindowsDevicesFormData=null}return n.prototype.Initialize=function(){var n=this;this.Get("PopularRegistrarsCompleteInfo").then(function(t){n.registrars=t})},n.prototype.GetCurrentStepsSet=function(){return this.currentStepsSet},n.prototype.GenerateAppendedStepsSetName=function(n,t,i){var r=n+":"+t;return angular.forEach(i,function(n){r+="|"+n.stepsSet+":"+n.stepSetVersion}),r},n.prototype.SetCurrentStepsSet=function(n,t,i){var r=this,u;return i===void 0&&(i=null),i&&this.$rootScope.features.SetupWizardAppendDefinition?(u=this.GenerateAppendedStepsSetName(n,t,i),this.LoadStepsSetDefinition(n,t,i).then(function(){r.stepsSet[u]&&(r.currentStepsSet={name:n,version:t,appendedStepsSet:i,steps:r.stepsSet[u]},r.$rootScope.$broadcast('wizard:stepssetchanged',{stepsSet:r.currentStepsSet}))})):this.LoadServerSideStepSet(n,t).then(function(){r.stepsSet[n]&&(r.currentStepsSet={name:n,version:t,steps:r.stepsSet[n]},r.$rootScope.$broadcast('wizard:stepssetchanged',{stepsSet:r.currentStepsSet}))})},n.prototype.AppendCurrentStepsSet=function(n,t){var u=this,r=this.GetCurrentStepsSet(),f=!1;angular.forEach(r.appendedStepsSet,function(t){!!f||t.stepsSet.toLowerCase()===n.toLowerCase()&&(f=!0)}),!!f||this.GetStepsSet(n,t).then(function(f){var e,o;null!=f&&(e=new i,e.stepsSet=n,e.stepSetVersion=t,r.appendedStepsSet||(r.appendedStepsSet=[]),o={name:r.name+":"+r.version+"|"+f.name+":"+t,steps:r.steps.concat(f.steps),appendedStepsSet:r.appendedStepsSet.concat(e)},u.stepsSet[o.name]=o.steps,u.currentStepsSet=o,u.$rootScope.$broadcast('wizard:stepssetappended',{stepsSet:u.currentStepsSet,appendedStepsSet:e}))})},n.prototype.GetStepsSet=function(n,t,i){var u=this,r;return i===void 0&&(i=null),i&&this.$rootScope.features.SetupWizardAppendDefinition?(r=this.GenerateAppendedStepsSetName(n,t,i),this.LoadStepsSetDefinition(n,t,i).then(function(){return{name:r,steps:u.stepsSet[r]}})):this.LoadServerSideStepSet(n,t).then(function(){return{name:n,steps:u.stepsSet[n]}})},n.prototype.Previous=function(){this.$rootScope.$broadcast('wizard:previous')},n.prototype.Next=function(){this.$rootScope.$broadcast('wizard:next')},n.prototype.Skip=function(){this.$rootScope.$broadcast('wizard:next',{skip:!0})},n.prototype.SkipButKeepHistory=function(){this.$rootScope.$broadcast('wizard:skipButKeepHistory')},n.prototype.NextStep=function(){this.$rootScope.$broadcast('wizard:nextstep')},n.prototype.GoToStep=function(n,t){this.$rootScope.$broadcast('wizard:goto',{stepName:n,subStepName:t})},n.prototype.GoToStepButSkip=function(n,t){this.$rootScope.$broadcast('wizard:goto',{stepName:n,subStepName:t,skip:!0})},n.prototype.BackToStep=function(n,t){this.$rootScope.$broadcast('wizard:backto',{stepName:n,subStepName:t})},n.prototype.Exit=function(){this.$rootScope.$broadcast('wizard:exit')},n.prototype.SmbExit=function(){this.$rootScope.$broadcast('wizard:smbexit')},n.prototype.ShowMessage=function(n,i){var r=new t;r.ErrorMessage=n,r.MessageType=i,this.ShowErrorModelMessage(r)},n.prototype.ShowErrorModelMessage=function(n){this.$rootScope.$broadcast('wizard:message',n)},n.prototype.ShowLoading=function(n){this.$rootScope.$broadcast('wizard:showloading',n)},n.prototype.SaveState=function(n,t){var i="state/"+n;return this.Put(i,"'"+JSON.stringify(t)+"'")},n.prototype.LoadState=function(n){var t="state/"+n;return this.Get(t).then(function(n){return n?JSON.parse(n):null})},n.prototype.GetStepDefinition=function(n,t){return this.Get("SetupSetDefinition?stepSet="+n+"&version="+t)},n.prototype.StepChanged=function(n,t,i,r){return r===void 0&&(r=""),this.Post("StepChanged?step="+n+"&subStep="+t+"&tagId="+i+"&option="+r,null)},n.prototype.OptionSelected=function(n,t){this.$rootScope.$broadcast('wizard:optionselected',{tagId:n,option:t})},n.prototype.InitialSetupWizardSession=function(n,t){return this.Post("InitialSetupWizardSession?setupBannerType="+n+"&productSkuId="+t,null)},n.prototype.Step_IsSecondLevelDomain=function(n){return this.Get("IsSecondLevelDomain?domain="+n)},n.prototype.Step_SaveDomain=function(n){return this.Put("SavedDomain?domain="+n,null)},n.prototype.Step_GetSavedDomain=function(){return this.Get("SavedDomain")},n.prototype.Step_CheckDomainAvailability=function(n){return this.Post("CheckDomainAvailability?domain="+n,null)},n.prototype.Step_CheckDomainAvailabilityForVSB=function(n){return this.Post("CheckDomainAvailabilityForVSB?domain="+n,null)},n.prototype.Step_PurchaseFreeDomain=function(n,t,i){return this.Post("PurchaseFreeDomain?domain="+n+"&registrar="+t,i)},n.prototype.Step_GetCurrentOnMicrosoftDomain=function(){return this.Get("CurrentOnMicrosoftDomain")},n.prototype.Step_GetDefaultDomain=function(){return this.Get("DefaultDomain")},n.prototype.Step_HasDefaultCustomDomain=function(){return this.Get("HasDefaultCustomDomain")},n.prototype.Step_ValidateDomain=function(n){return this.Post("ValidateDomain?domain="+n,null)},n.prototype.Step_OwnedDomainCheck=function(n){return this.Post("OwnedDomainCheck?domain="+n,null)},n.prototype.Step_GetDomainContacts=function(n){return this.Get("DomainContacts?domain="+n)},n.prototype.Step_SendVerificationCode=function(n){return this.Post("SendVerificationCode?domain="+n,null)},n.prototype.Step_VerifyDomainOwnership=function(n,t){return this.Post("VerifyDomainOwnership?domain="+n+"&verificationCode="+t,null)},n.prototype.Step_SaveDomainRegistrar=function(n,t){return this.Put("DomainRegistrar?domain="+n+"&registrar="+t,null)},n.prototype.Step_GetDomainRegistrar=function(n){return this.Get("DomainRegistrar?domain="+n)},n.prototype.Step_GetPopularRegistrarsCompleteInfo=function(){return this.registrars},n.prototype.Step_GetPopularRegistrar=function(n){var t=null;return angular.forEach(this.registrars,function(i){i.RegistrarName==n&&(t=i)}),t},n.prototype.Step_GetInstructionsLink=function(n,t,i){return this.Get("InstructionsLink?domain="+n+"&registrar="+t+"&instructionType="+i)},n.prototype.Step_GetDomainVerificationData=function(n){return this.Get("DomainVerificationData?domain="+n)},n.prototype.Step_VerifyDomainTxtOrMxRecord=function(n){return this.Post("VerifyDomainTxtOrMxRecord?domain="+n,null)},n.prototype.Step_IsFullDelegatedResellerDomain=function(n){return this.Get("IsFullDelegatedResellerDomain?domain="+n)},n.prototype.Step_GetNameserverSettings=function(n){return this.Get("Nameservers?domain="+n)},n.prototype.Step_VerifyNameserverSettings=function(n){return this.Post("VerifyNameservers?domain="+n,null)},n.prototype.Step_GetAdminEmail=function(){return this.Get("AdminEmail")},n.prototype.Step_PostFeedback=function(n){return this.Post("Feedback",n)},n.prototype.Step_AddUsers=function(n,t){return this.Post("Users?domain="+n,t)},n.prototype.Step_AssignLicenses=function(n,t){return this.Post("AssignLicenses?productSkuId="+n,t)},n.prototype.Step_GetUnlicensedUsers=function(){return this.Get("UnlicensedUsers")},n.prototype.Step_GetUsers=function(){return this.Get("AllUsers")},n.prototype.Step_GetUsersAddedInCurrentSession=function(){return this.Get("Users")},n.prototype.Step_GetUsersAssignedInCurrentSession=function(){return this.Get("AssignedUsers")},n.prototype.Step_PurchaseNewLicense=function(n,t){return this.Post("PurchaseNewLicense?newLicense="+n+"&productSkuId="+t,null)},n.prototype.Step_SendPasswordEmails=function(n,t){return this.Post("SendPasswordEmails?bannertype="+t,n)},n.prototype.Step_SkipAddUsers=function(n){return this.Post("SkipAddUsers?domain="+n,null)},n.prototype.Step_GetProductsListForAssignLicense=function(){return this.Get("ProductsList")},n.prototype.Step_GetTenantDefaultLicense=function(){return this.Get("TenantDefaultLicense")},n.prototype.Step_GetUserProductsModel=function(n){return this.Get("UserProductsModel?productSkuId="+n)},n.prototype.Step_GetTenantLicenseBySkuId=function(n){return this.Get("TenantLicense?productSkuId="+n)},n.prototype.Step_GetDomainDelegationModel=function(n){return this.Get("GetDomainDelegationModel?domain="+n)},n.prototype.Step_GetDnsRecords=function(n){return this.Get("DnsRecords?domain="+n)},n.prototype.Step_VerifyDnsRecords=function(n,t){return this.Post("VerifyDnsRecords?domain="+n+"&setupBannerType="+t,null)},n.prototype.BeginSession=function(n){return this.Post("BeginSession?domain="+n,null)},n.prototype.Step_GetDomainRegistrarDetails=function(n){return this.Get("DomainRegistrarDetails?domain="+n)},n.prototype.Step_VerifyGoDaddyDomainOwnership=function(n,t){return this.Post("VerifyGoDaddyDomainOwnership?domain="+n+"&authCode="+t,null)},n.prototype.Step_VerifyGoDaddyDnsRecordSettings=function(n,t){return this.Post("VerifyGoDaddyDnsRecords?domain="+n+"&authCode="+t,null)},n.prototype.Step_GetFeatureStates=function(){return this.Get("FeatureStates")},n.prototype.Step_GetSetupSettings=function(){return this.Get("SetupWizardConfig")},n.prototype.Step_GetSetupSettingsAdvanced=function(n,t){return this.Post("SetupWizardConfig?initialize="+n,t)},n.prototype.Step_SetSessionStatus=function(n,t){return this.Post("SetSessionStatus?sessionId="+n,t)},n.prototype.Step_MarkSetupCompleted=function(n){var t=this;return this.Post("MarkSetupCompleted?domain="+n,null).then(function(){t.$rootScope.$broadcast('refreshsetupbannerstatus')})},n.prototype.Step_GetSoftwareInstallData=function(){return this.Get("SoftwareDownloadInfo")},n.prototype.Step_GetIsAoboScenario=function(){return this.Get("IsAoboScenario")},n.prototype.Step_GetDomainTakeoverData=function(n){return this.Get("DomainTakeoverData?domain="+n)},n.prototype.Step_SendSignupInvitation=function(n,t,i){return this.Post("SendSignupInvitation?domain="+n+"&userName="+t+"&trackingGuid="+i,null)},n.prototype.Step_SetCurrentUserLicense=function(n){var t="CurrentUserLicense?productSkuId="+n;return this.Put(t,null)},n.prototype.Banner_GetSetupBanner=function(){return this.Get("SetupBanner")},n.prototype.Banner_SetLicenseSimple=function(n){var t="UserLicenseSimple?bannerType="+n;return this.Put(t,null)},n.prototype.Banner_GetDownloadUrl=function(){return this.Get("GetDownloadUrl")},n.prototype.Install_GetSharedContext=function(){return this.Get("GetSharedContext")},n.prototype.Install_GetInstallContext=function(){return this.Get("GetInstallContext")},n.prototype.GetProductTiles=function(n){return this.Get("GetProductTiles?sku="+n)},n.prototype.HideSetupBanner=function(){return this.Post("HideSetupBanner",null)},n.prototype.GetConciergeMessage=function(n,t,i){return this.Get("GetConciergeMessage?currentStep="+n+"&currentSubStep="+t+"&errorMessage="+i)},n.prototype.GetGoDaddyState=function(){return this.Get("GoDaddyState")},n.prototype.SetGoDaddyState=function(n){return this.Put("GoDaddyState",n)},n.prototype.ShowProgressOverlay=function(n,t){this.$rootScope.showProgressOverlay!=n&&(this.$rootScope.showProgressOverlay=n),this.$rootScope.progressRingDescription!=t&&(this.$rootScope.progressRingDescription=t)},n.prototype.IsProgressOverlayShown=function(){return this.$rootScope.showProgressOverlay},n.prototype.SetProtectOfficeDataFormData=function(n){this.protectOfficeDataFormData=n},n.prototype.GetProtectOfficeDataFormData=function(){return this.protectOfficeDataFormData},n.prototype.SetSecureWindowsDevicesFormData=function(n){this.secureWindowsDevicesFormData=n},n.prototype.GetSecureWindowsDevicesFormData=function(){return this.secureWindowsDevicesFormData},n.prototype.Get=function(n){var i="/admin/api/setupwizard/"+n,t=this;return this.$http({method:'GET',url:i,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),WizardSessionId:this.BootstrapData.StoreSessionId}}).then(function(n){return t.PostProcess(n,t)},function(n){return t.PostProcess(n,t)})},n.prototype.Put=function(n,t){var r="/admin/api/setupwizard/"+n,i=this;return this.$http({method:'PUT',url:r,data:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),WizardSessionId:this.BootstrapData.StoreSessionId}}).then(function(n){return i.PostProcess(n,i)},function(n){return i.PostProcess(n,i)})},n.prototype.Post=function(n,t){var r="/admin/api/setupwizard/"+n,i=this;return this.$http({method:'POST',url:r,data:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),WizardSessionId:this.BootstrapData.StoreSessionId}}).then(function(n){return i.PostProcess(n,i)},function(n){return i.PostProcess(n,i)})},n.prototype.PostProcess=function(n,i){var r,u,f;return n.status>=400?(i.ShowMessage(n.data,2),console.error("Failure in api call: "+n.config.url),null):(r=n.data,!r.Succeeded)?(u=new t,r.Data!==null&&r.Data.ErrorMessage!==undefined&&r.Data.ErrorMessage!==null?(u.ErrorMessage=r.Data.ErrorMessage,u.MessageType=r.Data.MessageType,r.Data.Action!==null&&(u.Action=r.Data.Action),i.ShowErrorModelMessage(u)):(f=r.message,f||(f=r.Message),i.ShowMessage(f,2)),console.warn("Error in api call: "+n.config.url),null):r.Data},n.prototype.LoadStepsSetDefinition=function(n,t,i){var r=this,u,e;if(i===void 0&&(i=null),u=this.$q.defer(),e=this.GenerateAppendedStepsSetName(n,t,i),this.stepsSet[e])u.resolve();else{var o=[],h=n.split('-'),f=[],s=[];o.push(this.LoadServerSideStepSet(n,t)),f.push(n),i&&angular.forEach(i,function(n){f.indexOf(n.stepsSet)===-1&&(f.push(n.stepsSet),o.push(r.LoadServerSideStepSet(n.stepsSet,n.stepSetVersion)))}),this.$q.all(o).then(function(){angular.forEach(f,function(n){r.stepsSet[n]&&(s=s.concat(r.stepsSet[n]))}),r.stepsSet[e]=s,u.resolve()})}return u.promise},n.prototype.LoadServerSideStepSet=function(n,t){var u=this,i=this.$q.defer(),r;return this.stepsSet[n]&&this.stepsSet[n].length?i.resolve():(r=h[n],r&&this.GetStepDefinition(r,t).then(function(t){u.stepsSet[n]=t,i.resolve()})),i.promise},n.$inject=["$rootScope","$http","$q"],n}(),rt,it,tt,nt,g,d,k,b,t,s,w,y,ut,h,r,v,a,i,l,o,e,f,c,p,ft;n.SetupWizardService=u,AdminApp.service("SetupWizardService",u),function(n){n[n.Info=0]="Info",n[n.Warning=1]="Warning",n[n.Error=2]="Error",n[n.Critical=3]="Critical",n[n.Success=4]="Success"}(n.SetupWizardMessageType||(n.SetupWizardMessageType={})),rt=n.SetupWizardMessageType,function(n){n[n.Verify=0]="Verify",n[n.MX=1]="MX",n[n.CNAME=2]="CNAME",n[n.TXT=3]="TXT",n[n.SRV=4]="SRV",n[n.NS=5]="NS"}(n.SetupWizardInstructionType||(n.SetupWizardInstructionType={})),it=n.SetupWizardInstructionType,function(n){n[n.Success=0]="Success",n[n.Failed=1]="Failed",n[n.Skipped=2]="Skipped",n[n.ResolveConflict=3]="ResolveConflict"}(n.SetupWizardAddUserResult||(n.SetupWizardAddUserResult={})),tt=n.SetupWizardAddUserResult,function(n){n[n.None=0]="None",n[n.Pending=1]="Pending",n[n.Completed=2]="Completed",n[n.Aborted=3]="Aborted"}(n.SetupWizardSessionStatus||(n.SetupWizardSessionStatus={})),nt=n.SetupWizardSessionStatus,function(n){n[n.Communication=0]="Communication",n[n.Software=1]="Software",n[n.App=2]="App"}(n.SetupWizardSoftwareChoice||(n.SetupWizardSoftwareChoice={})),g=n.SetupWizardSoftwareChoice,function(n){n[n.NoRecords=0]="NoRecords",n[n.SingleRecord_IncorrectProperties=1]="SingleRecord_IncorrectProperties",n[n.MultipleRecords_NotHighestPriority=2]="MultipleRecords_NotHighestPriority",n[n.MultipleRecords_AdditionalNonMatchingHighestPriority=3]="MultipleRecords_AdditionalNonMatchingHighestPriority",n[n.MultipleRecords_NoMatch=4]="MultipleRecords_NoMatch",n[n.MultipleRecords=5]="MultipleRecords",n[n.TooManyNSRecords=6]="TooManyNSRecords",n[n.TooFewNSRecords=7]="TooFewNSRecords"}(n.SetupWizardReasonUnhealthy||(n.SetupWizardReasonUnhealthy={})),d=n.SetupWizardReasonUnhealthy,function(n){n[n.Verified=0]="Verified",n[n.Unverified=1]="Unverified",n[n.FailedToAddAsUnverifiedDomain=2]="FailedToAddAsUnverifiedDomain",n[n.FailedTakeoverRequired=3]="FailedTakeoverRequired"}(n.SetupWizardOwnDomainState||(n.SetupWizardOwnDomainState={})),k=n.SetupWizardOwnDomainState,function(n){n[n.None=0]="None",n[n.RestartWizard=1]="RestartWizard",n[n.NavigateTo=2]="NavigateTo"}(n.SetupWizardMessageAction||(n.SetupWizardMessageAction={})),b=n.SetupWizardMessageAction,t=function(){function n(){}return n}(),n.SetupWizardErrorModel=t,s=function(){function n(){}return n}(),n.SetupWizardErrorAction=s,function(n){n[n.None=0]="None",n[n.SetupWizard=1]="SetupWizard",n[n.Visio=2]="Visio",n[n.Project=3]="Project",n[n.OfficeBusiness=4]="OfficeBusiness",n[n.OfficeBusinessPremium=5]="OfficeBusinessPremium",n[n.Skype=6]="Skype",n[n.Smb=7]="Smb",n[n.E3=8]="E3",n[n.Vsb=9]="Vsb",n[n.Bcs=10]="Bcs"}(n.SetupBannerType||(n.SetupBannerType={})),w=n.SetupBannerType,function(n){n[n.Success=0]="Success",n[n.GenericError=1]="GenericError",n[n.Skipped=2]="Skipped",n[n.SkippedSelf=3]="SkippedSelf",n[n.AccessDenied=4]="AccessDenied",n[n.MixOfErrors=5]="MixOfErrors",n[n.DeleteFailedForAll=6]="DeleteFailedForAll",n[n.RestoreUserError=7]="RestoreUserError",n[n.SuccessSelfUpnUpdate=8]="SuccessSelfUpnUpdate",n[n.SkippedNonBoxUISku=9]="SkippedNonBoxUISku",n[n.SaveEmailAddressesFailed=10]="SaveEmailAddressesFailed"}(n.FaultCode||(n.FaultCode={})),y=n.FaultCode,function(n){n[n.Success=0]="Success",n[n.Failed=1]="Failed",n[n.Skipped=2]="Skipped",n[n.ResolveConflict=3]="ResolveConflict",n[n.Warning=4]="Warning"}(n.ResultCode||(n.ResultCode={})),ut=n.ResultCode,function(n){n[n.None=0]="None",n[n.owndomain=1]="owndomain",n[n.buydomain=2]="buydomain",n[n.nodomain=3]="nodomain",n[n.OwnDomainSoftware=4]="OwnDomainSoftware",n[n.BuyDomainSoftware=5]="BuyDomainSoftware",n[n.NoDomainSoftware=6]="NoDomainSoftware",n[n.OwnDomainSkype=7]="OwnDomainSkype",n[n.BuyDomainSkype=8]="BuyDomainSkype",n[n.NoDomainSkype=9]="NoDomainSkype",n[n.NoDomainSetupSoftware=10]="NoDomainSetupSoftware",n[n.OwnDomainSmb=11]="OwnDomainSmb",n[n.BuyDomainSmb=12]="BuyDomainSmb",n[n.NoDomainSmb=13]="NoDomainSmb",n[n.OwnDomainSoftwareSmb=14]="OwnDomainSoftwareSmb",n[n.BuyDomainSoftwareSmb=15]="BuyDomainSoftwareSmb",n[n.NoDomainSoftwareSmb=16]="NoDomainSoftwareSmb",n[n.SoftwareSmb=17]="SoftwareSmb",n[n.OwnDomainE3=22]="OwnDomainE3",n[n.BuyDomainE3=23]="BuyDomainE3",n[n.NoDomainE3=24]="NoDomainE3",n[n.OwnDomainSoftwareE3=25]="OwnDomainSoftwareE3",n[n.BuyDomainSoftwareE3=26]="BuyDomainSoftwareE3",n[n.NoDomainSoftwareE3=27]="NoDomainSoftwareE3",n[n.SoftwareE3=28]="SoftwareE3",n[n.OwnDomainBcs=32]="OwnDomainBcs",n[n.BuyDomainBcs=33]="BuyDomainBcs",n[n.NoDomainBcs=34]="NoDomainBcs",n[n.HideDomainBcs=35]="HideDomainBcs"}(n.SetupWizardStepSet||(n.SetupWizardStepSet={})),h=n.SetupWizardStepSet,r=function(){function n(){this.SavedRegistrar=null}return n}(),n.BootstrapData=r,function(n){n[n.NotSent=0]="NotSent",n[n.Sent=1]="Sent",n[n.Failed=2]="Failed"}(n.EmailSentStatus||(n.EmailSentStatus={})),v=n.EmailSentStatus,function(n){n[n.Unknown=0]="Unknown",n[n.Full=1]="Full",n[n.Partial=2]="Partial"}(n.DomainDelegationType||(n.DomainDelegationType={})),a=n.DomainDelegationType,i=function(){function n(){}return n}(),n.AppendedStepsSetModel=i,function(n){n[n.Next=0]="Next",n[n.Back=1]="Back",n[n.Unknown=2]="Unknown"}(n.PreviousAction||(n.PreviousAction={})),l=n.PreviousAction,o=function(){function n(){}return n}(),n.WizardFrameworkModel=o,e=function(){function n(){}return n}(),n.ProtectOfficeDataDevicesModel=e,f=function(){function n(){}return n}(),n.SecureWindowsDevicesModel=f,function(n){n[n.Mdm=0]="Mdm",n[n.Mam=1]="Mam"}(n.PolicyTargetType||(n.PolicyTargetType={})),c=n.PolicyTargetType,function(n){n[n.AllUsers=0]="AllUsers",n[n.OnlyMe=1]="OnlyMe"}(n.ProtectDevicesAudience||(n.ProtectDevicesAudience={})),p=n.ProtectDevicesAudience,function(n){n[n.One=1]="One",n[n.Five=5]="Five",n[n.Fifteen=15]="Fifteen",n[n.Thirty=30]="Thirty",n[n.Sixty=60]="Sixty"}(n.WindowsScreenTurnOffMins||(n.WindowsScreenTurnOffMins={})),ft=n.WindowsScreenTurnOffMins})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){this.$q=n,this.HttpService=t,this.$rootScope=i}return n.prototype.SendSMS=function(n,t,i,r){i===void 0&&(i=null),r===void 0&&(r=null);var e=JSON.stringify({toPhoneNumber:n,Scenario:i,Platform:r,RequestSource:t}),o='/admin/api/message/sendtextmessage',f=this.$q.defer(),u={};return this.HttpService.Post(o,e).success(function(n){u.data=n,f.resolve(u)}).error(function(n){u.data=n,console.log("Error in admin checklist set user preferences"),f.reject(u)}),f.promise},n.$inject=["$q","HttpService","$rootScope"],n}();n.SendSMSService=t,n.app&&n.app.service("SendSMSService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){this.$q=n,this.$http=t,this.HttpService=i}return n.prototype.GetCompanyInformation=function(){var n="/admin/api/Settings/company/profile";return this.$http({url:n,method:'GET',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(n){return n})},n.prototype.UpdateCompanyInformation=function(n){var t="/admin/api/Settings/company/profile";return this.$http({method:'POST',url:t,data:n,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(n){return n})},n.prototype.GetReleasePreference=function(){var n="/admin/api/Settings/company/releasetrack";return this.$http({url:n,method:'GET',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(n){return n})},n.prototype.GetReleasePreferenceUsers=function(n,t){var i="/admin/api/Settings/company/releasetrack/listusers",r={SearchText:n,PageContext:t};return this.$http({url:i,data:r,method:'POST',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(n){return n})},n.prototype.GetReleasePreferenceCompassUsers=function(n,t){var i="/admin/api/Settings/company/compass/listusers",r={SearchText:n,PageContext:t};return this.$http({url:i,data:r,method:'POST',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(n){return n})},n.prototype.UpdateReleasePreference=function(n){var t="/admin/api/Settings/company/releasetrack";return this.$http({method:'POST',url:t,data:n,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(n){return n})},n.prototype.UpdateReleasePreferenceUsers=function(n){var t="/admin/api/Settings/company/releasetrack/users";return this.$http({method:'POST',url:t,data:n,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(n){return n})},n.prototype.UpdateReleasePreferenceCompassUsers=function(n){var t="/admin/api/Settings/company/compass/users";return this.$http({method:'POST',url:t,data:n,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(n){return n})},n.prototype.GetBingPlacesLink=function(){var n="/admin/api/navigation/url";return this.$http({url:n,params:{url:"/bingplaces"},method:'GET',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(n){return n})},n.prototype.GetTenantUICustomizationSettings=function(){var i="/admin/api/Settings/company/theme",n={},r=[],t=this.$q.defer();return this.HttpService.Get(i,r,!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in Get company theme api call"),t.reject(n)}),t.promise},n.prototype.UpdateTenantUICustomizationSettings=function(n){var i="/admin/api/Settings/company/theme",r="/admin/api/Settings/company/theme",t=this.$q.defer();return this.HttpService.Post(i,n,r).success(function(n){t.resolve(n)}).error(function(n){console.log("Error in update company theme api call"),t.reject(n)}),t.promise},n.prototype.GetCustomHelpdeskSettings=function(){var i="/admin/api/Settings/company/helpdesk",n={},r=[],t=this.$q.defer();return this.HttpService.Get(i,r,!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in Get company helpdesk settings api call"),t.reject(n)}),t.promise},n.prototype.UpdateCustomHelpdeskSettings=function(n){var i="/admin/api/Settings/company/helpdesk",t=this.$q.defer();return this.HttpService.Post(i,n,i).success(function(n){t.resolve(n)}).error(function(n){console.log("Error in update company helpdesk settings api call"),t.reject(n)}),t.promise},n.prototype.GetCustomTiles=function(){var i="/admin/api/Settings/company/tile",n={},r=[],t=this.$q.defer();return this.HttpService.Get(i,r,!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in Get company custom tiles api call"),t.reject(n)}),t.promise},n.prototype.UpdateCustomTiles=function(n){var i="/admin/api/Settings/company/tile",t=this.$q.defer();return this.HttpService.Post(i,n,i).success(function(n){t.resolve(n)}).error(function(n){console.log("Error in update company custom tiles api call"),t.reject(n)}),t.promise},n.prototype.GetCustomTileandSupportVisibility=function(){var i="/admin/api/Settings/company/tile/visibility",n={},r=[],t=this.$q.defer();return this.HttpService.Get(i,r,!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in Get company custom tiles visibility api call"),O365.Log.WriteLog(419110,O365.LogLevel.Error,O365.LogArea.ModernAdminPortal,O365.LogParameter.Empty,"Error in get company custom tiles visibility call:"+n.data),t.reject(n)}),t.promise},n.prototype.AddCustomTile=function(n){var i="/admin/api/Settings/company/tile/add",r="/admin/api/Settings/company/tile",t=this.$q.defer();return this.HttpService.Post(i,n,r).success(function(n){t.resolve(n)}).error(function(n){console.log("Error in add company custom tile api call"),t.reject(n)}),t.promise},n.prototype.RemoveCustomTile=function(n){var i="/admin/api/Settings/company/tile/remove",r="/admin/api/Settings/company/tile",t=this.$q.defer();return this.HttpService.Post(i,n,r).success(function(n){t.resolve(n)}).error(function(n){console.log("Error in remove company custom tile api call"),t.reject(n)}),t.promise},n.prototype.GetDataLocations=function(){var i="/admin/api/tenant/datalocation",n={},r=[],t=this.$q.defer();return this.HttpService.Get(i,r,!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in Get data location for services"),O365.Log.WriteLog(419110,O365.LogLevel.Error,O365.LogArea.ModernAdminPortal,O365.LogParameter.Empty,"Error in Get data location for services call:"+n.data),t.reject(n)}),t.promise},n.prototype.GetEligibleLocalLocation=function(){var i="/admin/api/tenant/localdatalocation",n={},r=[],t=this.$q.defer();return this.HttpService.Get(i,r,!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in Get local data location for tenant"),O365.Log.WriteLog(419110,O365.LogLevel.Error,O365.LogArea.ModernAdminPortal,O365.LogParameter.Empty,"Error in Get local data location for tenant call:"+n.data),t.reject(n)}),t.promise},n.prototype.SaveLocalDataMoveSettings=function(){var i="/admin/api/tenant/optinforlocaldatamove",t=["/admin/api/tenant/localdatalocation","/admin/api/tenant/datalocation"],n=this.$q.defer();return this.HttpService.Post(i,null,t).success(function(t){n.resolve(t)}).error(function(t){console.log("Error in setting local data move opt in to true"),O365.Log.WriteLog(419110,O365.LogLevel.Error,O365.LogArea.ModernAdminPortal,O365.LogParameter.Empty,"Error in setting local data move opt in to true call:"+t),n.reject(t)}),n.promise},n.$inject=["$q","$http","HttpService"],n}();n.CompanyProfileService=t,n.app&&n.app.service("CompanyProfileService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n){this.$http=n}return n.prototype.GetErrorsList=function(){var n="/admin/api/dirsyncerrors",t=[];return this.$http.get(n,t).success(function(n){return n}).error(function(){console.log("Error in GetErrorsList() API call")})},n.prototype.GetConflictingObjects=function(n){var t="/admin/api/dirsyncerrors/conflictingobjects";return this.$http({url:t,params:{ErrorCategory:n.ErrorCategory,PropertyName:n.PropertyName,PropertyValue:n.PropertyValue},method:'GET',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(){console.log("Error in GetConflictingObjects() API call")})},n.$inject=["$http"],n}();n.DirSyncObjectErrorsService=t,AdminApp.service("DirSyncObjectErrorsService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(n,t){this.$rootScope=n,this.LogService=t}return t.prototype.GetCulturePrefix=function(){return this.$rootScope.CultureInfo.toUpperCase()+'_'},t.prototype.GetStatus=function(n,t){if(t===1||t===2)return'Removed';switch(n){case 1:return'On';case 0:case 2:case 3:case 4:return'Off';default:return this.LogService.LogError(417757,'Unsupported status code '+n),'Off'}},t.prototype.CreateDisplayAddIn=function(t,i){var r=new n.DisplayAddIn;return r.AppId=i.AppId,r.Description=this.GetLocalizedData(t,'Description',i.LocalizedDescriptions,i.Description),r.DisplayName=this.GetLocalizedData(t,'Name',i.LocalizedNames,i.DisplayName),r.IconUrl=this.GetLocalizedData(t,'IconUrl',i.LocalizedIconUrls,i.IconUrl),r.HostApps=i.OfficeProducts.join(', '),r.Name=i.AddInId,r.ServicePrincipalObjectId=i.ServicePrincipalObjectId,r.AssignedGroups=i.AssignedGroups,r.AssignedUsers=i.AssignedUsers,r.Capabilities=i.Capabilities,r.LimitedAvailability=i.LimitedAvailability,r.ProviderName=i.ProviderName,r.Version=i.Version,r.Scopes=i.Scopes,r.StatusCode=i.StatusCode,r.Status=this.GetStatus(i.StatusCode,i.StoreStatusCode),r.IsPrivateCatalog=!0,r},t.prototype.GetLocalizedData=function(n,t,i,r){if(!i)return this.LogService.LogError(417760,'The localized '+t+' set returned by GetAddInDetails is null.'),r;var f=n+t,u=i[f];return u?u:r},t.$inject=['$rootScope','LogService'],t}();n.PrivateCatalogDisplayService=t,AdminApp.service('PrivateCatalogDisplayService',t)})(Admin||(Admin={}));var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Admin;(function(n){'use strict';;var h=function(){function n(n,t,i,r,u){this.$rootScope=n,this.$q=t,this.HttpService=i,this.LogService=r,this.PrivateCatalogUrl=u}return n.prototype.UploadAddIn=function(n,t,i,r,u,f,e,o){var h=this,c=this.PrivateCatalogUrl+'UploadAddIn',l={Locale:this.$rootScope.CultureInfo,AddInContents:t,AddInUrl:i,AssetId:r,ContentMarket:u,DeepLinkingCampaign:f,Members:e,Status:s[n],LimitedAvailability:o};return this.HttpService.Post(c,l).then(function(n){return h.UploadAddInSuccess(n)},function(n){return h.CallError(n,'UploadAddIn')})},n.prototype.UploadAddInSuccess=function(t){this.LogService.LogInfo(417805,n.CreateSuccessLogString(t,'UploadAddIn'));var r=new u;return r.ResponseResult=i[t.data.ResponseResult],r.ErrorMessages=t.data.ErrorMessages,r.ResponseResult===0&&(r.FailedEmailAddresses=t.data.FailedEmailAddresses,r.NestedGroupAddresses=t.data.NestedGroupAddresses,r.AddInDetails=n.ConvertAddIn(t.data.AddInDetails)),r},n.prototype.GetAddInDetails=function(n){var t=this,i,r;return n===void 0&&(n=null),i=this.PrivateCatalogUrl+'GetAddInDetails',r={Locale:this.$rootScope.CultureInfo,ServicePrincipalObjectIds:n},this.HttpService.Post(i,r).then(function(n){return t.GetAddInDetailsSuccess(n)},function(n){return t.CallError(n,'GetAddInDetails')})},n.prototype.GetAddInDetailsSuccess=function(t){this.LogService.LogInfo(417806,n.CreateSuccessLogString(t,'GetAddInDetails'));var r=new f;return r.ResponseResult=i[t.data.ResponseResult],r.ErrorMessages=t.data.ErrorMessages,r.ResponseResult===0&&(r.AddInDetails=n.ConvertAddIns(t.data.AddInDetails)),r},n.prototype.UpdateAddInAssignments=function(n,t,i,r){var u=this,f=this.PrivateCatalogUrl+'UpdateAddInAssignments',e={Locale:this.$rootScope.CultureInfo,ServicePrincipalObjectId:n,LimitedAvailability:t,AddMemberEmailAddresses:i,RemoveMemberEmailAddresses:r};return this.HttpService.Put(f,e).then(function(n){return u.UpdateAddInAssignmentsSuccess(n)},function(n){return u.CallError(n,'UpdateAddInAssignments')})},n.prototype.UpdateAddInAssignmentsSuccess=function(t){this.LogService.LogInfo(417807,n.CreateSuccessLogString(t,'UpdateAddInAssignments'));var u=new r;return u.ResponseResult=i[t.data.ResponseResult],u.ErrorMessages=t.data.ErrorMessages,u.ResponseResult===0&&(u.FailedEmailAddresses=t.data.FailedEmailAddresses,u.NestedGroupAddresses=t.data.NestedGroupAddresses),u},n.prototype.RemoveAddIn=function(n){var t=this,i=this.PrivateCatalogUrl+'RemoveAddIn',r={Locale:this.$rootScope.CultureInfo,ServicePrincipalObjectId:n};return this.HttpService.Delete(i,r).then(function(n){return t.CallSuccess(n,'RemoveAddIn')},function(n){return t.CallError(n,'RemoveAddIn')})},n.prototype.ChangeAddInStatus=function(n,t){var i=this,r=this.PrivateCatalogUrl+'ChangeAddInStatus',u={Locale:this.$rootScope.CultureInfo,StatusChange:n,ServicePrincipalObjectId:t};return this.HttpService.Put(r,u).then(function(n){return i.CallSuccess(n,'ChangeAddInStatus')},function(n){return i.CallError(n,'ChangeAddInStatus')})},n.prototype.UpdateAddInAvailability=function(n,t){var i=this,r=this.PrivateCatalogUrl+'UpdateAddInAvailability',u={Locale:this.$rootScope.CultureInfo,LimitedAvailability:n,ServicePrincipalObjectId:t};return this.HttpService.Put(r,u).then(function(n){return i.CallSuccess(n,'UpdateAddInAvailability')},function(n){return i.CallError(n,'UpdateAddInAvailability')})},n.prototype.GetManifestDetails=function(n,t,i,r,u,f){var e=this,o=this.PrivateCatalogUrl+'GetManifestDetails',s={Locale:this.$rootScope.CultureInfo,ServicePrincipalObjectId:n,AddInContents:t,AddInUrl:i,AssetId:r,ContentMarket:u,DeepLinkingCampaign:f};return this.HttpService.Post(o,s).then(function(n){return e.GetManifestDetailsSuccess(n)},function(n){return e.CallError(n,'GetManifestDetails')})},n.prototype.GetManifestDetailsSuccess=function(t){this.LogService.LogInfo(417808,n.CreateSuccessLogString(t,'GetManifestDetails'));var r=new o;return r.ResponseResult=i[t.data.ResponseResult],r.ErrorMessages=t.data.ErrorMessages,r.ResponseResult===0&&(r.AddInDetails=n.ConvertAddIn(t.data.AddInDetails)),r},n.prototype.UpdateAddIn=function(n,t,i){var r=this,u=this.PrivateCatalogUrl+'UpdateAddIn',f={Locale:this.$rootScope.CultureInfo,AddInContents:n,AddInUrl:t,ServicePrincipalObjectId:i};return this.HttpService.Put(u,f).then(function(n){return r.CallSuccess(n,'UpdateAddIn')},function(n){return r.CallError(n,'UpdateAddIn')})},n.prototype.CallSuccess=function(r,u){this.LogService.LogInfo(417809,n.CreateSuccessLogString(r,u));var f=new t;return f.ResponseResult=i[r.data.ResponseResult],f.ErrorMessages=r.data.ErrorMessages,f},n.prototype.CallError=function(n,t){return this.LogService.LogError(417810,String(t+' call failed. Status: '+n.status+'. Status text: '+n.statusText+'.')),this.$q.reject(null)},n.prototype.GetErrorMessage=function(n){n===void 0&&(n=null);var t;if(n===null)t='The request could not be completed.';else switch(n){case 0:this.LogService.LogError(417811,'Response result '+n+' indicates it is a success. There should not be an error message.'),t='';break;case 1:t='The requested action failed.';break;case 2:t='Cannot perform the action you requested. Please try again later.';break;case 3:t='Failed to register the Add-In.';break;case 4:t='Unable to retrieve the user information.';break;case 5:t='Unable to retrieve the group information.';break;case 6:t='An error occured with Active Directory. Cannot locate service principal object.';break;case 7:t='Unable to find the Add-In.';break;case 8:t='This Add-In has previously been uploaded. Please edit the existing Add-In.';break;case 9:t='Unable to complete the action.';break;case 10:t='<a href="https://dev.office.com/docs/add-ins/overview/add-in-manifests">The manifest provided has an incorrect format and cannot be uploaded. Please refer to the documentation.</a>';break;case 11:t='Cannot register your Add-In. Please try again later.';break;case 12:t='There was an error when opening the manifest file of the add-in. The manifest either wasn\x27t found or contained errors.';break;case 13:t='Failed to remove the Add-In from Exchange. Please try again later.';break;case 14:t='Failed to update the Add-In. Please try again later.';break;case 15:t='Manifest file validation has failed.';break;case 16:t='Error deleting the Add-In. Could not find the application object. Please try again later.';break;case 17:t='Error deleting the Add-In. Could not delete the service principal object. Please try again later.';break;case 18:t='Unable to update the user\x2fgroup assignment for the Add-In. Please try again later.';break;case 19:t='Unable to add the user\x2fgroup assignment for the Add-In. Please try again later.';break;case 20:t='Unable to update some or all of the user\x2fgroup assignments for the Add-In. Please try again later.';break;case 21:t='Cannot update your Add-In. Please try again later.';break;case 22:t='Error registering Add-In. You have reached the limit on the number of Add-Ins that can be registered for your organization. Please remove unused Add-Ins and try again.';break;case 23:t='The Add-In is corrupted as its ID is currently missing. Please try again later.';break;case 24:t='The existing Add-In is corrupted as its version cannot be interpreted. Please try again later.';break;case 25:t='The ID of the Add-In cannot be interpreted. Please ensure the manifest file is valid and try again.';break;case 26:t='The version of the Add-In cannot be interpreted. Please ensure the manifest file is valid and try again.';break;case 27:t='Cannot update the Add-In as the ID of the new Add-In differs from that of the existing Add-In.';break;case 28:t='Cannot update the Add-In as the version of the new Add-In is equal to or less than that of the existing Add-In.';break;case 29:t='Error displaying the Add-In. Please refresh the page to view the registered Add-In.';break;case 30:t='Manifest uploaded is not a valid XML file.';break;case 31:t='Cannot update the Add-In as this is an Office store add-in.';break;case 32:t='Unable to upload this add-in as it has already been added.';break;case 33:t='Something went wrong and we can\x27t show the Add-ins right now. Please try again later.';break;case 34:t='You don\x27t have sufficient privileges to complete this action. It must be performed by a Tenant Admin.';break;default:this.LogService.LogError(417812,'Response result '+n+' is not supported.'),t='Cannot perform the action you requested. Please try again later.'}return t},n.ConvertAddIns=function(t){var i=[];return angular.forEach(t,function(t){return i.push(n.ConvertAddIn(t))}),i},n.ConvertAddIn=function(n){if(!n)return null;var t=new e;return t.AddInId=n.AddInId,t.AppId=n.AppId,t.AssignedGroups=n.AssignedGroups,t.AssignedUsers=n.AssignedUsers,t.Capabilities=n.Capabilities,t.Description=n.Description,t.DisplayName=n.DisplayName,t.IconUrl=n.IconUrl,t.LimitedAvailability=n.LimitedAvailability,t.Locale=n.Locale,t.LocalizedDescriptions=n.LocalizedDescriptions,t.LocalizedIconUrls=n.LocalizedIconUrls,t.LocalizedNames=n.LocalizedNames,t.OfficeProducts=n.OfficeProducts,t.ProviderName=n.ProviderName,t.Scopes=n.Scopes,t.StatusCode=s[n.StatusCode],t.StoreStatusCode=c[n.StoreStatusCode],t.Type=n.Type,t.ServicePrincipalObjectId=n.ServicePrincipalObjectId,t.Version=n.Version,t},n.CreateSuccessLogString=function(n,t){return t+' call succeeded. Response result: '+n.data.ResponseResult+'. Status text: '+n.statusText+'.'},n.$inject=['$rootScope','$q','HttpService','LogService','PrivateCatalogUrl'],n}(),t,r,u,f,e,o,s,c,i;n.PrivateCatalogService=h,t=function(){function n(){}return n}(),n.PrivateCatalogResponse=t,r=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(t),n.UpdateAddInAssignmentsResponse=r,u=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(t),n.UploadAddInResponse=u,f=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(t),n.GetAddInDetailsResponse=f,e=function(){function n(){}return n}(),n.AddIn=e,o=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(t),n.GetManifestDetailsResponse=o,function(n){n[n.Undefined=-1]="Undefined",n[n.Removed=0]="Removed",n[n.Ok=1]="Ok",n[n.Withdrawn=2]="Withdrawn",n[n.Flagged=3]="Flagged",n[n.Withdrawingsoon=4]="Withdrawingsoon"}(n.AddInStatusCode||(n.AddInStatusCode={})),s=n.AddInStatusCode,function(n){n[n.Undefined=-1]="Undefined",n[n.OK=0]="OK",n[n.Removed=1]="Removed",n[n.Withdrawn=2]="Withdrawn",n[n.Flagged=3]="Flagged",n[n.Withdrawingsoon=4]="Withdrawingsoon"}(n.AddInStoreStatusCode||(n.AddInStoreStatusCode={})),c=n.AddInStoreStatusCode,function(n){n[n.Success=0]="Success",n[n.Failure=1]="Failure",n[n.BadRequest=2]="BadRequest",n[n.FailedAddInRegistration=3]="FailedAddInRegistration",n[n.UserNotFound=4]="UserNotFound",n[n.GroupNotFound=5]="GroupNotFound",n[n.ServicePrincipalNotFound=6]="ServicePrincipalNotFound",n[n.AddInNotFound=7]="AddInNotFound",n[n.AddInExists=8]="AddInExists",n[n.FailedWriteToExchange=9]="FailedWriteToExchange",n[n.FailedManifestExtract=10]="FailedManifestExtract",n[n.FailedServicePrincipalRegistration=11]="FailedServicePrincipalRegistration",n[n.UnableToParseManifest=12]="UnableToParseManifest",n[n.FailedRemoveManifestFromExchange=13]="FailedRemoveManifestFromExchange",n[n.FailedApplicationUpdate=14]="FailedApplicationUpdate",n[n.FailedManifestValidation=15]="FailedManifestValidation",n[n.ApplicationNotFound=16]="ApplicationNotFound",n[n.FailedServicePrincipalDeletion=17]="FailedServicePrincipalDeletion",n[n.FailedAppRoleAssignmentDeletion=18]="FailedAppRoleAssignmentDeletion",n[n.FailedAppRoleAssignmentAddition=19]="FailedAppRoleAssignmentAddition",n[n.FailedAppRoleAssignmentUpdate=20]="FailedAppRoleAssignmentUpdate",n[n.FailedServicePrincipalUpdate=21]="FailedServicePrincipalUpdate",n[n.MaximumAddInsAllowedDetected=22]="MaximumAddInsAllowedDetected",n[n.MissingId=23]="MissingId",n[n.FailedExistingVersionParsing=24]="FailedExistingVersionParsing",n[n.FailedNewIdParsing=25]="FailedNewIdParsing",n[n.FailedNewVersionParsing=26]="FailedNewVersionParsing",n[n.UpdateIdDifferent=27]="UpdateIdDifferent",n[n.UpdateVersionSameOrLower=28]="UpdateVersionSameOrLower",n[n.FailedServicePrincipalConvertToAddInModel=29]="FailedServicePrincipalConvertToAddInModel",n[n.FailedManifestLoad=30]="FailedManifestLoad",n[n.UnableToUpdateStoreAddIn=31]="UnableToUpdateStoreAddIn",n[n.StoreAddInAlreadyUploaded=32]="StoreAddInAlreadyUploaded",n[n.UnableToGetAddInList=33]="UnableToGetAddInList",n[n.InsufficientPrivileges=34]="InsufficientPrivileges"}(n.PrivateCatalogResultCode||(n.PrivateCatalogResultCode={})),i=n.PrivateCatalogResultCode,AdminApp.service('PrivateCatalogService',h),AdminApp.constant('PrivateCatalogUrl','/admin/api/privatecatalog/')})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(){}return n.prototype.Reset=function(){this.Contents='',this.Url='https://',this.IsExistingAddIn=!1,this.ServicePrincipalObjectId=null,this.AudiencePicker=1,this.Members=[],this.IsUpdating=!1,this.IsEnabled=!0,this.IsNewEnableSet=!1,this.AssetId='',this.ContentCulture='',this.DeepLinkingCampaign=null},n}(),r,i;n.ManifestUploadService=t,function(n){n[n.Everyone=0]="Everyone",n[n.Specified=1]="Specified"}(n.AudiencePicker||(n.AudiencePicker={})),r=n.AudiencePicker,i=function(){function n(){}return n}(),n.Member=i,AdminApp.service('ManifestUploadService',t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(){}return n.prototype.LogInfo=function(n,t){O365.Log.WriteLog(n,O365.LogLevel.Info,O365.LogArea.O365Settings,O365.LogParameter.Empty,t)},n.prototype.LogError=function(n,t){O365.Log.WriteLog(n,O365.LogLevel.Error,O365.LogArea.O365Settings,O365.LogParameter.Empty,t)},n}();n.LogService=t,AdminApp.service('LogService',t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){this.$q=n,this.$http=t,this.HttpService=i,this.GetSettings=function(n){return this.$http({url:n,method:'GET',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(n){return n})},this.UpdateSettings=function(n,t){return this.$http({method:'POST',url:n,data:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(n){return n})},this.GetProductSettings=function(){var n=this.$q.defer(),t={},i="/admin/api/officepolicies/ListOfficePolicyProducts";return this.HttpService.Get(i).success(function(i){t.data=i,n.resolve(t)}).error(function(){console.log("Error in Get product settings call"),n.reject(t)})},this.CreateOfficePolicySettings=function(n,t){var i=this.$q.defer(),r="/admin/api/officepolicies/officepolicydetails",u={OfficePolicyId:n,OfficePolicySettingTemplateId:t};return this.HttpService.Post(r,u).success(function(n){return i.resolve(n),i.promise}).error(function(){return console.log("Error in Get product settings call"),i.reject({}),i.promise})},this.UpdateOfficePolicySettings=function(n){var t=this.$q.defer(),i="/admin/api/officepolicies/officepolicydetails",r=n;return this.HttpService.Put(i,r).success(function(n){return t.resolve(n),t.promise}).error(function(){return console.log("Error in Get product settings call"),t.reject({}),t.promise})}}return n.prototype.GetPasswordPolicy=function(){var n="/admin/api/Settings/security/passwordpolicy";return this.GetSettings(n)},n.prototype.UpdatePasswordPolicy=function(n){var t="/admin/api/Settings/security/passwordpolicy";return this.UpdateSettings(t,n)},n.prototype.GetDataAccessSettings=function(){var n="/admin/api/Settings/security/dataaccess";return this.GetSettings(n)},n.prototype.GetGuestUserSettings=function(){var n="/admin/api/Settings/security/guestUserPolicy";return this.GetSettings(n)},n.prototype.UpdateGuestUserSettings=function(n){var t="/admin/api/Settings/security/guestUserPolicy";return this.UpdateSettings(t,n)},n.prototype.UpdateDataAccessSettings=function(n){var t="/admin/api/Settings/security/dataaccess";return this.UpdateSettings(t,n)},n.prototype.GetAuditSettings=function(){var n="/admin/api/Settings/security/auditstore";return this.GetSettings(n)},n.prototype.UpdateAuditSettings=function(n){var t="/admin/api/Settings/security/auditstore";return this.UpdateSettings(t,n)},n.prototype.GetCommunitySettings=function(){var n="/admin/api/settings/apps/community";return this.GetSettings(n)},n.prototype.UpdateCommunitySettings=function(n){var t="/admin/api/settings/apps/community";return this.UpdateSettings(t,n)},n.prototype.GetOfficeOnlineSettings=function(){var n="/admin/api/settings/apps/officeonline";return this.GetSettings(n)},n.prototype.UpdateOfficeOnlineSettings=function(n){var t="/admin/api/settings/apps/officeonline";return this.UpdateSettings(t,n)},n.prototype.GetOfficeNotificationHubSettings=function(){var n="/admin/api/settings/apps/officenotificationhub";return this.GetSettings(n)},n.prototype.UpdateOfficeNotificationHubSettings=function(n){var t="/admin/api/settings/apps/officenotificationhub";return this.UpdateSettings(t,n)},n.prototype.GetCortanaSettings=function(){var n="/admin/api/settings/apps/cortana";return this.GetSettings(n)},n.prototype.UpdateCortanaSettings=function(n){var t="/admin/api/settings/apps/cortana";return this.UpdateSettings(t,n)},n.prototype.GetSwaySettings=function(){var n="/admin/api/settings/apps/sway";return this.GetSettings(n)},n.prototype.UpdateSwaySettings=function(n){var t="/admin/api/settings/apps/sway";return this.UpdateSettings(t,n)},n.prototype.GetGigJamSettings=function(){var n="/admin/api/settings/apps/gigjam";return this.GetSettings(n)},n.prototype.UpdateGigJamSettings=function(n){var t="/admin/api/settings/apps/gigjam";return this.UpdateSettings(t,n)},n.prototype.GetDocsComSettings=function(){var n="/admin/api/settings/apps/docscom";return this.GetSettings(n)},n.prototype.UpdateDocsComSettings=function(n){var t="/admin/api/settings/apps/docscom";return this.UpdateSettings(t,n)},n.prototype.GetSkypeTeamsSettings=function(){var n="/admin/api/settings/apps/skypeteams";return this.GetSettings(n)},n.prototype.UpdateSkypeTeamsSettings=function(n){var t="/admin/api/settings/apps/skypeteams";return this.UpdateSettings(t,n)},n.prototype.GetSkypeSettings=function(){var n="/admin/api/settings/apps/skype";return this.GetSettings(n)},n.prototype.UpdateSkypeSettings=function(n){var t="/admin/api/settings/apps/skype";return this.UpdateSettings(t,n)},n.prototype.GetO365GroupsGuestSettings=function(){var n="/admin/api/settings/security/o365guestuser";return this.GetSettings(n)},n.prototype.UpdateO365GroupsGuestSettings=function(n){var t="/admin/api/settings/security/o365guestuser";return this.UpdateSettings(t,n)},n.prototype.GetSoftwareInstallSettings=function(){var n="/admin/api/settings/apps/usersoftware";return this.GetSettings(n)},n.prototype.SetSoftwareInstallSettings=function(n){var t="/admin/api/settings/apps/usersoftware";return this.UpdateSettings(t,n)},n.prototype.GetModernAuthSettings=function(){var n="/admin/api/settings/security/modernauth";return this.GetSettings(n)},n.prototype.UpdateModernAuthSettings=function(n){var t="/admin/api/settings/security/modernauth";return this.UpdateSettings(t,n)},n.prototype.SendDelveRequestEmail=function(n){var t="/admin/api/users/sendemail";return this.UpdateSettings(t,n)},n.prototype.GetReportsSettings=function(){var n="/admin/api/reports/config/GetTenantConfiguration";return this.GetSettings(n)},n.prototype.UpdateReportsSettings=function(n){var t="/admin/api/reports/config/SetTenantConfiguration";return this.UpdateSettings(t,n)},n.prototype.GetReportsPrivacySettings=function(){var n="/admin/api/reports/config/GetPrivacyEnabled";return this.GetSettings(n)},n.prototype.UpdateReportsPrivacySettings=function(n){var t="/admin/api/reports/config/SetPrivacyEnabled";return this.UpdateSettings(t,n)},n.prototype.GetMultiFactorAuthSettings=function(){var n="/admin/api/settings/security/multifactorauth";return this.GetSettings(n)},n.prototype.GetStaffHubSettings=function(){var n="/admin/api/settings/apps/staffhub";return this.GetSettings(n)},n.prototype.GetDirSyncSettings=function(){var n="/admin/api/settings/apps/dirsync";return this.GetSettings(n)},n.prototype.GetSoftwareDownloadLinks=function(){var i="/admin/api/tenant/downloadLinks",n={},r=[],t=this.$q.defer();return this.HttpService.Get(i,r,!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in Get software download links call"),t.reject(n)}),t.promise},n.prototype.GetAADLink=function(){var i="/admin/api/tenant/AADLink",n={},r=[],t=this.$q.defer();return this.HttpService.Get(i,r,!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,t.reject(n)}),t.promise},n.prototype.CreatePolicy=function(n){var r="/admin/api/officepolicies",t={},u=[],i=this.$q.defer();return this.HttpService.Post(r,n).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,i.reject(t)}),i.promise},n.prototype.ListOfficePolicies=function(){var i="/admin/api/officepolicies/ListOfficePolicies",n={},r=[],t=this.$q.defer();return this.HttpService.Get(i,r).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,t.reject(n)}),t.promise},n.prototype.GetAssignedGroups=function(){var n=this.$q.defer(),t=[{Prefix:"H",Name:"Help Desk"},{Prefix:"I",Name:"IT Support"},{Prefix:"N",Name:"Network Admins"}];return n.resolve(t),n.promise},n.prototype.GetGroupsToAssign=function(){var n=this.$q.defer(),t=[{Prefix:"H",Name:"Human Resource"},{Prefix:"T",Name:"Tech Support"},{Prefix:"H",Name:"House Keeping"}];return n.resolve(t),n.promise},n.prototype.UpdateOfficePolicy=function(n){var r="/admin/api/officepolicies",t={},u=[],i=this.$q.defer();return this.HttpService.Put(r,n).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,i.reject(t)}),i.promise},n.prototype.CopyOfficePolicy=function(n){var r="/admin/api/officepolicies/CopyOfficePolicy",t={},u=[],i=this.$q.defer();return this.HttpService.Post(r,n).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,i.reject(t)}),i.promise},n.prototype.GetProductConfigurationViewOptions=function(){var n=this.$q.defer(),t=[{ID:"",Name:"All Settings"},{ID:"No",Name:"Policies"},{ID:"Yes",Name:"Preferences"}];return n.resolve(t),n.promise},n.prototype.GetProductConfigurationPolicies=function(n,t){var u="/admin/api/officepolicies/ListOfficeProductDetails/?officePolicyId="+n+"&productName="+t,i={},f=[],r=this.$q.defer();return this.HttpService.Get(u,f).success(function(n){i.data=n,r.resolve(i)}).error(function(n){i.data=n,console.log("Error in Get product settings call"),r.reject(i)}),r.promise},n.prototype.DeleteSettings=function(n){var t=this.$q.defer(),i="/admin/api/officepolicies/?officePolicyId="+n,r=[];return this.HttpService.Delete(i,r).success(function(n){return t.resolve(n),t.promise}).error(function(n){return t.reject(n),t.promise})},n.$inject=["$q","$http","HttpService"],n}();n.SettingsService=t,AdminApp.service("SettingsService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n){this.$http=n}return n.prototype.GetUserToken=function(){return this.$http.get("/admin/api/domorepoll").then(function(n){return n.data})},n.prototype.NextPoll=function(n,t,i,r,u){var e=n+"userquests/"+i+"/phases/"+r,f=new PhaseStatus;return f.Status="Completed",f.Version=u,f.Verification=null,this.$http({method:'PUT',url:e,headers:{Authorization:'Bearer '+t},data:f})},n.prototype.SubmitPoll=function(n,t,i,r,u){var e=n+"userquests/",o="Completed",f=new UserQuest;return f.Puid=t,f.FirstPhase={Status:o,Verification:r,Version:null},f.QuestId=u,this.$http({method:'POST',url:e,headers:{Authorization:'Bearer '+i},data:f})},n.prototype.GetPollResults=function(n,t,i){var r=n+"verificationanswers/"+i;return this.$http({method:'GET',url:r,headers:{Authorization:'Bearer '+t}})},n.prototype.GetPoll=function(n,t,i){var r="&include=Poll&IsComplete=false",u=n+"userquests?puid="+t+r;return this.$http({method:'GET',url:u,headers:{Authorization:'Bearer '+i}})},n.prototype.SendSMS=function(n,t,i){return this.$http({method:'POST',url:n,headers:{Authorization:'Bearer '+i},data:t})},n.$inject=["$http"],n}();n.DoMorePollService=t,AdminApp.service("DoMorePollService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n){this.$http=n}return n.prototype.GetPartnerDetails=function(n){var t="/admin/api/Partners/"+n,i=[];return this.$http.get(t,i).success(function(n){return n}).error(function(){console.log("Error retrieving single partner")})},n.prototype.GetPartners=function(){var n="/admin/api/Partners/GetPartners";return this.$http({url:n,method:'POST',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(){console.log("Error retrieving partners")})},n.prototype.DeletePartners=function(n){var t="/admin/api/Partners";return this.$http({method:'POST',url:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),'X-HTTP-Method-Override':'DELETE'},data:n}).success(function(n){return n}).error(function(n){return console.log("Error deleting partner"),n})},n.prototype.RemoveDap=function(n){var t="/admin/api/Partners/RemoveDap";return this.$http({method:'POST',url:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:n}).success(function(n){return n}).error(function(n){return console.log("Error removing dap from partners"),n})},n.prototype.GetDapGrantData=function(n,t,i){var r="/admin/api/tenant/AuthorizeDelegateAdmin",u={params:{partnerId:n,msppid:t,resellerflag:i}};return this.$http.get(r,u).success(function(n){return n}).error(function(){console.log("Error retreiving grant data")})},n.prototype.AuthorizeDelegateAdmin=function(n){var t="/admin/api/tenant/AuthorizeDelegateAdmin";return this.$http({method:'POST',url:t,data:n,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(n){return n})},n.$inject=["$http"],n}();n.PartnerService=t,AdminApp.service("PartnerService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var i,r,u,t;(function(n){n[n.User=0]="User",n[n.Group=1]="Group",n[n.Contact=2]="Contact",n[n.Task=3]="Task",n[n.ExternalUser=4]="ExternalUser",n[n.Recipient=5]="Recipient",n[n.Member=6]="Member",n[n.Domain=7]="Domain",n[n.AppPermission=8]="AppPermission"})(n.SearchType||(n.SearchType={})),i=n.SearchType,function(n){n[n.User=0]="User",n[n.Group=1]="Group",n[n.SharedMailbox=2]="SharedMailbox",n[n.ResourceMailbox=3]="ResourceMailbox",n[n.MailboxMembership=4]="MailboxMembership",n[n.MailboxSendOnBehalf=5]="MailboxSendOnBehalf",n[n.ReleasePreferenceUsers=6]="ReleasePreferenceUsers",n[n.AppPermission=7]="AppPermission"}(n.CheckMembershipType||(n.CheckMembershipType={})),r=n.CheckMembershipType,function(n){n[n.UserGroups=0]="UserGroups",n[n.GroupMembers=1]="GroupMembers",n[n.GroupOwners=2]="GroupOwners",n[n.SharedMailboxMembers=3]="SharedMailboxMembers",n[n.ReleasePreferenceUsers=4]="ReleasePreferenceUsers",n[n.ReleasePreferenceCompassUsers=5]="ReleasePreferenceCompassUsers"}(n.MembershipType||(n.MembershipType={})),u=n.MembershipType,t=function(){function n(n,t,i,r,u,f,e,o,s,h,c){var v=this,a,l;this.$q=n,this.HttpService=t,this.ProfileService=i,this.AppsService=r,this.GroupService=u,this.SharedMailboxService=f,this.SitesService=e,this.CompanyProfileService=o,this.LogService=s,this.DomainService=h,this.$rootScope=c,this.validApps=[],this.limitResultCount=5,this.ozRanker=null,this.GetUsers=function(n,t,i){var i;i===void 0&&(i=null);var f="/admin/api/Users/ListUsers",e=this.GetMaxResults(t),r={ListAction:-1,ListContext:i,SearchText:n,SelectedView:null,SelectedViewType:null,SortDirection:0,SortPropertyName:"DisplayName"},u=this;if(t&&t!==null){if(!angular.isUndefined(t.Membership))switch(t.Membership){case 1:var o=t.CheckMembershipDetails.GroupType,s=t.CheckMembershipDetails.GroupId,h=t.CheckMembershipDetails.GroupSmtp,i=i;return this.GroupService.GetGroupMembers(o,s,h,n,i).then(function(n){if(n.data!==null){var t=n.data.Members,i=n.data.NextPage;return u.NormalizeSearchResults(6,t,i,e,u)}});case 2:var o=t.CheckMembershipDetails.GroupType,s=t.CheckMembershipDetails.GroupId,h=t.CheckMembershipDetails.GroupSmtp,i=i;return this.GroupService.GetGroupOwners(o,s,h,n,i).then(function(n){if(n.data!==null){var t=n.data.Owners,i=n.data.NextPage;return u.NormalizeSearchResults(6,t,i,e,u)}});case 3:return i=i,this.SharedMailboxService.GetPermissions(t.ObjectId,n).then(function(n){if(n.data!==null){var t=n.data.SharedMailboxMembers,i=n.data.NextPage;return u.NormalizeSearchResults(6,t,i,e,u)}});case 4:return this.CompanyProfileService.GetReleasePreferenceUsers(n,i).then(function(n){if(n.data!==null){var t=n.data.UserIdentities;return u.NormalizeSearchResults(0,t,null,e,u)}});case 5:return this.CompanyProfileService.GetReleasePreferenceCompassUsers(n,i).then(function(n){if(n.data!==null){var t=n.data.UserIdentities;return u.NormalizeSearchResults(0,t,null,e,u)}});default:this.LogService.LogError(421495,t.Membership+' is not a supported type to membership type.')}if(!angular.isUndefined(t.CheckMembership))switch(t.CheckMembership){case 1:f="/admin/api/Users/ListUsersWithGroupMembership",r.MaxResults=e,r.GroupDomain=t.CheckMembershipDetails.GroupDomain,r.GroupId=t.CheckMembershipDetails.GroupId,r.GroupType=t.CheckMembershipDetails.GroupType,r.GroupSmtp=t.CheckMembershipDetails.GroupSmtp,r.IsOwner=t.CheckMembershipDetails.IsOwner;break;case 2:f="/admin/api/sharedmailbox/listrecipientswithsharedmailboxmembership",r.sharedMailboxId=t.CheckMembershipDetails.SharedMailboxId;break;case 4:f="/admin/api/users/listrecipientswithmailboxmembership",r.objectId=t.CheckMembershipDetails.MailboxId,r={SearchText:n,objectId:t.CheckMembershipDetails.MailboxId};break;case 5:f="/admin/api/users/listrecipientswithmailboxsendonbehalf",r.objectId=t.CheckMembershipDetails.MailboxId,r={SearchText:n,objectId:t.CheckMembershipDetails.MailboxId};break;case 3:f="/admin/api/resourcemailbox/listrecipientswithresourcemailboxmembership",r.resourceMailboxObjectId=t.CheckMembershipDetails.ResourceMailboxId;break;case 6:f="/admin/api/users/ListUsersWithReleasePreferenceMembership",r.ReleaseTrack=t.CheckMembershipDetails.ReleaseTrack;break;default:this.LogService.LogError(418957,t.CheckMembership+' is not a supported type to check membership.')}}return this.HttpService.Post(f,r).then(function(n){var r=[],t,i;if(n.data!=null)return t=n.data.Users,i=!n.data.MetaData||n.data.MetaData.IsLastPage?null:n.data.MetaData.ListContext,u.NormalizeSearchResults(0,t,i,e,u)})},this.GetGroups=function(n,t,i){i===void 0&&(i=null);var e="/admin/api/Groups/GetGroups",r=this.GetMaxResults(t),u={SortDirection:0,SortField:'GroupName',SearchString:n,GroupTypes:null,PageToken:i},f=this;if(t&&t!==null){if(!angular.isUndefined(t.Membership))switch(t.Membership){case 0:var o="/admin/api/users/"+t.ObjectId+"/groups",s=n!==null?n:"",h={searchText:s};return this.HttpService.Get(o,h,!1).then(function(n){if(n.data!==null){var t=n.data.Groups,i=n.data.PageToken;return f.NormalizeSearchResults(1,t,i,r,f)}});default:this.LogService.LogError(0,t.Membership+' is not a supported type to membership type.')}if(!angular.isUndefined(t.CheckMembership))switch(t.CheckMembership){case 1:e="/admin/api/groups/GetGroupsCheckMembership",t.CheckMembershipDetails.MaxResults=r,u.GroupMembershipCheck=t.CheckMembershipDetails;break;case 0:e="/admin/api/groups/GetGroupsCheckUserMembership",t.CheckMembershipDetails.MaxResults=r,u.GroupMembershipCheck=t.CheckMembershipDetails;break;default:this.LogService.LogError(0,t.CheckMembership+' is not a supported type to check membership.')}t.GroupTypes&&t.GroupTypes!=null&&(u.GroupTypes=t.GroupTypes)}return this.HttpService.Post(e,u).then(function(n){var u=[],t,i;if(n.data!==null)return t=n.data.Groups,i=n.data.PageToken,f.NormalizeSearchResults(1,t,i,r,f)})},this.GetRecipients=function(n,t,i){var r;i===void 0&&(i=null);var u="/admin/api/groups/GetRecipientListForExchangeGroupOwnersMembers",f={SearchString:n,SortField:"DisplayName",SortDirection:0,NextLink:i},e=this.GetMaxResults(t);return t&&t!==null&&(angular.isUndefined(t.CheckMembership)||(u="/admin/api/groups/GetRecipientListForExchangeGroupOwnersMembers",t.CheckMembershipDetails.MaxResults=e,f.GroupMembershipCheck=t.CheckMembershipDetails)),r=this,this.HttpService.Post(u,f).then(function(n){var u=[],t,i;if(n.data!=null)return t=n.data.Users,i=n.data.NextLink,r.NormalizeSearchResults(0,t,i,e,r)})},this.GetContacts=function(n,t,i){var r;i===void 0&&(i=null);var u="/admin/api/Contact/GetContacts",f={SearchString:n,SortField:"ContactDisplayName",SortDirection:0,NextLink:i},e=this.GetMaxResults(t);return t&&t!==null&&(angular.isUndefined(t.CheckMembership)||(u="/admin/api/Contact/GetContactsCheckMembership",t.CheckMembershipDetails.MaxResults=e,f.GroupMembershipCheck=t.CheckMembershipDetails)),r=this,this.HttpService.Post(u,f).then(function(n){var u=[],t,i;if(n.data!=null)return t=n.data.Contacts,i=n.data.NextLink,r.NormalizeSearchResults(2,t,i,e,r)})},this.GetSiteUsers=function(n,t,i){i===void 0&&(i=null);var u=this.GetMaxResults(t),r=this;return this.SitesService.GetSiteExternalUsers(t.Identity,n).then(function(n){var f=[],t,i;if(n.data!==null)return t=n.data.ExternalUsers,i=n.data.PageToken,r.NormalizeSearchResults(0,t,i,u,r)})},this.GetAppsPermissionUserList=function(n){var t=this;return this.AppsService.GetAppPermission(n).then(function(n){var i=n.data;return t.NormalizeSearchResults(0,i,null,null,null)})},this.GetDomainList=function(n,t,i){i===void 0&&(i=null);var u=this.GetMaxResults(t),r=this;return this.DomainService.GetDomainList(t,n).then(function(n){var f=[],t;if(n.data!==null)return t=n.data,r.NormalizeSearchResults(7,t,i,u,r)})},this.NormalizeSearchResults=function(n,t,i,r,u){var e=[],f,o;return t!==null&&t.length>0&&(r&&r!==-1&&(t=t.slice(0,r)),f=[],angular.forEach(t,function(t,i){switch(n){case 0:t.ResultType="user",t.ResultId=t.UserPrincipalName;break;case 1:t.ResultType="group",t.ResultId=t.GroupId,t.DisplayName=t.GroupName,t.ObjectId=t.GroupId;break;case 2:t.ResultType="contact",t.ResultId=t.ContactExternalEmailAddress,t.DisplayName=t.ContactDisplayName;break;case 7:t.ResultType="domain",t.ResultId=t.Name,t.DisplayName=t.Name;break;case 6:t.ResultType="member",t.ResultId=t.ObjectId;break;default:this.LogService.LogError(418958,n+' is not a supported type for search result.')}t.Type=n,t.ResultPos=i,t.ProfileImageColor=t.InitialsColor?t.InitialsColor:u.ProfileService.GetProfileImageColor(t.DisplayName),t.ProfileInitials=t.Initials?t.Initials:u.ProfileService.GetGroupInitials(t.DisplayName),f.push(t)}),f[0].IsFirstItem=!0,o={type:n,value:f,pageToken:i},e.push(o)),e},this.GetMaxResults=function(n){var t=-1;return n&&n.MaxResults&&(t=n.MaxResults),t},this.GetTasksAndSettings=function(n){var e=this.$q.defer(),o=[],a=[],u,i,s,h,c;if(this.$rootScope.features.ModernSearchTasks)if(window.ModernSearchOzDataMapping)if(this.ozRanker){if(u=this.ozRanker.getBestClasses(n),u!=null&&u.length>0){var r=[],f=[],t=this,l=0;angular.forEach(u,function(n){var i=t.ParseOzResult(n),u,o,e;i&&(i.Action&&(i.ResultType="tasks",i.ResultId=i.Name,u={},i.WindowType.toLowerCase()=="settings"&&(o=$.grep(t.validApps,function(n){return n.Name==i.Action}),u=o[0],i.WindowType="flyout"),u&&t.$rootScope.features[i.FeatureId]&&(t.UserBasedFeatureMapping[i.FeatureId]!==undefined&&!t.UserBasedFeatureMapping[i.FeatureId]()||(u.ResultPos=l++,i.Args=u,r.push(i)))),t.$rootScope.features[i.FeatureId]&&t.$rootScope.features.ModernSearchHelp&&i.HelpId&&f.length<t.limitResultCount&&(e=[],angular.isArray(i.HelpId)?e=i.HelpId:e.push(i.HelpId),angular.forEach(e,function(n){f.indexOf(n)<0&&f.push(n)})))}),i=[],s=0,angular.forEach(f,function(n){var u={},r=t.GetHelpObject(n);r&&(u.ResultPos=s++,u.TopicId=r.TopicId,u.HelpId=n,r.ResultType="help",r.ResultId=n,r.Action="openHelp",r.Args=u,i.push(r))}),r=r.slice(0,this.limitResultCount),r.length>0&&(r[0].IsFirstItem=!0),h={type:'tasks',value:r},i=i.slice(0,this.limitResultCount),i.length>0&&(i[0].IsFirstItem=!0),c={type:'help',value:i},o.push(h,c)}}else O365.Log.WriteLog(423619,O365.LogLevel.Error,O365.LogArea.ModernAdminPortal,O365.LogParameter.Empty);else O365.Log.WriteLog(417185,O365.LogLevel.Error,O365.LogArea.ModernAdminPortal,O365.LogParameter.Empty);return e.resolve(o),e.promise},this.ParseOzResult=function(n){var t,i,r;return window.ModernSearchOzDataMapping[n]?(t=window.ModernSearchOzDataMapping[n],!t)?(O365.Log.WriteLog(417212,O365.LogLevel.Error,O365.LogArea.ModernAdminPortal,O365.LogParameter.Empty,n),null):(i=n,this.KeyExistsInStringDictionary(n)&&(i=window.ModernSearchLocDictionary[n]),r=t.ClickAction?{Name:i,Action:t.ClickAction.action,WindowType:t.ClickAction.WindowType,FeatureId:t.FeatureId,HelpId:t.HelpId}:{FeatureId:t.FeatureId,HelpId:t.HelpId}):(O365.Log.WriteLog(417186,O365.LogLevel.Error,O365.LogArea.ModernAdminPortal,O365.LogParameter.Empty,n),null)},this.GetHelpObject=function(n){var t,i;return n?(t=n,this.KeyExistsInStringDictionary(n)&&(t=window.ModernSearchLocDictionary[n]),i={Title:t,WindowType:"helpPopup"}):null},this.KeyExistsInStringDictionary=function(n){var t=!1;return window.ModernSearchLocDictionary?window.ModernSearchLocDictionary[n]?t=!0:O365.Log.WriteLog(417110,O365.LogLevel.Error,O365.LogArea.ModernAdminPortal,O365.LogParameter.Empty,n):O365.Log.WriteLog(417109,O365.LogLevel.Error,O365.LogArea.ModernAdminPortal,O365.LogParameter.Empty),t},this.AppTemplateMapping={Mail:"/AdminPortal/Settings/MailFlyoutTemplate",Calendar:"/AdminPortal/Settings/CalendarFlyoutTemplate",Community:"/AdminPortal/Settings/Community",RightsManagement:"/AdminPortal/Settings/RMSOnline",OfficeOnline:"/AdminPortal/Settings/OfficeOnline",Cortana:"/AdminPortal/Settings/Cortana",Skype:"/AdminPortal/Settings/Skype",Sway:"/AdminPortal/Settings/Sway",Sites:"/AdminPortal/Settings/sitessharing",Delve:"/AdminPortal/Settings/Delve",Reports:"/AdminPortal/Settings/Reports",MultiFactorAuth:"/AdminPortal/Settings/MultiFactorAuth",CRM:"/AdminPortal/Settings/DynamicsCrm",SkypeTeams:"/AdminPortal/Settings/SkypeTeamsSettings",GigJam:"/AdminPortal/Settings/GigJamSettings",DocsCom:"/AdminPortal/Settings/DocsComSettings",ERP:"/AdminPortal/Settings/DynamicsErp",SoftwareDownload:"/AdminPortal/Settings/SoftwareDownloadTemplate",Store:"/AdminPortal/Settings/Store",IntegratedApps:"/AdminPortal/Settings/IntegratedApps",BusinessApps:"/AdminPortal/Settings/BusinessApps",Mobile:"/AdminPortal/Settings/Mobile",DirSync:"/AdminPortal/Settings/DirSync",StaffHub:"/AdminPortal/Settings/StaffHub",OfficeClientPolicy:"/AdminPortal/Settings/OfficeClientPolicyTemplate"},window.NLRT&&window.ModernSearchOzClassifier&&(this.ozRanker=new window.NLRT.Ranker(window.ModernSearchOzClassifier)),a=function(){var n=c.CurrentUserInfo.SetupBanner;return n!==undefined&&n.SetupBannerType===1&&!v.$rootScope.features.SetupWizardServerSideDefinition},this.UserBasedFeatureMapping={FinishSetupBanner:function(){return a()}},l=this,r.GetApps().then(function(n){angular.forEach(n.data.Services,function(n){var t=l.AppTemplateMapping[n.Name];t&&(n.TemplateName=t,l.validApps.push(n))})})}return n.prototype.Search=function(n){var t=this.$q.defer(),i=[{SearchCategory:0,Filter:{MaxResults:this.limitResultCount}},{SearchCategory:1,Filter:{MaxResults:this.limitResultCount}},{SearchCategory:3,Filter:{MaxResults:this.limitResultCount}}];return this.InternalSearch(n,i).then(function(n){t.resolve(n)}),t.promise},n.prototype.SearchCategories=function(n,t){var i=this.$q.defer();return this.InternalSearch(n,t).then(function(n){i.resolve(n)}),i.promise},n.prototype.InternalSearch=function(n,t){var i=[],r;if(angular.isDefined(t)&&t!=null)return n!==''?(r=this.GetPromises(n,t,null),this.$q.all(r).then(function(n){return angular.forEach(n,function(n){n!=null&&n.length>0&&angular.forEach(n,function(n){i=i.concat(n.value)})}),i})):void 0},n.prototype.PickerSearch=function(n,t,i){var r=this.$q.defer();return this.InternalPickerSearch(n,t,i).then(function(n){r.resolve(n)}),r.promise},n.prototype.InternalPickerSearch=function(n,t,i){var r=[],u;if(angular.isDefined(t)&&t!=null)return n!==''?(u=this.GetPromises(n,t,i),this.$q.all(u).then(function(n){var t=null;return angular.forEach(n,function(n){n!=null&&n.length>0&&angular.forEach(n,function(n){t=n.pageToken,r=r.concat(n.value)})}),n!=null&&n.length>1&&(t=null),{results:r,pageToken:t}})):void 0},n.prototype.GetPromises=function(n,t,i){for(var u=[],f,e,o,s,h,c,l,a,r=0;r<t.length;r++)switch(t[r].SearchCategory){case 0:f=this.GetUsers(n,t[r].Filter,i),u.push(f);break;case 1:e=this.GetGroups(n,t[r].Filter,i),u.push(e);break;case 3:o=this.GetTasksAndSettings(n),u.push(o);break;case 2:s=this.GetContacts(n,t[r].Filter,i),u.push(s);break;case 5:h=this.GetRecipients(n,t[r].Filter,i),u.push(h);break;case 4:c=this.GetSiteUsers(n,t[r].Filter,i),u.push(c);break;case 7:l=this.GetDomainList(n,t[r].Filter,i),u.push(l);break;case 8:a=this.GetAppsPermissionUserList(t[r].Filter),u.push(a);break;default:this.LogService.LogError(418956,t[r].SearchCategory+' is not a supported type to search.')}return u},n.$inject=["$q","HttpService","ProfileService","AppsService","GroupService","SharedMailboxService","SitesService","CompanyProfileService","LogService","DomainService","$rootScope"],n}(),n.ModernSearchService=t,AdminApp.service("ModernSearchService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var r,t,i;(function(n){n[n.User=0]="User",n[n.Group=1]="Group",n[n.Resource=2]="Resource",n[n.SharedMailbox=3]="SharedMailbox",n[n.Contact=4]="Contact"})(n.PhotoSupportedUserType||(n.PhotoSupportedUserType={})),r=n.PhotoSupportedUserType,t=function(){function n(){}return n}(),n.UserPhoto=t,i=function(){function n(n,t,i){this.$q=n,this.HttpService=t,this.$rootScope=i}return n.prototype.IsValid=function(n){return!angular.isDefined(n)||n==null||n==""?!1:!0},n.prototype.GetPhoto=function(n,i){var u=this.$q.defer(),r,f,e;return this.IsValid(n)?(r=new t,r.UserType=i,r.Identity=n,f="/admin/api/users/"+n+"/photo",e=[],this.HttpService.Get(f,e,!0).success(function(n){r.PhotoContent=n,u.resolve(r)}).error(function(n){console.log("Error in Get User Photo api call"),u.reject(n)})):u.resolve(null),u.promise},n.prototype.SetPhoto=function(n,i,r){var u=this.$q.defer(),e;if(this.IsValid(n)){var o="/admin/api/users/"+n+"/uploadphoto",s="/admin/api/users/"+n+"/photo",f=[];f.push(s),e='\"'+r+'\"',this.HttpService.Put(o,e,f).success(function(){var e=new t;e.UserType=i,e.Identity=n,e.PhotoContent=r,u.resolve(e)}).error(function(n){console.log("Error in Set User Photo api call"),u.reject(n)})}else u.resolve(null);return u.promise},n.prototype.BroadcastPhotoEvent=function(n,t){this.$rootScope.$broadcast(n,t)},n.$inject=["$q","HttpService","$rootScope"],n}(),n.PhotoService=i,AdminApp.service("PhotoService",i)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){this.$http=n,this.$cacheFactory=t,this.$filter=i}return n.prototype.WebApiGet=function(n){var t=[];return this.$http.get(n,t).success(function(n){return n}).error(function(){console.log("Error in Get api call: "+n)})},n.prototype.WebApiGet_Cache=function(n,t){if(t){var i=this.$cacheFactory.get('$http');i.remove(n)}return this.$http({method:'Get',url:n,cache:!0}).success(function(n){return n}).error(function(t){return console.log("Error in get api call: "+n),t})},n.prototype.WebApiPut=function(n,t){return this.$http({method:'POST',url:n,data:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),'X-HTTP-Method-Override':'PUT'}}).success(function(n){return n}).error(function(t){return console.log("Error in put api call: "+n),t})},n.prototype.WebApiPost=function(n,t){return this.$http({method:'POST',url:n,data:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')}}).success(function(n){return n}).error(function(t){return console.log("Error in post api call: "+n),t})},n.prototype.WebApiDelete=function(n,t){return this.$http({method:'POST',url:n,data:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),'X-HTTP-Method-Override':'DELETE'}}).success(function(n){return n}).error(function(t){return console.log("Error in delete api call: "+n),t})},n.prototype.GetDomainList=function(){var n,i,t="",r;return arguments.length>=1&&(i=arguments[0],t="?filter="+i,arguments.length>=2&&(n=arguments[1],t+=n==null?"":"&searchText="+n)),r="/admin/api/Domains/List"+t,this.WebApiGet(r)},n.prototype.GetDomainDns=function(n,t,i){var r;return r=t=='Full'?"/admin/api/Domains/GetDns?domainName="+n:"/admin/api/Domains/GetExpectedDns?domainName="+n,this.WebApiGet_Cache(r,i)},n.prototype.GetResellerDomainData=function(n,t,i){var r="/admin/api/Domains/GetResellerData?domainName="+n+"&registrar="+t;return this.WebApiGet_Cache(r,i)},n.prototype.GetStateList=function(n){var t="/admin/api/Domains/GetStates?CountryCode="+n;return this.WebApiGet(t)},n.prototype.GetObjectsOnDomain=function(n){var t="/admin/api/Domains/GetObjectsOnDomain?domainName="+n;return this.WebApiGet(t)},n.prototype.RemoveObjectsOnDomain=function(n){var t="/admin/api/Domains/RemoveObjectsOnDomain";return this.WebApiDelete(t,n)},n.prototype.RemoveDomain=function(n){var t="/admin/api/Domains/RemoveDomain?domainName="+n;return this.WebApiDelete(t,null)},n.prototype.EnableTransferDomain=function(n,t){var i="/admin/api/Domains/EnableTransferDomain?domainName="+n;return this.WebApiPost(i,t)},n.prototype.CompleteTransferDomain=function(n,t){var i="/admin/api/Domains/CompleteTransferDomain?domainName="+n;return this.WebApiPost(i,t)},n.prototype.UpdateContact=function(n,t,i,r){var u="/admin/api/Domains/contacts?domainName="+n+"&contactType="+t+"&registrar="+r;return this.WebApiPut(u,i)},n.prototype.SetDefaultDomain=function(n){var t="/admin/api/Domains/SetDefaultDomain?domainName="+n;return this.WebApiPost(t,null)},n.prototype.GetDefaultDomain=function(){var n="/admin/api/Domains/GetDefaultDomain";return this.WebApiGet(n)},n.prototype.GetDomainBuyModel=function(){var n="/admin/api/Domains/GetDomainBuyModel";return this.WebApiGet(n)},n.prototype.SaveCustomDnsRecord=function(n,t){var i="/admin/api/Domains/DnsRecord?domainName="+n;return this.WebApiPut(i,t)},n.prototype.RemoveCustomDnsRecord=function(n,t){var i="/admin/api/Domains/DnsRecord?domainName="+n;return this.WebApiDelete(i,t)},n.prototype.ResendVerificationEmail=function(n,t){var i="/admin/api/Domains/ResendVerficationEmail?domainName="+n+"&registrar="+t;return this.WebApiPost(i,null)},n.prototype.CheckDnsForAllDomains=function(){var n="/admin/api/Domains/CheckDnsForAllDomains";return this.WebApiGet(n)},n.prototype.CheckDnsHealth=function(n,t){var i="/admin/api/Domains/CheckDnsHealth?domainName="+n+"&overrideSkip="+t;return this.WebApiGet(i)},n.prototype.CheckIsTroubleshootingAllowed=function(n){var t="/admin/api/Domains/CheckIsTroubleshootingAllowed?domainName="+n;return this.WebApiGet(t)},n.prototype.GetDomainRegistrar=function(n){var t="/admin/api/Domains/GetDomainRegistrar?domainName="+n;return this.WebApiGet(t)},n.prototype.SetSkipDnsCheckOn=function(n){var t="/admin/api/Domains/SetSkipDnsCheckOn?domainName="+n;return this.WebApiPost(t,null)},n.prototype.GetRegistrarHelpInfo=function(){var n="/admin/api/Domains/GetRegistrarHelpInfo";return this.WebApiGet(n)},n.prototype.GetFeatureData=function(){var n="/admin/api/Domains/FeatureData";return this.WebApiGet(n)},n.prototype.LogOAuthRedirectNotCalled=function(){var n="/admin/api/Domains/LogOAuthRedirectNotCalled";return this.WebApiGet(n)},n.prototype.GetActualVerificationDnsRecords=function(n){var t="/admin/api/AddDomain/GetActualVerificationDnsRecords?domainName="+n;return this.WebApiGet(t)},n.prototype.GetAddDomainState=function(n){var t="/admin/api/AddDomain/GetDomainState";return this.WebApiPost(t,n)},n.prototype.GetVerificationData=function(n){var t="/admin/api/AddDomain/GetVerificationData";return this.WebApiPost(t,n)},n.prototype.AddUnverifiedDomain=function(n){var t="/admin/api/AddDomain/AddUnverifiedDomain";return this.WebApiPost(t,n)},n.prototype.SendSignupInvitation=function(n){var t="/admin/api/AddDomain/SendSignupInvitation";return this.WebApiPost(t,n)},n.prototype.AutoVerifyDomain=function(n){var t="/admin/api/AddDomain/AutoVerify";return this.WebApiPost(t,n)},n.prototype.ManualVerifyDomain=function(n){var t="/admin/api/AddDomain/ManualVerify";return this.WebApiPost(t,n)},n.prototype.CompleteAddDomain=function(n){var t="/admin/api/AddDomain/CompleteAddDomain";return this.WebApiPost(t,n)},n.prototype.GetAddUsersModel=function(n){var t="/admin/api/AddDomain/GetAddUsersModel";return this.WebApiPost(t,n)},n.prototype.SkipAddUsers=function(n){var t="/admin/api/AddDomain/SkipAddUsers";return this.WebApiPost(t,n)},n.prototype.MarkExitFeedbackShown=function(n){var t="/admin/api/AddDomain/MarkExitFeedbackShown";return this.WebApiPost(t,n)},n.prototype.GetDomainDelegationModel=function(n){var t="/admin/api/AddDomain/GetDomainDelegationModel";return this.WebApiPost(t,n)},n.prototype.SetDomainDelegation=function(n){var t="/admin/api/AddDomain/SetDomainDelegation";return this.WebApiPost(t,n)},n.prototype.ChangeDNSRecords=function(n,t,i,r){var u="/admin/api/Domains/ChangeDNSRecordsAuto?domainName="+n+"&domainCapabilities="+t+"&registrarName="+i+"&authCode="+r;return this.WebApiPost(u,null)},n.prototype.IsAuthorizedForAutoDnsConfig=function(n,t){var i="/admin/api/Domains/IsAuthorizedForAutoDnsConfig?domainName="+n+"&registrarName="+t;return this.WebApiGet(i)},n.prototype.AutoConfigDNSRecords=function(n,t,i){var r="/admin/api/AddDomain/AutoConfigDNSRecords?domainName="+n+"&registrarName="+t+"&authCode="+i;return this.WebApiPost(r,null)},n.prototype.IsFullDelegatedResellerDomain=function(n){var t="/admin/api/AddDomain/IsFullDelegatedResellerDomain";return this.WebApiPost(t,n)},n.prototype.GetConciergeMessage=function(n,t,i){var r="/admin/api/AddDomain/GetConciergeMessage?currentStepName="+t+"&errorMessage="+i;return this.WebApiPost(r,n)},n.prototype.GetWorkloadDnsRecords=function(n){var t="/admin/api/Domains/WorkloadDnsRecords?zoneName="+n;return this.WebApiGet(t)},n.prototype.CopyResellerContactData=function(n,t){n.FirstName=t.FirstName,n.LastName=t.LastName,n.Address1=t.Address1,n.Address2=t.Address2,n.City=t.City,n.State=t.State,n.PostalCode=t.PostalCode,n.CountryOrRegion=t.CountryOrRegion,n.PhoneNumber=t.PhoneNumber,n.EmailAddress=t.EmailAddress},n.prototype.generateHealthModel=function(n,t){var o=[],f,s,e,r,i,u,h;if(n&&t)return t.TXTRecord&&(f={},r=t.TXTRecord.Data,r&&(i={},i.HostName=r.Name,i.Value=r.Value,i.TtlValue=r.TTL,i.Type="TXT",f.ExpectedRecord=i,u=[],s=this.$filter('filter')(n,{RecordType:3},!0),s&&angular.forEach(s,function(n){var t={};t.HostName=n.Label,t.Value=n.Data,t.TtlValue=n.Ttl,u.push(t)}),f.ActualRecordList=u,o.push(f))),t.MXRecord&&(e={},r=t.MXRecord.Data,r&&(i={},i.HostName=r.HostName,i.Value=r.Address,i.Priority=r.Priority,i.TtlValue=r.TTL,i.Type="MX",e.ExpectedRecord=i,u=[],h=this.$filter('filter')(n,{RecordType:1},!0),h&&angular.forEach(h,function(n){var t={};t.HostName=n.Label,t.Value=n.Data,t.Priority=n.Preference,t.TtlValue=n.Ttl,u.push(t)}),e.ActualRecordList=u,o.push(e))),o},n.$inject=["$http","$cacheFactory","$filter"],n}();n.DomainService=t,AdminApp.service("DomainService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){this.$q=n,this.HttpService=t,this.$cacheFactory=i,this.$rootScope=r}return n.prototype.GetCategoryInfo=function(n){var i=this.$q.defer(),r="/admin/api/findus/CategorySuggestion?keyword="+n,u=[],t={};return this.HttpService.Get(r,u,!1).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in Get category info"),i.reject(t)}),i.promise},n.prototype.GetBusinessListings=function(){var t=this.$q.defer(),i="/admin/api/findus/BusinessListings",r=[],n={};return this.HttpService.Get(i,r,!1).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in Get business listings"),t.reject(n)}),t.promise},n.prototype.GetBusinesses=function(){var t=this.$q.defer(),i="/admin/api/findus/BusinessListingsV2",r=[],n={};return this.HttpService.Get(i,r,!1).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in Get business listings"),t.reject(n)}),t.promise},n.prototype.SetBusinessListings=function(n){var i=this.$q.defer(),r="/admin/api/findus/BusinessListings",u=null,t={};return this.HttpService.Post(r,n,u).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in Post business listings"),i.reject(t)}),i.promise},n.prototype.CreateNewListing=function(n){var i=this.$q.defer(),r="/admin/api/findus/NewListing",u=null,t={};return this.HttpService.Post(r,n,u).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in Post business listings"),i.reject(t)}),i.promise},n.prototype.UpdateListing=function(n){var i=this.$q.defer(),r="/admin/api/findus/UpdateListing",u=null,t={};return this.HttpService.Post(r,n,u).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in Post business listings"),i.reject(t)}),i.promise},n.prototype.VerifyListing=function(n,t){var r=this.$q.defer(),u="/admin/api/findus/VerifyListing?businessId="+n+"&verificationMode="+t,f=null,i={};return this.HttpService.Post(u,null,f).success(function(n){i.data=n,r.resolve(i)}).error(function(n){i.data=n,console.log("Error in Post business listings"),r.reject(i)}),r.promise},n.prototype.GetBusinessStatusInfo=function(){var t=this.$q.defer(),i="/admin/api/findus/BusinessesStatusInfo",r=[],n={};return this.HttpService.Get(i,r,!1).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in Get BusinessesStatusInfo"),t.reject(n)}),t.promise},n.prototype.GetShowFindUsData=function(){var t=this.$q.defer(),i="/admin/api/findus/ShowFindUs",r=[],n={};return this.HttpService.Get(i,r,!1).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in Get ShowFindUs data"),t.reject(n)}),t.promise},n.prototype.GetFindUsProgressData=function(){var t=this.$q.defer(),i="/admin/api/findus/Progress",r=[],n={};return this.HttpService.Get(i,r,!1).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in Get FindUsProgress data"),t.reject(n)}),t.promise},n.prototype.GetFindUsAnalyticsData=function(){var t=this.$q.defer(),i="/admin/api/findus/BusinessesAnalytics",r=[],n={};return this.HttpService.Get(i,r,!1).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in Get FindUsAnalytics data"),t.reject(n)}),t.promise},n.prototype.GetBingPlacesAnalytics=function(){var t=this.$q.defer(),i="/admin/api/findus/Analytics",r=[],n={};return this.HttpService.Get(i,r,!1).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in Get FindUsAnalytics data"),t.reject(n)}),t.promise},n.prototype.GetBusinessStateData=function(n){var i=this.$q.defer(),r="/admin/api/findus/BusinessStates?countryId="+n,u=[],t={};return this.HttpService.Get(r,u,!1).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in Get BusinessStates data"),i.reject(t)}),i.promise},n.prototype.GetFeatureData=function(){var t=this.$q.defer(),i="/admin/api/findus/FeatureData",r=[],n={};return this.HttpService.Get(i,r,!1).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,console.log("Error in Get FeatureData"),t.reject(n)}),t.promise},n.$inject=["$q","HttpService","$cacheFactory","$rootScope"],n}(),i,r,u,f,e,h,c,o,s;n.FindUsService=t,n.app&&n.app.service("FindUsService",t),i=function(){function n(){}return n}(),n.FindUsBusinessInfo=i,r=function(){function n(){}return n}(),n.FindUsBusinessInfoV2=r,u=function(){function n(){}return n}(),n.FindUsBusinessCategoryInfo=u,f=function(){function n(){}return n}(),n.FindUsBusinessCategory=f,e=function(){function n(){this.Succeeded=!1}return n}(),n.CommonAPIResult=e,function(n){n[n.QualityCheckInProgress=0]="QualityCheckInProgress",n[n.QualityIssueFound=1]="QualityIssueFound",n[n.PublishInProgress=2]="PublishInProgress",n[n.Published=3]="Published",n[n.Dropped=4]="Dropped"}(n.BusinessInformationStatus||(n.BusinessInformationStatus={})),h=n.BusinessInformationStatus,function(n){n[n.StaleBusinessData=0]="StaleBusinessData",n[n.ContentValidationError=1]="ContentValidationError",n[n.DuplicateAddress=2]="DuplicateAddress",n[n.AddressGeocodeError=3]="AddressGeocodeError"}(n.IssueType||(n.IssueType={})),c=n.IssueType,o=function(){function n(){}return n}(),n.QualityIssueType=o,s=function(){function n(){}return n}(),n.BusinessStatusInfo=s})(Admin||(Admin={}));var Admin;(function(n){'use strict';;(function(n){n[n.None=0]="None",n[n.Banner=1]="Banner",n[n.Widget=2]="Widget"})(n.FindUsShowMode||(n.FindUsShowMode={}));var t=n.FindUsShowMode})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){this.$q=n,this.HttpService=t,this.IntuneHelperService=i,this.intunePoliciesUrl="/admin/api/Intune/policies"}return n.prototype.GetPolicy=function(n,t,i){var r="/admin/api/Intune/policies/{0}/{1}?getGroups={2}",u=[];return r=t===1?r.Format("appPolicies",n,i):r.Format("devicePolicies",n,i),this.HttpService.Get(r,[],!1)},n.prototype.ListTargetGroups=function(){var n="/admin/api/Intune/policies/targetGroups";return this.HttpService.Get(n,[],!1)},n.prototype.GetAllDevices=function(){return this.GetDevices(null)},n.prototype.GetDevicesByUserId=function(n){return this.GetDevices(n)},n.prototype.GetDevices=function(n){var t="/admin/api/Intune/devices";return n!==null&&(t+="/"+n),this.HttpService.Get(t,[],!0)},n.prototype.FactoryResetDevice=function(n){var t="/admin/api/Intune/devices/"+n+"/wipe";return this.HttpService.Post(t,null,"/admin/api/Intune/devices")},n.prototype.RemoveCompanyDataDevice=function(n,t){var i=n==null||n===""?"/admin/api/Intune/devices/retire/{0}".Format(t):"/admin/api/Intune/devices/users/{0}/retire/{1}".Format(n,t);return this.HttpService.Post(i,null,"/admin/api/Intune/devices")},n.prototype.RemoveUsersCompanyDataDevices=function(n){var t="/admin/api/Intune/devices/retireUsersDevices";return this.HttpService.Post(t,n,null)},n.prototype.AssignAppPolicyTargetGroups=function(n,t){var i="/admin/api/Intune/policies/appPolicies/{0}/assignGroups".Format(n),r="/admin/api/Intune/policies";return this.HttpService.Post(i,t,r)},n.prototype.AssignDevicePolicyTargetGroups=function(n,t){var i="/admin/api/Intune/policies/devicePolicies/{0}/assignGroups".Format(n),r="/admin/api/Intune/policies";return this.HttpService.Post(i,t,r)},n.prototype.DeleteAppPolicies=function(n){var t="/admin/api/Intune/policies/appPolicies",i="/admin/api/Intune/policies";return this.HttpService.Delete(t,n,i)},n.prototype.DeleteDevicePolicies=function(n){var t="/admin/api/Intune/policies/devicePolicies",i="/admin/api/Intune/policies";return this.HttpService.Delete(t,n,i)},n.prototype.SetupPolicies=function(n,t){var i="/admin/api/Intune/policies/initialSetup",r={AppPolicy:n,DevicePolicy:t};return this.HttpService.Post(i,r)},n.prototype.CreateAppPolicy=function(n){var t="/admin/api/Intune/policies/appPolicies",i="/admin/api/Intune/policies";return this.HttpService.Post(t,n,i)},n.prototype.CreateDevicePolicy=function(n){var t="/admin/api/Intune/policies/devicePolicies",i="/admin/api/Intune/policies";return this.HttpService.Post(t,n,i)},n.prototype.UpdateAppPolicy=function(n){var t="/admin/api/Intune/policies/appPolicies/{0}".Format(n.Id),i="/admin/api/Intune/policies";return this.HttpService.Patch(t,n,i)},n.prototype.UpdateAppDeployments=function(n,t,i){var r="/admin/api/Intune/policies/appPolicies/{0}/updateAppDeployment?type={1}",u="/admin/api/Intune/policies/"+n;return r=r.Format(n,encodeURIComponent(t)),this.HttpService.Post(r,i,u)},n.prototype.UpdateDevicePolicy=function(n){var t="/admin/api/Intune/policies/devicePolicies/{0}".Format(n.Id),i="/admin/api/Intune/policies";return this.HttpService.Patch(t,n,i)},n.prototype.GetTargetGroups=function(){var n="/admin/api/Intune/policies/targetGroups";return this.HttpService.Get(n,null,!1)},n.$inject=["$q","HttpService","IntuneHelperService"],n}();n.IntuneService=t,AdminApp.service("IntuneService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){this.HttpService=n,this.LogService=t}return n.prototype.GetActiveServicesStatus=function(){var n="/admin/api/servicehealth/status/active";return this.HttpService.Get(n,[],!1).success(function(n){return n}).error(function(n){this.LogApiCallError("GetActiveServicesStatus",n)})},n.prototype.GetAllServicesStatus=function(){var n="/admin/api/servicehealth/status/all";return this.HttpService.Get(n,[],!1).success(function(n){return n}).error(function(n){this.LogApiCallError("GetAllServicesStatus",n)})},n.prototype.LogApiCallError=function(n,t){this.LogService.LogError(421077,"ServiceHealthDataService - GetActiveServicesStatus: Error: "+JSON.stringify(t))},n.$inject=["HttpService","LogService"],n}();n.ServiceHealthDataService=t,AdminApp.service("ServiceHealthDataService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(){}return n.prototype.alphabeticalComparator=function(n,t){var i=n.toLowerCase(),r=t.toLowerCase();return i<r?-1:i>r?1:0},n.prototype.generalComparator=function(n,t){return n===null?-1:t===null?1:n>t?1:n<t?-1:0},n.prototype.objectSorter=function(n,t,i,r){var u=0;switch(typeof n[i]){case"string":u=this.alphabeticalComparator(n[i],t[i]);break;default:u=this.generalComparator(n[i],t[i])}return r?-u:u},n.$inject=[],n}();n.ServiceHealthSortService=t,AdminApp.service("ServiceHealthSortService",t)})(Admin||(Admin={}));//-----------------------------------------------------------------------
// <copyright file="IntuneHelperService.ts" company="Microsoft">
//     Copyright (c) Microsoft. All rights reserved.
// </copyright>
//-----------------------------------------------------------------------
/// <reference path="../ext/angular/1.3.15/angular.d.ts" />
/// <reference path='../AdminBaseControls.ts' />
/// <reference path='../app.ts' /> 
/// <reference path='./LogService.ts' />
/// <reference path='./HttpService.ts' />
var Admin;
(function (Admin) {
    'use strict';
    /**
     * Policy target type
     */
    (function (PolicyTargetType) {
        PolicyTargetType[PolicyTargetType["Unknown"] = 0] = "Unknown";
        PolicyTargetType[PolicyTargetType["AppPolicy"] = 1] = "AppPolicy";
        PolicyTargetType[PolicyTargetType["DevicePolicy"] = 2] = "DevicePolicy";
    })(Admin.PolicyTargetType || (Admin.PolicyTargetType = {}));
    var PolicyTargetType = Admin.PolicyTargetType;
    /**
     * Supported policy type
     */
    (function (SupportedPolicyType) {
        SupportedPolicyType[SupportedPolicyType["Unknown"] = 0] = "Unknown";
        SupportedPolicyType[SupportedPolicyType["Mam_AndroidAppProtection"] = 1] = "Mam_AndroidAppProtection";
        SupportedPolicyType[SupportedPolicyType["Mam_IosAppProtection"] = 2] = "Mam_IosAppProtection";
        SupportedPolicyType[SupportedPolicyType["Mdm_Windows10General"] = 3] = "Mdm_Windows10General";
    })(Admin.SupportedPolicyType || (Admin.SupportedPolicyType = {}));
    var SupportedPolicyType = Admin.SupportedPolicyType;
    /**
     * Intune error model
     */
    var IntuneErrorModel = (function () {
        function IntuneErrorModel() {
            this.trackingId = "";
            this.message = "";
            this.utcTimestamp = new Date();
        }
        return IntuneErrorModel;
    })();
    Admin.IntuneErrorModel = IntuneErrorModel;
    /**
     * Intune model used for Get Policies
     */
    var PoliciesModel = (function () {
        function PoliciesModel() {
            this.policiesData = [];
            this.noResults = false;
            this.showSpinner = true;
            this.serverError = false;
            this.error = null;
        }
        return PoliciesModel;
    })();
    Admin.PoliciesModel = PoliciesModel;
    /**
     * Target group type
     */
    (function (TargetGroupType) {
        TargetGroupType[TargetGroupType["AdminCreated"] = 0] = "AdminCreated";
        TargetGroupType[TargetGroupType["AllUsers"] = 1] = "AllUsers";
    })(Admin.TargetGroupType || (Admin.TargetGroupType = {}));
    var TargetGroupType = Admin.TargetGroupType;
    /**
     * Target group model
     */
    var TargetGroup = (function () {
        function TargetGroup() {
        }
        return TargetGroup;
    })();
    Admin.TargetGroup = TargetGroup;
    /**
     * Application deployment info for MAM policy
     */
    var AppDeploymentInfo = (function () {
        function AppDeploymentInfo(id, displayName, imageId) {
            this.id = id;
            this.displayName = displayName;
            this.imageId = imageId;
            this.selected = false;
        }
        return AppDeploymentInfo;
    })();
    Admin.AppDeploymentInfo = AppDeploymentInfo;
    /**
     * Common helper functions for Intune policies
     */
    var IntuneHelperService = (function () {
        function IntuneHelperService($q, LogService, HttpService) {
            this.$q = $q;
            this.LogService = LogService;
            this.HttpService = HttpService;
        }
        IntuneHelperService.prototype.GetDeploymentsInfo = function () {
            return IntuneHelperService.appDeploymentsInfo;
        };
        IntuneHelperService.prototype.ListPolicies = function () {
            var url = "/admin/api/Intune/policies", params = [];
            return this.HttpService.Get(url, [], true);
        };
        IntuneHelperService.prototype.GetFormattedTargetGroup = function (targetGroups) {
            var formattedName = "", format = '\x7b0\x7d \x2b\x7b1\x7d others';
            if (targetGroups === null) {
                return "";
            }
            else if (targetGroups.length === 1) {
                formattedName = targetGroups[0].DisplayName;
            }
            else if (targetGroups.length > 1) {
                formattedName = format.Format(targetGroups[0].DisplayName, targetGroups.length - 1);
            }
            return formattedName;
        };
        IntuneHelperService.prototype.GetSupportedPolicyType = function (type) {
            switch (type) {
                case "#microsoft.graph.androidManagedAppProtection":
                    return 1 /* Mam_AndroidAppProtection */;
                case "#microsoft.graph.iosManagedAppProtection":
                    return 2 /* Mam_IosAppProtection */;
                case "#microsoft.graph.windows10GeneralConfiguration":
                    return 3 /* Mdm_Windows10General */;
                default:
                    return 0 /* Unknown */;
            }
        };
        IntuneHelperService.prototype.GetPolicyType = function (type) {
            type = parseInt(type.toString());
            switch (type) {
                case 1 /* Mam_AndroidAppProtection */:
                    return "#microsoft.graph.androidManagedAppProtection";
                case 2 /* Mam_IosAppProtection */:
                    return "#microsoft.graph.iosManagedAppProtection";
                case 3 /* Mdm_Windows10General */:
                    return "#microsoft.graph.windows10GeneralConfiguration";
                default:
                    return "Unknown";
            }
        };
        IntuneHelperService.prototype.GetPolicyTypeName = function (type) {
            type = parseInt(type.toString());
            switch (type) {
                case 1 /* Mam_AndroidAppProtection */:
                    return 'Application Management for Android';
                case 2 /* Mam_IosAppProtection */:
                    return 'Application Management for iOS';
                case 3 /* Mdm_Windows10General */:
                    return 'Windows 10 Device Configuration';
                default:
                    return 'Unknown';
            }
        };
        IntuneHelperService.prototype.GetPolicyTargetType = function (type) {
            type = parseInt(type.toString());
            switch (type) {
                case 1 /* Mam_AndroidAppProtection */:
                case 2 /* Mam_IosAppProtection */:
                    return 1 /* AppPolicy */;
                case 3 /* Mdm_Windows10General */:
                    return 2 /* DevicePolicy */;
                default:
                    return 0 /* Unknown */;
            }
        };
        IntuneHelperService.prototype.GetPoliciesModel = function () {
            var _this = this;
            var defer = this.$q.defer(), intuneModel = new PoliciesModel();
            this.ListPolicies().then(function (result) {
                if (result.data.length > 0) {
                    result.data.forEach(function (policy) {
                        policy = _this.GetPolicyData(policy);
                    });
                    intuneModel.policiesData = result.data;
                }
                else {
                    intuneModel.noResults = true;
                }
                intuneModel.policiesData = intuneModel.policiesData.filter(function (policy) {
                    return policy.SupportedType != 0 /* Unknown */;
                });
                intuneModel.showSpinner = false;
                defer.resolve(intuneModel);
            }, function (error) {
                intuneModel.serverError = true;
                intuneModel.showSpinner = false;
                intuneModel.error = error.data;
                _this.LogService.LogError(423424, "Intune_PoliciesHelper: ListPolicies error: {0}".Format(error.data));
                defer.resolve(intuneModel);
            });
            return defer.promise;
        };
        IntuneHelperService.prototype.AddNewPolicyToModel = function (model, newPolicy) {
            if (newPolicy != null && newPolicy.Id != null) {
                model.policiesData.forEach(function (policy, index, policies) {
                    if (policy.Id === newPolicy.Id) {
                        // Policy already exists
                        return model;
                    }
                });
                model.policiesData.push(this.GetPolicyData(newPolicy));
            }
            return model;
        };
        IntuneHelperService.prototype.DeletePoliciesFromModel = function (model, policies) {
            if (policies != null && policies.length > 0) {
                policies.forEach(function (policy) {
                    var index = 0;
                    model.policiesData = model.policiesData.filter(function (value, index, array) {
                        return model.policiesData[index].Id !== policy.Id;
                    });
                });
            }
            return model;
        };
        IntuneHelperService.prototype.UpdatePolicyInModel = function (model, updatedPolicy) {
            if (updatedPolicy != null && updatedPolicy.Id != null) {
                var index = 0;
                for (index = 0; index < model.policiesData.length; index++) {
                    if (model.policiesData[index].Id === updatedPolicy.Id) {
                        var newPolicy = this.GetPolicyData(updatedPolicy);
                        newPolicy.isChecked = model.policiesData[index].isChecked;
                        newPolicy.isSelected = model.policiesData[index].isSelected;
                        model.policiesData[index] = newPolicy;
                        break;
                    }
                }
            }
            return model;
        };
        IntuneHelperService.prototype.UpdatePoliciesGroupsInModel = function (model, policies, groups) {
            if (policies != null && policies.length > 0) {
                for (var updatedIndex = 0; updatedIndex < policies.length; updatedIndex++) {
                    for (var modelIndex = 0; modelIndex < model.policiesData.length; modelIndex++) {
                        if (model.policiesData[modelIndex].Id === policies[updatedIndex].Id) {
                            model.policiesData[modelIndex].GroupAssignments = groups;
                            model.policiesData[modelIndex].TargetGroupName = this.GetFormattedTargetGroup(groups);
                            break;
                        }
                    }
                }
            }
            return model;
        };
        IntuneHelperService.prototype.GetPolicyData = function (policy) {
            var lastUpdated = new Date(policy.LastUpdated);
            policy.LastUpdated = lastUpdated.toLocaleString();
            policy.TargetGroupName = this.GetFormattedTargetGroup(policy.GroupAssignments);
            policy.SupportedType = this.GetSupportedPolicyType(policy.Type);
            policy.TypeName = this.GetPolicyTypeName(policy.SupportedType);
            return policy;
        };
        /*
         *  This implementatin waits for all promises to either resolve or reject
         *  Angular $q.all() throws as soon as the first promise is rejected
         */
        IntuneHelperService.prototype.WaitForAllPromises = function (q, promises) {
            var num = promises.length, resolvedCount = 0, rejectedCount = 0, finishedCount = 0, deferred = q.defer();
            promises.forEach(function (promise, index, array) {
                promise.then(function (value) {
                    resolvedCount++;
                    return null;
                });
                promise.catch(function (reason) {
                    rejectedCount++;
                    return null;
                });
                promise.finally(function () {
                    finishedCount++;
                    if (finishedCount >= promises.length) {
                        if (rejectedCount === 0) {
                            deferred.resolve();
                        }
                        else {
                            deferred.reject();
                        }
                    }
                });
            });
            return deferred;
        };
        IntuneHelperService.$inject = ["$q", "LogService", "HttpService"];
        IntuneHelperService.appDeploymentsInfo = [
            new AppDeploymentInfo("excel", 'Excel', "excel_50x50.png"),
            new AppDeploymentInfo("skydrive", 'OneDrive', "onedrive_50x50.png"),
            new AppDeploymentInfo("onenote", 'OneNote', "onenote_50x50.png"),
            new AppDeploymentInfo("outlook", 'Outlook', "outlook_50x50.png"),
            new AppDeploymentInfo("powerpoint", 'PowerPoint', "powerpoint_50x50.png"),
            new AppDeploymentInfo("word", 'Word', "Word_50x50.png")
        ];
        return IntuneHelperService;
    })();
    Admin.IntuneHelperService = IntuneHelperService;
    AdminApp.service("IntuneHelperService", IntuneHelperService);
})(Admin || (Admin = {}));
;var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){this.$q=n,this.HttpService=t,this.IntuneHelperService=i,this.intunePoliciesUrl="/admin/api/Intune/policies"}return n.prototype.GetPolicy=function(n,t,i){var r="/admin/api/Intune/policies/{0}/{1}?getGroups={2}",u=[];return r=t===1?r.Format("appPolicies",n,i):r.Format("devicePolicies",n,i),this.HttpService.Get(r,[],!1)},n.prototype.ListTargetGroups=function(){var n="/admin/api/Intune/policies/targetGroups";return this.HttpService.Get(n,[],!1)},n.prototype.GetAllDevices=function(){return this.GetDevices(null)},n.prototype.GetDevicesByUserId=function(n){return this.GetDevices(n)},n.prototype.GetDevices=function(n){var t="/admin/api/Intune/devices";return n!==null&&(t+="/"+n),this.HttpService.Get(t,[],!0)},n.prototype.FactoryResetDevice=function(n){var t="/admin/api/Intune/devices/"+n+"/wipe";return this.HttpService.Post(t,null,"/admin/api/Intune/devices")},n.prototype.RemoveCompanyDataDevice=function(n,t){var i=n==null||n===""?"/admin/api/Intune/devices/retire/{0}".Format(t):"/admin/api/Intune/devices/users/{0}/retire/{1}".Format(n,t);return this.HttpService.Post(i,null,"/admin/api/Intune/devices")},n.prototype.RemoveUsersCompanyDataDevices=function(n){var t="/admin/api/Intune/devices/retireUsersDevices";return this.HttpService.Post(t,n,null)},n.prototype.AssignAppPolicyTargetGroups=function(n,t){var i="/admin/api/Intune/policies/appPolicies/{0}/assignGroups".Format(n),r="/admin/api/Intune/policies";return this.HttpService.Post(i,t,r)},n.prototype.AssignDevicePolicyTargetGroups=function(n,t){var i="/admin/api/Intune/policies/devicePolicies/{0}/assignGroups".Format(n),r="/admin/api/Intune/policies";return this.HttpService.Post(i,t,r)},n.prototype.DeleteAppPolicies=function(n){var t="/admin/api/Intune/policies/appPolicies",i="/admin/api/Intune/policies";return this.HttpService.Delete(t,n,i)},n.prototype.DeleteDevicePolicies=function(n){var t="/admin/api/Intune/policies/devicePolicies",i="/admin/api/Intune/policies";return this.HttpService.Delete(t,n,i)},n.prototype.SetupPolicies=function(n,t){var i="/admin/api/Intune/policies/initialSetup",r={AppPolicy:n,DevicePolicy:t};return this.HttpService.Post(i,r)},n.prototype.CreateAppPolicy=function(n){var t="/admin/api/Intune/policies/appPolicies",i="/admin/api/Intune/policies";return this.HttpService.Post(t,n,i)},n.prototype.CreateDevicePolicy=function(n){var t="/admin/api/Intune/policies/devicePolicies",i="/admin/api/Intune/policies";return this.HttpService.Post(t,n,i)},n.prototype.UpdateAppPolicy=function(n){var t="/admin/api/Intune/policies/appPolicies/{0}".Format(n.Id),i="/admin/api/Intune/policies";return this.HttpService.Patch(t,n,i)},n.prototype.UpdateAppDeployments=function(n,t,i){var r="/admin/api/Intune/policies/appPolicies/{0}/updateAppDeployment?type={1}",u="/admin/api/Intune/policies/"+n;return r=r.Format(n,encodeURIComponent(t)),this.HttpService.Post(r,i,u)},n.prototype.UpdateDevicePolicy=function(n){var t="/admin/api/Intune/policies/devicePolicies/{0}".Format(n.Id),i="/admin/api/Intune/policies";return this.HttpService.Patch(t,n,i)},n.prototype.GetTargetGroups=function(){var n="/admin/api/Intune/policies/targetGroups";return this.HttpService.Get(n,null,!1)},n.$inject=["$q","HttpService","IntuneHelperService"],n}();n.IntuneService=t,AdminApp.service("IntuneService",t)})(Admin||(Admin={}));var Admin;(function(n){var t=function(){function t(i,r,u){var h,f,e,o,s;u===void 0&&(u=0),this.optionsObject={},this.defaultChartAreaHeight=275,this.defaultFieldName="FieldName",h=this,this.optionsObject.legend={visible:!0,position:"top",align:"end",labels:{color:'#505050',font:'15px Segoe UI Large Plus,Segoe UI Large,Segoe UI,Segoe,Tahoma,Helvetica,Arial,Sans-Serif'}},this.optionsObject.title={visible:!1},this.optionsObject.tooltip=t.GetBarChartTooltipOptions(r),this.optionsObject.tooltip.color="#595959",this.optionsObject.transitions=!1,this.optionsObject.seriesDefaults={type:'line',overlay:{gradient:'none'},border:{width:0},spacing:1},f={},f.minorGridLines={visible:!1,step:1},f.majorGridLines={visible:!0,step:7},f.labels={step:1,dateFormats:{days:kendo.culture().calendar.patterns.d}},r&&(f.reverse=!0),e={},e.majorGridLines={visible:!1},e.line={visible:!0},e.labels={visible:!0},e.labels.template="#= Admin.ReportsUtils.FormatLongNumber(value, "+n.ReportConstants.DefaultDecimalpoints+") #",this.optionsObject.series=this.GenerateChartSeries(i),o=[],o.push(f),this.optionsObject.categoryAxis=o,s=[],s.push(e),this.optionsObject.valueAxis=s}return t.prototype.SetStorageViewOptions=function(t,i){this.optionsObject.tooltip.template=function(t){return n.ReportsUtils.GetToolTipTemplate(t,!0,i,!1,!0)}},t.prototype.GenerateChartSeries=function(n){var u=[],i,r;if(!n)return u;for(i=0;i<n.length;i++)r={},r.field=n[i].Field,r.name=n[i].Name,r.color=t.GetWidgetColorFromSeriesIndex(i),n[i].data&&(r.data=n[i].data),n[i].Stack&&(r.stack=n[i].Stack),u.push(r);return u},t.prototype.SetStepCountForChart=function(n){var t=this.optionsObject.categoryAxis.pop();n>=30?(t.majorGridLines.step=7,t.labels.step=14,t.majorTicks={step:14}):n<8&&(t.labels.step=1,t.majorTicks={step:1}),this.optionsObject.categoryAxis.push(t)},t.prototype.SetDefaultBarChartOptions=function(){this.optionsObject.chartArea={height:this.defaultChartAreaHeight},this.optionsObject.seriesDefaults.type='column',this.optionsObject.seriesDefaults.stack=!0,this.optionsObject.tooltip.shared=!1;var n=this.optionsObject.categoryAxis[0];n.field=this.defaultFieldName,n.type="category",n.labels={template:"#: (value) ? decodeURI(value) : '' #"},n.majorGridLines.step=1,n.majorGridLines.visible=!0,n.minorGridLines.visible=!1},t.GetKendoChartObjectFromElementId=function(n){return $("#"+n).data("kendoChart")},t.RedrawKendoChartById=function(n){var i=t.GetKendoChartObjectFromElementId(n);i&&i.redraw()},t.SetChartValueAxisTemplate=function(n,i){var r=t.GetKendoChartObjectFromElementId(n);r&&(r.options.valueAxis.labels.template=i)},t.GetNumDecForYAxisLabels=function(n){var u=0,f=0,t=0,i=0,r=0;return angular.forEach(n,function(n){if(t!=2){var o=n.text.split('.');i=parseInt(o[0]),o[1]&&(r=parseInt(o[1].substr(0,1))),i&&i==u&&t==0&&(t=1),r&&r==f&&t==1&&(t=2),u=i,f=r}}),t},t.GetVerticalSeriesClicklineOptions=function(n,t,i,r){return i===void 0&&(i=''),r===void 0&&(r=300),i&&i.length!=0||(i=kendo.toString(t,'MM/dd')),{line:{length:r,color:"gray"},icon:{border:{width:0}},label:{position:"outside"},position:"top",data:[{value:n,label:{}}]}},t.SetChartValueAxisType=function(n,t,i){var e,r,o,s;i===void 0&&(i=3);var h=Object.prototype.toString.call(t)==='[object Array]',u=Number.MAX_VALUE,f=0;for(e=0;e<n.series.length;e++){if(h)for(o=0;o<t.length;o++)(r=parseFloat(t[o][n.series[e].field]),r&&!isNaN(r))&&(r<u&&(u=r),r>f&&(f=r));else r=parseFloat(t[n.series[e].field]);r&&!isNaN(r)&&(r<u&&(u=r),r>f&&(f=r))}f>0&&u<Number.MAX_VALUE&&u!=f?(s=Math.log(f)/Math.log(10)-Math.log(u)/Math.log(10),n.valueAxis[0].type=s>i?"log":undefined):n.valueAxis[0].type=undefined},t.GetBarChartTooltipOptions=function(t){t===void 0&&(t=!1);return{visible:!0,background:'white',border:function(n){return{width:1,color:n.series.color}},template:function(i){return n.ReportsUtils.GetToolTipTemplate(i,!1,t,!1)}}},t.GetWidgetColorFromSeriesIndex=function(n){return n>-1&&n<t.WidgetColorPallet.length?t.WidgetColorPallet[n]:t.defaultColor},t.defaultColor="#1C64AF",t.WidgetColorPallet=["#2476BA","#b4009e","#BAD24B","#00B7C3","#117D3F","#5c2d91","#F16323","#DF3239","#8664AB","#FEB811","#E3068D","#3DB869","#CB5228","#1C64AF","#F14749"],t}();n.ChartOptions=t})(Admin||(Admin={}));var Admin;(function(n){var t=function(){function t(n,t,i,r){this.isInfiniteScrollInitialized=!1,this.gridHeight=400,this.isFilterSortEnabled=t,this.isGridEnhanced=!0,this.isPrefetchGrid=i,this.CreateKendoColumns(n.columns,n.columnGroups),this.CreateKendoSchema(n.columns),this.CreateDataSource(r),this.SetKendoGridOptions()}return t.prototype.GetDataLength=function(){return this.kendoDataSource.data().length},t.prototype.GetData=function(){return this.kendoDataSource.data()},t.prototype.AppendData=function(n){if(this.kendoDataSource&&n&&n.length>0){var t=this.kendoDataSource,i=t.data().toJSON().concat(n);t.data(i)}},t.prototype.UpdateData=function(n){if(this.kendoDataSource){var t=this.kendoDataSource;t.data(n)}},t.prototype.CreateKendoColumns=function(t,i){var u=this,r,f;if(u.kendoGridColumns=[],!t){n.ReportsUtils.LogError('Unable to create columns for detailed grid as columns are undefined or null','GridOptions');return}i&&i.length>0&&(r={},i.forEach(function(n){var t={};t.title=n.Title,t.columns=[],r[n.Id]=t})),t.forEach(function(n){var t={};t.field=n.DataField,t.title=n.Title,t.hidden=n.Hidden,t.type=u.GetKendoColumnTypeFromReportDataType(n.DataType),t.headerTemplate=n.Tooltip?'<span title="'+n.Tooltip+'">'+t.title+'</span>':'<span title="'+t.title+'">'+t.title+'</span>',u.SetColumnFormatTemplate(n,t),r&&n.GroupId&&n.GroupId.length>0?r[n.GroupId].columns.push(t):u.kendoGridColumns.push(t)});for(f in r)r.hasOwnProperty(f)&&r[f]&&r[f].columns.length>0&&u.kendoGridColumns.push(r[f])},t.prototype.SetColumnFormatTemplate=function(n,t){switch(n.DataType){case"date":t.template="#= Admin.GridOptions.GetColumnDataTemplate('"+n.DataType+"',"+t.field+")#";break;case"number":t.format='{0:n0}',t.encoded=!0;break;case"percent":t.format='{0:p0}';break;case"checkmark":t.template=function(n){return n[t.field]?'<i class="ms-Icon-Basel ms-Icon-Basel--CheckMark" > </i>':''};break;default:t.encoded=!0,t.template="#: (data."+t.field+") ? decodeURI("+t.field+") : '' #"}},t.prototype.CreateDataSource=function(n){var t=this;n||(n=[]),this.kendoDataSource=new kendo.data.DataSource({data:n,schema:t.kendoDataSourceSchema,pageSize:20})},t.prototype.CreateKendoSchema=function(n){var t={},i,r=this;n.forEach(function(n){t[n.DataField]={type:r.GetKendoColumnTypeFromReportDataType(n.DataType)},n.IsRowId&&(i=n.DataField)}),this.kendoDataSourceSchema={model:{id:i,fields:t}}},t.prototype.GetKendoColumnTypeFromReportDataType=function(n){switch(n){case"percent":return"number";default:return n}},t.prototype.GetFilterableMessages=function(){var t=n.ReportsLocStrings.GetInstance();return{extra:!1,messages:{and:t.RfmAnd,or:t.RfmOr,clear:t.RfmClear,filter:t.RfmFilter,info:t.RfmInfo},operators:{string:{eq:t.RfmOpEq,neq:t.RfmOpNeq,startswith:t.RfmOpStartsWith,contains:t.RfmOpContains,doesnotcontain:t.RfmOpDoesNotContain,endswith:t.RfmOpEndsWith},number:{eq:t.RfmOpEq,neq:t.RfmOpNeq,lt:t.RfmOpNumLt,lte:t.RfmOpNumLte,gt:t.RfmOpNumGt,gte:t.RfmOpNumGte},date:{eq:t.RfmOpEq,neq:t.RfmOpNeq,lt:t.RfmOpDateLt,lte:t.RfmOpDateLte,gt:t.RfmOpDateGt,gte:t.RfmOpDateGte}}}},t.prototype.GetColumnMenu=function(){var i=this,t=n.ReportsLocStrings.GetInstance();return{columns:!0,filterable:i.isFilterSortEnabled,sortable:i.isFilterSortEnabled,messages:{columns:t.RfmColumns,filter:t.RfmFilter,sortAscending:t.RfmSortAscending,sortDescending:t.RfmSortDescending}}},t.prototype.ToggleScrollbar=function(n){var i=n.sender.wrapper,t=n.sender.table,r=t.closest(".k-grid-content");i.toggleClass("no-scrollbar",t[0].offsetHeight<r[0].offsetHeight),n.sender.element.find(".k-grid-header-wrap table thead tr th a").attr("tabindex","0")},t.GetColumnDataTemplate=function(t,i){switch(t){case"date":var r=i;return(r&&typeof i=="string"&&(r=n.ReportsUtils.ParseKendoDate(i)),!r)?'':kendo.toString(r,kendo.culture().calendar.patterns.D);default:return''}},t.prototype.SetKendoGridOptions=function(){var n=this,t;n.isFilterSortEnabled&&(t=n.GetFilterableMessages()),n.kendoGridOptions={scrollable:{virtual:!0},pageable:!1,navigatable:!0,sortable:n.isFilterSortEnabled,filterable:t?t:!1,reorderable:!0,columnMenu:n.GetColumnMenu(),resizable:n.isGridEnhanced,allowCopy:n.isGridEnhanced,selectable:n.isGridEnhanced,height:n.gridHeight,title:{visibility:!1},tooltip:{visibility:!0},dataBound:n.ToggleScrollbar}},t}();n.GridOptions=t})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){this.$q=n,this.$http=t,this.HttpService=i}return n.prototype.GetServiceMessages=function(n){var i=this.$q.defer(),r=n,u=[],t={};return this.HttpService.Get(n,[],!0).then(function(n){t.data=n.data,i.resolve(t)},function(n){t.data=n,console.log("Error in getting message center messasges"),i.reject(t)}),i.promise},n.prototype.GetMessages=function(){var n="/admin/api/messagecenter";return this.$http({method:'GET',url:n,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:[]}).success(function(n){return n}).error(function(){console.log("Error in get message center list")})},n.prototype.RefreshMessageCenterMessages=function(n,t,i){var r="/admin/api/messagecenter/RefreshMessageList";return this.$http({method:'POST',url:r,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:{FilterPropertyName:n,SortDirection:i,SortPropertyName:t}}).success(function(n){return n}).error(function(){console.log("Error in refresh message center list")})},n.prototype.UpdateMessageReadStatus=function(n,t){var u="/admin/api/messagecenter/UpdateMessageReadStatus",f="/admin/api/messagecenter/RefreshMessageList",r=this.$q.defer(),i={},e={Messages:n,IsRead:t};return this.HttpService.Put(u,e,f).success(function(n){i.data=n,r.resolve(i)}).error(function(n){i.data=n,console.log("Error in set user preferences"),r.reject(i)}),r.promise},n.prototype.UpdateMessageDismissStatus=function(n,t){var u="/admin/api/messagecenter/UpdateMessageDismissStatus",f="/admin/api/messagecenter/RefreshMessageList",r=this.$q.defer(),i={},e={Messages:n,IsDismissed:t};return this.HttpService.Put(u,e,f).success(function(n){i.data=n,r.resolve(i)}).error(function(n){i.data=n,console.log("Error in set user preferences"),r.reject(i)}),r.promise},n.prototype.GetTranslatorResult=function(n,t){var u=this.$q.defer(),r={};return this.HttpService.Post(n,t,null).success(function(n){r=n,u.resolve(r)}).error(function(n){r=n,u.reject(r)}),u.promise},n.prototype.GetUserPreferences=function(n){var i=this.$q.defer(),r=n,u=[],t={};return this.HttpService.Get(r,u,!1).success(function(n){t.data=n,i.resolve(t)}).error(function(n){t.data=n,console.log("Error in getting message center User Preferences"),i.reject(t)}),i.promise},n.prototype.SetUserPreferences=function(n,t){var r=this.$q.defer(),i={},u='/admin/api/messagecenter/GetUserPreferences';return this.HttpService.Post(n,t,u).success(function(n){i.data=n,r.resolve(i)}).error(function(n){i.data=n,console.log("Error in set user preferences"),r.reject(i)}),r.promise},n.$inject=["$q","$http","HttpService"],n}();n.MessageCenterService=t,AdminApp.service("MessageCenterService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f){this.$rootScope=n,this.$scope=t,this.SetupWizardService=i,this.$location=r,this.$window=u,this.$sce=f;var e=function(n,t,i,r){var tt='Download',it='Install',rt='Sign in',ut='Office 2016 will now start downloading.',et='Open the Office .pkg file in your Downloads folder and follow the steps to install Office.',ot='To activate Office, sign in with the account you use for Office 365\x3a \x7b0\x7d.',ht='Once it downloads, double-click \x3cstrong\x3eMicrosoftOffice2011.dmg\x3c\x2fstrong\x3e.',kt='To activate Office, sign in with the account you use for Office 365\x3a \x7b0\x7d.',ct='After installation, start Office and sign in with the account you use for Office 365.',lt='Click Run',at='Click Open',vt='Say \x22yes\x22',yt='Stay online',g='If asked, click \x3cstrong\x3eSave File\x3c\x2fstrong\x3e, then run the file.',st='Click the \x3cstrong\x3eSetup\x3c\x2fstrong\x3e file at the bottom of the screen.',dt='If asked, click \x3cstrong\x3eSave File\x3c\x2fstrong\x3e, then run the file.',bt='Click \x3cstrong\x3eYes\x3c\x2fstrong\x3e to start installing.',wt='Downloading all of Office might take a while.',pt='After installation, start Office and sign in with the account you use for Office 365\x3a \x7b0\x7d.',o="",k="",b="",s="",p="",y="",e="",h="",c="",nt=n.platform.platformType,u,w,a,d;if(nt===1){var ft=n.platformVersion,l="",v=ft.compareTo(new Utils.PlatformVersion(10,10,0))===1?"2016":"2011";v==="2016"&&(l=v),o="step1_mac"+l+".png",k="step2_mac"+l+".png",b="step3_mac"+l+".png",s=tt,p=it,y=rt,v==="2016"?(e=ut,h=et,c=ot.Format(r.UserPrincipalName)):(e=ht,h=kt.Format(r.UserPrincipalName),c=ct)}else if(nt===0){u=n.browser.browserType,u!==0&&u!==2&&u!==3&&(u=0),o="step1_windows_"+Utils.BrowserType[u].toLowerCase()+".png",k="step2_windows.png",b=i?"step3_windows_signin.png":"step3_windows.png",s=lt,p=vt,y=yt;switch(u){case 0:e=g;break;case 2:e=st,s=at;break;case 3:e=dt;break;default:e=g}h=bt,c=i?pt.Format(r.UserPrincipalName):wt}if(o&&o.length){for(w=[{image:o,subtitle:f.trustAsHtml(s),body:f.trustAsHtml(e)},{image:k,subtitle:f.trustAsHtml(p),body:f.trustAsHtml(h)},{image:b,subtitle:f.trustAsHtml(y),body:f.trustAsHtml(c)}],a=0;a<3;a++)d=w[a],d.image=""+r.CdnRoot+"/images/InstallWizard/"+t+"/"+d.image;return w}return null},o=function(){t.wizardDialogTitle='Just a few more steps...',t.installWizardCloseButtonText='Close',t.installWizardCloseButtonAriaLabel='Close',t.installWizardSupportLinkText='Need help installing\x3f',t.installWizardSupportLinkAriaLabel='Open the Get help installing Office 365 Home support page',t.closeDialog=function(){t.$emit('installWizard:hideInstallWizard')},i.Install_GetInstallContext().then(function(n){if(n&&n.InstallWizardEnabled){t.installWizardSupportLinkTarget=n.SupportLinkTarget;var r=(new Utils.OfficeDeviceDetector).getDeviceInfo(window.navigator.userAgent);i.Install_GetSharedContext().then(function(i){if(i){var u=e(r,n.WizardLocale,!1,i);u&&(t.installWizardModelSteps=u)}})}})};o()}return n.$inject=["$rootScope","$scope","SetupWizardService","$location","$window","$sce"],n}();n.app.controller("InstallWizardController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){this.$scope=n,this.FindWizardsWidgetService=t,n.FindWizardsWidget={FindWizardsWidgetData:[],FindWizardsSplitLength:3,SlideFindWizardsChunks:[]};var i=function(){n.FindWizardsWidget.SlideFindWizardsChunks=[];var i=0,t=[];angular.forEach(n.FindWizardsWidget.FindWizardsWidgetData,function(r,u){t.push(r),i++,i===n.FindWizardsWidget.FindWizardsSplitLength&&t.length>0&&(n.FindWizardsWidget.SlideFindWizardsChunks.push(t),t=[],i=0),u===n.FindWizardsWidget.FindWizardsWidgetData.length-1&&t.length>0&&n.FindWizardsWidget.SlideFindWizardsChunks.push(t)})};t.GetFindWizards().then(function(t){n.FindWizardsWidget.FindWizardsWidgetData=t.data.FindWizards,i()},function(){n.FindWizardsWidget.FindWizardsWidgetData=[]})}return n.$inject=["$scope","FindWizardsWidgetService"],n}();n.FindWizardsWidgetController=t,n.app.controller("FindWizardsWidgetController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){this.$q=n,this.HttpService=t}return n.prototype.GetFindWizards=function(){var t=this.$q.defer(),i=[],r="/admin/api/findwizards",n={};return this.HttpService.Get(r,i,!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){n.data=i,t.reject(n)}),t.promise},n.$inject=["$q","HttpService"],n}();n.FindWizardsWidgetService=t,AdminApp.service("FindWizardsWidgetService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){this.$scope=n,this.RecommendedFeaturesWidgetService=t,this.LogService=i,n.RecommenderWidget={RecommenderWidgetData:[],RecommenderSplitLength:1,SlideRecommenderChunks:[],DetailRecommenderChunks:[]};var r=function(){n.RecommenderWidget.SlideRecommenderChunks=[];var i=0,t=[];angular.forEach(n.RecommenderWidget.RecommenderWidgetData,function(r,u){t.push(r),i++,i===n.RecommenderWidget.RecommenderSplitLength&&t.length>0&&(n.RecommenderWidget.SlideRecommenderChunks.push(t),t=[],i=0),u===n.RecommenderWidget.RecommenderWidgetData.length-1&&t.length>0&&n.RecommenderWidget.SlideRecommenderChunks.push(t)})};t.GetRecommendedFeatures().then(function(t){n.RecommenderWidget.RecommenderWidgetData=t.data.RecommendedFeatures,n.RecommenderWidget.DetailRecommenderChunks=t.data.RecommendedFeaturesDetails,r()},function(t){this.LogService.Write(424249,'Recommended feature Controller- Error in fetching',JSON.stringify(t)),n.RecommenderWidget.RecommenderWidgetData=[]})}return n.$inject=["$scope","RecommendedFeaturesWidgetService","LogService"],n}();n.RecommendedFeaturesWidgetController=t,n.app.controller("RecommendedFeaturesWidgetController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){this.$q=n,this.HttpService=t,this.LogService=i}return n.prototype.GetRecommendedFeatures=function(){var t=this.$q.defer(),i=[],r="/admin/api/recommendedfeatures",n={};return this.HttpService.Get(r,i,!0).success(function(i){n.data=i,t.resolve(n)}).error(function(i){this.LogService.Write(424250,'Recommended feature Service- Error in fetching',JSON.stringify(i)),n.data=i,t.reject(n)}),t.promise},n.$inject=["$q","HttpService","LogService"],n}();n.RecommendedFeaturesWidgetService=t,AdminApp.service("RecommendedFeaturesWidgetService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var r=function(){function n(n,i,r,u,f,e,o,s,h,c,l){var a=this;this.$scope=n,this.$rootScope=i,this.$q=r,this.LogService=u,this.AppsService=f,this.PrivateCatalogService=e,this.PrivateCatalogDisplayService=o,this.ManifestUploadService=s,this.$stateParams=h,this.HelperService=c,this.$timeout=l,this.isLoading=!0,this.sortDown=!0,this.filter=t[0],this.noResults=!1,this.servicesError=!1,this.addInsErrorMessages=null,this.addInRemovedWarning=!1,this.apps=[],this.services=[],this.addIns=[],this.flyoutAction="",this.flyoutInstance=undefined,this.$scope.$on('UpdateAddInList',function(){return a.UpdateAddInList()}),this.$scope.$on('$destroy',function(){return a.CancelDeepLinkingTimeout()}),this.flyoutAction=h.action,h.action!="AdminUnitTest"&&(this.GetAppsList(),this.DetectDeepLinking())}return n.prototype.GetAppsList=function(){var n=this;this.$q.all([this.AppsService.GetApps().then(function(t){return n.GetAppsSuccess(t)},function(t){return n.GetAppsError(t)}),this.PrivateCatalogService.GetAddInDetails().then(function(t){return n.GetAddInDetailsSuccess(t)},function(){return n.GetAddInDetailsError()})])['finally'](function(){return n.UpdateFilter()})},n.prototype.LoadDetails=function(n){n.IsPrivateCatalog&&(this.ManifestUploadService.Reset(),this.ManifestUploadService.IsExistingAddIn=!0,this.ManifestUploadService.IsUpdating=!1,this.ManifestUploadService.ServicePrincipalObjectId=n.ServicePrincipalObjectId,this.ManifestUploadService.SelectedItem=n,this.ManifestUploadService.DeepLinkingCampaign=null)},n.prototype.UploadAddIn=function(){this.ManifestUploadService.Reset(),this.ManifestUploadService.IsExistingAddIn=!1,this.ManifestUploadService.IsUpdating=!1},n.prototype.ToggleSort=function(){this.sortDown=!this.sortDown,this.apps=this.SortAddIns()},n.prototype.UpdateFilter=function(){if(this.$rootScope.features.PrivateCatalogRelease)switch(t[this.filter]){case 0:this.apps=this.services.concat(this.addIns);break;case 1:this.apps=this.services;break;case 2:this.apps=this.addIns;break;default:this.LogService.LogError(417753,'Incorrect filter index selected '+this.filter);return}else this.apps=this.services;this.isLoading=!1,this.noResults=this.apps.length===0,this.apps=this.SortAddIns(),this.OpenFlyout()},n.prototype.OpenFlyout=function(){var n=this,t;this.HelperService.IsValid(this.flyoutAction)&&this.flyoutAction.toLowerCase()=="editapppermissions"&&(t=this.HelperService.GetDeepLinkAttributes(this.flyoutAction),this.HelperService.IsValid(t)&&this.$timeout(function(){n.flyoutInstance!=null&&n.flyoutInstance!=undefined&&n.flyoutInstance.invoke(t)},500))},n.prototype.InitCallBackFlyout=function(n){this.flyoutInstance=n},n.prototype.HideAddInRemovedWarning=function(){this.addInRemovedWarning=!1,Microsoft.Online.BOX.JS.Shared.SetPersistentCookie(n.ADDIN_REMOVED_WARNING_COOKIE_NAME,n.ADDIN_REMOVED_WARNING_COOKIE_VALUE,1,'/',!0)},n.prototype.DetectDeepLinking=function(){if(!this.$rootScope.features.PrivateCatalogDeepLinking){if(!this.$rootScope.app.initFullFeaturesGet){this.deepLinkTimeoutPromise=this.$timeout(function(){this.DetectDeepLinking()}.bind(this),100);return}return}var t=this.$stateParams[n.DEEPLINKING_ASSETID_PARAM];if(t){if(!this.flyoutInstance){this.deepLinkTimeoutPromise=this.$timeout(this.DetectDeepLinking.bind(this),100);return}this.deepLinkTimeoutPromise=undefined,delete this.$stateParams.assetId,this.UploadAddIn(),this.ManifestUploadService.AssetId=t,this.ManifestUploadService.ContentCulture=this.$rootScope.CultureInfo,this.ManifestUploadService.DeepLinkingCampaign=this.$stateParams[n.DEEPLINKING_CAMPAIGN_PARAM],this.flyoutInstance.invoke({flyoutTemplateUrl:'../AdminPortal/Settings/ManifestPreview',flyoutType:'manifestPreview',flyoutHeaderTitle:'New Add-In',flyoutHeaderIcon:'ms-Icon ms-Icon--apps ss-apps-icon',selecteditem:{},entry:'panel'})}},n.prototype.UpdateAddInList=function(){var n=this;this.PrivateCatalogService.GetAddInDetails().then(function(t){return n.GetAddInDetailsSuccess(t)},function(){return n.GetAddInDetailsError()})['finally'](function(){return n.UpdateFilter()})},n.prototype.ValidateTemplates=function(n){var t=this;angular.forEach(n,function(n){return t.PushTemplates(n)})},n.prototype.PushTemplates=function(t){var u=n.templateMapping[t.Name],r;if(!u){this.LogService.LogError(418215,'Failed to locate template for '+t.Name+'.');return}r=new i,r.Description=t.Description,r.DisplayName=t.DisplayName,r.Name=t.Name,r.Image=t.Image,r.IsPrivateCatalog=!1,r.Icon=t.Icon,r.TemplateName=u,this.services.push(r)},n.prototype.SortAddIns=function(){var n=this;return this.apps.sort(function(t,i){return n.CompareAddIns(t,i)})},n.prototype.CompareAddIns=function(n,t){var i=n.DisplayName.localeCompare(t.DisplayName);return this.sortDown?i:-i},n.prototype.GetAppsSuccess=function(n){this.LogService.LogInfo(417758,'GetApps call succeeded.'),this.servicesError=!1,this.services=[],this.ValidateTemplates(n.data.Services)},n.prototype.GetAppsError=function(n){this.LogService.LogError(417759,String('GetApps call failed. Status: '+n.status+'. Status text: '+n.statusText+'.')),this.servicesError=!0,this.services=[]},n.prototype.GetAddInDetailsSuccess=function(n){var t=this,i;if(n.ResponseResult!==0){this.GetAddInDetailsError(n);return}this.addInsErrorMessages=null,this.addIns=[],i=this.PrivateCatalogDisplayService.GetCulturePrefix(),angular.forEach(n.AddInDetails,function(n){return t.addIns.push(t.PrivateCatalogDisplayService.CreateDisplayAddIn(i,n))}),this.DetectRemovedAddIns(n.AddInDetails)},n.prototype.GetAddInDetailsError=function(n){var t,i;n===void 0&&(n=null),t=n===null?null:n.ErrorMessages,t?this.addInsErrorMessages=t:(i=n===null?null:n.ResponseResult,this.addInsErrorMessages=[this.PrivateCatalogService.GetErrorMessage(i)]),this.addIns=[]},n.prototype.DetectRemovedAddIns=function(t){var u,i,r;if((this.addInRemovedWarning=!1,u=Microsoft.Online.BOX.JS.Shared.GetPersistentCookie(n.ADDIN_REMOVED_WARNING_COOKIE_NAME),u!==n.ADDIN_REMOVED_WARNING_COOKIE_VALUE)&&t)for(i=0;i<t.length;++i)if(r=t[i].StoreStatusCode,r===1||r===2){this.addInRemovedWarning=!0;return}},n.prototype.CancelDeepLinkingTimeout=function(){this.deepLinkTimeoutPromise&&this.$timeout.cancel(this.deepLinkTimeoutPromise)},n.$inject=['$scope','$rootScope','$q','LogService','AppsService','PrivateCatalogService','PrivateCatalogDisplayService','ManifestUploadService','$stateParams','HelperService','$timeout'],n.ADDIN_REMOVED_WARNING_COOKIE_NAME='Admin.Settings.Apps.AddInRemovedWarning',n.ADDIN_REMOVED_WARNING_COOKIE_VALUE='hidden',n.DEEPLINKING_ASSETID_PARAM='assetid',n.DEEPLINKING_CAMPAIGN_PARAM='mktcmpid',n.templateMapping={Calendar:'/AdminPortal/Settings/CalendarFlyoutTemplate',Community:'/AdminPortal/Settings/Community',Cortana:'/AdminPortal/Settings/Cortana',CRM:'/AdminPortal/Settings/DynamicsCrm',Delve:'/AdminPortal/Settings/Delve',DirSync:'/AdminPortal/Settings/DirSync',DocsCom:'/AdminPortal/Settings/DocsCom',ERP:'/AdminPortal/Settings/DynamicsErp',GigJam:'/AdminPortal/Settings/GigJam',IntegratedApps:'/AdminPortal/Settings/IntegratedApps',Mail:'/AdminPortal/Settings/MailFlyoutTemplate',Mobile:'/AdminPortal/Settings/Mobile',MultiFactorAuth:'/AdminPortal/Settings/MultiFactorAuth',OfficeNotificationHub:'/AdminPortal/Settings/OfficeNotificationHub',OfficeOnline:'/AdminPortal/Settings/OfficeOnline',Reports:'/AdminPortal/Settings/Reports',RightsManagement:'/AdminPortal/Settings/RMSOnline',Sites:'/AdminPortal/Settings/sitessharing',Skype:'/AdminPortal/Settings/Skype',SkypeTeams:'/AdminPortal/Settings/SkypeTeams',SoftwareDownload:'/AdminPortal/Settings/SoftwareDownloadTemplate',Store:'/AdminPortal/Settings/Store',Sway:'/AdminPortal/Settings/Sway',O365Groups:'/AdminPortal/Settings/O365Groups',BusinessApps:'/AdminPortal/Settings/BusinessApps',StaffHub:'/AdminPortal/Settings/StaffHub',OfficeClientPolicy:'/AdminPortal/Settings/OfficeClientPolicyTemplate'},n}(),t,i,u;n.AppsController=r,function(n){n[n.All=0]="All",n[n.Services=1]="Services",n[n.AddIns=2]="AddIns"}(n.FilterOption||(n.FilterOption={})),t=n.FilterOption,i=function(){function n(){}return n}(),n.DisplayService=i,u=function(){function n(){}return n}(),n.DisplayAddIn=u,n.app.controller('AppsController',r)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){function i(){n.pilotDomainName="",n.companyDomain="",n.userDomain="",n.isError=!1,t.GetMailSettings().then(function(t){n.pilotDomainName=t.data.ServiceDomain,n.companyDomain=t.data.EnableAoboScenario?"&delegatedOrg="+t.data.TenantDomain:t.data.TenantDomain,n.userDomain=t.data.UserDomain},function(t){n.isError=!0,n.errorMessage=t.data.Message})}this.$scope=n,this.AppsService=t,n.Cancel=function(){n.$emit('closeFlyout')},i()}return n.$inject=["$scope","AppsService"],n}();n.MailSettingsController=t,n.app.controller("MailSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){var i,r;this.$scope=n,this.SettingsService=t,i=function(){n.$emit('showWaitingIndicator',!0),n.showForm=!1,n.saveInProgress=!1,n.saveFinished=!1,n.saveError=!1,n.formData={},n.infoPath2013='InfoPath 2013',n.office2016='Office \x28includes Skype for Business\x29,MicrosoftOffice_ClientDownload',n.isInfoPath2013Enabled=!1,t.GetSoftwareInstallSettings().then(function(t){n.formData=t.data,r(),n.$emit('showWaitingIndicator',!1),n.showForm=!0},function(){n.saveError=!0,n.$emit('showWaitingIndicator',!1),n.showForm=!0})},r=function(){angular.forEach(n.formData.UserSoftwareSettings,function(t){angular.forEach(t.ServiceStatusMap,function(i,r){i&&(t.ShowDetails=!0,t.IsSelected=!0),i&&r==n.office2016&&t.ClientVersion==16&&(n.isInfoPath2013Enabled=!0)})})},i(),n.ToggleUserSoftwareSettingsDetails=function(t){n.formData.UserSoftwareSettings[t].ShowDetails=!n.formData.UserSoftwareSettings[t].ShowDetails},n.ToggleUserSoftwareSettings=function(t){t.ShowDetails=t.IsSelected,angular.forEach(t.ServiceStatusMap,function(n,i){t.ServiceStatusMap[i]=t.ShowDetails}),angular.forEach(t.LegacyServiceStatusMap,function(i,r){t.LegacyServiceStatusMap[r]=n.SplitKey(r)==n.infoPath2013&&t.ShowDetails?!1:t.ShowDetails})},n.IsLegacyServiceAvailable=function(n){var t=0;return angular.forEach(n,function(){t++}),t},n.ToggleUserSoftwareSelection=function(t){var r=!0,u=!0;angular.forEach(t.ServiceStatusMap,function(i,u){i&&(r=!1),i&&u==n.office2016&&t.ClientVersion==16?n.isInfoPath2013Enabled=!0:i||u!=n.office2016||t.ClientVersion!=16||(n.isInfoPath2013Enabled=!1)}),angular.forEach(t.LegacyServiceStatusMap,function(n){n&&(u=!1)}),u&&r?(t.ShowDetails=!1,t.IsSelected=!1):(t.ShowDetails=!0,t.IsSelected=!0)},n.SplitKey=function(n){return n.split(",")[0]},n.softwareSettingConfigs={clientVersionMap:{version11:'2011 version',version13:'2013 version',version16:'2016 version'},branchMap:{none:0,currentBranch:1,currentBranchForBusiness:2}},n.GetClientVersions=function(t){var i="";return t=="14"?i=n.softwareSettingConfigs.clientVersionMap.version11:t=="15"?i=n.softwareSettingConfigs.clientVersionMap.version13:t=="16"&&(i=n.softwareSettingConfigs.clientVersionMap.version16),i},n.SaveSoftwareDownloadSettings=function(){u(),t.SetSoftwareInstallSettings(n.formData).then(function(){f()},function(n){e(n)})},n.Cancel=function(){n.$emit('closeFlyout')};var u=function(){n.showForm=!1,n.saveInProgress=!0,n.saveFinished=!1,n.saveError=!1},f=function(){n.saveInProgress=!1,n.saveFinished=!0,n.saveError=!1,n.showCloseButton=!0},e=function(t){n.showForm=!0,n.saveInProgress=!1,n.saveError=!0,n.saveErrorMessage=t.data.Message}}return n.$inject=["$scope","SettingsService"],n}();n.SoftwareSettingsController=t,n.app.controller("SoftwareSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){function i(){n.$emit('showWaitingIndicator',!0),n.showForm=!1,n.isError=!1,n.saveInProgress=!1,n.formData.AppId="calendarsharing",n.isHydrationRequiredError=!1,t.GetCalendarSettings().then(function(t){n.formData.EnableCalendarSharing=t.data.EnableCalendarSharing,n.formData.EnableAnonymousCalendarSharing=t.data.EnableAnonymousCalendarSharing,n.formData.SharingOption=t.data.SharingOption?t.data.SharingOption:"CalendarSharingFreeBusySimple",n.formData.HydrationRequired=t.data.HydrationRequired,n.formData.ContractIdentity=t.data.ContractIdentity,n.formData.ServiceDomain=t.data.ServiceDomain,n.formData.TenantDomain=t.data.EnableAoboScenario?"&delegatedOrg="+t.data.TenantDomain:t.data.TenantDomain,n.formData.UserDomain=t.data.UserDomain,n.formData.Locale=t.data.Locale,n.$emit('showWaitingIndicator',!1),n.showForm=!0},function(t){n.isError=!0,n.errorMessage=t.data.Message,n.$emit('showWaitingIndicator',!1),n.showForm=!0})}this.$scope=n,this.AppsService=t,n.SaveCalendarSettings=function(){n.saveInProgress=!0,n.saveActionStarted=!0,n.formData.AppId="calendarsharing",t.UpdateSetting(n.formData).then(function(t){n.saveActionStarted=!1,t.data.Code>0?n.isHydrationRequiredError=!0:(n.showCloseButton=!0,n.statusMessageSuccess='Calendar settings have been updated')},function(t){n.saveActionStarted=!1,n.showCloseButton=!0,n.statusMessageError=t.data.ExceptionMessage})},n.SaveHydrationRequired=function(){n.saveInProgress=!0,n.saveActionStarted=!0,n.isHydrationRequiredError=!1,n.formData.AppId="calendar/enableorganizationcustomization",t.UpdateSetting(n.formData).then(function(){n.saveActionStarted=!1,n.showCloseButton=!0,n.statusMessageSuccess='OK, we\x27re working on it.'},function(){n.saveActionStarted=!1,n.showCloseButton=!0,n.statusMessageError='Something went wrong. Try again later. If this continues, contact support.'})},n.Cancel=function(){n.$emit('closeFlyout')},i()}return n.$inject=["$scope","AppsService"],n}();n.CalendarSettingsController=t,n.app.controller("CalendarSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){function i(){n.originalData={},n.saveInProgress=!1,n.$emit('showWaitingIndicator',!0),n.showForm=!1,n.isError=!1,n.formData.AppId="sitessharing",n.CollabTypes={},n.CollabTypes.NotAllowed=1,n.CollabTypes.ExistingOnly=32,n.CollabTypes.Invited=2,n.CollabTypes.Anonymous=16,t.GetSettingDetails(n.formData.AppId).then(function(t){n.originalData.AllowSharing=t.data.AllowSharing,n.originalData.CollaborationType=t.data.CollborationType,n.originalData.RequireAnonymousLinksExpireInDays=t.data.RequireAnonymousLinksExpireInDays,n.formData.AllowSharing=t.data.AllowSharing,n.formData.CollaborationType=t.data.CollaborationType,n.formData.SitesUrl=t.data.AdminUri,n.formData.RequireAnonymousLinksExpireInDays=t.data.RequireAnonymousLinksExpireInDays,n.$emit('showWaitingIndicator',!1),n.showForm=!0},function(t){n.isError=!0,n.errorMessage=t.data.Message,n.$emit('showWaitingIndicator',!1),n.showForm=!0})}this.$scope=n,this.AppsService=t,n.SaveSitesSettings=function(){n.saveInProgress=!0,n.saveActionStarted=!0,n.formData.AllowSharing==!1&&(n.formData.CollaborationType=1),t.UpdateSetting(n.formData).then(function(){n.saveActionStarted=!1,n.showCloseButton=!0,n.statusMessageSuccess='The external sharing settings for sites are updated.'},function(t){n.saveActionStarted=!1,n.showCloseButton=!0,n.statusMessageError=t.data.ExceptionMessage})},n.Cancel=function(){n.formData.refreshListArgs={},n.$emit('closeFlyout')},i()}return n.$inject=["$scope","AppsService"],n}();n.SitesSettingsController=t,n.app.controller("SitesSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){this.$scope=n,this.SettingsService=t,n.init=function(){n.softwareTitle="Skype for Business",n.GetSoftwareDownloadLinks()},n.Cancel=function(){n.$emit('closeFlyout')};var i=function(){n.showForm=!0,n.saveInProgress=!1,n.saveFinished=!1,n.saveError=!1,n.formData={}},r=function(){n.showForm=!1,n.saveInProgress=!0,n.saveFinished=!1,n.saveError=!1},u=function(){n.saveInProgress=!1,n.saveFinished=!0,n.showCloseButton=!0},f=function(t){n.showForm=!0,n.saveInProgress=!1,n.saveError=!0,n.saveErrorMessage=t.data.Message};n.FormatDownloadUrl=function(n){var t=n.downloadUrl;n.languagePlaceholder!==""&&(t=t.replace(n.languagePlaceholder,"{"+n.selectedLanguage+"}")),n.versionPlaceholder!==""&&(t=t.replace(n.versionPlaceholder,"{"+n.selectedVersion+"}")),n.formattedUrl=t},n.GetSoftwareDownloadLinks=function(){t.GetSoftwareDownloadLinks().then(function(t){n.ManualSoftwareDownloadsModel=[];var i=t.data;angular.forEach(i,function(t){var r={SoftwareDownloads:[],Title:"",Description:""};r.Title=t.SoftwareTitle,r.Description=t.Description,angular.forEach(t.Downloads,function(t){var u={languages:t.LanguageOptions,versions:t.VersionOptions,downloadUrl:t.DownloadUrl,languagePlaceholder:t.LanguagePlaceholder,versionPlaceholder:t.VersionPlaceholder,selectedLanguage:"en-us",selectedVersion:"X86",softwareTitle:t.SoftwareDisplayName,formattedUrl:t.DownloadUrl,HelpId:t.SystemRequirementsHelpId,description:t.Description,downloadLocationType:t.DownloadLocationType,showDetails:!1};(u.languagePlaceholder!==null||u.versionPlaceholder!==null)&&n.FormatDownloadUrl(u),r.SoftwareDownloads.push(u)}),n.ManualSoftwareDownloadsModel.push(r)})},function(){})},n.ToggleSoftwareDownloadChevron=function(n){n.showDetails=!n.showDetails},n.init()}return n.$inject=["$scope","SettingsService"],n}();n.ManualSoftwareDownloadController=t,n.app.controller("ManualSoftwareDownloadController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n){this.$scope=n,n.Close=function(){n.$emit('closeFlyout')}}return n.$inject=["$scope"],n}();n.RMSSettingsController=t,n.app.controller("RMSSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){var i,r;this.$scope=n,this.SettingsService=t,i=function(){r(),t.GetO365GroupsGuestSettings().then(function(t){n.showContent=!0,n.showErrors=!1,n.o365GroupsSettings.AllowGuestAccess=t.data.AllowGuestAccess,n.o365GroupsSettings.AllowGuestAccessOriginalValue=t.data.AllowGuestAccess,n.o365GroupsSettings.GuestMembersAllowed=t.data.AllowGuestsAsMembers,n.o365GroupsSettings.GuestMembersAllowedOriginalValue=t.data.AllowGuestsAsMembers},function(t){n.showErrors=!0,n.showContent=!1,n.errorMessage=t.data.Message}),t.GetGuestUserSettings().then(function(t){n.guestUserSettings=t.data,n.guestUserSettings.showErrors=!1},function(t){n.guestUserSettings.error=t.data,n.guestUserSettings.showErrors=!0})},n.Close=function(){n.$emit('closeFlyout')},n.SaveO365GroupsSettings=function(){n.saveSettingsInProgress=!0;var i={AllowGuestsAsMembers:n.o365GroupsSettings.GuestMembersAllowed,AllowGuestAccess:n.o365GroupsSettings.AllowGuestAccess};t.UpdateO365GroupsGuestSettings(i).then(function(){n.showContent=!1,n.savefinished=!0,n.showSuccess=!0,n.showErrors=!1,n.saveSettingsInProgress=!1},function(t){n.showContent=!1,n.savefinished=!0,n.showSuccess=!1,n.showErrors=!0,n.errorMessage=t.data.Message,n.saveSettingsInProgress=!1})},r=function(){n.o365GroupsSettings={},n.guestUserSettings={},n.guestUserSettings.showErrors=!1,n.showContent=!0,n.savefinished=!1,n.showErrors=!1,n.showSuccess=!1,n.saveSettingsInProgress=!1},i()}return n.$inject=["$scope","SettingsService"],n}();n.O365GroupsSettingsController=t,n.app.controller("O365GroupsSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){var r;this.$scope=n,this.SettingsService=t,this.HelperService=i,r=function(){u(),t.ListOfficePolicies().then(function(t){i.IsValid(t)&&(n.PolicyControllerModel.policies=t.data,n.PolicyControllerModel.policyCount=n.PolicyControllerModel.policies.OfficePolicies.length,angular.forEach(n.PolicyControllerModel.policies.OfficePolicies,function(n){n.SettingsSummary=[],n.ConfiguredSettings=0,n.isManaged=n.TargetType==="Managed",angular.forEach(n.Settings,function(t){if(t.Status!=0&&t.Status!=2)for(var i=0;i<=n.SettingsSummary.length;i++)if(i===n.SettingsSummary.length){n.SettingsSummary.push({Name:t.ProductName,Count:1}),n.ConfiguredSettings++;break}else if(n.SettingsSummary[i].Name===t.ProductName){n.SettingsSummary[i].Count++,n.ConfiguredSettings++;break}})}),f())},function(n){e(n)})},n.RaisePrecedence=function(t,i){i||(angular.forEach(n.PolicyControllerModel.policies.OfficePolicies,function(i,r){n.PolicyControllerModel.policies.OfficePolicies[r].PrecendenceOrder===t.PrecendenceOrder+1&&(n.PolicyControllerModel.policies.OfficePolicies[r].PrecendenceOrder=n.PolicyControllerModel.policies.OfficePolicies[r].PrecendenceOrder-1)}),t.PrecendenceOrder++)},n.LowerPrecedence=function(t,i){i||(angular.forEach(n.PolicyControllerModel.policies.OfficePolicies,function(i,r){n.PolicyControllerModel.policies.OfficePolicies[r].PrecendenceOrder===t.PrecendenceOrder-1&&(n.PolicyControllerModel.policies.OfficePolicies[r].PrecendenceOrder=n.PolicyControllerModel.policies.OfficePolicies[r].PrecendenceOrder+1)}),t.PrecendenceOrder--)},n.AddNewPolicy=function(){n.PolicyControllerModel.PolicyEditMode=!1},n.Cancel=function(){n.$emit('closeFlyout')},n.SaveAndClose=function(){n.Save(),n.Cancel()},n.Save=function(){angular.forEach(n.PolicyControllerModel.policies.OfficePolicies,function(n){n.TargetType=n.isManaged?"Managed":"Unmanaged",t.UpdateOfficePolicy(n)})};var u=function(){n.$emit('showWaitingIndicator',!0),n.PolicyControllerModel={},n.PolicyControllerModel.showForm=!1,n.PolicyControllerModel.saveError=!1},f=function(){n.$emit('showWaitingIndicator',!1),n.PolicyControllerModel.showForm=!0},e=function(){n.PolicyControllerModel.showForm=!0,n.PolicyControllerModel.saveError=!0,n.PolicyControllerModel.saveErrorMessage='Unable to retrieve policies'};r()}return n.$inject=["$scope","SettingsService","HelperService"],n}();n.OfficeClientPolicyController=t,n.app.controller("OfficeClientPolicyController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){var r;this.$scope=n,this.SettingsService=t,this.HelperService=i,r=function(){e(),s()},n.Save=function(){o(),n.selecteditem.PolicyEditMode?(n.PolicyControllerModel.OfficePolicyId=n.PolicyControllerModel.Id,t.UpdateOfficePolicy(n.PolicyControllerModel).then(function(){u()},function(n){f(n)})):t.CreatePolicy(n.PolicyControllerModel).then(function(t){i.IsValid(t)&&(n.PolicyControllerModel.PolicyId=n.PolicyControllerModel.Id=t.data.OfficePolicyId,u())},function(n){f(n)})},n.Cancel=function(){n.$emit('closeFlyout')};var e=function(){n.$emit('showWaitingIndicator',!0),n.PolicyControllerModel={},n.PolicyControllerModel=n.selecteditem,n.PolicyControllerModel.showForm=!1,n.PolicyControllerModel.saveError=!1,n.PolicyControllerModel.HeaderText='Add a configuration policy',n.PolicyControllerModel.PolicyEditMode&&(n.PolicyControllerModel.HeaderText='Edit configuration policy')},o=function(){n.$emit('showWaitingIndicator',!0),n.PolicyControllerModel.showForm=!1},u=function(){n.$emit('showWaitingIndicator',!1),n.PolicyControllerModel.showForm=!0},s=function(){n.$emit('showWaitingIndicator',!1),n.PolicyControllerModel.showForm=!0},f=function(){n.PolicyControllerModel.showForm=!0,n.PolicyControllerModel.saveError=!0,n.PolicyControllerModel.saveErrorMessage='Unable to save the policy'};r()}return n.$inject=["$scope","SettingsService","HelperService"],n}();n.AddEditOfficePolicyController=t,n.app.controller("AddEditOfficePolicyController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){var i,r;this.$scope=n,this.SettingsService=t,i=function(){u(),o()},n.Save=function(){f(),n.CopyPolicyControllerModel.OfficePolicyId=n.CopyPolicyControllerModel.Id,t.CopyOfficePolicy(n.CopyPolicyControllerModel).then(function(){r(),e()},function(n){s(n)})},n.initCallbackFlyout=function(t){n.flyout=t},r=function(){var t={flyoutTemplateUrl:"../AdminPortal/Settings/OfficeClientPolicyTemplate",flyoutType:"officepolicysettings",flyoutHeaderTitle:'Office Client Policy Settings',flyoutHeaderIcon:"ms-Icon ms-Icon--office ss-cldr-icon",waitingIndicatorMessage:'Please wait',selecteditem:n.CopyPolicyControllerModel};n.flyout.invoke(t),n.$emit('closePanel')},n.Cancel=function(){n.$emit('closeFlyout')};var u=function(){n.$emit('showWaitingIndicator',!0),n.PolicyControllerModel={},n.PolicyControllerModel.showForm=!1,n.PolicyControllerModel.saveError=!1,n.CopyPolicyControllerModel=n.selecteditem,n.CopyPolicyControllerModel.DisplayName=n.CopyPolicyControllerModel.DisplayName+"-Copy"},f=function(){n.$emit('showWaitingIndicator',!0),n.PolicyControllerModel.showForm=!1},e=function(){n.$emit('showWaitingIndicator',!1),n.PolicyControllerModel.showForm=!0},o=function(){n.$emit('showWaitingIndicator',!1),n.PolicyControllerModel.showForm=!0},s=function(){n.PolicyControllerModel.showForm=!0,n.PolicyControllerModel.saveError=!0,n.PolicyControllerModel.saveErrorMessage='Unable to save the policy'};i()}return n.$inject=["$scope","SettingsService"],n}();n.CopyOfficePolicyController=t,n.app.controller("CopyOfficePolicyController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){var r,u,f;this.$scope=n,this.SettingsService=t,this.HelperService=i,r=function(){u(),t.GetProductSettings().then(function(t){if(i.IsValid(t)){n.PolicyControllerModel=n.selecteditem,n.PolicyControllerModel.showForm=!1,n.PolicyControllerModel.HeaderText=n.PolicyControllerModel.PolicyEditMode?'Add a configuration policy':'Edit configuration policy',n.PolicyControllerModel.productSettings=t.data,(angular.isUndefined(n.PolicyControllerModel.AssignedGroups)||n.PolicyControllerModel.AssignedGroups==null)&&(n.PolicyControllerModel.AssignedGroups=[]),(angular.isUndefined(n.PolicyControllerModel.Settings)||n.PolicyControllerModel.Settings==null)&&(n.PolicyControllerModel.Settings=[]);var r=0;(angular.isUndefined(n.PolicyControllerModel.productsSummary)||n.PolicyControllerModel.productsSummary==null)&&(n.PolicyControllerModel.productsSummary=[],angular.forEach(n.PolicyControllerModel.productSettings,function(t){n.PolicyControllerModel.productsSummary.push({Name:t,Occurence:0});for(var i=0;i<n.PolicyControllerModel.Settings.length;i++)n.PolicyControllerModel.Settings[i].ProductName===t&&n.PolicyControllerModel.Settings[i].Status==1&&n.PolicyControllerModel.productsSummary[r].Occurence++;r++})),f()}})},n.Cancel=function(){n.$emit('closeFlyout')},n.SelectProduct=function(t){n.PolicyControllerModel.selectedProduct=t},n.EditPolicy=function(){n.PolicyControllerModel.PolicyEditMode=!0},u=function(){n.PolicyControllerModel={},n.UpdateOfficePolicyModel={},n.PolicyControllerModel.showForm=!1,n.PolicyControllerModel.saveError=!1,n.$emit('showWaitingIndicator',!0)},f=function(){n.$emit('showWaitingIndicator',!1),n.PolicyControllerModel.showForm=!0},r()}return n.$inject=["$scope","SettingsService","HelperService"],n}();n.OfficeClientPolicyDetailsController=t,n.app.controller("OfficeClientPolicyDetailsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){var u;this.$scope=n,this.$rootScope=t,this.SettingsService=i,this.GroupService=r,u=function(){o(),n.PolicyControllerModel=n.selecteditem,angular.forEach(n.PolicyControllerModel.AssignedGroups,function(t){t.Prefix=t.GroupName.charAt(0),n.EditAssignedGroupsModel.assignedGroups.push(t),n.EditAssignedGroupsModel.initialGroups.push(t)}),e()},n.SaveEditedGroups=function(){n.PolicyControllerModel.AssignedGroups=n.EditAssignedGroupsModel.assignedGroups,i.UpdateOfficePolicy(n.PolicyControllerModel)},n.Cancel=function(){n.$emit('closeFlyout')},n.RemoveGroup=function(t){var i=n.EditAssignedGroupsModel.assignedGroups.indexOf(t);n.EditAssignedGroupsModel.assignedGroups.splice(i,1),f()},n.AddGroup=function(t){var i=n.EditAssignedGroupsModel.assignedGroups.indexOf(t);t.Prefix=t.GroupName.charAt(0),i<0&&n.EditAssignedGroupsModel.assignedGroups.push(t),n.EditAssignedGroupsModel.currentGroup='',f()};var e=function(){r.GetGroups(null,null,null,null,null).then(function(t){var i=t.data;n.EditAssignedGroupsModel.groupsToAssign=i.Groups,s()},function(n){h(n)})},f=function(){if(n.EditAssignedGroupsModel.initialGroups.length===n.EditAssignedGroupsModel.assignedGroups.length){n.EditAssignedGroupsModel.hasChanges=!1,n.EditAssignedGroupsModel.initialGroups.every(function(t){var i=n.EditAssignedGroupsModel.assignedGroups.indexOf(t);if(i<0)return n.EditAssignedGroupsModel.hasChanges=!0,!1});return}n.EditAssignedGroupsModel.hasChanges=!0},o=function(){n.$emit('showWaitingIndicator',!0),n.EditAssignedGroupsModel={},n.EditAssignedGroupsModel.saveError=!1,n.EditAssignedGroupsModel.hasChanges=!1,n.EditAssignedGroupsModel.assignedGroups=[],n.EditAssignedGroupsModel.initialGroups=[],n.EditAssignedGroupsModel.showForm=!1,n.EditAssignedGroupsModel.saveInProgress=!1,n.EditAssignedGroupsModel.saveFinished=!1,n.EditAssignedGroupsModel.formData={}},s=function(){n.$emit('showWaitingIndicator',!1),n.EditAssignedGroupsModel.showForm=!0},c=function(){n.EditAssignedGroupsModel.saveInProgress=!1,n.EditAssignedGroupsModel.saveFinished=!0,n.EditAssignedGroupsModel.showCloseButton=!0},h=function(t){n.$emit('showWaitingIndicator',!1),n.EditAssignedGroupsModel.showForm=!0,n.EditAssignedGroupsModel.saveInProgress=!1,n.EditAssignedGroupsModel.saveError=!0,n.EditAssignedGroupsModel.saveErrorMessage=t.data.Message};u()}return n.$inject=["$scope","$rootScope","SettingsService","GroupService"],n}();n.EditAssignedGroupsController=t,n.app.controller("EditAssignedGroupsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){var i;this.$scope=n,this.SettingsService=t,i=function(){f(),n.ProductControllerModel=n.selecteditem,n.ProductControllerModel.showForm=!1,n.ProductControllerModel.configuredCount=0,n.ProductControllerModel.DisplayName=n.selecteditem.DisplayName,(angular.isUndefined(n.ProductControllerModel.settingsFilter)||n.ProductControllerModel.settingsFilter==null)&&(n.ProductControllerModel.settingsFilter=""),(angular.isUndefined(n.ProductControllerModel.viewFilter)||n.ProductControllerModel.viewFilter==null)&&(n.ProductControllerModel.viewFilter=""),(angular.isUndefined(n.ProductControllerModel.Categories)||n.ProductControllerModel.Categories==null)&&(n.ProductControllerModel.Categories=[]),r(),u()},n.Cancel=function(){n.$emit('closeFlyout')},n.ShowPolicyDetails=function(t){n.ProductControllerModel.SelectedConfigSetting=t},n.filterList=function(t){return(n.ProductControllerModel.settingsFilter==""||n.ProductControllerModel.settingsFilter==t.Category)&&(n.ProductControllerModel.viewFilter==""||n.ProductControllerModel.viewFilter==t.Configured)};var r=function(){t.GetProductConfigurationViewOptions().then(function(t){n.ProductControllerModel.viewOptions=t},function(){n.ProductControllerModel.saveError=!0,n.$emit('showWaitingIndicator',!1),n.ProductControllerModel.showForm=!0})},u=function(){t.GetProductConfigurationPolicies(n.ProductControllerModel.Id,n.ProductControllerModel.selectedProduct).then(function(t){t.data&&(n.ProductControllerModel.policyList=n.policyList=t.data.OfficePolicySettings,n.policyList.forEach(function(t){t.Configured=t.Status==1?"Yes":"No",t.Configured=="Yes"&&n.ProductControllerModel.configuredCount++,n.ProductControllerModel.Categories.indexOf(t.Category)<0&&n.ProductControllerModel.Categories.push(t.Category)})),e()},function(){n.ProductControllerModel.saveError=!0,n.$emit('showWaitingIndicator',!1),n.ProductControllerModel.showForm=!0})},f=function(){n.ProductControllerModel={},n.$emit('showWaitingIndicator',!0),n.ProductControllerModel.showForm=!1,n.ProductControllerModel.saveError=!1},e=function(){n.$emit('showWaitingIndicator',!1),n.ProductControllerModel.showForm=!0};i()}return n.$inject=["$scope","SettingsService"],n}();n.ProductConfigurationSettingsController=t,n.app.controller("ProductConfigurationSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function r(){n.DeletePolicyControllerModel=n.selecteditem}this.$scope=n,this.$rootScope=t,this.SettingsService=i,n.DeleteSettings=function(){n.DeletePolicyControllerModel.showForm=!1,n.DeletePolicyControllerModel.saveinprogress=!0,n.DeletePolicyControllerModel.savefinished=!1,i.DeleteSettings(n.selecteditem.Id).then(function(){u()},function(t){n.DeletePolicyControllerModel.showForm=!0,n.DeletePolicyControllerModel.saveinprogress=!1,n.DeletePolicyControllerModel.deleteSettingsError=!0,n.DeletePolicyControllerModel.deleteSettingsStatusMessage=t.data})},n.Cancel=function(){n.$emit('closeFlyout')};var u=function(){n.$emit('showWaitingIndicator',!1),n.DeletePolicyControllerModel.saveinprogress=!1,n.DeletePolicyControllerModel.savefinished=!0,n.DeletePolicyControllerModel.showForm=!1};r()}return n.$inject=["$scope","$rootScope","SettingsService"],n}();n.DeleteSettingsController=t,n.app.controller("DeleteSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){this.$scope=n,this.SettingsService=t,n.PolicyControllerModel=n.selecteditem,n.PolicyControllerModel.saveinprogress=!1,n.PolicyControllerModel.showForm=!0,t.CreateOfficePolicySettings(n.PolicyControllerModel.Id,n.PolicyControllerModel.SelectedConfigSetting.Id),angular.forEach(n.PolicyControllerModel.SelectedConfigSetting.Options,function(n){if(n.Value&&n.Type===3){var t=n.Items.filter(function(t){return t.Key===n.Value});n.SelectedItem=t[0]}}),n.Cancel=function(){n.$emit('closeFlyout')},n.Save=function(){n.PolicyControllerModel.showForm=!1,n.PolicyControllerModel.saveinprogress=!0,angular.forEach(n.PolicyControllerModel.SelectedConfigSetting.Options,function(n){n.Type===3&&n.SelectedItem&&(n.Value=n.SelectedItem.Key)});var f={DisplayName:n.PolicyControllerModel.SelectedConfigSetting.DisplayName,OfficePolicyId:n.PolicyControllerModel.Id,OfficePolicySettingId:n.PolicyControllerModel.SelectedConfigSetting.Id,Comments:n.PolicyControllerModel.SelectedConfigSetting.Comments,AllowUserToModify:n.PolicyControllerModel.SelectedConfigSetting.Configured=="Yes"?!0:!1,Status:n.PolicyControllerModel.SelectedConfigSetting.Status,Options:n.PolicyControllerModel.SelectedConfigSetting.Options};t.UpdateOfficePolicySettings(f).then(function(){i(),r()},function(n){u(n)})},n.initCallbackFlyout=function(t){n.flyout=t};var i=function(){var t={flyoutTemplateUrl:"../AdminPortal/Settings/productconfig",flyoutType:"officepolicysettingslarge",flyoutHeaderTitle:n.PolicyControllerModel.DisplayName,flyoutHeaderIcon:"ms-Icon ms-Icon--office ss-cldr-icon",waitingIndicatorMessage:'Please wait',selecteditem:n.PolicyControllerModel};n.flyout.invoke(t),n.$emit('closePanel')},r=function(){n.$emit('showWaitingIndicator',!1),n.PolicyControllerModel.showForm=!0},u=function(){n.PolicyControllerModel.showForm=!0,n.PolicyControllerModel.saveError=!0,n.PolicyControllerModel.saveErrorMessage='Unable to save the policy'}}return n.$inject=["$scope","SettingsService"],n}();n.EditPolicyConfigurationController=t,n.app.controller("EditPolicyConfigurationController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){var r,u,f;this.$scope=n,this.CompanyProfileService=t,this.UserManagementService=i,n.releaseTrackOptions={None:'Standard release',FirstRelease:'First release for everyone',StagedRollout:'First release for selected users'},n.recommendationText='\x28Recommended\x29',n.init=function(){n.LogoImageContent=null,n.BackgroundImageContent=null,n.showSummary=!1,n.fileLogoSizeError=!1,n.fileBgSizeError=!1,n.isGetServerError=!1,n.hideLogoPreview=!1,n.hideBgPreview=!1,n.saveThemeInProgress=!1,n.IsStateProvinceStored=!1,n.ThemeColors={accentColor:"0078D7",navBarColor:"000000",textIconColor:"FFFFFF",appLauncherColor:"000000"},n.HelpdeskModel={},n.isCustomTilesAndSupportVisible=!1,n.CheckTilesAndSupportVisibility(),n.GetDataLocations(),n.CurrentConfig={showZipCodeFirst:!1},i.GetAddUserPageDefaults().then(function(t){n.CurrentConfig.showZipCodeFirst=t.data.ShowZipFirst})},n.initCallbackFlyout=function(t){n.flyout=t},n.GetDataLocations=function(){t.GetDataLocations().then(function(i){n.TenantDataLocation=i.data,t.GetEligibleLocalLocation().then(function(t){n.TenantDataLocation.EligibleDataLocation=t.data})})},r=n.$on('refreshDataResidencyOption',function(){n.GetDataLocations()}),n.IsLocalDataLocationValid=function(n){return a(n)},n.GetBingPlacesLink=function(){n.bingPlacesLink={},t.GetBingPlacesLink().then(function(t){n.bingPlacesLink=t.data},function(){n.bingPlacesLink.error='Please try again later.',n.bingPlacesLink.showErrors=!0})},n.GetReleasePreference=function(){n.releasePreference={},t.GetReleasePreference().then(function(t){n.releasePreference=t.data,n.releasePreference.ReleaseTrackDisplayName=n.releaseTrackOptions[n.releasePreference.ReleaseTrack],n.userCount=n.releasePreference.UserCount,n.compassUserCount=n.releasePreference.CompassUserCount},function(){n.releasePreference.error='Sorry, we can\x27t load your release preferences. Try again. If that doesn\x27t help, check to be sure you have a valid Office subscription.',n.releasePreference.showErrors=!0})},u=n.$on('RefreshList',function(t,i){i&&i=='bulkaddreleasetrack'&&n.GetReleasePreference()}),f=n.$on('refreshReleasePreferences',function(){n.GetReleasePreference()}),n.GetCompanyInformation=function(){n.companyInfomation={},t.GetCompanyInformation().then(function(t){n.companyInfomation=t.data,n.companyInfomation.LanguageName=n.companyInfomation.SupportedLanguages[n.GetLanguageIndex(n.companyInfomation.SupportedLanguages,n.companyInfomation.Language)].Name,t.data.PossibleStatesOrProvinces&&(n.companyInfomation.StateOrProvinceName=n.companyInfomation.PossibleStatesOrProvinces[n.GetStateOrProvinceIndex(n.companyInfomation.PossibleStatesOrProvinces,n.companyInfomation.State)].Value)},function(t){n.companyInfomation.error=t.data,n.companyInfomation.showErrors=!0})},n.UpdateReleasePreference=function(t){s(),e(n.formData,t),n.formData.ReleaseTrackOption=n.formData.ReleaseTrack},n.UpdateCompanyInformation=function(t){s(),n.companyLanguages=t.SupportedLanguages,n.possibleStatesOrProvinces=t.PossibleStatesOrProvinces,angular.isDefined(t.State)&&(n.IsStateProvinceStored=!0),o(n.formData,t)},n.GetLanguageIndex=function(n,t){var i=0;return angular.forEach(n,function(n,r){n.ID==t&&(i=r)}),i},n.GetStateOrProvinceIndex=function(n,t){var i=0;return angular.forEach(n,function(n,r){n.Value==t&&(i=r)}),i},n.SaveCompanyProfile=function(){h(),t.UpdateCompanyInformation(n.formData).then(function(){c(),o(n.selecteditem,n.formData)},function(n){l(n)})},n.ConfirmReleasePreference=function(){n.showForm=!1,n.saveError=null,n.showConfirm=!0},n.GoBackReleasePreference=function(){n.showForm=!0,n.showConfirm=!1},n.SaveReleasePreference=function(){h();var i=n.formData.ReleaseTrack;n.formData.ReleaseTrack=n.formData.ReleaseTrackOption,t.UpdateReleasePreference(n.formData).then(function(){c(),e(n.selecteditem,n.formData),n.selecteditem.UserCount=0},function(t){n.formData.ReleaseTrack=i,l(t)})},n.CloseActionLinks=function(){$(".userlistActions").hide();return},n.ToggleActionLinks=function(){$(".userlistActions").toggle()},n.OpenManagePeopleFlyout=function(){n.$emit('closeFlyout');var t={flyoutTemplateUrl:"../AdminPortal/CompanyProfile/FirstReleaseSelect",flyoutHeaderTitle:'Manage people for first release',flyoutTitle:"",waitingIndicatorMessage:'Updating release preferences',selecteditem:{ReleaseTrack:'StagedRollout',GoToAdd:!0}};n.flyout.invoke(t)},n.$on('$destroy',function(){r&&(r(),r=null),u&&(u(),u=null),f&&(f(),f=null)}),n.Cancel=function(){n.$emit('closeFlyout'),n.$destroy()};var e=function(t,i){t.ReleaseTrack=i.ReleaseTrack,t.ReleaseTrackDisplayName=n.releaseTrackOptions[i.ReleaseTrack],t.ShowRecommendation=i.ShowRecommendation},o=function(n,t){n.Name=t.Name,n.Address1=t.Address1,n.Address2=t.Address2,n.Address3=t.Address3,n.Address4=t.Address4,n.PostalCode=t.PostalCode,n.City=t.City,n.State=t.State,n.PhoneNumber=t.PhoneNumber,n.TechnicalContactEmail=t.TechnicalContactEmail,n.Language=t.Language,n.LanguageName=t.LanguageName,n.Country=t.Country},s=function(){n.showForm=!0,n.showConfirm=!1,n.saveInProgress=!1,n.saveFinished=!1,n.saveError=!1,n.formData={}},h=function(){n.showForm=!1,n.showConfirm=!1,n.saveInProgress=!0,n.saveFinished=!1,n.saveError=!1},c=function(){n.saveInProgress=!1,n.saveFinished=!0,n.showCloseButton=!0},l=function(t){n.showForm=!0,n.saveInProgress=!1,n.saveError=!0,n.saveErrorMessage=t.data.Message},a=function(n){return!(n===null||n===""||n===" "||n===undefined)},v=['image/jpg','image/gif','image/png','image/jpeg'];n.UpdateThemeLogoImage=function(t){var i=new FileReader,f=t.target,r=f.files[0],u;n.fileLogoSizeError=r.size>10240?!0:!1,u=r.type,n.fileTypeError=v.indexOf(u)===-1,n.fileLogoSizeError||n.fileTypeError||(n.HasTenantLogo=!0,i.readAsDataURL(r),i.onloadend=function(){n.$applyAsync(function(){n.LogoImageContent=i.result,n.companyThemeModel.LogoPhotoBytes=i.result,n.UpdateTenantUICustomizationSettings(!1),n.logofilename=r.name})})},n.UpdateThemeBackgroundImage=function(t){var i=new FileReader,u=t.target,r=u.files[0];n.fileBgSizeError=r.size>15360?!0:!1,angular.equals(n.fileBgSizeError,!1)&&(n.HasTenantBackgroundImage=!0,i.readAsDataURL(r),i.onloadend=function(){n.$applyAsync(function(){n.BackgroundImageContent=i.result,n.companyThemeModel.BackgroundPhotoBytes=i.result,n.UpdateTenantUICustomizationSettings(!1),n.bgfilename=r.name})})},n.GetTenantUICustomizationSettings=function(){t.GetTenantUICustomizationSettings().then(function(t){n.companyThemeModel=t.data,n.ThemeModel={},n.ThemeModel.accentColor=t.data.Colors[0],n.ThemeModel.navBarColor=t.data.Colors[1],n.ThemeModel.textIconColor=t.data.Colors[2],n.ThemeModel.appLauncherColor=t.data.Colors[3],n.themeTemplateId=t.data.ThemeTemplateId,n.homePageUrl=t.data.HomePageUrl,n.HasTenantLogo=t.data.HasTenantLogo,n.LogoImageContent=t.data.LogoImageUrl,n.BackgroundImageContent=t.data.BackgroundImageUrl,n.HasTenantBackgroundImage=t.data.HasTenantBackgroundImage,n.ShowUserPersonalizationSetting=t.data.ShowUserPersonalizationSetting,n.userPersonalizationAllowed=!t.data.UserPersonalizationAllowed,n.ThemeColorChanged()},function(){n.showSummary=!0,n.isGetServerError=!0})},n.ThemeColorChanged=function(){var t=[];t[0]=n.ThemeModel.accentColor,t[1]=n.ThemeModel.navBarColor,t[2]=n.ThemeModel.textIconColor,t[3]=n.ThemeModel.appLauncherColor,n.UpdateColors(t)},n.setAppLauncherIconColor=function(t){n.ThemeModel.appLauncherColor=angular.isDefined(t)?t:n.ThemeModel.textIconColor,n.ThemeColorChanged()},n.UpdateTenantUICustomizationSettings=function(i){n.saveThemeInProgress=!0,n.companyThemeModel.Colors[0]=n.ThemeModel.accentColor,n.companyThemeModel.Colors[1]=n.ThemeModel.navBarColor,n.companyThemeModel.Colors[2]=n.ThemeModel.textIconColor,n.companyThemeModel.Colors[3]=n.ThemeModel.appLauncherColor,n.companyThemeModel.UserPersonalizationAllowed=!n.userPersonalizationAllowed,n.companyThemeModel.HomePageUrl=n.homePageUrl,n.companyThemeModel.HasTenantLogo=n.HasTenantLogo,n.companyThemeModel.HasTenantBackgroundImage=n.HasTenantBackgroundImage,n.ThemeColorChanged(),n.HasTenantLogo&&n.RefreshLogo(n.companyThemeModel.LogoPhotoBytes),n.HasTenantBackgroundImage&&n.RefreshBackground(n.companyThemeModel.BackgroundPhotoBytes),t.UpdateTenantUICustomizationSettings(n.companyThemeModel).then(function(){n.saveThemeInProgress=!1,i&&(n.showSummary=!0),n.isServerError=!1},function(){n.saveThemeInProgress=!1,i&&(n.showSummary=!0),n.isServerError=!0})},n.RenderCoBranding=function(t){var f="/data.theme?action=tc&tc=",e=t.join('|'),r=f+e+"&tt="+n.themeTemplateId+"&tv="+ +new Date,i=null,u=null;u=window.top.document.getElementsByTagName('head')[0],i=window.top.document.getElementById('shellThemeLink'),i||(i=window.top.document.createElement('link'),i.type='text/css',i.rel='stylesheet',i.id='shellThemeLink',u.appendChild(i)),i.href=r,angular.isDefined(window.top.Shared)&&window.top.Shared.LoadCssFile&&window.top.Shared.LoadCssFile("DynamicThemePreview",r),angular.isDefined(window.top.O365Shell)&&window.top.O365Shell.SetTenantBrandingVisibility&&window.top.O365Shell.SetTenantBrandingVisibility(!0)},n.ResetColors=function(){var t=n.companyThemeModel.DefaultColors;n.UpdateColors(t)},n.UpdateColors=function(t){n.companyThemeModel.Colors=t,n.ThemeModel.accentColor=t[0],n.ThemeModel.navBarColor=t[1],n.ThemeModel.textIconColor=t[2],n.ThemeModel.appLauncherColor=t[3];for(var i in t)t[i].match('#')&&(t[i]=t[i].substring(1));n.RenderCoBranding(t)},n.setBackground=function(n){return angular.isDefined(n)&&n.match('#')?{'background-color':n}:{'background-color':'#'+n}},n.RemoveLogo=function(){n.LogoImageContent=null,n.hideLogoPreview=!0,n.HasTenantLogo=!1,n.companyThemeModel.RemoveLogoCustomization=!0,n.logofilename=null,n.homePageUrl=null,n.RefreshLogo(null),n.UpdateTenantUICustomizationSettings(!1)},n.RemoveBackground=function(){n.$applyAsync(function(){n.BackgroundImageContent=null,n.hideBgPreview=!0,n.HasTenantBackgroundImage=!1,n.companyThemeModel.RemoveBackgroundCustomization=!0,n.bgfilename=null,n.RefreshBackground(null),n.UpdateTenantUICustomizationSettings(!1)})},n.RefreshLogo=function(t){angular.isDefined(window.top.O365Shell)&&window.top.O365Shell.SetTenantLogoProperties&&(window.top.O365Shell.SetTenantLogoProperties(n.HasTenantLogo,t,n.homePageUrl),window.top.O365Shell.SetTenantBrandingVisibility(!0))},n.RefreshBackground=function(t){angular.isDefined(window.top.O365Shell)&&window.top.O365Shell.SetTenantBackgroundImageProperties&&(window.top.O365Shell.SetTenantBackgroundImageProperties(n.HasTenantBackgroundImage,t),window.top.O365Shell.SetTenantBrandingVisibility(!0))},n.RemoveTenantCustomizations=function(){n.companyThemeModel.RemoveTenantUICustomizations=!0,n.ResetColors(),n.UpdateTenantUICustomizationSettings(!0)},n.GetCustomHelpdeskSettings=function(){t.GetCustomHelpdeskSettings().then(function(t){var i=t.data;n.HelpdeskModel=i},function(){n.HelpdeskModel.showSummary=!0,n.HelpdeskModel.isGetServerError=!0})},n.UpdateCustomHelpdeskSettings=function(i){i.$invalid||t.UpdateCustomHelpdeskSettings(n.HelpdeskModel).then(function(){n.HelpdeskModel.showSummary=!0,n.HelpdeskModel.isSetServerError=!1},function(){n.HelpdeskModel.showSummary=!0,n.HelpdeskModel.isSetServerError=!0})},n.CheckTilesAndSupportVisibility=function(){t.GetCustomTileandSupportVisibility().then(function(t){n.isCustomTilesAndSupportVisible=t.data},function(){})},n.init()}return n.$inject=["$scope","CompanyProfileService","UserManagementService"],n}();n.CompanyProfileController=t,n.app.controller("CompanyProfileController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(t,i,r){function e(){t.apps=[],t.AppsListConfig=n.prototype.GetAppsListConfig(),t.saveinprogress=!1,t.showTileform=!0,t.savefinished=!1,t.formData.customTile={},f()}this.$scope=t,this.CompanyProfileService=i,this.PanelService=r,t.$on('$destroy',function(){u&&(u(),u=null)}),t.Cancel=function(){t.$emit('closeFlyout'),t.$destroy()},t.Close=function(){t.formData.refreshListArgs={},t.$emit('closeFlyout'),t.$destroy()},t.Remove=function(){t.saveinprogress=!0,t.formData.customTile=t.selecteditem,i.RemoveCustomTile(t.formData.customTile).then(function(){t.showTileform=!1,t.saveinprogress=!1,t.savefinished=!0,t.successMessage="Successfully deleted app : "+t.formData.customTile.Name},function(){t.failureMessage='Sorry, we couldn\x27t delete the selected app right now. Please try again later.',t.deleteTileError=!0,t.saveinprogress=!1,t.savefinished=!1})},t.UpdateSelectedItem=function(n){n&&(t.selecteditem=n)};var u=t.$on('RefreshList',function(){f()}),f=function(){t.AppsListConfig.loadingList=!0,i.GetCustomTiles().then(function(n){o(n.data)},function(n){s(n)})},o=function(n){t.AppsListConfig.loadingList=!1,t.apps=n.Tiles,t.AppsListConfig.NoResults=this.$scope.apps.length===0},s=function(){t.AppsListConfig.loadingList=!1,t.AppsListConfig.GetAppsError=!0};e()}return n.prototype.GetAppsListConfig=function(){return{IsPreviousRequestPending:!1,NoResults:!1,GetAppsError:!1,loadingList:!0,sortDown:!0}},n.$inject=["$scope","CompanyProfileService","PanelService"],n}();n.CustomTilesController=t,n.app.controller("CustomTilesController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){function u(){n.isEdit=n.selecteditem?!0:!1,n.loadInProgress=!0,n.loadingMessage='Loading...',n.saveInProgress=!1,n.saveCompleted=!1,n.formData.customTile={},n.isEdit?f():n.loadInProgress=!1}function f(){n.formData.customTile=n.selecteditem,n.loadInProgress=!1}function i(){n.saveInProgress=!1,n.saveCompleted=!0,n.successMessage='Your changes were saved successfully.'}function r(){n.saveInProgress=!1,n.saveCompleted=!0,n.failureMessage='Sorry, we couldn\x27t make the change right now. Please try again later.'}this.$scope=n,this.CompanyProfileService=t,n.Save=function(){n.saveInProgress=!0,t.UpdateCustomTiles(n.formData.customTile).then(function(){i()},function(){r()})},n.Add=function(){n.saveInProgress=!0,t.AddCustomTile(n.formData.customTile).then(function(){i()},function(){r()})},n.Cancel=function(){n.formData.refreshListArgs={},n.$emit('closeFlyout')},n.Close=function(){n.formData.refreshListArgs={},n.$emit('closeFlyout')},u()}return n.$inject=["$scope","CompanyProfileService"],n}();n.app.controller("AddEditCustomTileController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){var l;this.$scope=n,this.SettingsService=t,this.NavigationService=i,n.init=function(){},n.GetPasswordPolicy=function(){n.passwordPolicy={},t.GetPasswordPolicy().then(function(t){n.passwordPolicy=t.data,n.passwordPolicy.showErrors=!1,n.showForm=!0,n.$emit('showWaitingIndicator',!1)},function(t){n.passwordPolicy.error=t.data,n.passwordPolicy.showErrors=!0,n.showForm=!0,n.$emit('showWaitingIndicator',!1)})},n.GetDataAccessSettings=function(){n.dataAccessSettings={},t.GetDataAccessSettings().then(function(t){n.dataAccessSettings=t.data,n.dataAccessSettings.showErrors=!1,n.showForm=!0,n.$emit('showWaitingIndicator',!1)},function(t){n.dataAccessSettings.error=t.data,n.dataAccessSettings.showErrors=!0,n.showForm=!0,n.$emit('showWaitingIndicator',!1)})},n.GetAuditSettings=function(){n.auditSettings={},t.GetAuditSettings().then(function(t){n.auditSettings=t.data,n.auditSettings.showErrors=!1,n.$emit('showWaitingIndicator',!1),n.showForm=!0},function(t){n.auditSettings.error=t.data,n.auditSettings.showErrors=!0,n.$emit('showWaitingIndicator',!1),n.showForm=!0})},n.GetCommunitySettings=function(){n.CommunitySettings={},n.CommunitySettings.showErrors=!1,r(),t.GetCommunitySettings().then(function(t){n.formData.Enabled=t.data.Enabled,n.CommunitySettings.originalEnabledValue=n.formData.Enabled,n.$emit('showWaitingIndicator',!1),n.showForm=!0},function(t){n.CommunitySettings.error=t.data,n.CommunitySettings.showErrors=!0,n.$emit('showWaitingIndicator',!1),n.showForm=!0})},n.GetModernAuthSettings=function(){n.modernAuthSettings={},t.GetModernAuthSettings().then(function(t){n.modernAuthSettings=t.data,n.modernAuthSettings.showErrors=!1,n.$emit('showWaitingIndicator',!1),n.showForm=!0},function(t){n.modernAuthSettings.error=t.data,n.modernAuthSettings.showErrors=!0,n.$emit('showWaitingIndicator',!1),n.showForm=!0})},n.GetGuestUserSettings=function(){n.guestUserSettings={},r(),t.GetGuestUserSettings().then(function(t){n.guestUserSettings=t.data,n.guestUserSettings.showErrors=!1,n.$emit('showWaitingIndicator',!1),n.showForm=!0},function(t){n.guestUserSettings.error=t.data,n.guestUserSettings.showErrors=!0,n.$emit('showWaitingIndicator',!1),n.showForm=!0})},n.GetUpdateModernAuthSettings=function(t){r(),n.GetModernAuthSettings(),c(n.formData,t)},n.GetUpdatePasswordPolicy=function(t){r(),n.GetPasswordPolicy(),s(n.formData,t),n.minimumNotificationDays=t.MinimumNotificationDays,n.maximumNotificationDays=t.MaximumNotificationDays,n.minimumValidityPeriod=t.MinimumValidityPeriod,n.maximumValidityPeriod=t.MaximumValidityPeriod},n.GetUpdateDataAccessSettings=function(t){r(),n.GetDataAccessSettings(),o(n.formData,t)},n.GetUpdateAuditSettings=function(t){r(),n.GetAuditSettings(),h(n.formData,t)},n.SavePasswordPolicy=function(){u(),t.UpdatePasswordPolicy(n.formData).then(function(){f(),s(n.selecteditem,n.formData)},function(t){n.passwordPolicy.showErrors=!0,e(t)})},n.SaveGuestUserPolicy=function(){u(),t.UpdateGuestUserSettings(n.guestUserSettings).then(function(){f(),a(n.selecteditem,n.guestUserSettings)},function(n){e(n)})},l=function(t){n.menuItems=t.Navigation,n.adminMenuItems=t.AdminConsoles,angular.forEach(n.adminMenuItems[0].submenu,function(t){t.text=='Azure AD'&&(n.AzureAD=t)})},n.ResetPassword=function(){n.AzureAD={},t.GetAADLink().then(function(t){n.AzureAD.aadAdminCenter=t.data.AadAdminCenter,n.AzureAD.passwordRegistration=t.data.PasswordRegistration})},n.SaveDataAccessSettings=function(){u(),t.UpdateDataAccessSettings(n.formData).then(function(){f(),o(n.selecteditem,n.formData)},function(t){n.dataAccessSettings.showErrors=!0,e(t)})},n.SaveAuditSettings=function(){u(),t.UpdateAuditSettings(n.formData).then(function(){f(),h(n.selecteditem,n.formData)},function(t){n.auditSettings.showErrors=!0,e(t)})},n.SaveCommunitySettings=function(){u(),t.UpdateCommunitySettings(n.formData).then(function(){f(),v(n.selecteditem,n.formData)},function(t){n.CommunitySettings.showErrors=!0,e(t)})},n.SaveModernAuthSettings=function(){u(),n.formData.OriginalState=n.modernAuthSettings.OriginalState,t.UpdateModernAuthSettings(n.formData).then(function(){f(),c(n.selecteditem,n.formData)},function(t){n.modernAuthSettings.showErrors=!0,e(t)})},n.ModernAuthStateChange=function(){n.hasActiveChange=n.modernAuthSettings.OriginalState!=n.formData.Enabled?!0:!1},n.Cancel=function(){n.$emit('closeFlyout')};var r=function(){n.$emit('showWaitingIndicator',!0),n.showForm=!1,n.saveInProgress=!1,n.saveFinished=!1,n.saveError=!1,n.hasActiveChange=!1,n.formData={}},u=function(){n.showForm=!1,n.saveInProgress=!0,n.saveFinished=!1,n.showErrors=!1},f=function(){n.saveInProgress=!1,n.saveFinished=!0,n.showCloseButton=!0},e=function(t){n.showForm=!0,n.saveInProgress=!1,n.showErrors=!0,n.saveErrorMessage=t.data.Message},o=function(n,t){n.RequireApproval=t.RequireApproval},s=function(n,t){n.NeverExpire=t.NeverExpire,n.ValidityPeriod=t.ValidityPeriod,n.NotificationDays=t.NotificationDays},a=function(n,t){n.AllowGuestAccess=t.AllowGuestAccess,n.AllowGuestInvitations=t.AllowGuestInvitations},h=function(n,t){n.Enabled=t.Enabled},v=function(n,t){n.Enabled=t.Enabled},c=function(n,t){n.Enabled=t.Enabled};n.init()}return n.$inject=["$scope","SettingsService","NavigationService"],n}();n.SecuritySettingsController=t,n.app.controller("SecuritySettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){n.TakeoverTrackingGuid="",n.AddModel=i.AddModel,n.domainChoice="add",n.errorMessages={},i.FirstRun&&(t.wizard().goTo(i.StartingStep),i.FirstRun=!1,t.wizard().setDomainName(i.AddModel.DomainName)),n.WaitingOnAdd=!1,n.AddUnverifiedDomain=function(){if(angular.isUndefined(i.AddModel.DomainName)){n.noDomainError=!0,n.noDomainErrorMessage='Please provide all required fields.';return}n.noDomainError=!1,n.WaitingOnAdd=!0,n.UpdateConciergeProblemDescription(),r.AddUnverifiedDomain(n.AddModel).then(function(r){i.AddModel=r.data,t.wizard().next(),t.wizard().setDomainName(i.AddModel.DomainName),n.WaitingOnAdd=!1},function(i){if(n.errorMessages.DomainName="",i.data.ModelState)for(var r in i.data.ModelState)r==="Redirect"&&(O365.Instrument.ClientInstrument.getInstance().logClientDataAndValue("Domains","DomainWizard_TakeoverProcess"),n.TakeoverTrackingGuid=i.data.ModelState[r][0],n.AddModel.TrackingGuid=n.TakeoverTrackingGuid,t.wizard("IntroductionSubWizard").goTo("ExternalTakeoverSeparateIntroduction")),n.errorMessages.DomainName+=i.data.ModelState[r][0],n.UpdateConciergeProblemDescription(n.errorMessages.DomainName);else console.error(i),n.errorMessages.DomainName+="Unexpected error",n.UpdateConciergeProblemDescription(n.errorMessages.DomainName);n.WaitingOnAdd=!1})},n.WaitingOnSend=!1,n.SendSignupInvitation=function(){n.WaitingOnSend=!0,n.UpdateConciergeProblemDescription(),r.SendSignupInvitation(n.AddModel).then(function(i){n.AddModel=i.data,t.wizard("IntroductionSubWizard").goTo("ExternalTakeoverSeparateComplete"),n.WaitingOnSend=!1},function(t){if(n.errorMessages.SendSignupInvitation="",t.data.ModelState)for(var i in t.data.ModelState)n.errorMessages.SendSignupInvitation+=t.data.ModelState[i][0],n.UpdateConciergeProblemDescription(n.errorMessages.SendSignupInvitation);else console.error(t),n.errorMessages.SendSignupInvitation+="Unexpected error",n.UpdateConciergeProblemDescription(n.errorMessages.SendSignupInvitation);n.WaitingOnSend=!1})},n.Signout=function(){location.href=n.AddModel.SignoutUrl}}return n.$inject=["$scope","wizardHandler","AddModelService","DomainService"],n}();n.app.controller("SelectDomainController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){n.AddModel=i.AddModel,n.ShowPanel=!1,n.WaitForNextStep=!1,n.InitializeDomainDelegation=function(){n.AddModel.Registrar.Name==='GoDaddy'?n.AddModel.ManageOptions=2:n.AddModel.ManageOptions===0&&(n.AddModel.ManageOptions=1),r.GetDomainDelegationModel(n.AddModel).then(function(t){n.DomainDelegationModel=t.data,n.DomainDelegationModel&&n.DomainDelegationModel.RequiredDelegation!=0?(n.AddModel.ManageOptions=n.DomainDelegationModel.RequiredDelegation,n.SetDomainDelegation()):n.ShowPanel=!0},function(t){console.error("Unexpected error checking if full delegation is allowed"),console.error(t.data),n.AddModel.ManageOptions=2,n.SetDomainDelegation()})},n.SetDomainDelegation=function(){n.WaitForNextStep=!0,n.DelegationError=null,n.UpdateConciergeProblemDescription(),r.SetDomainDelegation(n.AddModel).then(function(r){i.AddModel=r.data,t.wizard().next(),n.WaitForNextStep=!1},function(t){console.error("Unexpected error setting delegation type"),console.error(t.data),n.DelegationError=t.data,n.UpdateConciergeProblemDescription(n.DelegationError),n.ShowPanel=!0,n.WaitForNextStep=!1})},n.AddModel.IsAddUserCompleted?n.InitializeDomainDelegation():r.SkipAddUsers(n.AddModel).then(function(){console.log("skipping add users"),n.InitializeDomainDelegation()})}return n.$inject=["$scope","wizardHandler","AddModelService","DomainService"],n}();n.app.controller("DnsManagementController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f){function o(){t.DNSHealthModelLoaded=!1,t.DNSHealthModel=null,t.ManualConfigError=null,t.UpdateConciergeProblemDescription(),f.CheckIsTroubleshootingAllowed(t.AddModel.DomainName).then(function(n){n.data.CanManageDomains&&n.data.EnableTroubleshootingFeature||(t.ManualConfigError=n.data.DisabledReasonMessage,t.UpdateConciergeProblemDescription(t.ManualConfigError))},function(n){t.ManualConfigError=n.data,t.UpdateConciergeProblemDescription(t.ManualConfigError)}).then(function(){t.ManualConfigError?t.DNSHealthModelLoaded=!0:f.CheckDnsHealth(t.AddModel.DomainName,!0).then(function(n){n.data.Succeeded?(t.DNSHealthModel=n.data.Data,t.DNSHealthModelLoaded=!0,t.DNSHealthModel!=null?t.DNSHealthModel!=null&&t.DNSHealthModel.IsHealthy&&(O365.Instrument.ClientInstrument.getInstance().logClientDataAndValue("Domains","DomainWizard_PassedDnsRecordCheck"),r.wizard("DnsUpdateSubWizard").goTo("CompleteStep")):(t.ManualConfigError='We can\x27t verify the DNS records. Please try again later.',t.UpdateConciergeProblemDescription(t.ManualConfigError))):(t.ManualConfigError=n.data.Message,t.UpdateConciergeProblemDescription(t.ManualConfigError),t.DNSHealthModelLoaded=!0)},function(n){if(t.ManualConfigError=n.data,t.DNSHealthModelLoaded=!0,n.status===500){var i=' The DNS servers for \x7b0\x7d could not be reached. Please try again later.';t.ManualConfigError+=i.replace("{0}",t.AddModel.DomainName)}t.UpdateConciergeProblemDescription(t.ManualConfigError)})})}function s(n){t.DomainDNS=null,t.UpdateConciergeProblemDescription(),f.GetDomainDns(t.AddModel.DomainName,"Full",!0).then(function(i){t.DomainDNS=i.data,t.DomainDNSLoaded=!0,n||(t.showDnsSection={},t.DomainDNS.forEach(function(n){n.IsAddable&&(t.showDnsSection[n.ServiceName]=!0)}))},function(n){t.failureMessage=n.data,t.UpdateConciergeProblemDescription(t.failureMessage),t.ShowFailureMessage={value:!0},t.DomainDNSLoaded=!0})}function l(){t.parent={autoConfig:!0,SkipDnsRecordCheck:!1},t.supportAutoConfig=t.AddModel.Registrar&&t.AddModel.Registrar.SupportAutoConfiguration,t.supportFullRedelgation=t.AddModel.Registrar.SupportFullRedelegation,t.supportFullDelegation=t.$root.features&&t.$root.features.EnableNewDomainFullDelegationStep&&t.AddModel.ManageOptions==1,t.supportAutoConfig?a():t.supportFullDelegation?h():e(),t.domain={},t.domain.Name=t.AddModel.DomainName,t.domain.DomainType="Partial",t.domain.caller="AddDomain",t.selectedRegistrar={value:t.currentRegistrar}}function a(){t.IsAuthorizedForAutoDnsConfig=!1,u.CredentialUsed&&f.IsAuthorizedForAutoDnsConfig(t.AddModel.DomainName,t.AddModel.Registrar.NameEnum).then(function(n){t.IsAuthorizedForAutoDnsConfig=n.data.IsAuthorized})}function h(){t.WaitForSave=!1,t.WaitForRemove=!1,t.ShowSuccessMessage={value:!1},t.ShowFailureMessage={value:!1},t.failureMessage=null,t.formData={},t.DomainDNSLoaded=!1,s(!1)}function e(){t.firstRun=!0,t.DNSHealthModelLoaded||o()}function c(n){for(var i in n)t.failureMessage=n[i][0],t.UpdateConciergeProblemDescription(t.failureMessage),t.ShowFailureMessage.value=!0}this.$rootScope=n,t.AddModel=u.AddModel,t.currentRegistrar=u.SavedRegistrar&&u.SavedRegistrar.RegistrarName?u.SavedRegistrar:t.AddModel.Registrar?t.allRegistrarHelpInfo[t.AddModel.Registrar.NameEnum]:t.allRegistrarHelpInfo[0],l(),t.RecordTypeList=[{Name:'TXT \x28Text\x29',Value:"TXT"},{Name:'CNAME \x28Alias\x29',Value:"CNAME"},{Name:'A \x28Address\x29',Value:"A"},{Name:'AAAA \x28IPv6 Address\x29',Value:"AAAA"}],t.RecordTtlList=[{Name:'1 Hour',Value:3600},{Name:'1 Day',Value:86400},{Name:'1 Week',Value:604800}],t.CheckDnsRecords=function(){t.parent.SkipDnsRecordCheck?(O365.Instrument.ClientInstrument.getInstance().logClientDataAndValue("Domains","DomainWizard_SkipDNSRecordCheck"),t.DnsRecordCheckSkipped=!0,r.wizard("DnsUpdateSubWizard").goTo("CompleteStep")):(t.firstRun=!1,o())},t.OnDomainRegistrarHelpChange=function(n){t.currentRegistrar=u.SavedRegistrar=n,t.UpdateConciergeProblemDescription(u.LastError)},t.CompleteAdd=function(){f.CompleteAddDomain(t.AddModel).then(function(){n.$broadcast('refreshsetupbannerstatus'),t.Cancel()})},t.AutoConfigDomain=function(n){t.WaitForConfig=!0,t.AutoConfigError=null,t.UpdateConciergeProblemDescription(),f.AutoConfigDNSRecords(t.AddModel.DomainName,t.AddModel.Registrar.NameEnum,n).then(function(){t.firstRun=!1,t.WaitForConfig=!1,u.CredentialUsed=!0,r.wizard("DnsUpdateSubWizard").goTo("AutoConfigResult")},function(n){t.WaitForConfig=!1,n.data&&n.data.Message?(t.AutoConfigError=n.data.Message,t.UpdateConciergeProblemDescription(t.AutoConfigError)):(t.AutoConfigError='We can\x27t add the DNS records for you. Please try again later or add them yourself.',t.UpdateConciergeProblemDescription(t.AutoConfigError)),u.CredentialUsed=!1})},t.NextActionInConfigDnsOptionStep=function(){t.parent.autoConfig?t.IsAuthorizedForAutoDnsConfig&&u.CredentialUsed?t.AutoConfigDomain(""):t.authPopup=i.open(t.AddModel.Registrar.AuthorizationPageUrl,"_blank",t.AddModel.Registrar.AuthorizationPageSpec):(r.wizard("DnsUpdateSubWizard").goTo("ManualConfigDns"),e())},t.BackActionInConfigDnsOptionStep=function(){t.AddModel.Registrar&&t.AddModel.Registrar.SupportFullRedelegation===!1?r.wizard().goTo(1):t.GoBack()},t.NextActionInTransferRecordsStep=function(){e(),r.wizard("DnsUpdateSubWizard").goTo("ManualConfigDns")},t.BackActionInTransferRecordsStep=function(){t.supportAutoConfig?r.wizard("DnsUpdateSubWizard").goTo("ConfigDnsOption"):t.GoBack()},t.NextActionInManualConfigDns=function(){t.CheckDnsRecords()},t.BackActionInManualConfigDns=function(){t.supportFullDelegation?(h(),r.wizard("DnsUpdateSubWizard").goTo("TransferRecordsStep")):t.supportAutoConfig?r.wizard("DnsUpdateSubWizard").goTo("ConfigDnsOption"):t.supportFullRedelgation?t.GoBack():r.wizard().goTo(1)},t.NextActionInAutoConfigResult=function(){r.wizard("DnsUpdateSubWizard").goTo("CompleteStep")},t.BackActionInAutoConfigResult=function(){t.GoBack()},t.$on('updatednsrecords',function(n,i){i.action=='save'?(t.ShowSuccessMessage.value=!0,t.IsSaveMessage=!0):i.action=='delete'&&(t.ShowSuccessMessage.value=!0,t.IsSaveMessage=!1),t.DomainDNSLoaded=!1,s(!0)}),t.RemoveRecord=function(n,i){t.WaitForRemove=!0,t.ShowSuccessMessage.value=!1,t.ShowFailureMessage.value=!1,f.RemoveCustomDnsRecord(n,i).then(function(){t.WaitForRemove=!1;var r={domainName:n,action:"delete"};t.$emit('updatednsrecords',r)},function(n){t.WaitForRemove=!1,c(n.data.ModelState)})},t.AddRecord=function(n,i){if(t.WaitForSave=!0,t.ShowSuccessMessage.value=!1,t.ShowFailureMessage.value=!1,!i.Type||!i.HostName||!i.Value||!i.TtlValue){t.WaitForSave=!1,t.failureMessage='Please provide all required fields.',t.ShowFailureMessage.value=!0;return}f.SaveCustomDnsRecord(n,i).then(function(){t.WaitForSave=!1;var r={domainName:n,action:"save"};t.$emit('updatednsrecords',r),t.formData={}},function(n){t.WaitForSave=!1,c(n.data.ModelState)})},i.AcceptAuthCode=function(n){t.authPopup&&(t.authPopup.close(),t.authPopup=null);var r=n.AuthCode;r!=null?t.AutoConfigDomain(r):t.parent.autoConfig=!1}}return n.$inject=["$rootScope","$scope","$window","wizardHandler","AddModelService","DomainService"],n}();n.app.controller("DnsUpdateController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){function a(){n.parent={autoVerify:!0},n.WaitForVerify=!1,n.supportAutoVerify=!n.AddModel.IsVerified&&n.AddModel.Registrar&&n.AddModel.Registrar.SupportAutoVerification}var f,o;n.AddModel=r.AddModel,n.VerificationDataInitialized=!1,f=function(){return u.GetVerificationData(n.AddModel).then(function(t){n.VerificationDataModel=t.data.Records,n.VerificationDataInitialized=!0,n.VerificationDataChanged=n.PreviousVerificationTXTRecord!=null&&n.VerificationDataModel.TXTRecord.Data.Value!=n.PreviousVerificationTXTRecord,n.PreviousVerificationTXTRecord=n.VerificationDataModel.TXTRecord.Data.Value},function(t){console.error(t),n.VerificationDataInitialized=!0})},o=function(){return u.GetActualVerificationDnsRecords(n.AddModel.DomainName).then(function(t){n.ActualDnsRecords=t.data.Data},function(n){console.error(n)})},r.SavedRegistrar&&r.SavedRegistrar.RegistrarName?n.currentRegistrar=r.SavedRegistrar:n.AddModel.Registrar?(n.currentRegistrar=n.allRegistrarHelpInfo[n.AddModel.Registrar.NameEnum],n.UpdateConciergeProblemDescription()):n.currentRegistrar=n.allRegistrarHelpInfo[0],a(),n.AddModel.IsVerified||f();var e=function(){n.VerificationMissingRecords=!1,n.VerificationDataChanged=!1,n.VerifyErrors="",n.DnsHealthyList=null},c=function(t){if(t.data.ModelState)for(var i in t.data.ModelState)n.VerificationMissingRecords=i==="VerificationMissingRecordsAlert"},s=function(t){if(t.data.ModelState)for(var i in t.data.ModelState)n.VerifyErrors=t.data.ModelState[i][0],n.UpdateConciergeProblemDescription(n.VerifyErrors);else n.VerifyErrors='Failed to verify domain ownership.',n.UpdateConciergeProblemDescription(n.VerifyErrors);n.WaitForVerify=!1},l=function(n){r.CredentialUsed=!1,h(n)},h=function(t){f().then(function(){c(t),n.VerificationMissingRecords&&n.$root.features&&n.$root.features.ShowCurrentVericationDns?o().then(function(){s(t)}):s(t)})};n.OnDomainRegistrarHelpChange=function(t){r.SavedRegistrar=t,n.UpdateConciergeProblemDescription(r.LastError)},n.WaitForVerify=!1,n.ManualVerifyDomain=function(){if(e(),n.AddModel.IsVerified){u.IsFullDelegatedResellerDomain(n.AddModel).then(function(n){n.data?(i.wizard().SetAllStepsCompleted(),i.wizard().goTo(4)):i.wizard().next()});return}n.WaitForVerify=!0,u.ManualVerifyDomain(n.AddModel).then(function(t){r.AddModel=t.data,i.wizard().next(),n.WaitForVerify=!1},h)},n.AutoVerifyDomain=function(t){e(),n.WaitForVerify=!0,n.AddModel.AuthCode=t,u.AutoVerifyDomain(n.AddModel).then(function(t){r.AddModel=t.data,r.CredentialUsed=!0,i.wizard().next(),n.WaitForVerify=!1},l)},n.NextActionInVerificationOptionStep=function(){n.parent.autoVerify?(r.OpenedOAuth=!0,n.authPopup=t.open(n.AddModel.Registrar.AuthorizationPageUrl,"_blank",n.AddModel.Registrar.AuthorizationPageSpec)):i.wizard("VerifySubWizard").goTo("ManualVerifyStep")},n.NextActionInManualVerifyStep=function(){n.ManualVerifyDomain()},n.BackActionInVerificationOptionStep=function(){n.GoBack()},n.BackActionInManualVerifyStep=function(){e(),n.supportAutoVerify?i.wizard("VerifySubWizard").goTo("VerificationOptionStep"):n.GoBack()},t.AcceptAuthCode=function(t){n.authPopup&&(n.authPopup.close(),n.authPopup=null),r.OpenedOAuth=!1;var u=t.AuthCode;u!=null?n.AutoVerifyDomain(u):n.parent.autoVerify=!1},n.$watchGroup(['VerificationDataModel','ActualDnsRecords'],function(){n.DnsHealthyList=u.generateHealthModel(n.ActualDnsRecords,n.VerificationDataModel)})}return n.$inject=["$scope","$window","wizardHandler","AddModelService","DomainService"],n}();n.app.controller("VerifyDomainController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){n.AddModel=i.AddModel,n.SetStringFormat=function(n,t){return String.format(n,t)}}return n.$inject=["$scope","wizardHandler","AddModelService"],n}();n.app.controller("FinishDomainSetupController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){n.AddModel=i.AddModel,r.GetAddUsersModel(n.AddModel).then(function(t){n.GetAddUsersModel=t.data}),n.SkipAddUsers=function(){r.SkipAddUsers(i.AddModel).then(t.wizard().next())}}return n.$inject=["$scope","wizardHandler","AddModelService","DomainService"],n}();n.app.controller("AddDomainUserController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var i=function(){function n(n,t,i,r,u,f,e){var s,h,c,l,a,o;n.$root.refreshList=!0,n.$parent.$parent.childPerformCloseAction=!0,i.OpenedOAuth=!1,n.WizardDataLoaded=!1,n.GetCurrentStep=function(){return t.wizard()?t.wizard().currentStepNumber():-1},n.GetCurrentStepName=function(){return t.wizard()?t.wizard().currentStepTitle():null},n.GetCurrentSubstepName=function(){return t.wizard()?n.GetCurrentStepName()=='Add a domain'&&t.wizard("IntroductionSubWizard")!=null?t.wizard("IntroductionSubWizard").currentStepTitle():n.GetCurrentStepName()=='Verify domain'&&t.wizard("VerifySubWizard")!=null?t.wizard("VerifySubWizard").currentStepTitle():n.GetCurrentStepName()=='Update DNS settings'&&t.wizard("DnsUpdateSubWizard")!=null?t.wizard("DnsUpdateSubWizard").currentStepTitle():n.GetCurrentStepName()=='Set up your online services'&&t.wizard("DnsUpdateSubWizard")!=null?t.wizard("DnsUpdateSubWizard").currentStepTitle():null:null},i.AddModel={},i.SavedRegistrar={},i.CredentialUsed=!1,s=function(){return n.$root.features.EnableConciergeProblemDescriptions?e.InitializeProblemDescriptionsDictionary("domains").then(function(){return!0}):!0},h=function(){return r.GetRegistrarHelpInfo().then(function(t){return n.allRegistrarHelpInfo=t.data,!0})},n.GoBack=function(){t.wizard().previous()},c=function(n){var t=0;return n.IsVerified?t=2:n.Exists&&(t=1),t},i.StartingStep=0,i.FirstRun=!0,l=function(){return n.selecteditem&&!angular.equals({},n.selecteditem)?(i.AddModel.DomainName=n.selecteditem.Name,r.GetAddDomainState(i.AddModel).then(function(n){return i.AddModel=n.data,i.StartingStep=c(i.AddModel),!0},function(n){return console.log(n),!1})):!0},n.LastSavedConciergeProblemDescription=null,n.ShowConcierge=function(){O365.Instrument.ClientInstrument.getInstance().logClientAction("AddDomainWizard",{Value:"ShowConcierge"});var t=$("#conciergeMinState, #cw-min-state, #needHelperTitleV2").filter(function(){return $(this).css("display")=="block"});t&&(n.$root.features.EnableConciergeProblemDescriptions&&n.LastSavedConciergeProblemDescription!==null?(typeof Concierge!='undefined'&&Concierge.RestoreWidget(n.LastSavedConciergeProblemDescription),typeof FastTrack!='undefined'&&FastTrack.RestoreWidget(n.LastSavedConciergeProblemDescription)):i.AddModel.DomainName!=null?r.GetConciergeMessage(i.AddModel,n.GetCurrentSubstepName(),i.LastError).then(function(n){typeof Concierge!='undefined'&&Concierge.RestoreWidget(n.data),typeof FastTrack!='undefined'&&FastTrack.RestoreWidget(n.data)}):t.trigger("click"))},n.UpdateConciergeProblemDescription=function(t){typeof t!="string"&&(t=null),i.LastError=t,n.$root.features.EnableConciergeProblemDescriptions&&n.GetCurrentSubstepName()&&(n.LastSavedConciergeProblemDescription=e.UpdateProblemDescription("domains",n.GetCurrentSubstepName().toLowerCase(),t,i.SavedRegistrar))},u.all([h(),l(),s()]).then(function(){n.WizardDataLoaded=!0}),a=function(){n.$emit('updatedomaindata'),f(function(){n.$destroy()})},n.Cancel=function(){n.$root.refreshList=!0,n.$root.CurrentUserInfo.ShowExitFeedback&&n.GetCurrentStepName()!='FinishDomainWizard'&&i.AddModel.IsExitFeedbackShown!=null&&!i.AddModel.IsExitFeedbackShown?n.GetCurrentStepName()=='Update DNS settings'&&t.wizard("DnsUpdateSubWizard")!=null&&t.wizard("DnsUpdateSubWizard").currentStepTitle()=="CompleteStep"?n.Exit():n.GetCurrentStepName()=='Add a domain'&&t.wizard("IntroductionSubWizard")!=null&&t.wizard("IntroductionSubWizard").currentStepTitle()=="ExternalTakeoverSeparateComplete"?n.Exit():n.StartEWizard():n.Exit()},n.StartEWizard=function(){angular.element('#eWizOverlay').css('z-index','1999'),angular.element('#eWizDialog').css('z-index','2000'),$('#ModalExitWizardFeedbackDiv').appendTo('body'),n.$broadcast('EWizard:start')},n.ExitAfterEWizard=function(){$('#ModalExitWizardFeedbackDiv').remove(),n.Exit()},n.LogAndExitAfterEWizard=function(){r.MarkExitFeedbackShown(i.AddModel),n.ExitAfterEWizard()},n.Exit=function(){n.$parent.$parent.childPerformCloseAction=!1,i.OpenedOAuth&&r.LogOAuthRedirectNotCalled(),e.ClearProblemDescription(),n.$emit('closeFlyout')},o=n.$on('O365Flyout:close',function(){n.Cancel(),o&&(o(),o=null)}),n.$on("wizard:stepChanged",function(){n.UpdateConciergeProblemDescription()}),n.$root.RefreshList=a}return n.$inject=["$scope","wizardHandler","AddModelService","DomainService","$q","$timeout","ConciergeIntegrationService"],n}(),t;n.app.controller("AddDomainWizardController",i),t=function(){function n(){this.StartingStep=0,this.FirstRun=!0,this.CredentialUsed=!1,this.OpenedOAuth=!1}return n}(),n.AddModelService=t,AdminApp.service("AddModelService",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function u(){t.GetDomainBuyModel().then(function(t){n.DomainBuyModel=t.data,n.ShowPanel=!0},function(){n.ShowFailureMessage.value=!0,n.ShowPanel=!0})}this.$scope=n,this.domainService=t,this.$location=i,n.ShowPanel=!1,n.ShowFailureMessage={value:!1};var r="/catalog";n.GoToUpgradeServices=function(){i.path(r),n.Close()},n.Close=function(){n.$emit('closeFlyout')},u()}return n.$inject=["$scope","DomainService","$location"],n}();n.app.controller("BuyDomainController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f){function s(){t.GetDomainList().then(function(t){typeof n.DomainListModel=="undefined"||n.DomainListModel==null?(n.DomainListModel=angular.copy(t.data),n.DomainListConfig.ShowLoadingSpinner=!1,n.FilterDomainList(),e(n.DomainListModel,0),o(n.DomainListModel,0),c()):n.DomainListModel.length!=t.data.length?(n.DomainListModel=t.data,n.FilterDomainList()):(h(n.DomainListModel,t.data),n.FilterDomainList()),document.getElementById('ShellBodyAndFooterContainer').style.overflow="auto"},function(){n.DomainListConfig.ServerError=!0})}function e(n,i){if(!(i>=n.length)){var r=n[i];if(n.domainDns&&n.domainDns.DataLoaded){e(n,i+1);return}r.domainDns={},t.GetDomainDns(r.Name,r.DomainType,!1).then(function(){e(n,i+1)},function(){e(n,i+1)})}}function o(n,i){if(!(i>=n.length)){var r=n[i];if(!r.IsReseller||r.resellerData&&r.resellerData.DataLoaded){o(n,i+1);return}r.resellerData={},t.GetResellerDomainData(r.Name,r.DomainRegistrar,!1).then(function(){o(n,i+1)},function(){o(n,i+1)})}}function c(){t.CheckDnsForAllDomains().then(function(t){h(n.DomainListModel,t.data),n.enableViewFiltering=!0},function(){n.enableViewFiltering=!0})}function h(n,t){return t&&angular.forEach(t,function(t,i){angular.extend(n[i],t)}),n}this.$scope=n,this.DomainService=t,this.$window=i,this.HelperService=r,this.$stateParams=u,this.$timeout=f,n.init=function(){n.$emit("autoscrolltotop"),n.DomainListConfig={SearchInitiated:!1,NoResults:!1,DomainView:"AllDomains",DomainSorting:['-IsDefault','Name'],SortField:"",SearchTerm:"",SortAscending:!1,ShowLoadingSpinner:!0,ServerError:!1},n.enableViewFiltering=!1;var t=r.GetDeepLinkAttributes(u.action);t==undefined||t==null||f(function(){n.OpenFlyoutOrPanel(t)},500)},n.OpenFlyoutOrPanel=function(t){t!=undefined&&(r.IsValid(t.flyoutTemplateUrl)?n.flyout.invoke(t):r.IsValid(t.panelTemplateUrl)&&n.panel.invoke(t))},n.SetSelectedDomain=function(t){n.SelectedDomain=t},n.RedirectToBuy=function(){t.GetDomainBuyModel().then(function(n){var t=n.data;t==null||t.PaidSubscriptionRequired||t.BuyFromResellerPartnerRequired||t.PurchaseUrl&&t.PurchaseUrl.length&&(i.location=t.PurchaseUrl)})},n.ListNewDefaultDomains=function(){var t=[];return r.IsValid(n.DomainListModel)&&(n.DomainListModel.forEach(function(n){n.IsDefault||n.Status!=='Verified'||t.push(n)}),t.length===1&&(n.newDefaultDomain=t[0])),t},n.initCallbackPanel=function(t){n.panel=t},n.initCallbackFlyout=function(t){n.flyout=t},n.previousSearchTerm="",n.SearchKeyup=function(t){t.keyCode===13&&n.previousSearchTerm!==n.DomainListConfig.SearchTerm?(n.DomainListConfig.SearchInitiated=!0,n.previousSearchTerm=n.DomainListConfig.SearchTerm,n.FilterDomainList(),n.$emit("autoscrolltotop")):n.DomainListConfig.SearchTerm===""&&n.previousSearchTerm!==n.DomainListConfig.SearchTerm&&(n.DomainListConfig.SearchInitiated=!1,n.previousSearchTerm=n.DomainListConfig.SearchTerm,n.FilterDomainList(),n.$emit("autoscrolltotop"))},n.SearchBoxClose=function(){n.previousSearchTerm="",n.DomainListConfig.SearchTerm="",n.DomainListConfig.SearchInitiated=!1,n.FilterDomainList(),n.$emit("autoscrolltotop")},n.SearchBoxToggle=function(n){n?$("#domainSearchTerm").addClass("is-active"):$("#domainSearchTerm").removeClass("is-active")},n.ToggleSortOption=function(t){switch(t){case"DomainName":n.DomainListConfig.SortField=t,n.DomainListConfig.SortAscending=!n.DomainListConfig.SortAscending,n.DomainListConfig.DomainSorting=n.DomainListConfig.SortAscending?['Name']:['-Name'];break;default:n.DomainListConfig.SortField="",n.DomainListConfig.SortAscending=!1}},n.$on("updatedomaindata",function(){s()}),n.$on("SoftDeleteDomain",function(t,i){if(i)for(var r=0;r<n.DomainListModel.length;r++)n.DomainListModel[r].Name==i&&(n.DomainListModel[r].IsDeleted=!0)}),n.FilterDomainList=function(){var t=!0;angular.forEach(n.DomainListModel,function(i,r){switch(n.DomainListConfig.DomainView){case"AllDomains":n.DomainListModel[r].Show=!0;break;case"SetupInProgress":n.DomainListModel[r].Show=!n.DomainListModel[r].IsSetupCompleted;break;case"ServiceIssues":n.DomainListModel[r].Show=n.DomainListModel[r].IsSetupCompleted&&n.DomainListModel[r].DnsHealthStatus==="UnHealthy";break;case"SetupComplete":n.DomainListModel[r].Show=n.DomainListModel[r].IsSetupCompleted&&n.DomainListModel[r].DnsHealthStatus!=="UnHealthy";break;case"Verified":n.DomainListModel[r].Show=n.DomainListModel[r].Status==='Verified';break;case"Unverified":n.DomainListModel[r].Show=n.DomainListModel[r].Status!=='Verified';break;default:n.DomainListModel[r].Show=!0}n.DomainListModel[r].Show&&n.DomainListConfig.SearchTerm&&(n.DomainListConfig.SearchInitiated=!0,n.DomainListModel[r].Show=n.DomainListModel[r].Name.indexOf(n.DomainListConfig.SearchTerm)!==-1),n.DomainListModel[r].Show&&(t=!1)}),n.DomainListConfig.NoResults=t},n.init(),typeof n.DomainListModel=="undefined"&&s()}return n.$inject=["$scope","DomainService","$window","HelperService","$stateParams","$timeout"],n}();n.app.controller("DomainListViewController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){function o(){n.ShowSuccessMessageForSetDefaultDomain={value:!1},n.ShowErrorMessageForSetDefaultDomain={value:!1},n.ShowSuccessMessageForDnsHealth={value:!1},n.ShowErrorMessageForDnsHealth={value:!1},n.ShowErrorCanManageDomains={value:!1},n.ShowErrorEnableTroubleshootingFeature={value:!1},s()}function c(){return function(){return n.$parent.$parent.selectedItem}}var s,h,e,f;this.$scope=n,this.PanelService=i,this.DomainService=r,this.conciergeIntegrationService=u,n.ResetMessageBars=function(){n.ShowSuccessMessageForSetDefaultDomain.value=!1,n.ShowErrorMessageForSetDefaultDomain.value=!1,n.ShowSuccessMessageForDnsHealth.value=!1,n.ShowErrorMessageForDnsHealth.value=!1,n.ShowErrorCanManageDomains.value=!1,n.ShowErrorEnableTroubleshootingFeature.value=!1},s=function(){return n.$root.features.EnableConciergeProblemDescriptions?u.InitializeProblemDescriptionsDictionary("checkdnshealth").then(function(){return!0}):!0},n.UpdateConciergeProblemDescription=function(t){typeof t!="string"&&(t=null),n.DNSHealthContext={domainName:null,registrarName:null,dnsAilmentDescription:null},n.domain&&n.domain.Name&&(n.DNSHealthContext.domainName=n.domain.Name),n.domain&&n.domain.DnsHealthData&&(n.DNSHealthContext.dnsAilmentDescription=n.domain.DnsHealthData.DnsHealthAilmentDescription),n.$root.features.EnableConciergeProblemDescriptions&&(n.LastSavedConciergeProblemDescription=u.UpdateProblemDescription("checkdnshealth","dnshealthreport",t,n.DNSHealthContext))},h=n.$watch(c(),function(t){angular.isUndefined(t)||(n.domain=t,h(),o())}),e=n.$on(i.GetBroadCastEventName(),function(t,i){n.domain=i,o(),n.$apply(function(){})}),n.$on('panelclosed',function(){e&&(e(),e=null),f&&f&&(f(),f=null)}),f=n.$on('updateDnsHealthStatus',function(t,i){i=="Healthy"&&(n.ShowSuccessMessageForDnsHealth.value=!0),n.domain.DnsHealthStatus=i,n.domain.DnsHealthData={}}),n.SetDefaultDomain=function(t){n.ShowWaitMessageForSetDefaultDomain=!0,n.ResetMessageBars(),r.SetDefaultDomain(t).then(function(){n.ShowSuccessMessageForSetDefaultDomain.value=!0,n.ShowWaitMessageForSetDefaultDomain=!1,n.$emit('updatedomaindata'),n.domain.IsDefault=!0},function(){n.ShowErrorMessageForSetDefaultDomain.value=!0,n.ShowWaitMessageForSetDefaultDomain=!1})},n.EnableTransfer=function(){n.$broadcast('showtransfersection',null)},n.ShowWaitMessageForDnsHealth=!1,n.GetDnsHealth=function(){n.ShowWaitMessageForDnsHealth=!0,n.ResetMessageBars(),n.UpdateConciergeProblemDescription(),r.CheckIsTroubleshootingAllowed(n.domain.Name).then(function(t){n.ShowErrorCanManageDomains.value=!t.data.CanManageDomains,n.ShowErrorEnableTroubleshootingFeature.value=!t.data.EnableTroubleshootingFeature}).then(function(){n.ShowErrorCanManageDomains.value===!1&&n.ShowErrorEnableTroubleshootingFeature.value===!1?r.CheckDnsHealth(n.domain.Name,!0).then(function(i){i.data.Succeeded?(n.ShowWaitMessageForDnsHealth=!1,n.ShowErrorCanManageDomains.value=!1,n.ShowErrorEnableTroubleshootingFeature.value=!1,n.domain.DnsHealthData=i.data.Data,n.UpdateConciergeProblemDescription(),n.domain.DnsHealthData.IsHealthy?(n.domain.DnsHealthStatus="Healthy",n.ShowSuccessMessageForDnsHealth.value=!0):n.domain.DnsHealthData.IsHealthy==!1&&(n.domain.DnsHealthStatus="UnHealthy",t(function(){angular.element('#ViewErrorId').trigger('click')})),n.$emit('updatedomaindata')):(n.ShowErrorMessageForDnsHealth.value=!0,n.ShowWaitMessageForDnsHealth=!1,n.ShowErrorCanManageDomains.value=!1,n.ShowErrorEnableTroubleshootingFeature.value=!1,n.UpdateConciergeProblemDescription('Sorry we cannot check for DNS issues.'))},function(){n.ShowErrorMessageForDnsHealth.value=!0,n.ShowWaitMessageForDnsHealth=!1,n.ShowErrorCanManageDomains.value=!1,n.ShowErrorEnableTroubleshootingFeature.value=!1,n.UpdateConciergeProblemDescription('Sorry we cannot check for DNS issues.')}):n.ShowWaitMessageForDnsHealth=!1})}}return n.$inject=["$scope","$timeout","PanelService","DomainService","ConciergeIntegrationService"],n}();n.app.controller("DomainDetailController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function r(){n.formData={},i.CopyResellerContactData(n.formData,n.data),n.GetCurrentStateList(!0),n.UpdateAll=!1}function u(t){for(var i in t)n.errorMessage[i]=t[i][0]}this.$scope=n,this.$timeout=t,this.DomainService=i,n.Cancel=function(){n.$emit('closeFlyout')},n.Close=function(){n.$emit('closeFlyout')},n.GetCurrentStateList=function(t){i.GetStateList(n.formData.CountryOrRegion).then(function(i){n.StateList=i.data.Options,!t&&n.StateList.length>0&&(n.formData.State=n.StateList[0].Value)})},n.UpdateContact=function(){n.$emit('showWaitingIndicator',!0),n.showSuccess=!1,n.showError=!1;var r=n.objectid;n.UpdateAll&&(r=-1),i.UpdateContact(n.selecteditem.Name,r,n.formData,n.selecteditem.DomainRegistrar).then(function(){n.$emit('showWaitingIndicator',!1),n.showSuccess=!0,n.showError=!1;var f={};f.formData=n.formData,f.type=r,f.domainName=n.selecteditem.Name,n.$emit('updatecontacts',f),t(function(){i.GetResellerDomainData(n.selecteditem.Name,n.selecteditem.DomainRegistrar,!0)},5e3),n.Close()},function(t){n.$emit('showWaitingIndicator',!1),n.showSuccess=!1,n.showError=!0,u(t.data.ModelState)})},r()}return n.$inject=["$scope","$timeout","DomainService"],n}();n.app.controller("DomainResellerEditContactsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){function h(){n.errorMessage={},n.formData={},n.domainName=undefined,n.recordValueTooltipHelptext='\x3c\x25\x3dWebResourceString\x28\x22Microsoft.O365.SuiteShared.CommonUI.Loc.Tooltips\x22, \x22customDnsRecord_Tooltip_RecordValue\x22, Encoding.JavaScript\x29\x25\x3e',n.recordValueTooltipHelptextExists=n.recordValueTooltipHelptext.charAt(0)!=='@',n.data&&(n.formData.Type=n.data.Type,n.formData.HostName=n.data.HostName,n.formData.Value=n.data.Value,n.formData.TtlValue=n.data.TtlValue,n.formData.ObjectId=n.data.ObjectId,n.formData.IsSPFRecord=o(n.data),n.formData.SPFValid=!1),n.selecteditem&&n.selecteditem.Name&&(n.domainName=n.selecteditem.Name),n.RecordTypeList=n.selecteditem.IsInitial?[{Name:'TXT \x28Text\x29',Value:"TXT"}]:[{Name:'TXT \x28Text\x29',Value:"TXT"},{Name:'CNAME \x28Alias\x29',Value:"CNAME"},{Name:'A \x28Address\x29',Value:"A"},{Name:'AAAA \x28IPv6 Address\x29',Value:"AAAA"}],n.formData.Type||(n.formData.Type=n.RecordTypeList[0].Value),n.RecordTtlList=[{Name:'1 Hour',Value:3600},{Name:'1 Day',Value:86400},{Name:'1 Week',Value:604800}],n.formData.TtlValue||(n.formData.TtlValue=n.RecordTtlList[0].Value),n.formData.IsSPFRecord?(n.formData.loadingDefaultSPF=!0,t.GetFeatureData().then(function(n){n&&n.data&&(n.data.SPFMechanismsRegex&&(f=new RegExp(n.data.SPFMechanismsRegex,"ig")),n.data.SPFO365ValueRegex&&(r=new RegExp(n.data.SPFO365ValueRegex,"ig")),n.data.SPFRecordRegex&&(u=new RegExp(n.data.SPFRecordRegex,"ig")))}),s().then(function(t){t&&angular.forEach(t,function(t){i===undefined&&o(t)&&(i=t,r.lastIndex=0,e=r.exec(i.Value)[1],r.lastIndex=0,n.formData.O365DefaultInclude=r.exec(i.Value)[0].trim(),n.ValidateSPFRecord(),n.formData.loadingDefaultSPF=!1)})}),n.$watch(function(n){return n.formData.Value},function(){i&&n.ValidateSPFRecord()})):n.formData.SPFValid=!0}function c(t){for(var i in t)n.errorMessage[i]=t[i][0]}var o,s;this.$scope=n,this.DomainService=t;var u=/^v=spf1(\s+\S+)*$/ig,f=/^(\+|\?|~|-)?(all|a|ip4|ip6|mx|ptr|exists|include)(:[^\s]+)?$/ig,r=/(?:^|\s)include:([^\s]*)/ig,e,i=undefined;o=function(n){var t=!1;return n&&n.Type&&n.HostName&&n.Value&&(u.lastIndex=0,n.Type==="TXT"&&n.HostName==="@"&&u.test(n.Value)&&(t=!0)),t},s=function(){return t.GetWorkloadDnsRecords(n.domainName).then(function(n){return n.data})},n.GetSpfInvalidMessage=function(t,i){if(!n.formData.SPFValid&&!n.formData.loadingDefaultSPF)return n.formData.o365RecordFound?t:i+" "+n.formData.O365DefaultInclude},n.ValidateSPFRecord=function(){var t=angular.copy(n.formData.Value),i=!0,s,o,h;if(n.formData.o365RecordFound=!1,t){for(s=t.split(" "),u.lastIndex=0,i=u.test(t),o=1;o<s.length;o++)i&&(f.lastIndex=0,i=f.test(s[o]));if(e)for(r.lastIndex=0;!n.formData.o365RecordFound&&(h=r.exec(t))!==null;)angular.forEach(h,function(t){n.formData.o365RecordFound||t.toLowerCase()===e.toLowerCase()&&(n.formData.o365RecordFound=!0)})}n.formData.SPFValid=i&&n.formData.o365RecordFound},n.updateHelptextNow=function(){if(n.formData.IsSPFRecord)$("#tooltip_RecordValue").html($("#tooltip_RecordValueSPF").html());else switch(n.formData.Type){case'A':$("#tooltip_RecordValue").html($("#tooltip_RecordValueA").html());break;case'AAAA':$("#tooltip_RecordValue").html($("#tooltip_RecordValueAAAA").html());break;case'CNAME':$("#tooltip_RecordValue").html($("#tooltip_RecordValueCNAME").html());break;case'TXT':$("#tooltip_RecordValue").html($("#tooltip_RecordValueTXT").html());break;default:$("#tooltip_RecordValue").html("")}},n.updateHelptext=function(t){n.recordValueTooltipHelptextExists&&($("#tooltip_RecordValue").length?n.updateHelptextNow():t<1&&setTimeout(function(){n.updateHelptext(t+1)},1500))},n.Default=function(){n.formData.IsSPFRecord&&i&&(n.formData.Value=i.Value,n.formData.HostName=i.HostName,n.formData.TtlValue=i.TtlValue)},n.Cancel=function(){n.$emit('closeFlyout')},n.Close=function(){n.$emit('closeFlyout')},n.SaveRecord=function(){n.$emit('showWaitingIndicator',!0),n.errorMessage={},t.SaveCustomDnsRecord(n.selecteditem.Name,n.formData).then(function(){n.$emit('showWaitingIndicator',!1);var i={domainName:n.selecteditem.Name,action:"save"};n.$emit('updatednsrecords',i),n.Close()},function(t){n.$emit('showWaitingIndicator',!1),c(t.data.ModelState)})},h()}return n.$inject=["$scope","DomainService"],n}();n.app.controller("EditCustomDnsRecordController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var i=function(){function n(n,i,r,u,f,e,o,s){function b(){y().then(function(){a().then(function(){n.ShowPanel=!0})})}var v=this,h,y,a,c,l,p,w;this.$scope=n,this.domainService=i,this.userManagementService=r,this.$q=u,this.$rootScope=f,this.setupWizardService=e,this.$interval=o,this.conciergeIntegrationService=s,n.ShowPanel=!1,n.domain=n.selecteditem,n.$root.refreshList=!0,n.ShowSetDefaultDomainSuccessMessage={value:!1},n.ShowSetDefaultDomainErrorMessage={value:!1},n.ShowRemoveDomainSuccessMessage={value:!1},n.ShowRemoveDomainFailureMessage={value:!1},n.RemoveDomainDependecesFailureMessage={value:!1},n.ResetMessageBars=function(){n.ShowSetDefaultDomainSuccessMessage.value=!1,n.ShowSetDefaultDomainErrorMessage.value=!1,n.ShowRemoveDomainSuccessMessage.value=!1,n.ShowRemoveDomainFailureMessage.value=!1,n.RemoveDomainDependecesFailureMessage.value=!1},n.DomainDependancyModel=new t,n.IsRemoveDone=!1,n.CurrentDefaultDomainName="",i.GetDefaultDomain().then(function(t){n.CurrentDefaultDomainName=t.data.Name}),y=function(){var t=v.$q.defer();return n.$root.features.EnableConciergeProblemDescriptions?s.InitializeProblemDescriptionsDictionary("removedomain").then(function(){t.resolve()}):t.resolve(),t.promise},n.UpdateConciergeProblemDescription=function(t){typeof t!="string"&&(t=null),n.RemoveDomainContext={domainName:null,dependenciesDescription:null},n.domain&&n.domain.Name&&(n.RemoveDomainContext.domainName=n.domain.Name),n.DomainDependancyModel&&n.DomainDependancyModel.DependencyDescription&&(n.RemoveDomainContext.dependenciesDescription=n.DomainDependancyModel.DependencyDescription),n.$root.features.EnableConciergeProblemDescriptions&&(n.LastSavedConciergeProblemDescription=s.UpdateProblemDescription("removedomain","removedomainmainpage",t,n.RemoveDomainContext))},a=function(){var t=v.$q.defer();return n.UpdateConciergeProblemDescription(),n.domain.Status.toLowerCase()==="verified"||n.domain.Status===1?(i.GetObjectsOnDomain(n.domain.Name).then(function(t){n.DomainDependancyModel.Data=t.data,n.DomainDependancyModel.DataLoaded=!0,n.DomainDependancyModel.AnyDependentObjects=t.data.DepedencyKind!=0,n.DomainDependancyModel.DependencyDescription=t.data.DependencyKindDetail,n.UpdateConciergeProblemDescription()},function(){n.ShowWaitMessage=!1,n.DomainDependancyModel.PreventsDomainRemoval=!1}),t.resolve()):(n.DomainDependancyModel.PreventsDomainRemoval=!1,t.resolve()),t.promise},b(),n.SetDefaultDomain=function(t){n.ShowWaitMessage=!0,n.ResetMessageBars(),n.UpdateConciergeProblemDescription(),i.SetDefaultDomain(t).then(function(){n.ShowSetDefaultDomainSuccessMessage.value=!0,n.ShowWaitMessage=!1,n.$emit('updatedomaindata'),n.domain.IsDefault=!1,n.CurrentDefaultDomainName=t},function(){n.ShowSetDefaultDomainErrorMessage.value=!0,n.ShowWaitMessage=!1,n.UpdateConciergeProblemDescription('Sorry, we couldn\x27t set this domain as default. Please try again later.')})},n.RemoveDomain=function(){n.ShowRemoveWaitMessage=!0,n.ResetMessageBars(),n.RemoveDomainFailureErrorDetail=null,n.UpdateConciergeProblemDescription(),i.RemoveDomain(n.domain.Name).then(function(){n.ShowRemoveDomainSuccessMessage.value=!0,n.ShowRemoveWaitMessage=!1,n.$emit('SoftDeleteDomain',n.domain.Name),n.IsRemoveDone=!0},function(t){n.ShowRemoveWaitMessage=!1,n.ShowRemoveDomainFailureMessage.value=!0,t&&t.data&&t.data.Message&&(n.RemoveDomainFailureErrorDetail=t.data.Message,n.UpdateConciergeProblemDescription(n.RemoveDomainFailureErrorDetail))})},c=n.$on("StopUpdateDependentStatus",function(){o.cancel(h),h=null}),n.$on("$destroy",function(){s.ClearProblemDescription(),o.cancel(h),c&&(c(),c=null)}),l=12,p=function(){n.UpdateConciergeProblemDescription(),h=o(function(t){a().then(function(){n.DomainDependancyModel.DataLoaded&&!n.DomainDependancyModel.AnyDependentObjects?(n.ShowRemoveWaitMessage=!1,n.$emit("StopUpdateDependentStatus")):t===l-1&&(n.ShowRemoveWaitMessage=!1,n.RemoveDomainDependecesFailureMessage.value=!0,n.UpdateConciergeProblemDescription('Removing dependency objects failed, please retry the operation after couple minutes.'))})},1e4,l)},n.formatUserMessage=function(t){var i=t.replace("#currentDomain#",n.domain.Name);return i=i.replace("#defaultDomain#",n.CurrentDefaultDomainName)},n.RemoveDomainObjects=function(){n.ShowRemoveWaitMessage=!0,n.ResetMessageBars(),n.UpdateConciergeProblemDescription(),i.RemoveObjectsOnDomain(n.DomainDependancyModel.Data).then(function(){p()},function(){n.ShowRemoveWaitMessage=!1,n.RemoveDomainDependecesFailureMessage.value=!0,n.UpdateConciergeProblemDescription('Removing dependency objects failed, please retry the operation after couple minutes.')})},n.currentUser=f.CurrentUserInfo,w=function(){n.$emit('updatedomaindata'),n.IsRemoveDone&&n.$emit('closePanel'),n.$destroy()},n.$root.RefreshList=w}return n.$inject=["$scope","DomainService","UserManagementService","$q","$rootScope","SetupWizardService","$interval","ConciergeIntegrationService"],n}(),t;n.app.controller("RemoveDomainController",i),t=function(){function n(){this.DomainName="",this.Data=null,this.AnyDependentObjects=!1,this.PreventsDomainRemoval=!0,this.DataLoaded=!1}return n}()})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){function h(t){n.ShowWaitMessageForDnsHealth=!0,n.ResetMessageBars(),n.UpdateConciergeProblemDescription(),i.CheckIsTroubleshootingAllowed(t).then(function(t){n.ShowErrorCanManageDomains.value=!t.data.CanManageDomains,n.ShowErrorEnableTroubleshootingFeature.value=!t.data.EnableTroubleshootingFeature}).then(function(){n.ShowErrorCanManageDomains.value===!1&&n.ShowErrorEnableTroubleshootingFeature.value===!1?i.CheckDnsHealth(t,!1).then(function(t){t.data.Succeeded?(n.ShowWaitMessageForDnsHealth=!1,n.ShowErrorCanManageDomains.value=!1,n.ShowErrorEnableTroubleshootingFeature.value=!1,n.selecteditem.DnsHealthData=t.data.Data,n.UpdateConciergeProblemDescription(),n.$emit('updatedomaindata'),n.selecteditem.DnsHealthData.IsHealthy==!0?(n.$emit('updateDnsHealthStatus',"Healthy"),n.ShowSuccessMessageForDnsHealth.value=!0):n.selecteditem.DnsHealthData.IsHealthy==!1&&n.source!==null&&n.source==="DomainsWidget"&&n.$emit('updateDnsHealthStatus',"UnHealthy")):(n.ShowErrorMessageForDnsHealth.value=!0,n.ShowWaitMessageForDnsHealth=!1,n.ShowErrorCanManageDomains.value=!1,n.ShowErrorEnableTroubleshootingFeature.value=!1,n.UpdateConciergeProblemDescription('Sorry we cannot check for DNS issues.'))},function(){n.ShowErrorMessageForDnsHealth.value=!0,n.ShowWaitMessageForDnsHealth=!1,n.ShowErrorCanManageDomains.value=!1,n.ShowErrorEnableTroubleshootingFeature.value=!1,n.UpdateConciergeProblemDescription('Sorry we cannot check for DNS issues.')}):n.ShowWaitMessageForDnsHealth=!1})}function c(n){return i.GetDomainRegistrar(n).then(function(n){return n.data})}var s=this,f,e,o;this.$scope=n,this.$window=t,this.DomainService=i,this.conciergeIntegrationService=r,this.$q=u,f=['MX','CNAME','TXT','SRV','NS'],n.init=function(){n.ShowSuccessMessageForDnsHealth={value:!1},n.ShowErrorMessageForDnsHealth={value:!1},n.ShowErrorCanManageDomains={value:!1},n.ShowErrorEnableTroubleshootingFeature={value:!1},n.$parent.$parent.childPerformCloseAction=!0,e(),o().then(function(){n.selecteditem.DnsHealthData?n.UpdateConciergeProblemDescription():n.Refresh()})},n.ResetMessageBars=function(){n.ShowSuccessMessageForDnsHealth.value=!1,n.ShowErrorMessageForDnsHealth.value=!1,n.ShowErrorCanManageDomains.value=!1,n.ShowErrorEnableTroubleshootingFeature.value=!1},e=function(){return n.$root.features.EnableConciergeProblemDescriptions?r.InitializeProblemDescriptionsDictionary("checkdnshealth").then(function(){return!0}):!0},n.UpdateConciergeProblemDescription=function(t){typeof t!="string"&&(t=null),n.DNSHealthContext={domainName:null,registrarName:null,dnsAilmentDescription:null},n.selecteditem&&n.selecteditem.Name&&(n.DNSHealthContext.domainName=n.selecteditem.Name),n.currentRegistrar&&n.currentRegistrar.DisplayName&&n.currentRegistrar.DisplayName!='your DNS host'&&(n.DNSHealthContext.registrarName=n.currentRegistrar.DisplayName),n.selecteditem&&n.selecteditem.DnsHealthData&&(n.DNSHealthContext.dnsAilmentDescription=n.selecteditem.DnsHealthData.DnsHealthAilmentDescription),n.$root.features.EnableConciergeProblemDescriptions&&(n.LastSavedConciergeProblemDescription=r.UpdateProblemDescription("checkdnshealth","dnshealthreport",t,n.DNSHealthContext))},n.DiagnosticRecordTypes=function(){return f},n.Refresh=function(){h(n.selecteditem.Name)},n.IgnoreDnsErrors=function(){i.SetSkipDnsCheckOn(n.selecteditem.Name).then(function(){n.selecteditem.DnsHealthStatus="Suppressed",n.$emit('updateDnsHealthStatus',"Suppressed"),n.$emit('updatedomaindata'),n.$emit('closeFlyout')})},n.OpenAuthWindow=function(){n.authPopup=t.open(n.registrar.AuthorizationPageUrl,"_blank",n.registrar.AuthorizationPageSpec)},n.ChangeDnsRecords=function(t){t!=null&&(n.ShowWaitMessageForConfigDns=!0,i.ChangeDNSRecords(n.selecteditem.Name,n.selecteditem.Capabilities,n.registrar.NameEnum,t).then(function(){n.selecteditem.DnsHealthStatus="Healthy",n.$emit('updateDnsHealthStatus',"Healthy"),n.$emit('updatedomaindata'),n.$emit('closeFlyout')}).error(function(){n.ShowWaitMessageForConfigDns=!1}))},n.UpdateCurrentRegistrar=function(t){n.currentRegistrar=t},t.AcceptAuthCode=function(t){n.authPopup&&(n.authPopup.close(),n.authPopup=null);var r=t.AuthCode;r!=null&&n.ChangeDnsRecords(r)},o=function(){var t=s.$q.defer();return c(n.selecteditem.Name).then(function(r){n.registrar=r,i.GetRegistrarHelpInfo().then(function(i){n.allRegistrarHelpInfo=i.data,n.allRegistrarHelpInfo[r.NameEnum]?(n.currentRegistrar=n.allRegistrarHelpInfo[r.NameEnum],t.resolve()):(n.currentRegistrar=n.allRegistrarHelpInfo[0],t.resolve())})}),t.promise},n.$on('O365Flyout:close',function(){r.ClearProblemDescription(),n.$emit('closeFlyout')}),n.init()}return n.$inject=["$scope","$window","DomainService","ConciergeIntegrationService","$q"],n}();n.app.controller("DnsHealthReportController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var i=function(){function n(){}return n}(),t;n.RDWidget=i,t=function(){function t(t,i,r){var u=this;this.$scope=t,this.$window=i,this.ReportService=r,t.$on(n.ReportEventNames.TimeSelectorChangeNeededEvent,function(){t.$broadcast(n.ReportEventNames.TimeSelectorChangeBroadcastEvent)}),t.loading=n.ReportsLocStrings.GetInstance().RdLoading,t.dashboardLoadErrorMessage,r.GetWidgetConfigData().then(function(n){return u.LoadWidgetConfig(t,n)},function(n){return u.WidgetConfigRetrievalFailureHandler(n,t)}),$(window).resize(function(){kendo.resize($(".k-chart"),!0)})}return t.prototype.LoadWidgetConfig=function(n,t){n.widgets=t,n.dashboardLoadErrorMessage=undefined},t.prototype.WidgetConfigRetrievalFailureHandler=function(n,t){t.dashboardLoadErrorMessage=n,t.widgets=undefined},t.$inject=["$scope","$window","ReportService"],t}(),n.ReportsDashboardController=t,n.app.controller("ReportsDashboardController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u,f){this.$scope=t,this.$http=i,this.$window=r,this.$stateParams=u,this.ReportService=f,t.tab=f.GetDaysBackFilter().value,t.isActive=function(n){return t.tab===n},t.setTabKeyPress=function(n,i){i.which===13&&t.setTab(n)},t.setTab=function(i){t.tab=i,f.SetDaysBackFilter(i),t.$emit(n.ReportEventNames.TimeSelectorChangeNeededEvent)},t.isTimeSelectorEnabled=!1,t.$watch('selectedReport.report',function(i){i&&(t.isTimeSelectorEnabled=n.ReportsUtils.isTimeSelectorEnabled(i))})}return t.$inject=["$scope","$http","$window","$stateParams","ReportService"],t}();n.app.controller("ReportsDashboardTabController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){function i(t){var r,i;for(n.errors=t,n.errorObjs=[],r=0;r<t.length;r++)i=t[r],i.Code.toLowerCase()==="upn_conflict"&&(n.requireNewUpn=!0),i.domain=i.AdditionalData.domain,i.conflictingAlias=i.AdditionalData.conflictingAlias,i.conflictingWithType=i.AdditionalData.conflictingWithType,i.conflictingWithUser=i.AdditionalData.conflictingWithUser,i.defaultDomain=i.AdditionalData.defaultDomain,i.availableDomains=i.AdditionalData.availableDomains,i.userName=i.AdditionalData.userName,i.Code.toLowerCase()==="upn_conflict"&&(n.requireNewUpn=!0,n.UpdateValues(i)),i.Code.toLowerCase()==="invalid_domain"&&n.UpdateValues(i),n.errorObjs.push(i)}function r(t){for(var i,r=0;r<t.length;r++)i=t[r],i.Code.toLowerCase()==="upn_conflict"&&(i.domain=i.AdditionalData.domain,i.conflictingAlias=i.AdditionalData.conflictingAlias,i.conflictingWithType=i.AdditionalData.conflictingWithType,i.conflictingWithUser=i.AdditionalData.conflictingWithUser,i.defaultDomain=i.AdditionalData.defaultDomain,i.availableDomains=i.AdditionalData.availableDomains,i.userName=i.AdditionalData.userName,n.upnError=i)}function e(){n.RestoreUserModel={UserId:null,NewUpn:null,AutoReconcileProxyConflicts:!1,Password:!1,ForceChangePassword:!1},n.saveinprogress=!1,n.restoreError=!1,n.serverError=!1,n.userPrincipalName=n.selecteditem.UserPrincipalName,n.oldUserPrincipalName=n.selecteditem.UserPrincipalName,n.objectId=n.selecteditem.ObjectId,n.displayName=n.selecteditem.DisplayName,n.autoReconcileProxyConflicts=!1,n.retry=!0,n.requireNewUpn=!1,n.showConflictError=!1,n.upnError=null,n.formData.sendPasswordEmailCheck=!0,n.sendPasswordEmailModel={Recipients:n.formData.sendPasswordEmailAddress,Message:"",EmailTemplate:1,EmailContents:[]},n.formData.sendPasswordEmailAddress=n.$root.CurrentUserInfo.UserInfo.UserPrincipalName,t.GetAddUserPageDefaults().then(function(t){n.formData.SendPasswordEmailAddress=t.data.SendPasswordEmailAddress,n.formData.ForceChangePassword=!0})}this.$scope=n,this.UserManagementService=t,n.restoreUserStep="confirm",n.selfgeneratedpassword="********",n.RestoreUser=function(){return n.$emit('showWaitingIndicator',!0),n.saveinprogress=!0,n.serverError=!1,n.RestoreUserModel.UserId=n.objectId,n.RestoreUserModel.NewUpn=n.userPrincipalName,n.RestoreUserModel.AutoReconcileProxyConflicts=n.autoReconcileProxyConflicts,n.formData.isSelfgeneratePassword?n.RestoreUserModel.Password=n.formData.NewPassword:(n.RestoreUserModel.Password=null,n.formData.NewPassword=null),n.RestoreUserModel.ForceChangePassword=n.formData.ForceChangePassword,t.RestoreUser(n.RestoreUserModel).then(u,f),!1},n.Cancel=function(){n.$emit('closeFlyout')};var u=function(t){var e="3",s="0",u=t.data,f,o;n.saveinprogress=!1,u.Status==e&&n.retry?(n.restoreUserStep="conflict",i(u.Errors),n.autoReconcileProxyConflicts=!0,n.retry=!1):(n.restoreUserStep="summary",f=u.Message,u.Status==e?(r(u.Errors),n.upnError!=null&&(n.showConflictError=!0)):u.Status==s?(o={UserPrincipalName:u.AdditionalMessageInfo.EncryptedUPN,Password:u.AdditionalMessageInfo.EncryptedPassword},n.sendPasswordEmailModel.EmailContents.push(o),n.sendPasswordEmailModel.EmailTemplate=1,n.restoreMessage=f,n.$emit('closePanel'),n.formData.refreshListArgs={}):(n.restoreError=!0,n.restoreMessage=f,n.serverError=!0)),n.$emit('showWaitingIndicator',!1)},f=function(t){n.saveinprogress=!1,n.restoreError=!1,n.serverError=!0,n.restoreUserStep="summary",n.restoreMessage=t.data.Message,n.$emit('showWaitingIndicator',!1)};n.UpdateValues=function(t){var i=t.userName,r=t.defaultDomain;n.userPrincipalName=i+"@"+r},n.ShowPassword=function(){n.selfgeneratedpassword=n.restoreMessage},n.HidePassword=function(){n.selfgeneratedpassword="********"},n.SendPasswordEmail=function(){n.sendPasswordEmailModel.Recipients=n.formData.sendPasswordEmailAddress,t.SendSingleUserPasswordEmail(n.sendPasswordEmailModel).then(function(t){t.data.Status!=0?(n.showEmailConfirmationMessage=!0,n.emailConfirmationMessage=t.data.Message,n.emailSendFailure=!0,n.showSendEmailControl=!0,n.formData.sendPasswordEmailCheck=!1):n.Cancel()},function(t){n.showEmailConfirmationMessage=!0,n.emailConfirmationMessage=t.data.Message,n.emailSendFailure=!0,n.showSendEmailControl=!0,n.formData.sendPasswordEmailCheck=!1})},e()}return n.$inject=["$scope","UserManagementService"],n}();n.app.controller("RestoreUserController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f){function e(){function s(n,t){var i=!1;return n.some(function(n){t.toLowerCase()===String(n).toLowerCase()&&(i=!0)}),i}var e,o,h;n.domainList=[],n.newaliasesadded=[],n.oldaliasesremoved=[],n.hasChangeOnUpn=!1,n.hasChangeOnPrimaryEmailAddress=!1,n.hasChangeOnEmailAddresses=!1,n.UpnUpdatedSuccess=!1,n.EmailUpdatedSuccess=!1,n.hasActiveChange=!1,n.showUserChangeNotification=!1,n.showEmailChangeNotification=!1,n.showWaitingIndicator=!1,n.saveComplete=!1,n.hasErrorInSaving=!1,n.emailAddresses=[],n.smtpProxyEmailAddresses=[],n.nonSmtpProxyEmailAddresses=[],n.smtpProxyEmailAddressesWithoutPrimary=[],n.oldsmtpProxyEmailAddresses=[],n.oldSmtpProxyEmailAddressesWithoutPrimary=[],n.objectid=n.selecteditem.ObjectId,n.primaryemailaddress=n.selecteditem.PrimaryEmailAddress,n.userprincipalname=n.selecteditem.UserPrincipalName,n.emailAddresses=n.selecteditem.EmailAddresses,n.upnsameasprimary=n.selecteditem.UpnEqualsSmtp,r.IsValid(n.selecteditem.data)&&r.IsValid(n.selecteditem.data.HasExchangeLicense)&&!n.selecteditem.data.HasExchangeLicense&&(n.upnsameasprimary=!1),n.olduserprincipalname=n.selecteditem.UserPrincipalName,n.oldprimaryemailaddress=n.selecteditem.PrimaryEmailAddress,n.isCurrentUserManagementAdmin=n.$root.CurrentUserInfo.SetUserEnabled,n.isCurrentExchangeAdmin=n.$root.CurrentUserInfo.ManageExchangeEnabled,n.isCurrentGlobalAdmin=n.$root.CurrentUserInfo.ManageUserExchangeEnabled,n.IsSelfUser=t.IsSelfUser(n.userprincipalname),n.selecteditem.IsProvisioned===undefined||n.selecteditem.IsProvisioned==null?t.GetUserDetails(n.objectid).then(function(t){n.isProvisioned=t.data.IsProvisioned,n.isDirSyncEnabled=t.data.IsDirSyncEnabled}):(n.isDirSyncEnabled=n.selecteditem.IsDirSyncEnabled,n.isProvisioned=n.selecteditem.IsProvisioned),n.showAdviseSync=n.isDirSyncEnabled&&n.$root.features.AdviseSyncManagedUserUpn&&!n.saveComplete,angular.forEach(n.selecteditem.EmailAddresses,function(t){t.substr(0,4)=="smtp"||t.substr(0,4)=="SMTP"?(n.smtpProxyEmailAddresses.push(t),n.oldsmtpProxyEmailAddresses.push(t),t.substr(0,4)=="smtp"&&(n.smtpProxyEmailAddressesWithoutPrimary.push(t),n.oldSmtpProxyEmailAddressesWithoutPrimary.push(t))):n.nonSmtpProxyEmailAddresses.push(t)}),t.GetUserDomainInfo().then(function(t){n.aliasDomain=t.data.DefaultDomain.Name,angular.forEach(t.data.Domains,function(t){n.domainList.push(t.Name)}),n.upn=n.selecteditem.UpnAlias,n.selectedUpnDomain=n.selecteditem.UpnDomain},function(){}),n.UpdateUpn=function(t){n.upn=t,n.hasActiveChange=!0,n.saveAliasError=!1;var i=n.upn+'@'+n.selectedUpnDomain;i!=n.userprincipalname&&(n.userprincipalname=i,n.showUserChangeNotification=!0)},n.UpdateSelectedUpnDomain=function(t){n.selectedUpnDomain=t,n.hasActiveChange=!0;var i=n.upn+'@'+n.selectedUpnDomain;i!=n.userprincipalname&&(n.userprincipalname=i,n.showUserChangeNotification=!0)},n.AddAlias=function(){var t="smtp:"+n.newalias+'@'+n.aliasDomain;s(n.smtpProxyEmailAddresses,t)?(n.isAliasDuplicate=!0,n.AddDupProxyAddressWarningMsg='The email address you\u2019re trying to add already exists.'):(n.smtpProxyEmailAddresses.push(t),n.smtpProxyEmailAddressesWithoutPrimary.push(t),n.hasActiveChange=!0,n.isAliasDuplicate=!1),n.UpdateEmailAddresses(),n.newEmailAlias='',n.newalias=''},n.RemoveAlias=function(t){var r=n.smtpProxyEmailAddresses.indexOf(t),i;r!=-1&&n.smtpProxyEmailAddresses.splice(r,1),i=n.smtpProxyEmailAddressesWithoutPrimary.indexOf(t),i!=-1&&n.smtpProxyEmailAddressesWithoutPrimary.splice(i,1),n.UpdateEmailAddresses(),n.hasActiveChange=!0},n.UpdateEmailAddresses=function(){n.emailAddresses=n.smtpProxyEmailAddresses.concat(n.nonSmtpProxyEmailAddresses)},n.SetAsPrimary=function(t){var e="SMTP:"+n.primaryemailaddress,i="smtp:"+n.primaryemailaddress,o="SMTP:"+t.substring(5),r,u,f;i!=t&&(r=n.smtpProxyEmailAddressesWithoutPrimary.indexOf(t),r!=-1&&(n.smtpProxyEmailAddressesWithoutPrimary.splice(r,1),n.smtpProxyEmailAddressesWithoutPrimary.indexOf(i)===-1&&n.smtpProxyEmailAddressesWithoutPrimary.push(i)),n.smtpProxyEmailAddresses.indexOf(i)===-1&&(u=n.smtpProxyEmailAddresses.indexOf(e),u!=-1&&(n.smtpProxyEmailAddresses.splice(u,1),n.smtpProxyEmailAddresses.push(i)),f=n.smtpProxyEmailAddresses.indexOf(t),f!=-1&&(n.smtpProxyEmailAddresses.splice(f,1),n.smtpProxyEmailAddresses.push(o))),n.UpdateEmailAddresses(),n.primaryemailaddress=t.substring(5),n.hasActiveChange=!0,n.showEmailChangeNotification=!0)},n.CheckValidations=function(t){var i=!0;return t.$invalid&&(i=!1,n.saveAliasError=!0,n.saveAliasErrorMessage='Please provide all required fields.'),n.hasActiveChange||(i=!1,n.saveAliasError=!0,n.saveAliasErrorMessage='No changes requested'),i},n.SaveChanges=function(i){if(n.CheckValidations(i)){n.saveAliasError=!1,n.saveinprogress=!0,n.savefinished=!1,n.showWaitingIndicator=!0;var r=n.upn+'@'+n.selectedUpnDomain;n.userprincipalname=r,!n.isProvisioned||n.isCurrentUserManagementAdmin?(n.userprincipalname!=n.olduserprincipalname&&(n.hasChangeOnUpn=!0),n.formData.ObjectId=n.objectid,n.formData.UserPrincipalName=n.userprincipalname,n.formData.HasChangeOnUpn=n.hasChangeOnUpn):(n.primaryemailaddress.toLowerCase()!=n.oldprimaryemailaddress.toLowerCase()&&(n.hasChangeOnPrimaryEmailAddress=!0),angular.forEach(n.smtpProxyEmailAddressesWithoutPrimary,function(t){n.oldSmtpProxyEmailAddressesWithoutPrimary.indexOf(t)==-1&&n.newaliasesadded.push(t)}),angular.forEach(n.oldSmtpProxyEmailAddressesWithoutPrimary,function(t){n.smtpProxyEmailAddressesWithoutPrimary.indexOf(t)==-1&&n.oldaliasesremoved.push(t)}),(n.newaliasesadded.length>0||n.oldaliasesremoved.length>0||n.hasChangeOnPrimaryEmailAddress)&&(n.hasChangeOnEmailAddresses=!0),n.isProvisioned&&n.upnsameasprimary&&n.hasChangeOnPrimaryEmailAddress&&n.isCurrentGlobalAdmin&&(n.userprincipalname=n.primaryemailaddress),n.userprincipalname.toLowerCase()!=n.olduserprincipalname.toLowerCase()&&(n.hasChangeOnUpn=!0),n.formData.PrimaryEmailAddress=n.primaryemailaddress,n.formData.MailboxEmailAliases=n.smtpProxyEmailAddressesWithoutPrimary,n.formData.ObjectId=n.objectid,n.formData.MailboxEmailAddresses=n.emailAddresses,n.formData.UserPrincipalName=n.userprincipalname,n.formData.UpnEqualsSmtp=n.upnsameasprimary,n.formData.HasChangeOnUpn=n.hasChangeOnUpn,n.formData.HasChangeOnEmailAddresses=n.hasChangeOnEmailAddresses,n.formData.IsProvisioned=n.isProvisioned),t.UpdateEmailAddressesUPN(n.objectid,n.formData).then(function(t){t.data.Status==0?(n.showWaitingIndicator=!1,n.saveComplete=!0,n.formData.title="",e(),n.IsSelfUser&&n.hasChangeOnUpn&&o()):(n.showWaitingIndicator=!1,n.saveComplete=!0,n.hasErrorInSaving=!0,n.saveErrorMessage=t.data.Message)},function(t){n.showWaitingIndicator=!1,n.saveComplete=!0,n.hasErrorInSaving=!0,n.saveErrorMessage=t.data.Message})}},e=function(){var t=n.getIndex(n.selecteditem,n.$root.ActiveUserData.ListModel);t!=-1&&(n.isCurrentExchangeAdmin&&n.hasChangeOnEmailAddresses||n.isCurrentGlobalAdmin&&n.hasChangeOnEmailAddresses&&!n.hasChangeOnUpn?(n.$root.ActiveUserData.SelectedUserDetails.MailboxEmailAddresses=n.formData.MailboxEmailAddresses,n.$root.ActiveUserData.SelectedUserDetails.MailboxEmailAliases=n.formData.MailboxEmailAliases,n.$root.ActiveUserData.SelectedUserDetails.PrimaryEmailAddress=n.formData.PrimaryEmailAddress,n.$root.ActiveUserData.SelectedUserDetails.ObjectId=n.formData.ObjectId):n.isCurrentUserManagementAdmin&&n.hasChangeOnUpn||n.isCurrentGlobalAdmin&&n.hasChangeOnUpn&&!n.hasChangeOnEmailAddresses?(n.$root.ActiveUserData.SelectedUserDetails.UserPrincipalName=n.formData.UserPrincipalName,n.$root.ActiveUserData.SelectedUserDetails.ObjectId=n.formData.ObjectId,n.$root.ActiveUserData.ListModel[t].UserPrincipalName=n.formData.UserPrincipalName):n.isCurrentGlobalAdmin&&n.hasChangeOnEmailAddresses&&n.hasChangeOnUpn&&(n.$root.ActiveUserData.SelectedUserDetails.MailboxEmailAddresses=n.formData.MailboxEmailAddresses,n.$root.ActiveUserData.SelectedUserDetails.MailboxEmailAliases=n.formData.MailboxEmailAliases,n.$root.ActiveUserData.SelectedUserDetails.PrimaryEmailAddress=n.formData.PrimaryEmailAddress,n.$root.ActiveUserData.SelectedUserDetails.UserPrincipalName=n.formData.UserPrincipalName,n.$root.ActiveUserData.SelectedUserDetails.UpnEqualsSmtp=n.formData.UpnEqualsSmtp,n.$root.ActiveUserData.SelectedUserDetails.ObjectId=n.formData.ObjectId,n.$root.ActiveUserData.ListModel[t].UserPrincipalName=n.formData.UserPrincipalName),n.selecteditem.UserPrincipalName=n.formData.UserPrincipalName),i.SetSelectedItem(n.selecteditem)},o=function(){angular.element("button[data-hint='FlyoutClose'][data-value='user']").hide()},n.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.ObjectId==t[i].ObjectId)return i;return-1},n.Cancel=function(){n.$emit('closeFlyout')},n.SignOut=function(){var n=f.path();t.SignOut(n).then(function(n){u.location.href=n.data});return},h=function(n){return!(n===null||n===""||n===" "||n===undefined)}}this.$scope=n,this.UserManagementService=t,this.PanelService=i,this.HelperService=r,this.$window=u,this.$location=f,n.contentLoaded=!1,n.$on('$includeContentLoaded',function(){n.contentLoaded=!0}),n.UpdateMailboxAlias=function(){n.hasActiveChange=!0},n.UpdateAliasDomain=function(t){n.aliasDomain=t},e()}return n.$inject=["$scope","UserManagementService","PanelService","HelperService","$window","$location"],n}();n.app.controller("UserAliasController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){function r(){}this.$scope=n,this.ProfileService=t,n.IsValid=function(n){return n==null||n==""?!1:!0},n.IsUnifiedGroup=function(n){return n==0},n.GetBackgroundColor=function(n){return t.GetProfileImageColor(n)},n.ChangePersonPhoto=function(){n.$root.features&&n.$root.features.SetPersonPhoto&&angular.element(document.querySelector('#ChangePhotoLink')).click()},n.$on('UpdatePersonCard',function(t,i){n.selectedItem=i,n.formData.DisplayName=i.DisplayName,n.formData.InitialsColor=i.InitialsColor,n.formData.Initials=i.Initials,n.formData.UserPrincipalName=i.UserPrincipalName,n.formData.GroupName=i.GroupName,n.formData.InitialsColor=i.InitialsColor,n.formData.GroupType=i.GroupType,n.formData.GroupTypeDisplayName=i.GroupTypeDisplayName,n.formData.GroupSmtp=i.GroupSmtp,n.formData.SharedMailboxDisplayName=i.SharedMailboxDisplayName,n.formData.SharedMailboxSmtp=i.SharedMailboxSmtp,n.formData.ContactDisplayName=i.ContactDisplayName,n.formData.ContactExternalEmailAddress=i.ContactExternalEmailAddress,n.formData.ResourceMailboxDisplayName=i.ResourceMailboxDisplayName,n.formData.ResourceMailboxPrimarySmtpAddress=i.ResourceMailboxPrimarySmtpAddress,n.formData.ResourceMailboxRecipientTypeDetails=i.ResourceMailboxRecipientTypeDetails,n.formData.PartnerName=i.DisplayName,(n.formData.PhotoContent==null||i.PhotoContent!=null)&&(n.formData.PhotoContent=i.PhotoContent),n.formData.JobTitle=i.JobTitle,n.formData.Department=i.Department}),n.GeneraliseContactInfo=function(){return n.formData.JobTitle&&n.formData.Department?n.formData.JobTitle+", "+n.formData.Department:n.formData.JobTitle?n.formData.JobTitle:n.formData.Department?n.formData.Department:""},n.$on('panelclosed',function(){i&&(i(),i=null)});var i=n.$on('UpdatePersonPhoto',function(t,i){i&&(i.UserType==0&&i.Identity==n.formData.UserPrincipalName||i.UserType==1&&i.Identity==n.formData.GroupSmtp||i.UserType==3&&i.Identity==n.formData.SharedMailboxSmtp||i.UserType==2&&i.Identity==n.formData.ResourceMailboxPrimarySmtpAddress||i.UserType==4&&i.Identity==n.formData.ContactExternalEmailAddress)&&(n.IsValid(i.PhotoContent)||n.IsValid(n.formData.PhotoContent))&&(n.formData.PhotoContent=i.PhotoContent)});r()}return n.$inject=["$scope","ProfileService"],n}();n.PersonCardController=t,n.app.controller("PersonCardController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r){function f(n){t.currentView=n.toLowerCase()}function u(){t.errorMessage='Sorry, for some reason, we can\x27t display service health right now. Please try again later.',t.showErrorMessage=!0}this.$scope=t,this.ServiceHealthDataService=i,this.ServiceHealthConstants=r,t.isLoading=!0,t.showErrorMessage=!1,t.currentView="current",t.switchView=f,i.GetAllServicesStatus().then(function(n){t.isLoading=!1,n||u(),t.data=n.data},function(){t.isLoading=!1,u()}),t.$on(n.ServiceHealthConstants.EVENTS.FILTER_CHANGED,function(n,i){t.activeTabId=i.filter})}return t.$inject=["$scope","ServiceHealthDataService","ServiceHealthConstants"],t}();n.ServiceHealthMainController=t,n.app.controller("ServiceHealthMainController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u){function h(n){var t=[];return n.forEach(function(n){t.push({Name:n.Name,MessagesByClassification:{Incidents:n.MessagesByClassification.Incidents.filter(s),Advisories:n.MessagesByClassification.Advisories.filter(s)}})}),t}function s(n){return!n.MessageStatus.IsResolved}function c(n){switch(n){case 0:case 1:case 2:t.activeTabId=n;break;default:t.activeTabId=0}}function l(n,t){return n.MessagesByClassification.Incidents.length>0&&t.MessagesByClassification.Incidents.length>0?u.alphabeticalComparator(n.Name,t.Name):n.MessagesByClassification.Incidents.length===0&&t.MessagesByClassification.Incidents.length>0?1:n.MessagesByClassification.Incidents.length>0&&t.MessagesByClassification.Incidents.length===0?-1:n.MessagesByClassification.Advisories.length>0&&t.MessagesByClassification.Advisories.length>0?u.alphabeticalComparator(n.Name,t.Name):n.MessagesByClassification.Advisories.length===0&&t.MessagesByClassification.Advisories.length>0?1:n.MessagesByClassification.Advisories.length>0&&t.MessagesByClassification.Advisories.length===0?-1:0}var o,f,e;this.$scope=t,this.$stateParams=i,this.ServiceHealthConstants=r,this.ServiceHealthSortService=u,t.tabs=['All services','Incidents','Advisories'],o=this.$stateParams.tabid,c(parseInt(o)),t.showUserMessage=!1,f=0,e=0,t.tabClicked=function(n){t.activeTabId=n,t.activeTabId===1&&f===0?(t.userMessage='No active incidents right now',t.showUserMessage=!0):t.activeTabId===2&&e===0?(t.userMessage='No active advisories right now',t.showUserMessage=!0):(t.userMessage=null,t.showUserMessage=!1)},t.$watch('data',function(n){t.summaryText=n.StatusText,t.timestamp=n.Timestamp;var r=h(n.ServiceStatus);t.services=r.sort(l),f=r.reduce(function(n,t){return n+t.MessagesByClassification.Incidents.length},0),e=r.reduce(function(n,t){return n+t.MessagesByClassification.Advisories.length},0)}),t.$on(n.ServiceHealthConstants.EVENTS.FILTER_CHANGED,function(n,i){t.activeTabId=i.filter})}return t.$inject=["$scope","$stateParams","ServiceHealthConstants","ServiceHealthSortService"],t}();n.ServiceHealthCurrentViewController=t,n.app.controller("ServiceHealthCurrentViewController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){function s(t){t===n.currentSort.name?n.currentSort.isDescending=!n.currentSort.isDescending:n.currentSort={name:t,isDescending:!0},u(n.keywordFilter)}function h(){n.keywordFilter!==""&&(n.keywordFilter="")}function c(n){var t=[];return n.forEach(function(n){var i=n.Name;n.MessagesByClassification.Incidents.forEach(function(n){e(t,i,o(n))}),n.MessagesByClassification.Advisories.forEach(function(n){e(t,i,o(n))})}),t}function u(i){n.messages=t('filter')(f,i).sort(a)}function e(n,t,i){i.Service=t,i.Classification===0&&(i.ClassificationName='advisory'),i.Classification===1&&(i.ClassificationName='incident'),i.StartTime=l(i.StartTime),i.MessageStatusForSort=i.MessageStatus.DisplayName,n.push(i)}function l(n){return n?new Date(n):null}function a(t,i){return r.objectSorter(t,i,n.currentSort.name,n.currentSort.isDescending)}function o(n){return JSON.parse(JSON.stringify(n))}this.$scope=n,this.$filter=t,this.ServiceHealthConstants=i,this.ServiceHealthSortService=r;var f=[];n.keywordFilter="",n.currentSort={name:"StartTime",isDescending:!0},n.updateSort=s,n.searchButtomClicked=h,n.$watch('data',function(t){n.timestamp=t.Timestamp,f=c(t.ServiceStatus),u(n.keywordFilter)}),n.$watch('keywordFilter',function(n){u(n)})}return n.$inject=["$scope","$filter","ServiceHealthConstants","ServiceHealthSortService"],n}();n.ServiceHealthHistoryViewController=t,n.app.controller("ServiceHealthHistoryViewController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;(function(n){n[n.Red=0]="Red",n[n.Yellow=1]="Yellow",n[n.Green=2]="Green"})(n.StatusLevelEnums||(n.StatusLevelEnums={}));var i=n.StatusLevelEnums,t=function(){function n(n,t,i,r,u,f){var e=this;this.$scope=n,this.$http=t,this.$window=i,this.$stateParams=r,this.$location=u,this.$interval=f,this.getDataFromAPI=function(){var n=this;this.$http.get("/admin/api/servicestatus/status").success(function(t){n.$scope.ServiceStatusModel=t,n.initializeModel(n.$scope.ServiceStatusModel)})},t.get("/admin/api/servicestatus/status").success(function(t){n.ServiceStatusModel=t,e.initializeModel(n.ServiceStatusModel),n.ServiceStatusModel.RefreshInMilliSeconds>0&&f(function(){e.getDataFromAPI()},n.ServiceStatusModel.RefreshInMilliSeconds),n.$emit("autoscrolltotop")}),n.CurrentViewTab="Current",n.SetCurrentViewTab=function(t){n.CurrentViewTab=t},n.SetActiveWorkload=function(t){n.ActiveWorkload=t},n.SetClassViewForDay=function(n,t){var i='calendar_day';return i+=n.ServiceStatusText==''?' calendar_day_invalid':' calendar_day_valid',n.Day==t.HistoryViewDay.Day&&n.Month==t.HistoryViewDay.Month&&(i+=' calendar_day_selected'),n.IncidentIDs!=null&&(n.WorstStatusLevel==0?i+=' calendar_incident red':n.WorstStatusLevel==1&&(i+=' calendar_incident yellow')),i},n.SetHistoryViewDay=function(t,i){if(i.HistoryViewDay={},i.HistoryViewDay.Incidents=[],t.Day==i.CurrentDay.Day&&t.Month==i.CurrentDay.Month){i.HistoryViewDay=i.CurrentDay,i.HistoryViewDay.WorstStatusLevel=e.getWorstStatusLevel(i.HistoryViewDay,n.ServiceStatusModel.Incidents);return}i.HistoryViewDay=t,t.IncidentIDs!=null&&t.IncidentIDs.length>0?(i.HistoryViewDay.Incidents=e.getIncidents(t.IncidentIDs,n.ServiceStatusModel.Incidents),e.setShowCount(i.HistoryViewDay.Incidents)):i.HistoryViewDay.Incidents=null}}return n.prototype.initializeModel=function(n){var e=!1,i,t,o,r,s,u,h,f;if(typeof this.$stateParams.serviceid!="undefined")for(i in n.Workloads)if(t=n.Workloads[i],t.ServiceId==this.$stateParams.serviceid){this.$scope.ActiveWorkload=this.$stateParams.serviceid,e=!0;break}e||(this.$scope.ActiveWorkload=n.Workloads[0].ServiceId,typeof this.$stateParams.serviceid!="undefined"&&this.$location.path("/servicestatus").search('serviceid',this.$scope.ActiveWorkload)),n.IsAllUp?(n.BannerIcon=n.CDNUrls["icon-check"],n.BannerImage=$(this.$window).width()<=320?n.CDNUrls.banner_up_mobile:n.CDNUrls.banner_up):(n.BannerIcon=n.CDNUrls["icon-alertoutline"],n.BannerImage=$(this.$window).width()<=320?n.CDNUrls.banner_down_mobile:n.CDNUrls.banner_down);for(i in n.Workloads){t=n.Workloads[i],t.CurrentDay.IncidentIDs!=null&&t.CurrentDay.IncidentIDs.length>0?(t.CurrentDay.Incidents=this.getIncidents(t.CurrentDay.IncidentIDs,n.Incidents),this.setShowCount(t.CurrentDay.Incidents)):t.CurrentDay.Incidents=null,t.HistoryViewDay={},t.HistoryViewDay=t.CurrentDay,t.HistoryViewDay.WorstStatusLevel=this.getWorstStatusLevel(t.HistoryViewDay,n.Incidents);for(o in t.IncidentsByMonths){r=t.IncidentsByMonths[o];for(s in r.IncidentsByWeeks){u=r.IncidentsByWeeks[s];for(h in u.IncidentsByDays)f=u.IncidentsByDays[h],f.WorstStatusLevel=this.getWorstStatusLevel(f,n.Incidents)}}t.StatusIcon={},t.CurrentDay.StatusLevel==0?(t.StatusIcon.Icon="ms-Icon-Basel ms-Icon-Basel--StatusErrorFull ss-status-red",t.StatusIcon.Alt='service is interrupted'):t.CurrentDay.StatusLevel==1?(t.StatusIcon.Icon="ms-Icon-Basel ms-Icon-Basel--IncidentTriangle ss-status-yellow",t.StatusIcon.Alt='service is degraded'):(t.StatusIcon.Icon="ms-Icon-Basel ms-Icon-Basel--CompletedSolid ss-status-green",t.StatusIcon.Alt='service is healthy')}},n.prototype.setShowCount=function(n){var t,i;for(t in n)i=n[t]!=null&&n[t].Histories.length>0?1:0,n[t].InitShowCount=i,n[t].ShowCount=i},n.prototype.getWorstStatusLevel=function(n,t){var i,u,f,r;if(n.StatusLevel!=2)return n.StatusLevel;i=2;for(u in n.IncidentIDs)f=n.IncidentIDs[u],r=t[f],i=r.WorstStatusLevel<i?r.WorstStatusLevel:i;return i},n.prototype.getIncidents=function(n,t){var i=[],r,u;for(r in n)u=n[r],i.push(t[u]);return i},n.$inject=["$scope","$http","$window","$stateParams","$location","$interval"],n}();n.ServiceStatusController=t,n.app.controller("ServiceStatusController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){this.$scope=n,this.$window=t,this.HttpService=i,i.Get("/admin/api/DirSyncManagement/manage",[],!0).then(function(i){n.DirSyncManagementModel=i.data,n.DirSyncManagementModel.BannerImage=n.DirSyncManagementModel.IsSyncNormal&&n.DirSyncManagementModel.IsPasswordSyncNormal?$(t).width()<=320?n.DirSyncManagementModel.CDNUrls.banner_up_mobile:n.DirSyncManagementModel.CDNUrls.banner_up:$(t).width()<=320?n.DirSyncManagementModel.CDNUrls.banner_down_mobile:n.DirSyncManagementModel.CDNUrls.banner_down}),n.$emit("autoscrolltotop")}return n.$inject=["$scope","$window","HttpService"],n}();n.app.controller("DirSyncManagementController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(t,i){function f(){t.GetErrorsList()}this.$scope=t,this.DirSyncObjectErrorsService=i,t.GetErrorsList=function(){t.errorsListConfig=n.GetErrorsListConfig(),t.dirsyncErrorsData=[],i.GetErrorsList().then(r,u)};var r=function(n){t.dirsyncErrorsData=n.data,t.errorsListConfig.noResults=t.dirsyncErrorsData==null||t.dirsyncErrorsData.length===0,t.errorsListConfig.loadingList=!1,t.$emit("autoscrolltotop")},u=function(){t.errorsListConfig.loadingList=!1,t.errorsListConfig.serverError=!0};t.getRowCss=function(n){if(n.isChecked)return{'background-color':'#DDEBF7'}},f()}return n.GetErrorsListConfig=function(){return{noResults:!1,serverError:!1,loadingList:!0}},n.$inject=["$scope","DirSyncObjectErrorsService"],n}();n.app.controller("DirSyncObjectErrorsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f,e,o){function h(){n.selectedItem=n.$parent.$parent.selectedItem,n.selectedItem&&(n.GetConflictingObjects(),n.selectedItem.PropertyValueToLower=n.selectedItem.PropertyValue.toLowerCase())}this.$scope=n,this.$rootScope=t,this.DirSyncObjectErrorsService=i,this.UserManagementService=r,this.GroupService=u,this.ProfileService=f,this.PanelService=e,this.$timeout=o,n.GetConflictingObjects=function(){n.dirsyncConflictingObjects=[],i.GetConflictingObjects(n.selectedItem).then(function(t){n.dirsyncConflictingObjects=t.data},function(){})},n.GetObjectDetails=function(t){t.ObjectType==1?r.GetUserDetails(t.ObjectId).then(function(i){if(t.ObjectDetails={},i.data){var r=i.data;t.ObjectDetails={},t.ObjectDetails.DisplayName=r.DisplayName,t.ObjectDetails.InitialsColor=f.GetProfileImageColor(r.DisplayName),t.ObjectDetails.Initials=f.GetUserInitials(r.DisplayName),t.ObjectDetails.UserPrincipalName=r.UserPrincipalName,t.ObjectDetails.LastDirSyncTime=r.LastDirSyncTime,t.ObjectDetails.WhenCreated=r.WhenCreated,t.ObjectDetails.ObjectId=r.ObjectId,t.ObjectDetails.IsOnpremObject=n.IsOnpremObject(t),t.FoundObject=!0}else t.FoundObject=!1;t.SourceOfAuthority=n.GetSourceOfAuthority(t)},function(){return null}):t.ObjectType==2?u.GetGroupDetails(t.ObjectId).then(function(i){if(t.ObjectDetails={},i.data){var r=i.data;t.ObjectDetails={},t.ObjectDetails.GroupName=r.GroupName,t.ObjectDetails.InitialsColor=f.GetProfileImageColor(r.GroupName),t.ObjectDetails.GroupTypeDisplayName=r.GroupTypeDisplayName,t.ObjectDetails.LastDirSyncTime=r.LastDirSyncTime,t.ObjectDetails.WhenCreated="n/a",t.ObjectDetails.ObjectId=r.ObjectId,t.ObjectDetails.IsOnpremObject=n.IsOnpremObject(t),t.FoundObject=!0}else t.FoundObject=!1;t.SourceOfAuthority=n.GetSourceOfAuthority(t)},function(){return null}):t.ObjectType==3?t.SourceOfAuthority=n.GetSourceOfAuthority(t):t.ObjectType==4&&(t.SourceOfAuthority=n.GetSourceOfAuthority(t)),t.ObjectDetails&&t.ObjectDetails.UserPrincipalName&&(t.ObjectDetails.UserPrincipalNameToLower=t.ObjectDetails.UserPrincipalName.toLowerCase()),t.ProxyAddressesToLower=[],t.ProxyAddresses&&(t.ProxyAddressesToLower=t.ProxyAddresses.map(function(n){return n.toLowerCase()}))},n.GetSourceOfAuthority=function(t){var i=n.IsOnpremObject(t);return i?'On-premises Active Directory':'Cloud'},n.IsOnpremObject=function(n){return n.SourceAnchor||n.ObjectDetails!=null&&n.ObjectDetails.LastDirSyncTime},h(),n.$on('panelclosed',function(){s&&(s(),s=null)});var s=n.$on(e.GetBroadCastEventName(),function(t,i){n.selectedItem=i,n.formData.DisplayName=n.selectedItem.PropertyNameLocalized,n.formData.UserPrincipalName=n.selectedItem.PropertyValue,o(function(){n.$apply(function(){n.GetConflictingObjects()})})})}return n.$inject=["$scope","$rootScope","DirSyncObjectErrorsService","UserManagementService","GroupService","ProfileService","PanelService","$timeout"],n}();n.app.controller("DirSyncObjectErrorsDetailsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){function u(){i.ListUserMigrationStatus(!0).success(function(n){var t=n.OverallStatus!=0;r.path(t?"/EmailMigration/Status":"/EmailMigration/Source").replace()}),n.$emit("autoscrolltotop")}this.$scope=n,this.$rootScope=t,this.EmailMigrationService=i,this.$location=r,u()}return n.$inject=["$rootScope","$scope","EmailMigrationService","$location"],n}();n.app.controller("EmailMigrationController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function r(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$validators.emailFormatValidation=function(n){var t=/^(?!^[.])([-'a-zA-Z0-9_]+\.)*[-'a-zA-Z0-9_]+@(?!\.+)([-a-zA-Z0-9]+\.)+[a-zA-Z]{2,}$/i;return!n||t.test(n)}}}}var t,i;(function(n){n[n.exchange2016="Exchange 2016"]="exchange2016",n[n.exchange2013="Exchange 2013"]="exchange2013",n[n.exchange2010="Exchange 2010"]="exchange2010",n[n.exchange2007="Exchange 2007"]="exchange2007"})(t||(t={})),i=function(){function n(n,t,i,r,u,f){function o(){n.checking=!1,n.errorMessage="",n.showCustomDomainConfigForm=!1,n.showLoading=!1,n.customDomainConfig={Protocol:"SSL"},n.isExchangeMRSEnabledRunning=!1,i.ListUserMigrationStatus(!0).success(function(n){var t=n.OverallStatus!=0;t&&u.path("/EmailMigration/Status")}),n.$emit("autoscrolltotop")}function e(t){n.errorMessage=t,n.checking=!1,n.showLoading=!1,n.isExchangeMRSEnabledRunning=!1}this.$scope=n,this.$rootScope=t,this.EmailMigrationService=i,this.ExchangeEmailMigrationService=r,this.$location=u,this.$window=f,n.Start=function(n){i.SetActiveDomain(n).success(function(n){n.Succeeded?u.path("/EmailMigration/Status"):e(n.Message)}).error(e)},n.StartExchange=function(){n.showLoading=!0,n.isExchangeMRSEnabledRunning||s()};var s=function(){n.isExchangeMRSEnabledRunning=!0,r.GetIsExchangeMRSEnabled().then(function(t){n.showLoading=!1,n.isExchangeMRSEnabledRunning=!1;var i=t.data;i.Data?u.path("/EmailMigration/ExchangeMigrationStatus"):$("#launchSHCW").trigger("click")},function(n){console.log(n.data),n.data.indexOf("Failed to resolve tenant name")>-1?e('We are still in the process of getting a few things ready before you can start the migration. Please try again in approximately 30 minutes.'):e('We could not retrieve your migration endpoint information at this time, please try again.')})};n.ShowCustomDomainConfigForm=function(){n.showCustomDomainConfigForm=!0},n.ImportPst=function(){f.open("/EAdmin/Compliance/Ingestion.aspx","_blank")},n.LaunchYammerOnboardingPage=function(){f.open("https://aka.ms/yammerdeploy","_blank")},n.LaunchProPlusDeploymentAdvisorWizard=function(){f.open("http://aka.ms/proplusguidance","_blank")},n.LaunchSkypeforBusinessAdvisorWizard=function(){f.open("https://aka.ms/skypeguidance","_blank")},n.LaunchSharePointOnlineDeploymentAdvisorWizard=function(){f.open("http://aka.ms/spoguidance","_blank")},n.LaunchGmailContactsCalendarAssistantWizard=function(){f.open("https://aka.ms/gmailcontactscalendar","_blank")},n.LaunchExchangeOnlineGuidanceWizard=function(){u.path("/EmailMigration/ExchangeOnlineMigration")},n.LaunchYammerOnboardingQuickStartGuide=function(){f.open("https://aka.ms/yamquickstartguide","_blank")},n.LaunchProPlusDeploymentQuickStartGuide=function(){f.open("https://aka.ms/OPPquickstartguide","_blank")},n.LaunchOneDriveForBusinessQuickStartGuide=function(){f.open("https://aka.ms/ODfBquickstartguide","_blank")},n.LaunchSharePointOnlineDeploymentQuickStartGuide=function(){f.open("https://aka.ms/SPOquickstartguide","_blank")},n.LaunchSkypeforBusinessQuickStartGuide=function(){f.open("https://aka.ms/SfBquickstartguide","_blank")},n.LaunchSMBOnboardingQuickStartGuide=function(){f.open("https://aka.ms/SmallBusinessQuickstartGuide","_blank")},n.GoToEmailSetupAdvisor=function(){f.open("http://aka.ms/office365setup","_blank")},n.GoToCutoverMigration=function(){f.open("http://aka.ms/cutoverguidance","_blank")},n.GoToImapMigration=function(){f.open("http://aka.ms/imapguidance","_blank")},n.GoToGmailMigration=function(){f.open("http://aka.ms/gmailimapguidance","_blank")},n.GoToGmailContactsAndCalendarMigration=function(){f.open("http://aka.ms/gmailcontactscalendar","_blank")},n.GoToStagedMigration=function(){f.open("http://aka.ms/stagedguidance","_blank")},n.GoToHybrid2016Migration=function(){f.open("http://aka.ms/hybrid2016guidance","_blank")},n.GoToHybrid2013Migration=function(){f.open("http://aka.ms/hybrid2013guidance","_blank")},n.GoToHybrid2010Migration=function(){f.open("http://aka.ms/hybrid2010guidance","_blank")},n.GoToMinimalHybridMigration=function(){f.open("https://aka.ms/minimalexpresshybridguidance","_blank")},n.GoToExchangeOnlineProtection=function(){f.open("https://aka.ms/eopguidance","_blank")},n.GoToMicrosoftIntune=function(){f.open("http://aka.ms/intuneguidance","_blank")},n.GoToAzureActiveDirectoryBasic=function(){f.open("https://aka.ms/azureadbasic","_blank")},n.GoToAzureActiveDirectoryPremium=function(){f.open("http://aka.ms/aadpguidance","_blank")},n.GoToAzureRightsManagementInformationProtection=function(){f.open("http://aka.ms/azurermsguidance","_blank")},n.GoToAdminCenterPortal=function(){f.open("http://aka.ms/newadmincentermigrations","_blank")},n.GoToBasicEmailSetup=function(){f.open("http://aka.ms/o365basicsetup","_blank")},n.GoToFastTrackCenterSupport=function(){f.open("http://aka.ms/getfasttrackhelp","_blank")},n.StartWithCustomDomain=function(){n.checking=!0;var t=n.customDomainConfig.AdminEmailAddress.trim().replace(/.*@/,"");n.customDomainConfig.Domain=t,i.CheckAndSaveCustomServerConfigs(n.customDomainConfig).success(function(n){n.Succeeded?i.SetActiveDomain(t).success(function(n){n.Succeeded?u.path("/EmailMigration/Status"):e(n.Message)}).error(e):e(n.Message)}).error(e)},n.Cancel=function(){n.showCustomDomainConfigForm=!1},n.CloseErrorPanel=function(){n.errorMessage=""},n.TogglePasswordPeek=function(n){angular.element($('#'+n)).attr("type")=="password"?angular.element($('#'+n)).attr("type","text"):angular.element($('#'+n)).attr("type","password")},o()}return n.$inject=["$rootScope","$scope","EmailMigrationService","ExchangeEmailMigrationService","$location","$window"],n}(),n.app.controller("EmailMigrationSourceController",i),n.app.directive("emailFormatValidation",r)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function r(n,t,i,r){return{restrict:'A',scope:{content:"@",handler:"&confirmPopover",verify:"&verifyStartButton"},link:function(n,u,f){var e=n.$new(!1);e.show=!1,e.content=f.content;var h=angular.element(t.get(f.template).trim()),o=i(h)(e),s=function(){var n=r.positionElements(u,o,"bottom",!1);n.left+=73,n.top+='px',n.left+='px',o.css(n)};e.Show=function(n){e.show=n,o.css({display:e.show?'block':'none'}),s(),s()},e.Ok=function(){e.Show(!1),n.handler()},e.startButtonEnabled=function(){return n.verify()};u.on('click',function(){e.Show(!e.show)});angular.element(document.body).bind('click',function(n){if(n.target!=u[0]&&n.target.parentNode!=u[0]){for(var t=n.target.parentNode,i=!1;!i&&t;)i=angular.element(t).hasClass('popover'),t=t.parentNode;i||e.Show(!1)}}),u.after(o)}}}var t,i;(function(n){n[n.inprogress=0]="inprogress",n[n.ok=1]="ok",n[n.error=2]="error"})(t||(t={})),i=function(){function n(n,i,r,u,f,e,o){var g;this.$rootScope=n,this.$scope=i,this.EmailMigrationService=r,this.HelperService=u,this.$interval=f,this.$location=e,this.$filter=o,i.init=function(n){i.stringTable=n,i.users=[],i.sortField="",i.sortAsc=!1,i.sortDirection=0,i.isBatchRunning=!1,i.allUsersSelected=!1,i.refreshTimer=null,i.domain="",i.successStatusList=[3,6,11,14,15,16,17],i.errorStatusList=[2,4,8],i.errorMessage=null,i.errorType=null,i.inited=!1,i.starting=!1,i.exiting=!1,i.stopped=!1,i.listUsersFailure=!1,i.listContext=null,i.endOfList=!1,i.isPreviousRequestPending=!1,i.selectedView=null,i.selectedViewType=null,i.searchInitiated=!1,i.searchDisabled=!1,i.searchBoxTracker=!1,i.searchTerm=null,i.currentStep=-1;var t={};i.inProgressCredentialCache=t,i.errorPanelNotficationsCache={inProgress:!1,completed:!1},r.GetActiveDomain().success(function(n){n.Succeeded?(n.Data&&n.Data.ActiveDomain||e.path("/EmailMigration/Source"),i.domain=n.Data.ActiveDomain,i.isPreviousRequestPending=!0,r.GetDefaultUserList(0,"DisplayName",null,null).success(function(n){i.users=n.Users,i.endOfList=n.MetaData.IsLastPage,i.isPreviousRequestPending=!1,i.searchDisabled=i.users.length==0?!0:!1,i.listContext=n.MetaData.ListContext===null||n.MetaData.ListContext===undefined?null:n.MetaData.ListContext,b(i.users),i.sortField="DisplayName";var t=document.getElementById('ShellBodyAndFooterContainer');angular.element(t).bind('scroll',d),i.RefreshStatus(!0).success(function(){i.isBatchRunning?k():angular.forEach(i.users,function(n){n.Selected=n.CredentialsSaved}),i.UpdateAllUsersSelected(),i.inited=!0})}).error(a)):s(n.Message)}).error(s),i.$emit("autoscrolltotop")},i.$on("$destroy",function(){i.refreshTimer&&(f.cancel(i.refreshTimer),i.refreshTimer=null);var n=document.getElementById('ShellBodyAndFooterContainer');angular.element(n).unbind('scroll',d)}),i.ExitMigration=function(){c(i.stringTable.MigrationClosing,0),i.exiting=!0,r.Exit().success(function(n){n.Succeeded?e.path().indexOf("Status")>-1&&e.path("/EmailMigration/Source"):s(n.Message),i.exiting=!1}).error(function(n){i.exiting=!1,s(n)})},i.SaveUserCredentials=function(n,t,u,f){var o,c,e;if(!n.SourceEmailPassword&&!n.SourceEmailAddress){o=null,(n.Status.indexOf(t)>-1||n.Status.indexOf(u)>-1)&&r.ListUserMigrationStatus(!0).success(function(t){if(angular.forEach(t.MigrationUserStatuses,function(t){var r=y(t.ObjectId);r&&t.ObjectId==n.ObjectId&&(n.Status=h(t.StatusText),o=!0)}),!o){var i='Not started';n.Status=h(i,null)}});return}if(c=/^(?!^[.])([-'a-zA-Z0-9_]+\.)*[-'a-zA-Z0-9_]+@(?!\.+)([-a-zA-Z0-9]+\.)+[a-zA-Z]{2,}$/i,e=n.SourceEmailAddress+"@"+i.domain,!n.SourceEmailAddress||!c.test(e)){n.CredentialsSaved=!1,n.Status=h(t,"error");return}if(!n.SourceEmailPassword){n.CredentialsSaved=!1,n.Status=h(u,"error");return}i.inProgressCredentialCache[n.ObjectId]&&i.inProgressCredentialCache[n.ObjectId].email===e&&i.inProgressCredentialCache[n.ObjectId].password===n.SourceEmailPassword||(i.inProgressCredentialCache[n.ObjectId]={email:e,password:n.SourceEmailPassword},n.Status=h(f,"inprogress"),r.SaveUserCredentials(n.ObjectId,e,n.SourceEmailPassword).success(function(t){n.Status=h(t.Message,t.Succeeded?"ok":"error",t.Data.KbUrl),n.Selected=t.Succeeded,n.CredentialsSaved=t.Succeeded}).error(s))},i.StartOrStop=function(n,t,u){if(i.StartButtonEnabled()||i.isBatchRunning||!u){c("",0);var f=[];angular.forEach(i.users,function(n){n.Selected&&f.push(n.ObjectId)}),i.isBatchRunning?(i.stopped=!0,l(t,"inprogress"),r.Stop(f).success(function(n){n.Succeeded?(i.isBatchRunning=!1,l(null,null),i.RefreshStatus(!1),angular.forEach(i.users,function(n){n.Selected=!1,i.inProgressCredentialCache[n.ObjectId].password=""})):(s(n.Message),l(null,null))}).error(function(n){l(null,null),s(n)})):(i.stopped=!1,r.CheckImapConfigurations([i.domain]).success(function(t){!t||!t.length?(i.isBatchRunning=!0,i.starting=!0,l(n,"inprogress"),r.Start(f).success(function(n){n.Succeeded?(nt(),k()):(i.isBatchRunning=!1,l(null,null),s(n.Message,n.Data.KbUrl)),i.starting=!1}).error(function(n){i.isBatchRunning=!1,i.starting=!1,l(null,null),s(n)})):$("#flyout").trigger("click")}).error(s))}},i.RefreshStatus=function(n){return r.ListUserMigrationStatus(n).success(function(n){if(i.isBatchRunning=n.OverallStatus==1,i.isBatchRunning){var t=[],r=[],u=[];angular.forEach(n.MigrationUserStatuses,function(n){i.errorStatusList.indexOf(n.Status)>-1?r.push(n.ObjectId):i.successStatusList.indexOf(n.Status)>-1?u.push(n.ObjectId):t.push(n.ObjectId)}),i.stopped||(t.length>0&&!i.errorPanelNotficationsCache.inProgress?c(i.stringTable.InProgressMessage,0):r.length>0?c(i.stringTable.CompletedWithErrorMessage,2):!i.errorPanelNotficationsCache.completed&&u.length>0&&(i.domain=="gmail.com"?c('The email migration from Gmail is done. Close the connection to start another migration or finish. Then \x3ca class\x3d\x22gmailErrorContent\x22 href\x3d\x22https\x3a\x2f\x2faka.ms\x2fgmailcontactscalendar\x22 target\x3d\x22_blank\x22\x3emigrate your contacts and calendars from Google\x3c\x2fa\x3e.',1):c(i.stringTable.CompletedWithoutErrorMessage,1)))}angular.forEach(n.HistoryMigrationUserStatuses,function(n){var i=y(n.ObjectId);i&&(i.Status=h(n.StatusText),i.Selected=!1)}),l(null,null),angular.forEach(n.MigrationUserStatuses,function(n){var i=y(n.ObjectId);i&&(i.Status=h(n.StatusText),i.Selected=!0)})}).error(s)},g=o('orderBy'),i.ToggleSortOption=function(n){i.sortField==n?(i.sortAsc=!i.sortAsc,i.sortDirection=i.sortDirection===1?0:1):i.sortField=n,i.sortField=="DisplayName"?i.RefreshList():i.users=g(i.users,n,i.sortAsc)},i.RefreshList=function(){i.$emit("autoscrolltotop"),p(i.searchTerm)?v(i.searchTerm):r.GetDefaultUserList(i.sortDirection,i.sortField,i.selectedView,i.selectedViewType).success(w).error(a)},i.UpdateAllUsersSelected=function(){var n=!0;angular.forEach(i.users,function(t){t.Selected||(n=!1)}),i.allUsersSelected=n,$('#allUsersSelected').prop('checked',n)},i.ToggleAllUsersSelected=function(){var n=$('#allUsersSelected').prop('checked');angular.forEach(i.users,function(t){t.Selected=n&&t.HasExchange}),i.allUsersSelected=n},i.StartButtonEnabled=function(){if(i.isBatchRunning||i.exiting)return!1;var n=!0,t=0;return angular.forEach(i.users,function(i){i.Selected&&(t++,i.CredentialsSaved||(n=!1))}),n&&t>0},i.HideStartPopOver=function(){return i.StartButtonEnabled()||i.isBatchRunning},i.SearchOnClick=function(){var n=$("#searchTerm").val();u.IsValid(n)&&(i.searchInitiated=!0,v(n))},i.SearchKeydown=function(n){if(n.keyCode===13){var t=$("#searchTerm").val();i.searchInitiated=!0,v(t)}else return!1},i.clearLabel=function(){$("#userSearch").children(".sb-label").hide(),$("#userSearch").addClass("is-active"),i.searchInitiated=!1,i.searchTerm=null},i.searchBoxClose=function(){i.searchBoxTracker=!0,i.searchBoxBlur(),i.searchTerm=null,i.searchInitiated=!1,i.RefreshList()},i.searchBoxBlur=function(){i.searchBoxTracker===!0&&($("#searchTerm").val(""),$("#userSearch").children(".sb-label").show()),$("#userSearch").removeClass("is-active"),$("#searchTerm").val()==""&&$("#searchTerm").val().length===0&&$("#userSearch").children(".sb-label").show(),i.searchBoxTracker=!1},i.openDataMigrationTour=function(){i.openTour()},i.closeAndDisableTour=function(){i.setCurrentStep(-1),i.closeTour()};var y=function(n){var t;return angular.forEach(i.users,function(i){i.ObjectId==n&&(t=i)}),t},k=function(){i.refreshTimer=f(function(){if(!i.isBatchRunning&&!!i.refreshTimer){f.cancel(i.refreshTimer),i.refreshTimer=null;return}i.exiting||i.RefreshStatus(!1)},6e4)},h=function(n,t,i){var u=n,r;return t&&(r="GreenCheck_default_16x16.png",t=="error"?r="Alert_High_default_16x16.png":t=="inprogress"&&(r="spinner_16x16.gif"),u="<img src='/images/"+r+"' /> "+n),i&&(u+=" <a href='"+i+"' target='_blank' >"+$("#helpLink").text()+"</a>"),u};i.ToggleActionLinks=function(){$(".userlistActions:visible").length>0?$(".userlistActions").hide():$(".userlistActions").show()},i.TogglePasswordPeek=function(n){angular.element($('#'+n)).attr("type")=="password"?angular.element($('#'+n)).attr("type","text"):angular.element($('#'+n)).attr("type","password")},i.PasswordKeyPressed=function(n){n.keyCode===13&&n.target.blur()},i.$watch('errorMessage',function(n,t){if((n||t)&&(!n||!t)){var i=$("#errorBar").height()+20,r=n?"+=":"-=";$("#listContainer").css("padding-top",r+i)}},!0);var s=function(n,t){i.KbUrl=t,n.indexOf("DOCTYPE")>-1?c('Your request could not be processed at this time. Please try again.',2):c(n,2)},w=function(n){i.users=n.Users,i.endOfList=n.MetaData.IsLastPage,i.isPreviousRequestPending=!1,i.searchDisabled=i.users.length==0?!0:!1,i.searchTerm=$("#searchTerm").val(),i.listContext=n.MetaData.ListContext===null||n.MetaData.ListContext===undefined?null:n.MetaData.ListContext,b(i.users),i.$emit("autoscrolltotop")},a=function(){i.listUsersFailure=!0,i.searchDisabled=!0,c('Your request could not be processed at this time. Please try again.',2)};i.CloseErrorPanel=function(n){i.errorMessage=null,n==t[0]?i.errorPanelNotficationsCache.inProgress=!0:n==t[1]&&(i.errorPanelNotficationsCache.completed=!0)};var c=function(n,r){i.errorMessage=n,i.errorType=t[r]},it=function(n,t){return n.indexOf(t,n.length-t.length)!==-1},l=function(n,t){var r=!!n&&!!t?h(n,t):"";angular.forEach(i.users,function(n){n.Selected&&(n.TempStatus=r)})},nt=function(){angular.forEach(i.users,function(n){n.SourceEmailPassword="",n.CredentialsSaved=!1})},b=function(n){var t=h(i.stringTable.NoExchange,"error");angular.forEach(n,function(n){n.CredentialsSaved=!!n.SourceEmailAddress&&!!n.SourceEmailPassword,i.isBatchRunning||(n.Selected=n.CredentialsSaved),n.Selected=i.allUsersSelected&&n.HasExchange,!n.SourceEmailAddress||(n.SourceEmailAddress=n.SourceEmailAddress.substring(0,n.SourceEmailAddress.indexOf('@'))),n.HasExchange||(n.Status=t)})};i.FilterUsers=function(n,t){i.selectedView=n,i.selectedViewType=t,p(i.searchTerm)?v(i.searchTerm):r.GetDefaultUserList(0,'DisplayName',i.selectedView,i.selectedViewType).success(w).error(a)},i.InitFilterDropDown=function(){i.statusFilter=$("#SelectedStatus option:eq(0)").val()};var d=function(){var n=$("#listContainer .listRow:last").offset().top;!i.endOfList&&!i.isPreviousRequestPending&&n<$(window).height()&&(i.isPreviousRequestPending=!0,p(i.searchTerm)||(i.searchTerm=null),r.GetNextListUserPage(i.selectedView,i.selectedViewType,i.listContext,i.searchTerm).success(tt))},v=function(n){i.endOfList=!1,r.SearchUser(n,i.selectedView,i.selectedViewType,0,'DisplayName').success(w).error(a)},p=function(n){return!(n===null||n===""||n===" "||n===undefined)},tt=function(n){i.users=i.users.concat(n.Users),i.endOfList=n.MetaData.IsLastPage,i.listContext=n.MetaData.ListContext===null||n.MetaData.ListContext===undefined?null:n.MetaData.ListContext,i.isPreviousRequestPending=!1,b(n.Users)}}return n.$inject=["$rootScope","$scope","EmailMigrationService","HelperService","$interval","$location","$filter"],n}(),n.app.controller("EmailMigrationStatusController",i),n.app.directive("confirmPopover",['$parse','$templateCache','$compile','$position','$timeout',r])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function r(){n.exiting=!0,n.errorMessage="",t.Exit().success(function(t){n.exiting=!1,t.Succeeded?(n.triggeredByNew||i.path("/EmailMigration"),n.$emit('exitExistingMigration'),n.Cancel()):n.errorMessage=t.Message}).error(function(t){n.errorMessage=t,n.exiting=!1})}function u(){n.exiting=!0,n.errorMessage="",t.RemoveLegacyMigrationData().success(function(t){n.exiting=!1,t.Succeeded?(n.$emit('exitLegacyMigration'),n.Cancel()):n.errorMessage=t.Message}).error(function(t){n.errorMessage=t,n.exiting=!1})}this.$scope=n,this.EmailMigrationService=t,this.$location=i,n.init=function(t,i){n.exiting=!1,n.errorMessage="",n.migration=t,n.triggeredByNew=i},n.Exit=function(){n.migration=="Legacy"?u():r()},n.Cancel=function(){n.$emit('closeFlyout')},n.CloseErrorPanel=function(){n.errorMessage=""}}return n.$inject=["$scope","EmailMigrationService","$location"],n}();n.app.controller("EmailMigrationExitConfirmationController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f){function o(){t.migrationEndPoints=null,t.showAddEndPoint=!0,t.initiated=!1,i.GetExchangeMigrationEndpoints().then(function(n){t.initiated=!0;var i=n.data;i.Data.length>0&&(t.showAddEndPoint=!1,angular.forEach(i.Data,function(n){t.migrationEndPoints=n}))},function(n){h(n.data)})}this.$rootScope=n,this.$scope=t,this.ExchangeEmailMigrationService=i,this.MigrationHelperService=r,this.PanelService=u,this.$window=f,t.LaunchHybridWizard=function(){f.navigator.userAgent.indexOf("Chrome")>0||f.navigator.userAgent.indexOf("Firefox")>0?window.open("https://mshrcstorageprod.blob.core.windows.net/o365exchangehybrid/HybridSetup.exe"):window.open("https://mshrcstorageprod.blob.core.windows.net/o365exchangehybrid/Microsoft.Online.CSE.Hybrid.Client.application")},t.Cancel=function(){s()},t.$on('panelclosed',function(){e&&(e(),e=null)});var e=t.$on(u.GetBroadCastEventName(),function(){o()}),s=function(){t.$emit('closeFlyout')},h=function(){t.initiated=!0};o()}return n.$inject=["$rootScope","$scope","ExchangeEmailMigrationService","MigrationHelperService","PanelService","$window"],n}();n.app.controller("ExchangeMigrationSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r){function f(){t.formData=new n.AddEndpointModel,t.AutoDetect=t.EndpointType=0,t.ManualInput=1,t.saveInprogress=!1,t.showError=!1,t.showSucceess=!1,t.errorMessage=""}this.$scope=t,this.ExchangeEmailMigrationService=i,this.PanelService=r,t.ChangeEndpoint=function(n){t.showError=!1,t.EndpointType=n,t.EndpointType==t.ManualInput?(t.formData.Autodiscover=!1,t.formData.AutodiscoverEmail=null):(t.formData.Autodiscover=!0,t.formData.RemoteServer=null)},t.AddExchangeEndpoint=function(){t.showError=!1,t.saveInprogress=!0,i.AddExchangeMigrationEndPoint(t.formData).success(function(n){n.Succeeded?(t.saveInprogress=!1,t.showSucceess=!0,e()):(t.saveInprogress=!1,t.showSucceess=!1,t.showError=!0,u(n.Message))}).error(function(n){t.showSucceess=!1,t.showError=!0,t.saveInprogress=!1,u(n)})},t.Cancel=function(){t.$emit('closeFlyout')};var e=function(){r.SetSelectedItem(t.formData)},u=function(n){t.errorMessage=n.indexOf("DOCTYPE")>-1?('Add Exchange Migration Endpoint request could not be processed at this time. Please try again.'):n.indexOf("Assignment statements are not allowed")>-1?('It looks like we could not connect to the Migration endpoint, this is often resolved by restarting IIS on the Exchange servers on-premises. Please restart IIS on the Exchange server\x28s\x29\u00a0and then click add again below. \x3cbr\x3eHow to restart IIS\x3a\u00a0From the Exchange Server\x28s\x29 click\u00a0Start, then Run,\u00a0then type IISReset, and then click OK.'):n};f()}return t.$inject=["$scope","ExchangeEmailMigrationService","PanelService"],t}();n.ExchangeAddEndpointController=t,n.app.controller("ExchangeAddEndpointController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){this.$scope=n,this.PanelService=i,this.ExchangeEmailMigrationService=r;var u=n.$on(i.GetBroadCastEventName(),function(t,i){n.user=i,n.$apply(function(){})});n.$on('panelclosed',function(){u&&(u(),u=null)})}return n.$inject=["$scope","$timeout","PanelService","ExchangeEmailMigrationService"],n}();n.app.controller("ExchangeErrorDetailsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t,i;(function(n){n[n.inprogress=0]="inprogress",n[n.ok=1]="ok",n[n.error=2]="error"})(t||(t={})),i=function(){function i(i,r,u,f,e,o,s,h){var b;this.$rootScope=i,this.$scope=r,this.$timeout=u,this.ExchangeEmailMigrationService=f,this.MigrationHelperService=e,this.$interval=o,this.$location=s,this.$filter=h,b=6e4,r.init=function(t){r.stringTable=t,r.users=[],r.sortField="",r.sortAsc=!1,r.sortDirection=0,r.isExchangeBatchRunning=!1,r.completeBatchAutomatically=!0,r.allUsersSelected=!1,r.refreshTimer=null,r.successStatusList=[2],r.errorStatusList=[3],r.migrationUserStatusValue=n.MigrationUIStatus,r.errorMessage=null,r.errorType=null,r.inited=!1,r.starting=!1,r.exiting=!1,r.stopped=!1,r.completed=!1,r.listUsersFailure=!1,r.noUsers=!1,r.listContext=null,r.endOfList=!1,r.isPreviousRequestPending=!1,r.selectedView=null,r.selectedViewType=null,r.searchInitiated=!1,r.searchDisabled=!1,r.searchBoxTracker=!1,r.searchTerm=null,r.currentStep=-1,r.errorPanelNotficationsCache={inProgress:!1,completed:!1},f.GetIsExchangeMRSEnabled().then(function(n){var t=n.data;t.Data?(r.isPreviousRequestPending=!0,f.GetExchangeDefaultUserList(0,"DisplayName",null,null).success(function(n){var t=n.Data,i;r.users=t.Users,r.endOfList=t.MetaData.IsLastPage,r.isPreviousRequestPending=!1,r.users.length==0?(r.noUsers=!0,r.searchDisabled=!0):r.searchDisabled=!1,r.listContext=t.MetaData.ListContext===null||t.MetaData.ListContext===undefined?null:t.MetaData.ListContext,y(r.users),r.sortField="DisplayName",r.inited=!0,i=document.getElementById('ShellBodyAndFooterContainer'),angular.element(i).bind('scroll',k),f.GetDirsyncStatus().then(function(n){var t=n.data;t.Data.Status!=2&&c('You may notice that some of your users are not listed here, please install AAD Connect and synchronize your users. \x3ca class\x3d\x22gmailErrorContent\x22 href\x3d\x22https\x3a\x2f\x2fazure.microsoft.com\x2fdocumentation\x2farticles\x2factive-directory-aadconnect-get-started-express\x2f\x22 target\x3d\x22_blank\x22\x3eLearn more\x3c\x2fa\x3e.',0)}),f.ListExchangeOverallMigrationStatus().then(function(n){if(e.IsValid(n.data.Data)){var t=n.data.Data;r.isExchangeBatchRunning=t.Status==1,r.isExchangeBatchRunning&&g()}},function(n){l(n.data)})}).error(v)):s.path("/EmailMigration/Source")},function(n){console.log(n.data),l('We could not retrieve your migration endpoint information at this time, please try again.')}),r.$emit("autoscrolltotop")},r.$on("$destroy",function(){r.refreshTimer&&(o.cancel(r.refreshTimer),r.refreshTimer=null);var n=document.getElementById('ShellBodyAndFooterContainer');angular.element(n).unbind('scroll',k)}),r.$watch('errorMessage',function(n,t){if((n||t)&&(!n||!t)){var i=$("#errorBar").height()+20,r=n?"+=":"-=";$("#listContainer").css("padding-top",r+i)}},!0),r.CompleteMigration=function(){c(r.stringTable.MigrationClosing,0),r.exiting=!0,f.CompleteExchangeDataMigration().success(function(n){n.Succeeded?s.path().indexOf("Status")>-1&&s.path("/EmailMigration/Source"):l(n.Message),r.exiting=!1}).error(function(n){r.exiting=!1,l(n)})},r.StartOrStop=function(n,t){var i,e;(r.StartButtonEnabled()||r.isExchangeBatchRunning)&&(c("",0),i=[],angular.forEach(r.users,function(n){n.Selected&&i.push(n.UserPrincipalName)}),r.isExchangeBatchRunning?(e='Your migration could not be stopped at this time, please try to stop the migration again.',r.stopped=!0,a(t,"inprogress"),f.StopExchangeDataMigration(i).success(function(n){n.Succeeded?(r.isExchangeBatchRunning=!1,a(null,null),u(function(){r.RefreshStatus()},b)):(console.log(n.Message),l(e),a(null,null))}).error(function(n){a(null,null),console.log(n),l(e)})):(r.stopped=!1,r.completed=!1,c('Validating Configuration, Please wait...',0),f.GetExchangeMigrationEndpoints().then(function(t){var u,e;c("",0),u=t.data,!!u&&u.Data.length<1?$("#exchangeMigrationConfiguration").trigger("click"):(e='Your migration could not be started at this time, please try to start your migration again. ',r.isExchangeBatchRunning=!0,r.starting=!0,a(n,"inprogress"),f.StartExchangeDataMigration(i).success(function(n){n.Succeeded?(r.RefreshStatus(),g()):(r.isExchangeBatchRunning=!1,a(null,null),console.log(n.Message),l(e)),r.starting=!1}).error(function(n){r.isExchangeBatchRunning=!1,r.starting=!1,a(null,null),console.log(n),l(e)}))},function(n){console.log(n.data),l('We could not retrieve your migration configuration information at this time, please try starting the migration again.')})))},r.RefreshStatus=function(){var n=!1;return f.ListExchangeOverallMigrationStatus().then(function(t){if(e.IsValid(t.data.Data)){var i=t.data.Data;r.isExchangeBatchRunning=i.Status==1,n=i.Status==2}}),f.ListExchangeUserMigrationStatus().then(function(t){var i=t.data.Data;if(r.isExchangeBatchRunning||n){var u=[],f=[],o=[];angular.forEach(i,function(n){var i=d(n.UserPrincipalName);i&&(r.errorStatusList.indexOf(n.Status)>-1?f.push(n.ObjectId):r.successStatusList.indexOf(n.Status)>-1?o.push(n.ObjectId):u.push(n.ObjectId))}),r.stopped||(u.length>0&&!r.errorPanelNotficationsCache.inProgress?c(r.stringTable.InProgressMessage,0):f.length>0?c(r.stringTable.CompletedWithErrorMessage,2):!r.errorPanelNotficationsCache.completed&&o.length>0&&(r.completed=!0,c(r.stringTable.CompletedWithoutErrorMessage,1)))}a(null,null),angular.forEach(i,function(n){var i=d(n.UserPrincipalName);i&&(i.Status=e.GenerateStatusText(n.StatusText),i.UserStatus=n.FailureRecord.Message,i.StatusValue=n.Status,i.Selected=!(i.StatusValue===4||i.StatusValue===2))})},function(n){console.log(n.data)})},r.ToggleSortOption=function(n){r.sortField==n?(r.sortAsc=!r.sortAsc,r.sortDirection=r.sortDirection===1?0:1):r.sortField=n,r.sortField=="DisplayName"?r.RefreshList():r.users=tt(r.users,n,r.sortAsc)},r.RefreshList=function(){r.$emit("autoscrolltotop"),e.IsValid(r.searchTerm)?w(r.searchTerm):f.GetExchangeDefaultUserList(r.sortDirection,r.sortField,r.selectedView,r.selectedViewType).success(p).error(v)},r.UpdateAllUsersSelected=function(){var n=!0;angular.forEach(r.users,function(t){t.Selected||(n=!1)}),r.allUsersSelected=n,$('#allUsersSelected').prop('checked',n)},r.ToggleAllUsersSelected=function(){var n=$('#allUsersSelected').prop('checked');angular.forEach(r.users,function(t){t.Selected=n&&t.HasExchange&&t.StatusValue!==4&&t.StatusValue!==2}),r.allUsersSelected=n},r.StartButtonEnabled=function(){if(r.isExchangeBatchRunning||r.exiting)return!1;var n=!0,t=0;return angular.forEach(r.users,function(i){i.Selected&&(t++,i.HasExchange||(n=!1))}),n&&t>0},r.CloseErrorPanel=function(n){r.errorMessage=null,n==t[0]?r.errorPanelNotficationsCache.inProgress=!0:n==t[1]&&(r.errorPanelNotficationsCache.completed=!0)},r.FilterUsers=function(n,t){r.selectedView=n,r.selectedViewType=t,r.inited=!1,f.GetExchangeDefaultUserList(0,'DisplayName',r.selectedView,r.selectedViewType).success(p).error(v)},r.InitFilterDropDown=function(){r.statusFilter=$("#SelectedStatus option:eq(0)").val()},r.ToggleActionLinks=function(){$(".userlistActions:visible").length>0?$(".userlistActions").hide():$(".userlistActions").show()},r.SearchOnClick=function(){var n=$("#searchTerm").val();r.searchInitiated=!0,w(n)},r.SearchKeydown=function(n){if(n.keyCode===13){var t=$("#searchTerm").val();r.searchInitiated=!0,w(t)}else return!1},r.clearLabel=function(){$("#userSearch").children(".sb-label").hide(),$("#userSearch").addClass("is-active"),r.searchInitiated=!1,r.searchTerm=null},r.searchBoxClose=function(){r.searchBoxTracker=!0,r.searchBoxBlur(),r.searchTerm=null,r.searchInitiated=!1,r.RefreshList()},r.searchBoxBlur=function(){r.searchBoxTracker===!0&&($("#searchTerm").val(""),$("#userSearch").children(".sb-label").show()),$("#userSearch").removeClass("is-active"),$("#searchTerm").val()==""&&$("#searchTerm").val().length===0&&$("#userSearch").children(".sb-label").show(),r.searchBoxTracker=!1},r.openDataMigrationTour=function(){r.openTour()},r.closeAndDisableTour=function(){r.setCurrentStep(-1),r.closeTour()},r.HideStartPopOver=function(){return r.StartButtonEnabled()||r.isExchangeBatchRunning};var tt=h('orderBy'),d=function(n){var t;return angular.forEach(r.users,function(i){i.UserPrincipalName.indexOf(n)>-1&&(t=i)}),t},g=function(){r.refreshTimer=o(function(){if(!r.isExchangeBatchRunning&&!!r.refreshTimer){o.cancel(r.refreshTimer),r.refreshTimer=null;return}r.exiting||r.RefreshStatus()},b)},p=function(n){var t=n.Data;r.users=t.Users,r.inited=!0,r.endOfList=t.MetaData.IsLastPage,r.isPreviousRequestPending=!1,r.noUsers=!1,r.users.length==0?(r.noUsers=!0,r.searchDisabled=!0):r.searchDisabled=!1,r.searchTerm=$("#searchTerm").val(),r.listContext=t.MetaData.ListContext===null||t.MetaData.ListContext===undefined?null:t.MetaData.ListContext,y(r.users),r.$emit("autoscrolltotop")},l=function(n,t){r.KbUrl=t,n.indexOf("DOCTYPE")>-1?c('Your request could not be processed at this time. Please try again.',2):c(n,2)},v=function(){r.listUsersFailure=!0,r.searchDisabled=!0,c('Your request could not be processed at this time. Please try again.',2)},c=function(n,i){r.errorMessage=n,r.errorType=t[i]},a=function(n,t){var i=!!n&&!!t?e.GenerateStatusText(n,t):"";angular.forEach(r.users,function(n){n.Selected&&(n.TempStatus=i)})},y=function(n){var t='https\x3a\x2f\x2fsupport.office.com\x2farticle\x2fAssign-or-remove-licenses-for-Office-365-for-business-997596b5-4173-4627-b915-36abac6786dc ',i=e.GenerateStatusText('License required',"error",t);r.RefreshStatus(),angular.forEach(n,function(n){n.Selected=r.allUsersSelected&&n.HasExchange&&n.StatusValue!==4&&n.StatusValue!==2,n.HasExchange||(n.Status=i),n.Status||(n.Status=e.GenerateStatusText('In cloud'))})},k=function(){var n=$("#listContainer .listRow:last").offset().top;!r.endOfList&&!r.isPreviousRequestPending&&n<$(window).height()&&(r.isPreviousRequestPending=!0,e.IsValid(r.searchTerm)||(r.searchTerm=null),f.GetExchangeNextListUserPage(r.selectedView,r.selectedViewType,r.listContext,r.searchTerm).success(nt))},w=function(n){r.endOfList=!1,r.inited=!1,f.SearchExchangeUser(n,r.selectedView,r.selectedViewType,0,'DisplayName').success(p).error(v)},nt=function(n){var t=n.Data;r.users=r.users.concat(t.Users),r.endOfList=t.MetaData.IsLastPage,r.listContext=t.MetaData.ListContext===null||t.MetaData.ListContext===undefined?null:t.MetaData.ListContext,r.isPreviousRequestPending=!1,y(t.Users)},it=function(n,t){if(n||t){var i=$("#errorBar").height()+20,r=n?"+=":"-=";$("#listContainer").css("padding-top",r+i)}}}return i.$inject=["$rootScope","$scope","$timeout","ExchangeEmailMigrationService","MigrationHelperService","$interval","$location","$filter"],i}(),n.app.controller("ExchangeEmailMigrationStatusController",i)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){this.$rootScope=n,this.$scope=t,this.ExchangeEmailMigrationService=i,this.$location=r,this.$window=u,t.Cancel=function(){f()},t.Launch=function(){u.navigator.userAgent.indexOf("Chrome")>0||u.navigator.userAgent.indexOf("Firefox")>0?window.open("https://mshrcstorageprod.blob.core.windows.net/o365exchangehybrid/HybridSetup.exe"):window.open("https://mshrcstorageprod.blob.core.windows.net/o365exchangehybrid/Microsoft.Online.CSE.Hybrid.Client.application"),f()};var f=function(){t.$emit('closeFlyout')}}return n.$inject=["$rootScope","$scope","ExchangeEmailMigrationService","$location","$window"],n}();n.app.controller("ExchangeHybridDownloadController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u,f){this.$scope=t,this.SetupWizardService=i,this.$location=r,this.FindWizardsWidgetService=u,this.$window=f,t.SetupGuidesRawData=[],t.SetupGuidesFilteredData=[],t.init=function(){t.formData.Status!==2&&(t.uuid="9dd4e795-b044-48f3-aebe-eecd1a44d5ae",MsnVideoUx.render("ocVideo","renderedVideo",{"ocVideo.Width":"640","ocVideo.Height":"360",'ocVideo.AutoPlayVideo':!1,'ocVideo.DefaultVideo':{videoQuery:{videoFilter:{type:'uuid',uuids:[t.uuid]}}},'ocVideo.PlayerChannel':'ocvideo','ocVideo.PlayerLocation':'SetupWizard','ocVideo.MsnPlayerLeadsWith':'Html'},{csid:"ux-cms-en-us-msoffice"}));var n=function(n,t){return!n||!t?!1:t.indexOf(n)!==-1?!0:n.indexOf("Office")!==-1&&t.indexOf("Word")!==-1?!0:!1};t.GetSetupGuides=function(){t.formData.Tiles.length>0&&u.GetFindWizards().then(function(i){var r,u,f;for(t.SetupGuidesRawData=i.data.FindWizards,r=0,u=0,r=0;r<t.SetupGuidesRawData.length;r++)for(u=0;u<t.formData.Tiles.length;u++)if(f=t.SetupGuidesRawData[r],n(f.name,t.formData.Tiles[u].title)){t.SetupGuidesFilteredData.push(f);break}},function(){t.SetupGuidesRawData=[]})},t.GetSetupGuides()},t.GoToSetup=function(){i.BootstrapData=new n.BootstrapData,i.BootstrapData.StoreSessionId="",i.StepChanged("SetupProductsDetail","Resume",422850),t.Close(),r.path("/setupwizard")},t.BuyMore=function(){t.Close();var n={message:'Once you have purchased more licenses, navigate to the Users page to assign the licenses.',onNextLoad:!0};t.$root.$broadcast('setNavigationInformationBar',n),r.path("/subscriptions")},t.ChatNow=function(){t.Close(),t.ShowConcierge()},t.AssignLicenses=function(){t.Close();var n={message:'To assign software licenses, click on a user to open their details, then click \x3cstrong\x3eEdit\x3c\x2fstrong\x3e on the Product licenses line.',onNextLoad:!0};t.$root.$broadcast('setNavigationInformationBar',n),r.path("/users")},t.ShowConcierge=function(){$("#conciergeMinState, #cw-min-state, #needHelperTitleV2").filter(function(){return $(this).css("display")=="block"}).trigger("click")},t.Close=function(){t.DisposePlayer(),t.$emit('closePanel')},t.DisposePlayer=function(){var n='renderedVideo';Vhs.Player.Services.VhsPlayerService.playerDictionary[n]&&(Vhs.Player.Services.VhsPlayerService.playerDictionary[n].playerConfig.defaultVideo="00000000-0000-0000-0000-000000000000")}}return t.$inject=["$scope","SetupWizardService","$location","FindWizardsWidgetService","$window"],t}();n.app.controller("SetupProductsDetailController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u){this.$scope=t,this.SetupWizardService=i,this.$location=r,this.$window=u,t.SetupProductsListConfig={ServerError:!1,NoResults:!1,ShowLoadingSpinner:!0,EmptyListViewTitle:'Nothing here yet',EmptyListBodyLabel:""},t.SetupProductsData=[],t.$root.features.SetupWizardSettingsBusinessLogic&&t.$root.features.FinishSetupBanner&&t.$root.$broadcast('refreshsetupbannerstatus'),i.Step_GetProductsListForAssignLicense().then(function(n){n!==null&&angular.forEach(n,function(n){n.Tiles=[],n.Icons!=null&&(n.Icons.AppIcons!=null&&angular.forEach(n.Icons.AppIcons,function(t){t!=null&&n.Tiles.push({src:t.IconUrl,title:t.ToolTip})}),n.Icons.ServiceIcons!=null&&angular.forEach(n.Icons.ServiceIcons,function(t){t!=null&&n.Tiles.push({src:t.IconUrl,title:t.ToolTip})})),n.Status=2,n.StatusText=n.TotalUnits<=0?'Disabled':n.TotalUnits>=1&&n.TotalUnits!==n.WarningUnits?'Active':'Expired',t.SetupProductsData.push(n)}),t.SetupProductsListConfig.ShowLoadingSpinner=!1,t.SetupProductsData.length===0&&(t.SetupProductsListConfig.NoResults=!0),t.$emit("autoscrolltotop")}),t.ShowSetupButton=function(n){var i=t.SetupEnabled()&&t.$root.CurrentUserInfo.SetupBanner.ProductSkuId===n.ProductSkuId;return n.Status=i?1:2,i},t.SetupEnabled=function(){if(t.$root.features.SetupWizardSettingsBusinessLogic&&t.$root.features.FinishSetupBanner&&t.$root.CurrentUserInfo&&t.$root.CurrentUserInfo.SetupBanner){var n=t.$root.CurrentUserInfo.SetupBanner;if(n.SetupBannerType!==0&&!n.SimpleMode)return!0}return!1},t.GoToSetup=function(){i.BootstrapData=new n.BootstrapData,i.BootstrapData.StoreSessionId="",i.StepChanged("SetupProducts","Resume",421849),r.path("/setupwizard")},t.BuyMore=function(){var n={message:'Once you have purchased more licenses, navigate to the Users page to assign the licenses.',onNextLoad:!0};t.$root.$broadcast('setNavigationInformationBar',n),r.path("/subscriptions")},t.AssignLicenses=function(){var n={message:'To assign software licenses, click on a user to open their details, then click \x3cstrong\x3eEdit\x3c\x2fstrong\x3e on the Product licenses line.',onNextLoad:!0};t.$root.$broadcast('setNavigationInformationBar',n),r.path("/users")}}return t.$inject=["$scope","SetupWizardService","$location","$window"],t}();n.app.controller("SetupProductsListViewController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u,f,e,o,s,h,c){function b(n){return i.stringTable&&i.stringTable.Office365&&n.trim().indexOf(i.stringTable.Office365)===0?n.replace(i.stringTable.Office365,""):n}function k(){i.$root.currentCultureInfo||$('.viewport').css('margin-left')==="0px"?i.$root.currentCultureInfo&&$('.viewport').css('margin-right')!=="0px"&&(a=$('.viewport').css('margin-right')):a=$('.viewport').css('margin-left'),$('.viewport').css({width:'100%',margin:0,padding:0}),$('.aside').css({display:'none'}),$('#ShellBody').css({'background-color':'#fff'}),$('#ShellBodyAndFooterContainer').css({overflow:'auto'})}function v(n,t){var r=-1,u=-1;return angular.forEach(i.steps,function(i,f){i.name==n&&(r=f,angular.forEach(i.substeps,function(n,i){n.name==t&&(u=i)}))}),{stepIndex:r,subStepIndex:u}}function l(n,t){if(n<0||n>=i.steps.length||t<0||t>=i.steps[n].substeps.length){console.log("cannot find the step or substep.");return}i.currentStepIndex={step:n,subStep:t}}function w(){i.savedStepInfo.history.push({step:i.currentStep.name,subStep:i.currentSubStep.name})}var y,p,a;this.$rootScope=t,this.$scope=i,this.SetupWizardService=r,this.$location=u,this.$window=f,this.$templateRequest=e,this.$compile=o,this.$timeout=s,this.HelperService=h,this.ConciergeIntegrationService=c,i.init=function(t){i.stringTable=t,i.steps=null,i.currentStepIndex=null,i.currentStep=null,i.currentSubStep=null,i.savedStepInfo=null,i.messageType=null,i.message=null,i.showLoading=!1,i.exitFeedbackShown=!0,i.timeouts=[],i.productDisplayName="",i.hideDefaultSteps=!1,i.SetupWizardMessageAction=n.SetupWizardMessageAction,k();for(var u=0;u<=5;++u)i.timeouts.push(s(k,250*Math.pow(2,u)));r.Initialize(),typeof r.BootstrapData.StoreSessionId!="undefined"&&r.BootstrapData.StoreSessionId.length?typeof r.BootstrapData.StepsInfo=="undefined"?(r.StepChanged("SetupWizardConntroller","UndefinedStepSet",423627),r.Exit()):(y(r.BootstrapData.StepsInfo),p()):(r.ShowLoading(!0),r.Banner_GetSetupBanner().then(function(t){c.InitializeProblemDescriptionsDictionary("setupwizard"),t!=null&&t.SetupBannerType!==0?i.$root.features.SetupWizardSettingsBusinessLogic?r.Step_GetSetupSettingsAdvanced(!0,t).then(function(i){var u=null,f=0,e=null;i?(u=i.stepSet,f=i.stepSetVersion,e=i.sid,r.BootstrapData=new n.BootstrapData,r.BootstrapData.StoreSessionId=e,r.BootstrapData.ProductSkuId=t.ProductSkuId,r.BootstrapData.ProductDisplayName=t.ProductDisplayName,r.BootstrapData.SetupBannerType=t.SetupBannerType,r.LoadState("wizardframework").then(function(n){n||(n={stepsSet:u,stepSetVersion:f,history:[]},r.SaveState("wizardframework",n)),r.BootstrapData.StepsInfo=n,r.BootstrapData.StepsSetVersion=n.stepSetVersion,r.StepChanged("SetupWizardConntroller","Resume",421848),r.SaveState("SetupBannerInfo",t),y(r.BootstrapData.StepsInfo),p(),r.ShowLoading(!1)})):r.Exit()}):r.Step_GetSetupSettings().then(function(i){var u=null,f=0,o=0,s=0,h=0,c=0,l=0,a=0,e=0;i&&(i.CurrentExchangeStepSetVersion&&(o=i.CurrentExchangeStepSetVersion),i.CurrentSkypeStepSetVersion&&(s=i.CurrentSkypeStepSetVersion),i.CurrentSmbStepSetVersion&&(h=i.CurrentSmbStepSetVersion),i.CurrentE3StepSetVersion&&(c=i.CurrentE3StepSetVersion),i.CurrentWorkloadsStepSetVersion&&(l=i.CurrentWorkloadsStepSetVersion),i.CurrentVsbStepSetVersion&&(a=i.CurrentVsbStepSetVersion),i.CurrentBcsStepSetVersion&&(e=i.CurrentBcsStepSetVersion));switch(t.SetupBannerType){case 9:u="OwnDomainVsb",f=a;break;case 7:u="OwnDomainSmb",f=h;break;case 8:u="OwnDomainE3",f=c;break;case 1:u=t.HasOfficeClient||t.HasSkype?"OwnDomainSoftware":"owndomain",f=o;break;case 10:t.HasBcsExchangeSetupCompleted?(u="HideDomainBcs",f=e):(u="OwnDomainBcs",f=e);break;case 2:case 3:case 4:u="NoDomainSetupSoftware",f=l;break;case 6:u="NoDomainSetupSoftware",f=s}r.InitialSetupWizardSession(t.SetupBannerType,t.ProductSkuId).then(function(i){r.BootstrapData=new n.BootstrapData,r.BootstrapData.StoreSessionId=i,r.BootstrapData.ProductSkuId=t.ProductSkuId,r.BootstrapData.ProductDisplayName=t.ProductDisplayName,r.BootstrapData.SetupBannerType=t.SetupBannerType,r.LoadState("wizardframework").then(function(n){n||(n={stepsSet:u,stepSetVersion:f,history:[]},r.SaveState("wizardframework",n)),r.BootstrapData.StepsInfo=n,r.BootstrapData.StepsSetVersion=n.stepSetVersion,r.StepChanged("SetupWizardConntroller","Resume",421848),r.SaveState("SetupBannerInfo",t),y(r.BootstrapData.StepsInfo),p(),r.ShowLoading(!1)})})}):r.Exit()}))},i.LastSavedConciergeProblemDescription=null,i.SubStepToIncludeRegistrars=null,i.UpdateConciergeProblemDescription=function(n){i.$root.features.EnableConciergeProblemDescriptions&&i.currentSubStep.name&&(i.LastSavedConciergeProblemDescription=c.UpdateProblemDescription("setupwizard",i.currentSubStep.name.toLowerCase(),n,r.BootstrapData.SavedRegistrar))},y=function(n){i.savedStepInfo=n,r.SetCurrentStepsSet(n.stepsSet,n.stepSetVersion,n.appendedStepsSet).then(function(){var t=v(n.step,n.subStep);(t.stepIndex==-1||t.subStepIndex==-1)&&(t.stepIndex=0,t.subStepIndex=0),l(t.stepIndex,t.subStepIndex)}),r.LoadState("ExitFeedbackShown").then(function(n){i.exitFeedbackShown=n})},p=function(){r.BootstrapData&&h.IsValid(r.BootstrapData.ProductDisplayName)?i.productDisplayName=b(r.BootstrapData.ProductDisplayName):r.BootstrapData&&r.BootstrapData.ProductSkuId&&r.BootstrapData.ProductSkuId!=="00000000-0000-0000-0000-000000000000"&&r.Step_GetUserProductsModel(r.BootstrapData.ProductSkuId).then(function(n){n&&n.ProductDisplayName&&(i.productDisplayName=b(n.ProductDisplayName))})},i.$on('wizard:stepssetchanged',function(n,u){if(i.steps=u.stepsSet.steps,console.log("steps set changed to "+u.stepsSet.name),u.stepsSet.name!=i.savedStepInfo.stepsSet||t.features.SetupWizardAppendDefinition&&u.stepsSet.appendedStepsSet!==i.savedStepInfo.appendedStepsSet){var f={stepsSet:u.stepsSet.name,stepSetVersion:u.stepsSet.version,step:u.stepsSet.steps[0].name,subStep:u.stepsSet.steps[0].substeps[0].name,history:[],appendedStepsSet:[],previousAction:2};(f.subStep==="SmbChoice"||f.subStep==="E3Choice")&&(f.subStep="SelectDomainType"),i.savedStepInfo=f,r.SaveState("wizardframework",i.savedStepInfo)}}),i.$on('wizard:stepssetappended',function(n,t){i.steps=t.stepsSet.steps,console.log("steps set appened to "+t.stepsSet.name),r.LoadState('wizardframework').then(function(n){n.appendedStepsSet||(n.appendedStepsSet=[]),n.appendedStepsSet.push(t.appendedStepsSet),i.savedStepInfo=n,r.SaveState("wizardframework",i.savedStepInfo)})}),i.$on('wizard:smbinstallsoftwareonly',function(){i.steps!=null&&angular.forEach(i.steps,function(n){n.name==="SetupWithDataMigration"&&(n.ui.visible=!1)})}),a="0",i.$on("$destroy",function(){angular.forEach(i.timeouts,function(n){s.cancel(n)}),i.$root.currentCultureInfo?$('.viewport').css({width:'',padding:'',margin:'','margin-right':a}):$('.viewport').css({width:'',padding:'',margin:'','margin-left':a}),$('.aside').css({display:''}),$('#ShellBody').css({'background-color':''})}),i.$on('wizard:previous',function(){if(!i.savedStepInfo.history||i.savedStepInfo.history.length==0){console.log("no history data to go back");return}var u=i.savedStepInfo.history.pop(),r=v(u.step,u.subStep);(r.stepIndex==-1||r.subStepIndex==-1)&&(i.savedStepInfo.history=[],r.stepIndex=0,r.subStepIndex=0),i.savedStepInfo.previousAction=1,l(r.stepIndex,r.subStepIndex)}),i.$on('wizard:backto',function(n,t){var u,r;if(!i.savedStepInfo.history||i.savedStepInfo.history.length==0){console.log("no history data to go back");return}for(u=null;u=i.savedStepInfo.history.pop();)if(u.step==t.stepName&&u.subStep==t.subStepName)break;r=v(u.step,u.subStep),(r.stepIndex==-1||r.subStepIndex==-1)&&(i.savedStepInfo.history=[],r.stepIndex=0,r.subStepIndex=0),i.savedStepInfo.previousAction=1,l(r.stepIndex,r.subStepIndex)}),i.$on('wizard:next',function(n,t){var r=null;i.currentStepIndex.subStep<i.currentStep.substeps.length-1?r={step:i.currentStepIndex.step,subStep:i.currentStepIndex.subStep+1}:i.currentStepIndex.step<i.steps.length-1?r={step:i.currentStepIndex.step+1,subStep:0}:console.log("already reached the end of the wizard steps"),!r||(t&&t.skip||w(),i.savedStepInfo.previousAction=0,i.currentStepIndex=r)}),i.$on('wizard:nextstep',function(){var r=null;i.currentStepIndex.step<i.steps.length-1?r={step:i.currentStepIndex.step+1,subStep:0}:console.log("already reached the end of the wizard steps"),!r||(w(),i.savedStepInfo.previousAction=0,i.currentStepIndex=r)}),i.$on('wizard:skipButKeepHistory',function(){i.savedStepInfo&&i.savedStepInfo.previousAction===1?r.Previous():r.Next()}),i.$on('wizard:goto',function(n,t){var u=v(t.stepName,t.subStepName);if(u.stepIndex==-1||u.subStepIndex==-1){console.error("cannot find step or substep: "+t.stepName+","+t.subStepName);return}if(u.stepIndex==i.currentStepIndex.step&&u.subStepIndex==i.currentStepIndex.subStep){console.error("already at this step");return}t&&!t.skip?(w(),i.savedStepInfo.previousAction=0,l(u.stepIndex,u.subStepIndex)):i.savedStepInfo&&i.savedStepInfo.previousAction===1?r.Previous():(i.savedStepInfo.previousAction=0,l(u.stepIndex,u.subStepIndex))}),i.GoToHomePage=function(){u.path("/homepage")},i.GoToBusinessCenter=function(){f.location.href="/BusinessCenter/Home"},i.LogAndGoToHomePage=function(){r.OptionSelected(417979,"ExitFeedbackShown"),r.SaveState("ExitFeedbackShown",1),i.GoToHomePage()},i.$on('wizard:exit',function(){c.ClearProblemDescription(),i.$root.CurrentUserInfo.ShowExitFeedback&&i.currentStep!==null&&!i.exitFeedbackShown?(i.currentStep.name==='Domain'||i.currentStep.name==='SmbDomain'||i.currentStep.name==='E3Domain')&&i.currentSubStep!==null&&i.currentSubStep.name==="ExternalTakeoverCompletion"?i.GoToHomePage():i.currentSubStep!==null&&i.currentSubStep.name==="Feedback"?i.GoToHomePage():i.$broadcast('EWizard:start'):i.GoToHomePage()}),i.$on('wizard:smbexit',function(){c.ClearProblemDescription(),i.GoToBusinessCenter()}),i.$on('wizard:message',function(t,r){i.messageAction=null,i.messageActionData=null,i.messageActionDisplayMessage=null;var u=r.ErrorMessage;u||r.MessageType===0||(u=i.stringTable.GenericError),i.UpdateConciergeProblemDescription(),u&&r.MessageType!==4&&i.UpdateConciergeProblemDescription(u),i.message=u,i.messageType=n.SetupWizardMessageType[r.MessageType].toLowerCase(),r.Action!==undefined&&r.Action!==null&&(i.messageAction=r.Action.ActionType,i.messageActionData=r.Action.ActionData,i.messageActionDisplayMessage=r.Action.DisplayMessage)}),i.$on('wizard:optionselected',function(n,t){r.StepChanged(i.currentStep.name,i.currentSubStep.name,t.tagId,t.option)}),i.$on('wizard:showloading',function(n,t){i.showLoading=t}),i.$watch('currentStepIndex',function(){if(i.currentStepIndex){i.CloseMessagePanel(),i.currentStep=i.steps[i.currentStepIndex.step],i.currentSubStep=i.steps[i.currentStepIndex.step].substeps[i.currentStepIndex.subStep],e(i.currentSubStep.template).then(function(n){return r.ShowLoading(!1),o($("#setupWizardStepPlaceholder").html(n).contents())(i),null});var n=v(i.savedStepInfo.step,i.savedStepInfo.subStep);(n.stepIndex!=i.currentStepIndex.step||n.subStepIndex!=i.currentStepIndex.subStep)&&(i.savedStepInfo.step=i.currentStep.name,i.savedStepInfo.subStep=i.currentSubStep.name,r.SaveState("wizardframework",i.savedStepInfo)),i.UpdateConciergeProblemDescription(),r.StepChanged(i.currentStep.name,i.currentSubStep.name,i.currentSubStep.tagId)}},!0),i.GetStepIconCssClass=function(n){return n==i.currentStepIndex.step?"inprogress":n<i.currentStepIndex.step?"done ms-Icon-Basel ms-Icon-Basel--CompletedSolid":"notstarted"},i.RestartWizard=function(){i.CloseMessagePanel(),l(0,0),r.SaveState("EmailMigration",null),r.SaveState("SelectSetupType",null),r.SaveState("VerifyDomain",null),r.SaveState("godaddystate",null),r.SaveState("commondata",null);var n=r.GetCurrentStepsSet().name,t={stepsSet:n,history:[],stepSetVersion:r.BootstrapData.StepsSetVersion};r.SaveState("wizardframework",t);return},i.NavigateTo=function(){u.path(i.messageActionData)},i.CloseMessagePanel=function(){i.message=null},i.ShowConcierge=function(){var n=$("#conciergeMinState, #cw-min-state, #needHelperTitleV2").filter(function(){return $(this).css("display")=="block"});n&&(i.$root.features.EnableConciergeProblemDescriptions&&i.LastSavedConciergeProblemDescription!==null?(typeof Concierge!='undefined'&&Concierge.RestoreWidget(i.LastSavedConciergeProblemDescription),typeof FastTrack!='undefined'&&FastTrack.RestoreWidget(i.LastSavedConciergeProblemDescription)):r.GetConciergeMessage(i.currentStep.name,i.currentSubStep.name,i.message).then(function(n){Concierge.RestoreWidget(n),FastTrack.RestoreWidget(n)})),r.OptionSelected(417642,"NeedHelp")}}return t.$inject=["$rootScope","$scope","SetupWizardService","$location","$window","$templateRequest","$compile","$timeout","HelperService","ConciergeIntegrationService"],t}();n.app.controller("SetupWizardController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){function u(){t.domain=null,t.registrar=null,t.mxLink=null,t.cnameLink=null,t.txtLink=null,t.srvLink=null,t.showVerifyDnsError=!1,t.folded={mx:!1,cname:!1,txt:!1,srv:!1},t.records=null,t.firstRun=!0,t.verifying=!1,t.verified=!1,i.Step_GetSavedDomain().then(function(n){t.domain=n,i.Step_VerifyDnsRecords(n,i.BootstrapData.SetupBannerType).then(function(n){n!=null?(t.verified=n.IsVerified,t.records=n.DnsRecordsHealthResult):t.showVerifyDnsError=!0}).then(function(){t.verified&&(t.firstRun=!1,i.Step_MarkSetupCompleted(t.domain).then(i.NextStep()))}),i.Step_GetDomainRegistrar(n).then(function(r){t.registrar=i.Step_GetPopularRegistrar(r),i.BootstrapData.SavedRegistrar=t.registrar,t.UpdateConciergeProblemDescription(),i.Step_GetInstructionsLink(n,r,1).then(function(n){t.mxLink=n}),i.Step_GetInstructionsLink(n,r,2).then(function(n){t.cnameLink=n}),i.Step_GetInstructionsLink(n,r,3).then(function(n){t.txtLink=n}),i.Step_GetInstructionsLink(n,r,4).then(function(n){t.srvLink=n})})})}this.$rootScope=n,this.$scope=t,this.SetupWizardService=i,this.$timeout=r,t.ToggleSection=function(n){t.folded[n]=!t.folded[n]},t.Copy=function(n){var r=document.getElementById(n),t=document.createRange(),i=window.getSelection();i.removeAllRanges();try{t.selectNodeContents(r),i.addRange(t)}catch(u){t.selectNode(r),i.addRange(t)}document.execCommand("Copy"),i.removeAllRanges()},t.Previous=function(){i.Previous()},t.Next=function(){if(t.verified){i.NextStep();return}t.verifying=!0,t.firstRun=!1,i.Step_VerifyDnsRecords(t.domain,i.BootstrapData.SetupBannerType).then(function(n){n!=null?(t.showVerifyDnsError=!1,t.records=n.DnsRecordsHealthResult,n.IsVerified?i.Step_MarkSetupCompleted(t.domain).then(i.NextStep()):i.ShowMessage(n.VerifyMessage,2)):t.showVerifyDnsError=!0,r(function(){t.verifying=!1},500)})},t.Exit=function(){i.Exit()},t.ShowUnhealthyReasonMessage=function(n,t){var i;switch(n){case 0:i='No records found';break;case 1:i='The record we detected doesn\x27t match the expected value';break;case 2:i='The records matched, however the priority doesn\x27t match the expected values';break;case 3:i=String.format('Only one \x7b0\x7d record can have a priority of \x7b1\x7d',t.Type,t.Priority);break;case 4:i='The records we detected do not match the expected values';break;case 5:i='More than one actual records of this type were detected';break;case 6:i='More actual NS records detected than expected records';break;case 7:i='Less actual NS records detected than expected records'}return i},u()}return n.$inject=["$rootScope","$scope","SetupWizardService","$timeout"],n}();n.app.controller("SetupWizardAddDnsRecordsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f,e,o){function h(n,i,r){n.css('top',i.top-$('#ShellBodyAndFooterContainer').position().top+$('#ShellBodyAndFooterContainer').scrollTop()),t.$root.currentCultureInfo?n.css('left',r.left-$('#ShellBodyAndFooterContainer').position().left+$('#ShellBodyAndFooterContainer').scrollLeft()-390):n.css('left',r.right-$('#ShellBodyAndFooterContainer').position().left+$('#ShellBodyAndFooterContainer').scrollLeft())}function l(){t.purchasing=!0,f.Step_PurchaseNewLicense(1,t.sku).then(function(n){if(!n){t.purchasing=!1,f.ShowMessage(t.strings.PurchaseFailed,2);return}t.purchaseUserTimer=u(function(){f.Step_GetTenantDefaultLicense().then(function(n){n.TotalUnits!=t.totalUnits&&(u.cancel(t.purchaseUserTimer),t.maxUsers++,t.totalUnits=n.TotalUnits,t.users.push({DisplayName:null,UserName:null,Added:!1}),t.purchasing=!1)})},5e3)})}var c=this,s;this.$rootScope=n,this.$scope=t,this.$filter=i,this.$timeout=r,this.$interval=u,this.SetupWizardService=f,this.$q=e,this.HelperService=o,s=function(){var t=c.$q.defer(),n={};return f.BootstrapData&&f.BootstrapData.ProductSkuId&&f.BootstrapData.ProductSkuId!=="00000000-0000-0000-0000-000000000000"?f.Step_GetTenantLicenseBySkuId(f.BootstrapData.ProductSkuId).then(function(i){n.data=i,t.resolve(n)}):f.LoadState("SetupBannerInfo").then(function(i){i&&i.ProductSkuId&&i.ProductSkuId!=="00000000-0000-0000-0000-000000000000"?f.Step_GetTenantLicenseBySkuId(i.ProductSkuId).then(function(i){n.data=i,t.resolve(n)}):f.Step_GetTenantDefaultLicense().then(function(i){n.data=i,t.resolve(n)})}),t.promise},t.init=function(n){t.strings=n,t.skipValidating=!1,t.users=[],t.hasPreviouslyAddedUsers=!1,t.sku=null,t.maxUsers=0,t.loading=!0,t.domain=null,t.verifying=!1,t.featureStates=null,t.purchasing=!1,t.purchaseUserTimer=null,t.totalUnits=0,t.productDisplayName=null,t.userNameRegex=/^([a-zA-Z0-9'_-]\?)*[a-zA-Z0-9'_.-]+$/,t.enableBack=!0,t.maxInitialRows=5,t.isDomainSetupPartOfStepSet=function(n){var t=!0;return(n.name==='NoDomainSetupSoftware'||n.name==='NoDomainSetupSoftwareSmb'||n.name==='NoDomainSetupSoftwareE3')&&(t=!1),t},t.canDomainSetupBeReverted=function(n){var t=!0;return(n.name==='BuyDomainSmb'||n.name==='BuyDomainSoftwareSmb'||n.name==='BuyDomainBusinessAppSmb')&&(t=!1),t},f.Step_GetFeatureStates().then(function(n){t.featureStates=n;var i=f.GetCurrentStepsSet();t.isDomainSetupPartOfStepSet(i)&&t.canDomainSetupBeReverted(i)||(t.enableBack=!1),s().then(function(n){t.sku=n.data.ProductSkuId,t.maxUsers=n.data.AvailableUnits,t.totalUnits=n.data.TotalUnits,t.productDisplayName=n.data.ProductDisplayName,f.Step_GetUsersAddedInCurrentSession().then(function(n){var i,r,u;if(n){for(t.hasPreviouslyAddedUsers=n.length>0,t.maxUsers+=n.length,i=0;i<n.length;++i)r=n[i],r.Added=!0,t.AddUser(r);for(u=n.length;u<Math.min(t.maxUsers,t.maxInitialRows);++u)t.AddUser(null);t.loading=!1}})})}),f.Step_GetSavedDomain().then(function(n){t.domain=n,t.domain||f.Step_GetDefaultDomain().then(function(n){t.domain=n,f.BeginSession(t.domain)})})},t.AddUser=function(n){n?t.users.push(n):t.users.length>=t.maxUsers?l():t.users.push({DisplayName:null,UserName:null,Added:!1})},t.showTooltip=function(n,i){var r=i.target.getBoundingClientRect(),u=i.target.parentNode.parentNode.getBoundingClientRect();switch(n){case 0:h(angular.element('#tooltip_displayNameInput'),r,u),t.showDisplayNameHelptext=!0;break;case 1:h(angular.element('#tooltip_usernameInput'),r,u),t.showUsernameHelptext=!0}},t.hideTooltip=function(n){switch(n){case 0:t.showDisplayNameHelptext=!1;break;case 1:t.showUsernameHelptext=!1}},t.$on("$destroy",function(){t.purchaseUserTimer&&(u.cancel(t.purchaseUserTimer),t.purchaseUserTimer=null)}),t.AddUserButtonEnabled=function(){return t.featureStates&&t.featureStates.SetupWizardPurchaseUser?!t.loading&&!t.purchasing:!t.loading&&t.users.length<t.maxUsers},t.Previous=function(){o.IsValid(t.steps[0])&&t.steps[0].name==="SmbDomain"?f.BackToStep("SmbDomain","SelectDomainType"):o.IsValid(t.steps[0])&&t.steps[0].name==="E3Domain"?f.BackToStep("E3Domain","SelectDomainType"):f.BackToStep("Domain","SelectDomainType")},t.$watch('users',function(){var u,f,e,r,n;if(!t.skipValidating){for(t.skipValidating=!0,u={},r=0;r<t.users.length;++r)f=t.users[r].UserName,f&&(u[f]=u[f]?u[f]+1:1);for(e=i('filter'),r=0;r<t.users.length;++r)if(n=t.users[r],!n.Added){if(!n.DisplayName&&!n.UserName){n.DisplayNameError=null,n.UserNameError=null;continue}n.DisplayNameError=n.DisplayName?null:t.strings.CannotBeEmpty,n.UserNameError=n.UserName?t.userNameRegex.test(n.UserName)?u[n.UserName]>1?t.strings.DuplicatedUserName:null:t.strings.InvalidCharacters:t.strings.CannotBeEmpty}t.skipValidating=!1}},!0),t.ShowBackButton=function(){var n=!0,i=f.GetCurrentStepsSet();return i.name!=='NoDomainSetupSoftware'&&t.canDomainSetupBeReverted(i)||(n=!1),n},t.NextButtonEnabled=function(){if(t.loading)return!1;var n=!0;return angular.forEach(t.users,function(t){!t.DisplayNameError&&!t.UserNameError||(n=!1)}),n},t.Next=function(){if(t.NextButtonEnabled()){var n=[];angular.forEach(t.users,function(i){!i.DisplayName||!i.UserName||i.Added||(i.SelectedProductSkuId=t.sku,i.DisplayName=i.DisplayName.trim(),n.push(i))}),t.verifying=!0,f.Step_AddUsers(t.domain,n).then(function(n){var i=!1;t.skipValidating=!0,angular.forEach(n,function(n){var r=null;(angular.forEach(t.users,function(t){t.UserName&&t.UserName==n.UserName&&(r=t)}),r)&&(n.AddUserResultType==0?r.Added=!0:(i=!0,r.UserNameError=n.Message))}),r(function(){t.skipValidating=!1}),i||f.Next(),r(function(){t.verifying=!1},2e3)})}},t.Exit=function(){f.Exit()}}return n.$inject=["$rootScope","$scope","$filter","$timeout","$interval","SetupWizardService","$q","HelperService"],n}();n.app.controller("SetupWizardAddUserController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){var f=this;this.$scope=n,this.SetupWizardService=t,this.$q=i,this.$timeout=r;var e=function(){var i=f.$q.defer(),n={};return t.BootstrapData&&t.BootstrapData.ProductSkuId&&t.BootstrapData.ProductSkuId!=="00000000-0000-0000-0000-000000000000"?t.Step_GetTenantLicenseBySkuId(t.BootstrapData.ProductSkuId).then(function(t){n.data=t,i.resolve(n)}):t.LoadState("SetupBannerInfo").then(function(r){r&&r.ProductSkuId&&r.ProductSkuId!=="00000000-0000-0000-0000-000000000000"?t.Step_GetTenantLicenseBySkuId(r.ProductSkuId).then(function(t){n.data=t,i.resolve(n)}):t.Step_GetTenantDefaultLicense().then(function(t){n.data=t,i.resolve(n)})}),i.promise},u=function(){var i=document.getElementById("setupGridRowsContainer").getBoundingClientRect().top+document.documentElement.scrollTop,t=$(window).height(),n=t-i-95;n<300&&(n=300),document.getElementById("setupGridRowsContainer").style.maxHeight=n.toString()+"px"},o=function(){u(),window.addEventListener("resize",function(){u()})};n.init=function(){if(n.loading=!0,!n.$root.features.SetupWizardAssignLicenses){t.Skip();return}n.users=[],n.verifying=!1,n.numChecked=0,n.numberAvailableText="",n.numberAvailableTemplateText='You have \x7b0\x7d of \x7b1\x7d licenses available.',n.numberAvailableUnlimitedTemplateText='You have unlimited licenses available.',n.productTiles=[],o(),e().then(function(i){if(n.availableUnits=i.data.AvailableUnits,n.totalUnits=i.data.TotalUnits,n.productDisplayName=i.data.ProductDisplayName,n.ProductSkuId=i.data.ProductSkuId,n.HasUnlimitedSeats=i.data.HasUnlimitedSeats,n.availableUnits===0){t.SaveState("ShowAssignLicenseText",0),t.SkipButKeepHistory();return}t.GetProductTiles(n.ProductSkuId).then(function(t){t!=null&&(t.AppIcons!=null&&angular.forEach(t.AppIcons,function(t){t!=null&&n.productTiles.push({src:t.IconUrl,title:t.ToolTip})}),t.ServiceIcons!=null&&angular.forEach(t.ServiceIcons,function(t){t!=null&&n.productTiles.push({src:t.IconUrl,title:t.ToolTip})}))}),t.Step_GetUnlicensedUsers().then(function(i){if(i!==null&&i!==undefined||n.$parent.message){if((i===null||i===undefined)&&n.$parent.message){t.SaveState("ShowAssignLicenseText",1),t.SkipButKeepHistory();return}if(i.length===0){t.SaveState("ShowAssignLicenseText",0),t.SkipButKeepHistory();return}for(var r=0;r<i.length;++r)n.users.push(i[r])}else{t.SaveState("ShowAssignLicenseText",1),t.SkipButKeepHistory();return}n.UpdateNumberAvailableText(),n.loading=!1})})},n.UpdateNumberAvailableText=function(){n.numberAvailableText=n.HasUnlimitedSeats?n.numberAvailableUnlimitedTemplateText:n.numberAvailableTemplateText.replace("{0}",n.availableUnits-n.numChecked).replace("{1}",n.totalUnits)},n.DisplayMaxLicensesWarning=function(){return!n.HasUnlimitedSeats&&n.numChecked>=n.availableUnits&&n.numChecked!==n.users.length},n.ExceedMaxLicenses=function(){return!n.HasUnlimitedSeats&&n.numChecked>n.availableUnits},n.ToggleAllUsers=function(){n.numChecked=0,angular.forEach(n.users,function(t){t.checked=n.allUsersChecked,t.checked&&(n.numChecked++,n.ExceedMaxLicenses()&&(n.numChecked--,t.checked=!1))}),n.UpdateNumberAvailableText()},n.CheckToggled=function(t){t.checked?n.numChecked++:n.numChecked--,n.ExceedMaxLicenses()&&(n.numChecked--,t.checked=!1),n.allUsersChecked=n.numChecked===n.users.length?!0:!1,n.UpdateNumberAvailableText()},n.Previous=function(){t.Previous()},n.Next=function(){n.verifying=!0,n.usersUid=[],angular.forEach(n.users,function(t){t.checked&&n.usersUid.push(t.ObjectId)}),n.usersUid.length>0?t.Step_AssignLicenses(n.ProductSkuId,n.usersUid).then(function(i){i!==null&&i!==undefined&&(n.assignLicensesFailed=!1,n.assignLicensesFailedMessage="",n.assignLicensesSkipped=!1,n.assignLicensesSkippedMessage="",angular.forEach(i,function(t){t&&t.Status!==0&&(t.Status===2?(n.assignLicensesSkippedMessage=t.Message,n.assignLicensesSkipped=!0):(t.Message!=null&&(n.assignLicensesFailedMessage=" "+t.Message),n.assignLicensesFailed=!0))}),n.assignLicensesSkipped?n.assignLicensesSkippedMessage===null||n.assignLicensesSkippedMessage===""?t.ShowMessage('Failed to assign licenses to one or more existing users. Please try again later, or go to Home \x3e Users to assign licenses after Setup.',1):t.ShowMessage(n.assignLicensesSkippedMessage,1):n.assignLicensesFailed?t.ShowMessage('Failed to assign licenses to one or more existing users. Please try again later, or go to Home \x3e Users to assign licenses after Setup.'+n.assignLicensesFailedMessage,1):(t.SaveState("ShowAssignLicenseText",0),t.Next()),r(function(){n.verifying=!1},2e3))}):t.Next()},n.Exit=function(){t.Exit()}}return n.$inject=["$scope","SetupWizardService","$q","$timeout"],n}();n.app.controller("SetupWizardAssignLicensesController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u,f){this.$rootScope=t,this.$scope=i,this.$filter=r,this.$timeout=u,this.SetupWizardService=f,i.initialing=!0;var e=function(){i.loading=!1,i.users=[],i.currentTab="email",i.sendingEmails=!1,i.loading=!0,i.activateSoftware=!1,i.emailPreview="/images/setupwizard_email_preview.png",i.EmailSentStatus=n.EmailSentStatus,f.Step_GetFeatureStates().then(function(n){i.featureStates=n,i.featureStates.ShareCredentials?f.Step_GetUsersAssignedInCurrentSession().then(function(n){n.length?f.LoadState("SetupBannerInfo").then(function(t){if(t&&(t.HasOfficeClient||t.HasProject||t.HasSkype||t.HasVisio)){i.activateSoftware=!0;switch(t.SetupBannerType){case 4:i.emailPreview="/images/setupwizard_email_preview.png";break;case 2:i.emailPreview="/images/setupwizard_email_visio_preview.png";break;case 3:i.emailPreview="/images/setupwizard_email_project_preview.png";break;case 6:i.emailPreview="/images/setupwizard_email_skype_preview.png";break;default:i.emailPreview="/images/setupwizard_email_preview.png"}}angular.forEach(n,function(n){!n.SendPasswordEmailAddress||(n.SavedSendPasswordEmailAddress=n.SendPasswordEmailAddress,n.SavedEmailSent=n.EmailSent,i.CheckEmailFormat(n))}),i.users=n,i.allUsersChecked=!1,i.ToggleAllUsers(),i.loading=!1,i.initialing=!1}):f.Skip()}):f.Skip()})};i.Print=function(){var n,t,r,u;for(f.OptionSelected(421575,"Print"),n=window.open('','_blank'),n.document.write('<html><head><title></title><style type="text/css">'),n.document.write('* { font-family: SegoeUI-Regular-final, "Segoe UI", Segoe, Tahoma, Helvetica, Arial, Sans-Serif; }'),n.document.write('.page { page-break-after: always; }'),n.document.write('li { list-style-type: none; }'),n.document.write('</style></head><body>'),t=0;t<i.users.length;++t)r=i.users[t],u=r.TempPassword||'Use existing password',n.document.write("<h2>Your Microsoft Office 365 User Credentials</h2>"),n.document.write('<ul'+(t==i.users.length-1?'':' class="page"')+'>'),n.document.write("<li>Display Name: "+HtmlEncode(r.DisplayName)+'</li>'),n.document.write("<li>User name: "+HtmlEncode(r.UserName)+'@'+r.Domain+'</li>'),n.document.write("<li>Temporary password: "+HtmlEncode(u)+'</li>'),n.document.write('</ul>');n.document.write('</body></html>'),n.document.close(),n.focus(),n.print(),n.close()},i.Download=function(){window.open("/admin/api/setupwizard/users/export","_blank")},i.CheckboxClickable=function(n){return n.SendPasswordEmailAddress&&!n.SendPasswordEmailAddressError},i.ToggleAllUsers=function(){angular.forEach(i.users,function(n){n.checked=i.allUsersChecked,i.CheckboxClickable(n)||(n.checked=!1)})},i.CheckboxClicked=function(n){i.allUsersChecked=!1,i.CheckboxClickable(n)||(n.checked=!1)},i.SendEmailButtonEnabled=function(){if(i.sendingEmails)return!1;var n=!1,t=!1,r=!1;return angular.forEach(i.users,function(i){i.SendPasswordEmailAddressError&&(t=!0),i.checked&&i.SendPasswordEmailAddress&&!i.SendPasswordEmailAddressError&&(r=!0),!i.SendPasswordEmailAddress||i.SendPasswordEmailAddressError||(n=!0)}),n&&!t&&r},i.Email=function(){var n=[];(angular.forEach(i.users,function(t){!t.SendPasswordEmailAddress||t.SendPasswordEmailAddressError||!t.checked||n.push(t)}),n.length!=0)&&(i.sendingEmails=!0,f.LoadState("SetupBannerInfo").then(function(t){var r=0;t&&(r=t.SetupBannerType),f.Step_SendPasswordEmails(n,r).then(function(t){var r,u;t.success?(r='Email successfully sent to \x7b0\x7d users. Click \x3cb\x3eNext\x3c\x2fb\x3e at the bottom of the screen to move to the next step.'.replace("{0}",n.length.toString()),f.ShowMessage(r,4)):(u='Failed to send email due to a technical error. Please use one of the other 2 share methods \x28download or print\x29.',f.ShowMessage(u,1)),t.users&&angular.forEach(i.users,function(n){angular.forEach(t.users,function(t){!n.SendPasswordEmailAddress||!t.SendPasswordEmailAddress||n.UserName!==t.UserName||(n.SavedSendPasswordEmailAddress=t.SendPasswordEmailAddress,n.EmailSent=t.EmailSent,n.SavedEmailSent=n.EmailSent)})}),i.sendingEmails=!1})}))},e(),i.CheckEmailFormat=function(n){var t=/^(?!^[.])([-'a-zA-Z0-9_]+\.)*[-'a-zA-Z0-9_]+@(?!\.+)([-a-zA-Z0-9]+\.)+[a-zA-Z]{2,}$/i;n.SendPasswordEmailAddressError=!!n.SendPasswordEmailAddress&&!t.test(n.SendPasswordEmailAddress),n.SendPasswordEmailAddressError||!n.SendPasswordEmailAddress?(!n.SendPasswordEmailAddress||n.SendPasswordEmailAddressError)&&(n.checked=!1):n.checked=!0,n.EmailSent=n.SendPasswordEmailAddress===n.SavedSendPasswordEmailAddress?n.SavedEmailSent:0},i.Previous=function(){f.Previous()},i.Next=function(){f.Next()},i.Exit=function(){f.Exit()}}return t.$inject=["$rootScope","$scope","$filter","$timeout","SetupWizardService"],t}();n.app.controller("SetupWizardShareCredentialsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;(function(n){n[n.Success=0]="Success",n[n.GeneralError=1]="GeneralError",n[n.InvalidDomainName=2]="InvalidDomainName",n[n.TldNotAvailableForSale=3]="TldNotAvailableForSale",n[n.CanOnlyBuySecondLevelDomain=4]="CanOnlyBuySecondLevelDomain",n[n.DomainExistsInAnotherTenant=5]="DomainExistsInAnotherTenant"})(n.SearchDomainResultCode||(n.SearchDomainResultCode={}));var i=n.SearchDomainResultCode,t=function(){function n(n,t,i,r){this.$scope=n,this.$timeout=t,this.SetupWizardService=i,this.HelperService=r,n.Init=function(){n.availabilityMessage=null,n.availableDomainChosen=!1,n.alternateDomains=null,n.alternateDomainChosen=null,n.domainChosen=null,n.showAlternateDomains=!1,n.domainAvailable=!1,n.checkingDomainAvailability=!1,n.savingDomainInfo=!1},n.SetDomainChosen=function(t){n.availableDomainChosen=!0,n.domainChosen=t},n.CheckDomainAvailability=function(){if(!n.checkingDomainAvailability){n.checkingDomainAvailability=!0,n.showErrorMessage=!1,n.alternateDomains=[],n.showAlternateDomains=!1;var t=n.domainName;n.availableDomainChosen=!1,n.showDomainAvailabilityMessage=!1,i.Step_CheckDomainAvailabilityForVSB(t).then(function(i){n.checkingDomainAvailability=!1,i&&i.Registrar!=undefined&&(n.chosenDomainRegistrar=i.Registrar),i&&i.IsAvailable?(n.SetDomainChosen(t),n.showDomainAvailabilityMessage=!0,n.domainAvailabilityMessage=String.format('\x7b0\x7d is available.',t)):(n.availableDomainChosen=!1,n.alternateDomainChosen=null,i&&i.Alternates&&i.Alternates.length>0&&(angular.forEach(i.Alternates,function(t){n.alternateDomains.push(t.Name)}),n.showAlternateDomains=!0),n.ShowError(i,t))})}},n.ShowError=function(t,i){var u,f;if(r.IsValid(t)){if(u=t.ResultCode,u!=0)switch(u){case 2:n.errorMessage='The domain name you entered is invalid. Please enter a valid domain name';break;case 5:n.errorMessage=String.format('Sorry, \x7b0\x7d was already added to a different Office 365 tenant. Please choose a different name',i);break;case 4:n.errorMessage='Please enter a domain name in the form of yourcompany.com';break;case 3:f=i.substr(i.lastIndexOf(".")),n.errorMessage=String.format('We don\x27t offer domains that end in \x7b0\x7d. Please try something else for the last part of your domain name',f);break;case 1:default:n.errorMessage='Something is not working. Please try refreshing the page.'}else t&&!t.IsAvailable&&(n.errorMessage=String.format('Sorry, \x7b0\x7d is already taken.',i));n.showErrorMessage=!0}},n.Previous=function(){i.Previous()},n.Next=function(){n.savingDomainInfo||(n.savingDomainInfo=!0,i.Step_SaveDomain(n.domainChosen).then(function(){i.Step_SaveDomainRegistrar(n.domainChosen,n.chosenDomainRegistrar).then(function(r){r&&i.Next(),t(function(){n.savingDomainInfo=!1},500)})}))},n.Exit=function(){i.Exit()}}return n.$inject=["$scope","$timeout","SetupWizardService","HelperService"],n}();n.app.controller("SetupWizardChooseDomainNameController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;(function(n){n[n.Success=0]="Success",n[n.GeneralError=1]="GeneralError",n[n.InvalidAddress=2]="InvalidAddress",n[n.DomainNoLongerAvailable=3]="DomainNoLongerAvailable",n[n.AcquireDomainError=4]="AcquireDomainError"})(n.PlaceOrderResultCode||(n.PlaceOrderResultCode={}));var i=n.PlaceOrderResultCode,t=function(){function n(n,t,i,r,u,f,e){function o(){f.ShowLoading(!0),t.showLegalText=!1,t.showErrorMessage=!1,t.errorMessage=null,t.loadedUserMailingAddress=!1,t.loadedUserPreferredDomain=!1,t.firstNamePlaceholderText='First name',t.lastNamePlaceholderText='Last name',e.GetUserMailingAddress(n.CurrentUserInfo.UserInfo.ObjectId).then(function(n){n?(t.showZipCodeFirst=n.ShowZipCodeFirst,t.ShowLastNameFirst=n.ShowLastNameFirst,t.name1=n.ShowLastNameFirst?n.ContactLastName:n.ContactFirstName,t.name2=n.ShowLastNameFirst?n.ContactFirstName:n.ContactLastName,t.emailAddress=n.ContactExternalEmailAddress,t.phoneNumber=n.ContactPhone,t.address1=n.ContactStreetAddress,t.address2=n.ContactStreetAddress2,t.city=n.ContactCity,t.stateOrProvince=n.ContactStateOrProvince,t.zipCode=n.ContactPostalCode,t.SetInitialInformationLoaded(!0,t.loadedUserPreferredDomain)):t.ResetInputFields()},function(){t.ResetInputFields()}),s()}this.$rootScope=n,this.$scope=t,this.$window=i,this.$timeout=r,this.HelperService=u,this.SetupWizardService=f,this.UserManagementService=e,t.SetInitialInformationLoaded=function(n,i){t.loadedUserMailingAddress=n,t.loadedUserPreferredDomain=i,t.loadedUserMailingAddress&&t.loadedUserPreferredDomain&&f.ShowLoading(!1)},t.ResetInputFields=function(){t.name1="",t.name2="",t.emailAddress="",t.phoneNumber="",t.address1="",t.address2="",t.city="",t.stateOrProvince="",t.zipCode="",t.showZipCodeFirst=!1,t.SetInitialInformationLoaded(!0,t.loadedUserPreferredDomain)};var s=function(){f.Step_GetSavedDomain().then(function(n){t.domain=n,u.IsValid(t.domain)?f.Step_GetDomainRegistrar(t.domain).then(function(n){t.domainRegistrar=n?n:null,t.SetInitialInformationLoaded(t.loadedUserMailingAddress,!0)}):t.SetInitialInformationLoaded(t.loadedUserMailingAddress,!0)})},h='Please don\x27t close your browser or refresh this page while we get everything ready.';t.countryOrRegion='US',t.ToggleShowLegalDescription=function(){t.showLegalText=!t.showLegalText},t.ShowGoDaddyTermsAndConditions=function(){i.open("../commerce/domainagree.aspx?d="+t.domain+"&r="+t.domainRegistrar+"&p=true&s=0",'_blank')},t.Previous=function(){f.IsProgressOverlayShown()||f.Previous()},t.Next=function(){if(!f.IsProgressOverlayShown()){t.showErrorMessage=!1,f.ShowProgressOverlay(!0,h);var n={ContactFirstName:t.ShowLastNameFirst?t.name2:t.name1,ContactLastName:t.ShowLastNameFirst?t.name1:t.name2,ContactExternalEmailAddress:t.emailAddress,ContactPhone:t.phoneNumber,ContactStreetAddress:t.address1,ContactStreetAddress2:t.address2,ContactCity:t.city,ContactPostalCode:t.zipCode,ContactStateOrProvince:t.stateOrProvince,ContactCountryOrRegion:{DisplayName:t.countryOrRegion}};f.Step_PurchaseFreeDomain(t.domain,t.domainRegistrar,n).then(function(n){n==0?f.NextStep():(t.showErrorMessage=!0,t.SetErrorMessage(n)),r(function(){f.ShowProgressOverlay(!1,null)},500)})}},t.SetErrorMessage=function(n){t.errorMessage=null;switch(n){case 2:t.errorMessage='One or more fields in the following address is invalid. Please enter a valid mailing address';break;case 4:t.errorMessage='Something went wrong when setting up the domain. Please try again';break;case 3:t.errorMessage='The domain you chose is no longer available. Please go back and choose a different domain name';break;case 1:default:t.errorMessage='Something is not working. Please try refreshing the page.'}},t.Exit=function(){f.IsProgressOverlayShown()||f.Exit()},o()}return n.$inject=["$rootScope","$scope","$window","$timeout","HelperService","SetupWizardService","UserManagementService"],n}();n.app.controller("SetupWizardDomainContactInfoController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){function e(){t.migrationType=null,t.migrated=!1,t.isFullDelegatedResellerDomain=!1,i.ShowLoading(!0),i.LoadState("EmailMigration").then(function(n){n?(t.migrationType=n.migrationType,t.migrated=n.migrated):(t.migrationType="noMigration",t.migrated=!1),i.Step_GetSavedDomain().then(function(n){i.Step_IsFullDelegatedResellerDomain(n).then(function(n){t.isFullDelegatedResellerDomain=n,i.ShowLoading(!1)})})})}function f(){t.isFullDelegatedResellerDomain?i.GoToStep("Feedback","Feedback"):i.Next()}this.$rootScope=n,this.$scope=t,this.SetupWizardService=i,this.$location=r,this.ConciergeIntegrationService=u,t.Previous=function(){i.Previous()},t.Next=function(){i.SaveState("EmailMigration",{migrationType:t.migrationType,migrated:t.migrationType=="doMigration"});switch(t.migrationType){case"noMigration":i.OptionSelected(416961,"SkipMigration"),f();break;case"doMigration":t.migrated?(i.OptionSelected(416962,"MigrationFinished"),f()):(i.OptionSelected(416963,"GoToMigration"),u.ClearProblemDescription(),r.path("/EmailMigration/Source"))}},t.Exit=function(){i.Exit()},e()}return n.$inject=["$rootScope","$scope","SetupWizardService","$location","ConciergeIntegrationService"],n}();n.app.controller("SetupWizardEmailMigrationController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){this.$rootScope=n,this.$scope=t,this.SetupWizardService=i,this.HelperService=r,this.ConciergeIntegrationService=u,t.init=function(n){t.ratingText=n,t.five=new Array(5),t.rating=-1,t.hovering=-1,t.comments=null,t.allowContact=!1,t.email=null,i.Step_GetAdminEmail().then(function(n){t.email=n}),t.showMigrationNextStep=i.GetCurrentStepsSet().name==="nodomain"||i.GetCurrentStepsSet().name==="BuyDomainSmb"||i.GetCurrentStepsSet().name==="buydomain"||i.GetCurrentStepsSet().name==="BuyDomainSmb"||i.GetCurrentStepsSet().name==="BuyDomainE3"||i.GetCurrentStepsSet().name==="NoDomainSmb"||i.GetCurrentStepsSet().name==="NoDomainE3"||i.GetCurrentStepsSet().name==="NoDomainSoftware"||i.GetCurrentStepsSet().name==="BuyDomainSoftware",i.LoadState("ShowAssignLicenseText").then(function(n){t.showAssignLicensesNextStep=!(n===undefined||n===null||n===0)}),i.Step_SetSessionStatus(i.BootstrapData.StoreSessionId,2)},t.StarHovered=function(n){t.hovering=n},t.StarClicked=function(n){t.rating=n,t.hovering=-1},t.GetStarStyle=function(n){return{color:t.hovering==-1?n<=t.rating?'orange':'lightgray':n<=t.hovering?'#0072c6':'lightgray'}},t.GetRatingText=function(){return t.rating==-1&&t.hovering==-1?null:t.hovering==-1?t.ratingText[t.rating]:t.ratingText[t.hovering]},t.PostRating=function(){t.rating!=-1&&i.Step_PostFeedback({Rating:t.rating+1,Comments:t.comments,AllowContact:t.allowContact,Email:t.allowContact?t.email:""})},t.PostRatingFromLink=function(){t.PostRating(),u.ClearProblemDescription()},t.Exit=function(){t.PostRating(),i.Exit()}}return n.$inject=["$rootScope","$scope","SetupWizardService","HelperService","ConciergeIntegrationService"],n}();n.app.controller("SetupWizardFeedbackController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){this.$rootScope=n,this.$scope=t,this.SetupWizardService=i,t.init=function(){t.showNext=!1,t.showAppend=!0},t.Exit=function(){i.Step_SetSessionStatus(i.BootstrapData.StoreSessionId,2).then(function(){i.Exit()})},t.AppendDataMigration=function(){i.AppendCurrentStepsSet("OwnDomainSoftwareDataMigrationSmb",i.BootstrapData.StepsSetVersion),t.showAppend=!1,t.showNext=!0},t.Next=function(){i.Next()}}return n.$inject=["$rootScope","$scope","SetupWizardService"],n}();n.app.controller("SetupWizardMidFeedbackController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r){function v(){i.protectofficeDataFormData=new n.ProtectOfficeDataDevicesModel,i.audience=n.ProtectDevicesAudience,i.showProtectOfficeDataDetails=!1,i.showControlOfficeDocuments=!1,i.loading=!0;var t=r.GetProtectOfficeDataFormData();t?i.protectofficeDataFormData=t:a(),i.loading=!1}this.$rootScope=t,this.$scope=i,this.SetupWizardService=r;var e=90,o=5,s=30,u=function(){i.protectofficeDataFormData.ProtectAgainstLostOrStolenDevices&&(i.protectofficeDataFormData.DaysOfflineBeforeWipeIsEnforced=e,i.protectofficeDataFormData.OnlyAllowOneDriveForBusinessStorage=!0,i.protectofficeDataFormData.EncryptOfficeFiles=!0)},c=function(){i.protectofficeDataFormData.ProtectAgainstLostOrStolenDevices||(i.protectofficeDataFormData.DaysOfflineBeforeWipeIsEnforced=e,i.protectofficeDataFormData.OnlyAllowOneDriveForBusinessStorage=!1,i.protectofficeDataFormData.EncryptOfficeFiles=!1)},l=function(){i.protectofficeDataFormData.ControlUsersOfficeDocsAccessOnMobileDevices&&(i.protectofficeDataFormData.PinRequiredForOfficeApps=!0,i.protectofficeDataFormData.MaxPinRetries=o,i.protectofficeDataFormData.MinutesOfIdleBeforePinRequired=s,i.protectofficeDataFormData.DoNotAllowJailbrokenOrRootedDevices=!0,i.protectofficeDataFormData.DoNotAllowCompanyCopyingFromOffice=!1)},f=function(){i.protectofficeDataFormData.ControlUsersOfficeDocsAccessOnMobileDevices||(i.protectofficeDataFormData.PinRequiredForOfficeApps=!1,i.protectofficeDataFormData.MaxPinRetries=o,i.protectofficeDataFormData.MinutesOfIdleBeforePinRequired=s,i.protectofficeDataFormData.DoNotAllowJailbrokenOrRootedDevices=!1,i.protectofficeDataFormData.DoNotAllowCompanyCopyingFromOffice=!1)},a=function(){i.protectofficeDataFormData.ProtectAgainstLostOrStolenDevices=!0,u(),i.protectofficeDataFormData.ControlUsersOfficeDocsAccessOnMobileDevices=!1,f(),i.protectofficeDataFormData.audience=i.audience.AllUsers},h=function(){var t=new n.ProtectOfficeDataDevicesModel;r.SaveState("ProtectOfficeData",{protectOfficeDataDevicesModel:i.protectofficeDataFormData})};i.ToggleProtectOfficeData=function(){i.showProtectOfficeDataDetails=i.showProtectOfficeDataDetails?!1:!0},i.ToggleControlOfficeDocs=function(){i.showControlOfficeDocuments=i.showControlOfficeDocuments?!1:!0},i.ToggleProtectOfficeDataSwitch=function(){i.protectofficeDataFormData.ProtectAgainstLostOrStolenDevices?u():(c(),i.showProtectOfficeDataDetails=!1)},i.ToggleControlOfficeDocsSwitch=function(){i.protectofficeDataFormData.ControlUsersOfficeDocsAccessOnMobileDevices?l():(f(),i.showControlOfficeDocuments=!1)},i.RestoreDefaultSettings=function(){i.protectofficeDataFormData.ProtectAgainstLostOrStolenDevices=!0,u(),i.protectofficeDataFormData.ControlUsersOfficeDocsAccessOnMobileDevices=!1,f()},i.Previous=function(){h(),r.SetProtectOfficeDataFormData(i.protectofficeDataFormData),r.Previous()},i.Next=function(){h(),r.SetProtectOfficeDataFormData(i.protectofficeDataFormData),r.Next()},i.Exit=function(){r.Exit()},v()}return t.$inject=["$rootScope","$scope","SetupWizardService"],t}();n.app.controller("SetupWizardProtectOfficeDataController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u,f,e,o,s){function y(){if(i.protectOfficeDataFormData=r.GetProtectOfficeDataFormData(),!i.protectOfficeDataFormData){r.Previous();return}i.secureWindowsDevicesFormData=new n.SecureWindowsDevicesModel,i.audience=n.ProtectDevicesAudience,i.turnOffMins=n.WindowsScreenTurnOffMins,i.showProtectWindowsDevices=!1,i.loading=!0,i.verifying=!1;var t=r.GetSecureWindowsDevicesFormData();t?i.secureWindowsDevicesFormData=t:v(),i.loading=!1}this.$rootScope=t,this.$scope=i,this.SetupWizardService=r,this.IntuneService=u,this.IntuneHelperService=f,this.HelperService=e,this.$q=o,this.$timeout=s;var c=5,h=function(){i.secureWindowsDevicesFormData.ProtectWindows10Devices&&(i.secureWindowsDevicesFormData.WindowsDefenderOn=!0,i.secureWindowsDevicesFormData.ProtectFromThreats=!0,i.secureWindowsDevicesFormData.AllowFingerprintOrFacialLogin=!0,i.secureWindowsDevicesFormData.MinutesOfIdleBeforeTurnOffScreen=c,i.secureWindowsDevicesFormData.PreventAppDownload=!1,i.secureWindowsDevicesFormData.AutoUpdateWin10Devices=!0,i.secureWindowsDevicesFormData.PreventCortanaUsage=!1,i.secureWindowsDevicesFormData.AllowRecoveryOfCorruptedData=!1)},a=function(){i.secureWindowsDevicesFormData.ProtectWindows10Devices||(i.secureWindowsDevicesFormData.WindowsDefenderOn=!1,i.secureWindowsDevicesFormData.ProtectFromThreats=!1,i.secureWindowsDevicesFormData.AllowFingerprintOrFacialLogin=!1,i.secureWindowsDevicesFormData.MinutesOfIdleBeforeTurnOffScreen=c,i.secureWindowsDevicesFormData.PreventAppDownload=!1,i.secureWindowsDevicesFormData.AutoUpdateWin10Devices=!1,i.secureWindowsDevicesFormData.PreventCortanaUsage=!1,i.secureWindowsDevicesFormData.AllowRecoveryOfCorruptedData=!1)},v=function(){i.secureWindowsDevicesFormData.ProtectWindows10Devices=!0,h(),i.secureWindowsDevicesFormData.audience=i.audience.AllUsers},l=function(){var t=new n.SecureWindowsDevicesModel;r.SaveState("SecureWindowsDevices",{secureWindowsDevicesModel:i.secureWindowsDevicesFormData})};i.ToggleProtectWindowsDevices=function(){i.showProtectWindowsDevices=i.showProtectWindowsDevices?!1:!0},i.ToggleProtectWindowsDevicesSwitch=function(){i.secureWindowsDevicesFormData.ProtectWindows10Devices?h():(a(),i.showProtectWindowsDevices=!1)},i.RestoreDefaultSettings=function(){i.secureWindowsDevicesFormData.ProtectWindows10Devices=!0,h()},i.Previous=function(){l(),r.SetSecureWindowsDevicesFormData(i.secureWindowsDevicesFormData),r.Previous()},i.Next=function(){i.verifying=!0,i.showErrorMessage=!1,l(),i.appPolicyModel={},i.devicePolicyModel={},!i.protectOfficeDataFormData||(i.appPolicyModel.ProtectAgainstLostOrStolenDevices=i.protectOfficeDataFormData.ProtectAgainstLostOrStolenDevices,i.appPolicyModel.DisplayName='Default app policy for mobile',i.appPolicyModel.DaysOfflineBeforeWipeIsEnforced=i.protectOfficeDataFormData.DaysOfflineBeforeWipeIsEnforced,i.appPolicyModel.OnlyAllowOneDriveForBusinessStorage=i.protectOfficeDataFormData.OnlyAllowOneDriveForBusinessStorage,i.appPolicyModel.EncryptOfficeFiles=i.protectOfficeDataFormData.EncryptOfficeFiles,i.appPolicyModel.ControlUsersOfficeDocsAccessOnMobileDevices=i.protectOfficeDataFormData.ControlUsersOfficeDocsAccessOnMobileDevices,i.appPolicyModel.PinRequiredForOfficeApps=i.protectOfficeDataFormData.PinRequiredForOfficeApps,i.appPolicyModel.MaxPinRetries=i.protectOfficeDataFormData.MaxPinRetries,i.appPolicyModel.MinutesOfIdleBeforePinRequired=i.protectOfficeDataFormData.MinutesOfIdleBeforePinRequired,i.appPolicyModel.DoNotAllowJailbrokenOrRootedDevices=i.protectOfficeDataFormData.DoNotAllowJailbrokenOrRootedDevices,i.appPolicyModel.DoNotAllowCompanyCopyingFromOffice=i.protectOfficeDataFormData.DoNotAllowCompanyCopyingFromOffice),i.devicePolicyModel.ProtectWindows10Devices=i.secureWindowsDevicesFormData.ProtectWindows10Devices,i.devicePolicyModel.DisplayName='Default device policy for Windows 10 devices',i.devicePolicyModel.WindowsDefenderOn=i.secureWindowsDevicesFormData.WindowsDefenderOn,i.devicePolicyModel.ProtectFromThreats=i.secureWindowsDevicesFormData.ProtectFromThreats,i.devicePolicyModel.AllowFingerprintOrFacialLogin=i.secureWindowsDevicesFormData.AllowFingerprintOrFacialLogin,i.devicePolicyModel.MinutesOfIdleBeforeTurnOffScreen=i.secureWindowsDevicesFormData.MinutesOfIdleBeforeTurnOffScreen,i.devicePolicyModel.PreventAppDownload=i.secureWindowsDevicesFormData.PreventAppDownload,i.devicePolicyModel.AutoUpdateWin10Devices=i.secureWindowsDevicesFormData.AutoUpdateWin10Devices,i.devicePolicyModel.PreventCortanaUsage=i.secureWindowsDevicesFormData.PreventCortanaUsage,i.devicePolicyModel.AllowRecoveryOfCorruptedData=i.secureWindowsDevicesFormData.AllowRecoveryOfCorruptedData,r.SetSecureWindowsDevicesFormData(i.secureWindowsDevicesFormData),u.SetupPolicies(i.appPolicyModel,i.devicePolicyModel).then(function(){r.NextStep()},function(n){e.IsValid(n.data)&&e.IsValid(n.data.Message)?r.ShowMessage(n.data.Message,2):r.ShowMessage('While doing setup, failed to create at least one policy',2),i.showErrorMessage=!0},s(function(){i.verifying=!1},2e3))},i.Exit=function(){r.Exit()},y()}return t.$inject=["$rootScope","$scope","SetupWizardService","IntuneService","IntuneHelperService","HelperService","$q","$timeout"],t}();n.app.controller("SetupWizardSecureWindowsDevicesController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function r(){}this.$rootScope=n,this.$scope=t,this.SetupWizardService=i,t.Previous=function(){i.Previous()},t.Next=function(){i.GoToStep("PurchaseDomain","PurchaseDomainForm")},t.Exit=function(){i.Exit()},r()}return n.$inject=["$rootScope","$scope","SetupWizardService"],n}();n.app.controller("SetupWizardPurchaseDomainConfirmationController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function r(){}this.$rootScope=n,this.$scope=t,this.SetupWizardService=i,t.Previous=function(){i.Previous()},t.Next=function(){i.NextStep()},t.Exit=function(){i.Exit()},r()}return n.$inject=["$rootScope","$scope","SetupWizardService"],n}();n.app.controller("SetupWizardPurchaseDomainFormController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function u(){t.loading=!0,t.userNameError=!1,t.sendingInvitation=!1,i.Step_GetSavedDomain().then(function(n){i.Step_GetDomainTakeoverData(n).then(function(i){t.domainName=n,t.userName=i.UserName,t.trackingGuid=i.TrackingGuid,t.loading=!1})})}this.$rootScope=n,this.$scope=t,this.SetupWizardService=i;var r=/^([a-zA-Z0-9'_-]\?)*[a-zA-Z0-9'_.-]+$/;t.Previous=function(){i.Previous()},t.Next=function(){if(!r.test(t.userName)){t.userNameError=!0;return}t.userNameError=!1,t.sendingInvitation=!0,i.Step_SendSignupInvitation(t.domainName,t.userName,t.trackingGuid).then(function(n){t.sendingInvitation=!1,n&&i.GoToStep(t.currentStep.name,"ExternalTakeoverCompletion")})},t.Exit=function(){i.Exit()},u()}return n.$inject=["$rootScope","$scope","SetupWizardService"],n}();n.app.controller("SetupWizardExternalTakeoverIntroductionController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f){function e(){t.loading=!0,u.Step_GetSavedDomain().then(function(n){u.Step_GetDomainTakeoverData(n).then(function(n){t.emailAddress=n.UserName+"@"+n.DomainName,t.loading=!1})})}this.$rootScope=n,this.$scope=t,this.$window=i,this.$location=r,this.SetupWizardService=u,this.UserManagementService=f,t.Previous=function(){u.Previous()},t.Signout=function(){u.Step_SetSessionStatus(u.BootstrapData.StoreSessionId,3).then(function(){u.Exit();var t=r.path();f.SignOut(t).then(function(n){i.location.href=n.data})})},e()}return n.$inject=["$rootScope","$scope","$window","$location","SetupWizardService","UserManagementService"],n}();n.app.controller("SetupWizardExternalTakeoverCompletionController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f){this.$rootScope=n,this.$scope=t,this.SetupWizardService=i,this.DomainService=r,this.$timeout=u,this.HelperService=f,t.DomainType={OwnDomain:"owndomain",BuyDomain:"buydomain",NoDomain:"nodomain"},t.init=function(n){t.strings=n,t.domainType=null,t.ownDomain=null,t.ownDomainError=null,t.ownDomainChecking=!1,t.buyDomain=null,t.buyDomainChecking=!1,t.isEligibleForFreeDomain=!1,t.ownDomainHelptext='\x40SetupWizardSelectDomainTypeForm_Tooltip_owndomainInput',t.ownDomainEmailAddressHint='Your users\x27 email addresses will look like this\x3a username\x40\x7b0\x7d',t.ownDomainHelptextExists=t.ownDomainHelptext.charAt(0)!=='@',t.onMicrosoftDomain=null,t.onMicrosoftDomainLoaded=!1,i.Step_GetCurrentOnMicrosoftDomain().then(function(n){t.onMicrosoftDomain=n,i.BootstrapData.OnMSDomainName=n,t.onMicrosoftDomainLoaded=!0}),t.savingDomain=!1,i.ShowLoading(!0),i.LoadState("SetupBannerInfo").then(function(n){n&&(t.isEligibleForFreeDomain=n.IsEligibleForFreeDomain,n.SetupBannerType===8?f.IsValid(i.BootstrapData.SoftwareChoice)?i.BootstrapData.SoftwareChoice==0?t.DomainType={OwnDomain:"OwnDomainE3",BuyDomain:"BuyDomainE3",NoDomain:"NoDomainE3"}:i.BootstrapData.SoftwareChoice==1&&(t.DomainType={OwnDomain:"OwnDomainSoftwareE3",BuyDomain:"BuyDomainSoftwareE3",NoDomain:"NoDomainSoftwareE3"}):i.LoadState("E3Choice").then(function(n){!n||(n.softwareChoice==0?t.DomainType={OwnDomain:"OwnDomainE3",BuyDomain:"BuyDomainE3",NoDomain:"NoDomainE3"}:n.softwareChoice==1&&(t.DomainType={OwnDomain:"OwnDomainSoftwareE3",BuyDomain:"BuyDomainSoftwareE3",NoDomain:"NoDomainSoftwareE3"}))}):n.SetupBannerType===7?f.IsValid(i.BootstrapData.SoftwareChoice)?i.BootstrapData.SoftwareChoice==0?t.DomainType={OwnDomain:"OwnDomainSmb",BuyDomain:"BuyDomainSmb",NoDomain:"NoDomainSmb"}:i.BootstrapData.SoftwareChoice==1&&(t.DomainType={OwnDomain:"OwnDomainSoftwareSmb",BuyDomain:"BuyDomainSoftwareSmb",NoDomain:"NoDomainSoftwareSmb"}):i.LoadState("SmbChoice").then(function(n){!n||(n.softwareChoice==0?t.DomainType={OwnDomain:"OwnDomainSmb",BuyDomain:"BuyDomainSmb",NoDomain:"NoDomainSmb"}:n.softwareChoice==1&&(t.DomainType={OwnDomain:"OwnDomainSoftwareSmb",BuyDomain:"BuyDomainSoftwareSmb",NoDomain:"NoDomainSoftwareSmb"}))}):n.SetupBannerType===10?t.DomainType={OwnDomain:"OwnDomainBcs",BuyDomain:"BuyDomainBcs",NoDomain:"NoDomainBcs"}:n.SetupBannerType===1&&(n.HasOfficeClient||n.HasProject||n.HasVisio||n.HasSkype)?t.DomainType={OwnDomain:"OwnDomainSoftware",BuyDomain:"BuyDomainSoftware",NoDomain:"NoDomainSoftware"}:n.SetupBannerType===6&&(t.DomainType={OwnDomain:"OwnDomainSkype",BuyDomain:"BuyDomainSkype",NoDomain:"NoDomainSkype"}))}),i.Step_GetSavedDomain().then(function(n){i.LoadState("SelectDomainType").then(function(r){!r||(r.domainType==t.DomainType.BuyDomain?t.buyDomain=n:r.domainType==t.DomainType.OwnDomain&&(t.ownDomain=n,t.emailAddressHint=t.ownDomainEmailAddressHint.replace("{0}",t.ownDomain))),t.domainType=t.isEligibleForFreeDomain?t.DomainType.BuyDomain:r&&r.domainType?r.domainType:t.DomainType.OwnDomain,i.ShowLoading(!1)})})},t.$watch('domainType',function(){t.domainType&&(t.ownDomainError=null,t.buyDomainError=null,i.SetCurrentStepsSet(t.domainType,i.BootstrapData.StepsSetVersion))},!0),t.NextButtonEnabled=function(){return(t.domainType==t.DomainType.NoDomain&&t.onMicrosoftDomainLoaded||t.domainType==t.DomainType.OwnDomain&&!!t.ownDomain&&!t.ownDomainError||t.domainType==t.DomainType.BuyDomain)&&!t.ownDomainChecking&&!t.ownDomainChecking&&!t.buyDomainChecking&&!t.savingDomain};var e=function(n){i.SaveState("SelectDomainType",{domainType:n}),i.SaveState("EmailMigration",null),i.SaveState("SelectSetupType",null),i.SaveState("VerifyDomain",null),i.SetGoDaddyState(null)};t.UpdateHint=function(){t.emailAddressHint=t.ownDomainEmailAddressHint.replace("{0}",t.ownDomain)},t.Next=function(){if(t.NextButtonEnabled()){var n=angular.copy(t.domainType),r=n==t.DomainType.NoDomain?t.onMicrosoftDomain:n==t.DomainType.BuyDomain?t.buyDomain:t.ownDomain;t.savingDomain=n!==t.DomainType.BuyDomain,i.BeginSession(r).then(function(){switch(n){case t.DomainType.OwnDomain:t.ownDomainChecking=!0,e(n),t.savingDomain=!1,i.Step_ValidateDomain(t.ownDomain).then(function(n){if(n.Result!=0){t.ownDomainError=n.Message,u(function(){t.ownDomainChecking=!1},500);return}i.Step_IsSecondLevelDomain(t.ownDomain).then(function(n){if(!t.$root.features.SetupWizardSupportSubdomain&&!n){t.ownDomainError=t.strings.InvalidDomainName,u(function(){t.ownDomainChecking=!1},500);return}i.Step_CheckDomainAvailability(t.ownDomain).then(function(r){if(r){t.ownDomainError=t.strings.DomainNotRegistered,u(function(){t.ownDomainChecking=!1},500);return}i.OptionSelected(416973,"BringYourOwnDomain"),i.BootstrapData.OwnDomainName&&i.BootstrapData.OwnDomainName.toLocaleLowerCase()==t.ownDomain.toLocaleLowerCase()||(i.BootstrapData.OwnDomainName=t.ownDomain,i.BootstrapData.OwnDomainContactInfo=null),i.Step_OwnedDomainCheck(t.ownDomain).then(function(r){r.Status===2?(t.ownDomainError=r.ErrorMessage,u(function(){t.ownDomainChecking=!1},500)):r.Status===3?i.GoToStep(t.currentStep.name,"ExternalTakeoverIntroduction"):r.Status===0?i.NextStep():i.Step_GetFeatureStates().then(function(r){if(!r){i.GoToStep(t.currentStep.name,"VerifyDomainTxtRecord");return}r.VerifyDomainByEmail&&n?i.BootstrapData.OwnDomainContactInfo?i.GoToStep(t.currentStep.name,"VerifyDomain"):i.Step_GetDomainContacts(t.ownDomain).then(function(n){!!n&&n.length>0&&(i.BootstrapData.OwnDomainContactInfo=n.join(', ')),i.BootstrapData.OwnDomainContactInfo!=null?i.GoToStep(t.currentStep.name,"VerifyDomain"):r.GoDaddyIntegration?i.Step_GetDomainRegistrarDetails(t.ownDomain).then(function(n){n.IsGoDaddy?i.GoToStep(t.currentStep.name,"VerifyDomain"):i.GoToStep(t.currentStep.name,"VerifyDomainTxtRecord")}):i.GoToStep(t.currentStep.name,"VerifyDomainTxtRecord")}):r.GoDaddyIntegration?i.Step_GetDomainRegistrarDetails(t.ownDomain).then(function(n){n.IsGoDaddy?i.GoToStep(t.currentStep.name,"VerifyDomain"):i.GoToStep(t.currentStep.name,"VerifyDomainTxtRecord")}):i.GoToStep(t.currentStep.name,"VerifyDomainTxtRecord")})})})})});break;case t.DomainType.BuyDomain:t.buyDomainChecking=!0,e(n),i.OptionSelected(424396,"BuyDomain"),i.NextStep();break;case t.DomainType.NoDomain:e(n),i.OptionSelected(416974,"OnMicrosoftDomain"),i.NextStep()}})}},t.Exit=function(){i.SaveState("SelectDomainType",{domainType:t.domainType}),i.Exit()}}return n.$inject=["$rootScope","$scope","SetupWizardService","DomainService","$timeout","HelperService"],n}();n.app.controller("SetupWizardSelectDomainTypeController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f,e){var o,s;this.$rootScope=n,this.$scope=t,this.$http=i,this.$modal=r,this.$location=u,this.$compile=f,this.$timeout=e,o=function(n,t,i){var r={row:t.row,col:t.col,sizeX:i,sizeY:1};return t.col<n-t.sizeX?r.col+=t.sizeX:(r.row+=1,r.col=0),r},n.Dashboard={},t.colWidth=310,t.leftnavWidth=300,n.Dashboard.cols=Math.floor(($(window).width()-t.leftnavWidth)/t.colWidth),t.gridsterOpts={columns:n.Dashboard.cols,pushing:!1,floating:!1,swapping:!0,width:'auto',colWidth:t.colWidth,rowHeight:'245',margins:[10,10],outerMargin:!0,isMobile:!1,mobileBreakPoint:600,mobileModeEnabled:!0,minColumns:2,minRows:1,maxRows:3,defaultSizeX:1,defaultSizeY:1,minSizeX:1,maxSizeX:2,minSizeY:1,maxSizeY:1,resizable:{enabled:!1,handles:['n','e','s','w','ne','se','sw','nw'],start:function(){},resize:function(){},stop:function(){}},draggable:{enabled:!1,handle:'.my-class',start:function(){},drag:function(){},stop:function(){}}},n.ResetGridsterProperties=function(){t.showCover=!1,n.SelectedWidgets=[]},t.LogWidgetHeaderClick=function(n){O365.Instrument.ClientInstrument.getInstance().logClick($(n.currentTarget))},t.init=function(){t.$emit("autoscrolltotop"),(t.isGridsterPropertiesSet===undefined||t.isGridsterPropertiesSet===!1)&&(n.ResetGridsterProperties(),n.setGridsterPropertiesFromConfig())},s=function(t,i,r,u){var e,s,o,f;if(t===undefined){for(f=0;f<r.length;f++)f===0?e={sizeX:1,sizeY:1,row:0,col:0}:(s=1,e=1),n[r[f]]=e,console.log(r[f],e);for(o=0;o<u.length;o++)n[u[o]]={}}else for(f=0;f<i.length;f++)t[i[f]]!=undefined&&t[i[f]].row!=undefined?(n[i[f]]=t[i[f]],console.log("WidgetId: "+i[f]+", position - row: "+t[i[f]].row+" col: "+t[i[f]].col)):n[i[f]]={}}}return n.$inject=["$rootScope","$scope","$http","$modal","$location","$compile","$timeout"],n}();n.SetupWizardSmbChoiceController=t,n.app.controller("SetupWizardSmbChoiceController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){function o(){t.setupType=null,t.isFullDelegationAllowed=!1,t.isPartialDelegationAllowed=!1,t.isGoDaddyDomain=!1,t.featureStates={},t.domain=null,t.goDaddyAttempts=0,t.goDaddyLoginWindow=null,t.savedGoDaddyAuthCode=null,t.goDaddyDomainSigninUrl=null,t.verifying=!1,i.ShowLoading(!0),i.Step_GetSavedDomain().then(function(n){t.domain=n,i.Step_GetFeatureStates().then(function(r){t.featureStates=r,i.Step_GetDomainRegistrarDetails(n).then(function(r){t.isGoDaddyDomain=r.IsGoDaddy,t.goDaddyDomainSigninUrl=r.AuthorizationUrl,t.isGoDaddyDomain&&t.ShowGoDaddyOption()&&i.GetGoDaddyState().then(function(n){!!n&&n.AuthCode&&(t.savedGoDaddyAuthCode=n.AuthCode)}),i.Step_GetDomainDelegationModel(n).then(function(n){t.DomainDelegationModel=n,t.isFullDelegationAllowed=t.DomainDelegationModel!=null&&t.DomainDelegationModel.RequiredDelegation!=2,t.isPartialDelegationAllowed=t.DomainDelegationModel!=null&&t.DomainDelegationModel.RequiredDelegation!=1,t.genericRequirementReason='\x28Not supported for your domain type\x29',t.requirementReason=t.DomainDelegationModel!=null&&t.DomainDelegationModel.RequirementReason!=null?t.DomainDelegationModel.RequirementReason:t.genericRequirementReason;var r=!1;i.LoadState("SelectSetupType").then(function(n){if(!n)t.ShowGoDaddyOption()?t.setupType=f.SetupForMeGoDaddy:t.isFullDelegationAllowed?t.setupType=f.SetupForMe:(t.setupType=f.ManageMyself,t.$root.features.SetupWizardSkipSelectDns&&(r=!0,t.Next()));else switch(n.setupType){case f.SetupForMe:t.setupType=t.ShowGoDaddyOption()?f.SetupForMeGoDaddy:t.isFullDelegationAllowed?f.SetupForMe:f.ManageMyself;break;case f.SetupForMeGoDaddy:t.setupType=t.ShowGoDaddyOption()?f.SetupForMeGoDaddy:f.SetupForMe;break;case f.ManageMyself:t.setupType=f.ManageMyself,t.$root.features.SetupWizardSkipSelectDns&&!t.isFullDelegationAllowed&&(r=!0,t.Next())}r||i.ShowLoading(!1)})})})})})}function e(n){t.verifying=!0,i.Step_VerifyGoDaddyDnsRecordSettings(t.domain,n).then(function(n){n&&(n.IsVerified?(i.OptionSelected(416975,"GoDaddy"),i.Step_MarkSetupCompleted(t.domain).then(function(){i.NextStep()})):(i.SaveState("godaddystate",null),i.ShowMessage(n.VerifyMessage,2))),r(function(){t.verifying=!1},500)})}this.$rootScope=n,this.$scope=t,this.SetupWizardService=i,this.$timeout=r,this.$window=u;var f={SetupForMe:"setupForMe",SetupForMeGoDaddy:"setupForMeGoDaddy",ManageMyself:"manageMyself"};t.ShowGoDaddyOption=function(){return t.isGoDaddyDomain&&t.featureStates.GoDaddyIntegration},u.AcceptAuthCode=function(n){t.verifying=!0,t.goDaddyLoginWindow&&(t.goDaddyLoginWindow.close(),t.goDaddyLoginWindow=null);var u=n.AuthCode;u!=null?(e(u),i.SetGoDaddyState({AuthCode:u})):t.setupType=f.ManageMyself},t.Previous=function(){i.Previous()},t.Next=function(){if(!t.verifying){i.SaveState("SelectSetupType",{setupType:t.setupType});switch(t.setupType){case f.SetupForMeGoDaddy:t.goDaddyAttempts++,t.goDaddyAttempts!=1||!t.savedGoDaddyAuthCode?t.goDaddyLoginWindow=u.open(t.goDaddyDomainSigninUrl,"_blank","height=580,width=750"):e(t.savedGoDaddyAuthCode);break;case f.SetupForMe:i.OptionSelected(416976,"NameServers"),t.$root.features&&t.$root.features.EnableNewDomainFullDelegationStep?i.GoToStep(t.currentStep.name,"AddWebsiteRecords"):i.GoToStep(t.currentStep.name,"UpdateNameServers");break;case f.ManageMyself:i.OptionSelected(416977,"DnsRecords"),!t.$root.features.SetupWizardSkipSelectDns||t.isFullDelegationAllowed||t.ShowGoDaddyOption()?i.GoToStep(t.currentStep.name,"AddDnsRecords"):i.GoToStepButSkip(t.currentStep.name,"AddDnsRecords")}}},t.Exit=function(){i.Exit()},o()}return n.$inject=["$rootScope","$scope","SetupWizardService","$timeout","$window"],n}();n.app.controller("SetupWizardSelectSetupTypeController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){function o(){t.formData={},t.DomainDNSLoaded=!1,t.domain=null,t.registrar=null,t.loading=!0,i.Step_GetSavedDomain().then(function(n){t.domain=n,f(!1),i.BootstrapData.SavedRegistrar!==null?t.registrar=i.BootstrapData.SavedRegistrar:i.Step_GetDomainRegistrar(n).then(function(n){t.registrar=i.Step_GetPopularRegistrar(n),i.BootstrapData.SavedRegistrar=t.registrar,t.UpdateConciergeProblemDescription()})})}function f(n){t.DomainDNS=null,u.GetDomainDns(t.domain,"Full",!0).then(function(i){t.DomainDNS=i.data,t.DomainDNSLoaded=!0,t.loading=!1,n||(t.showDnsSection={},t.DomainDNS.forEach(function(n){n.IsAddable&&(t.showDnsSection[n.ServiceName]=!0)}))},function(n){i.ShowMessage(n.data,2),t.DomainDNSLoaded=!0})}function e(n){for(var t in n)i.ShowMessage(n[t][0],2)}this.$rootScope=n,this.$scope=t,this.SetupWizardService=i,this.$timeout=r,this.domainService=u,t.RecordTypeList=[{Name:'TXT \x28Text\x29',Value:"TXT"},{Name:'CNAME \x28Alias\x29',Value:"CNAME"},{Name:'A \x28Address\x29',Value:"A"},{Name:'AAAA \x28IPv6 Address\x29',Value:"AAAA"}],t.RecordTtlList=[{Name:'1 Hour',Value:3600},{Name:'1 Day',Value:86400},{Name:'1 Week',Value:604800}],t.$on('updatednsrecords',function(n,r){r.action=='save'?i.ShowMessage('Custom record saved successfully.',4):r.action=='delete'&&i.ShowMessage('Custom record deleted successfully.',4),t.DomainDNSLoaded=!1,f(!0)}),t.AddRecord=function(n,r){if(t.loading=!0,!r.Type||!r.HostName||!r.Value||!r.TtlValue){t.loading=!1,i.ShowMessage('Please provide all required fields.',2);return}u.SaveCustomDnsRecord(n,r).then(function(){t.loading=!1;var r={domainName:n,action:"save"};t.$emit('updatednsrecords',r),t.formData={}},function(n){t.loading=!1,e(n.data.ModelState)})},t.RemoveRecord=function(n,i){t.loading=!0,u.RemoveCustomDnsRecord(n,i).then(function(){t.loading=!1;var r={domainName:n,action:"delete"};t.$emit('updatednsrecords',r)},function(n){t.loading=!1,e(n.data.ModelState)})},t.Previous=function(){i.Previous()},t.Next=function(){i.GoToStep(t.currentStep.name,"UpdateNameServers")},t.Exit=function(){i.Exit()},o()}return n.$inject=["$rootScope","$scope","SetupWizardService","$timeout","DomainService"],n}();n.app.controller("SetupWizardAddWebsiteRecordsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){function u(){t.domain=null,t.registrar=null,t.instructionsLink=null,t.nameservers=null,t.verified=!1,t.verifying=!1,t.loading=!0,t.firstRun=!0,t.showVerifyDnsError=!1,i.Step_GetSavedDomain().then(function(n){t.domain=n,i.Step_GetDomainRegistrar(n).then(function(r){t.registrar=i.Step_GetPopularRegistrar(r),i.BootstrapData.SavedRegistrar=t.registrar,t.UpdateConciergeProblemDescription(),i.Step_GetInstructionsLink(n,r,5).then(function(n){t.instructionsLink=n})}),i.Step_VerifyNameserverSettings(n).then(function(n){t.loading=!1,n!=null?(t.verified=n.IsVerified,t.nameservers=n.DnsRecordsHealthResult):t.showVerifyDnsError=!0}).then(function(){t.verified&&(t.firstRun=!1,i.Step_MarkSetupCompleted(t.domain).then(i.NextStep()))})})}this.$rootScope=n,this.$scope=t,this.SetupWizardService=i,this.$timeout=r,t.Previous=function(){i.Previous()},t.Next=function(){if(t.verified){i.NextStep();return}t.verifying=!0,t.firstRun=!1,i.Step_VerifyNameserverSettings(t.domain).then(function(n){n!=null?(t.showVerifyDnsError=!1,n.IsVerified?i.Step_MarkSetupCompleted(t.domain).then(i.NextStep()):(i.ShowMessage(n.VerifyMessage,2),t.nameservers=n.DnsRecordsHealthResult)):t.showVerifyDnsError=!0,r(function(){t.verifying=!1},500)})},t.Exit=function(){i.Exit()},u()}return n.$inject=["$rootScope","$scope","SetupWizardService","$timeout"],n}();n.app.controller("SetupWizardUpdateNameServersController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f,e,o,s){this.$rootScope=n,this.$scope=t,this.$filter=i,this.$timeout=r,this.$interval=u,this.SetupWizardService=f,this.$q=e,this.HelperService=o,this.UserManagementService=s,t.init=function(n){t.formData={UserObjectIds:[],DomainName:null},t.strings=n,t.skipValidating=!1,t.users=[],t.sku=null,t.maxUsers=0,t.loading=!0,t.domain=null,t.verifying=!1,t.featureStates=null,t.purchasing=!1,t.purchaseUserTimer=null,t.totalUnits=0,t.productDisplayName=null,t.updated=!1,t.numberOfUpdatedUsers=0,t.currentUPN=null,t.newUPN=null,t.logoutURL=null,t.userNameRegex=/^([a-zA-Z][\w\.-]*[a-zA-Z0-9])@[a-zA-Z0-9][\w\.-]*[a-zA-Z0-9]\.[a-zA-Z][a-zA-Z\.]*[a-zA-Z]$/g,t.enableBack=!0,f.ShowLoading(!0),f.Step_GetSavedDomain().then(function(n){t.domain=n,t.formData.DomainName=n,t.domain||f.Step_GetCurrentOnMicrosoftDomain().then(function(n){t.domain=n,f.BeginSession(t.domain),t.formData.DomainName=t.domain}),f.Step_GetUsers().then(function(n){t.users=n,t.CreateUserIDAfterUpdate(),f.ShowLoading(!1),t.loading=!1})})},t.Previous=function(){o.IsValid(t.steps[0])&&t.steps[0].name==="VsbDomain"&&f.BackToStep("VsbDomain","SelectDomainType")},t.CreateUserIDAfterUpdate=function(){for(var n,r,i=0;i<t.users.length;i++)n=t.users[i],r=new RegExp(t.userNameRegex).exec(n.UserPrincipalName)[1],n.NewUserID=r+"@"+t.domain,s.IsSelfUser(n.UserPrincipalName)&&(t.currentUPN=n.UserPrincipalName,t.newUPN=n.NewUserID),t.formData.UserObjectIds.push(n.ObjectId)},t.NextButtonEnabled=function(){return t.loading?!1:!0},t.Next=function(){t.NextButtonEnabled()&&s.SignOut("/setupwizard").then(function(n){t.logoutURL=n,s.UpdateUserDomain(t.formData).then(function(n){n.data&&n.data.length>0&&(t.numberOfUpdatedUsers=n.data.length,t.updated=!0,t.enableBack=!1)})})},t.Exit=function(){window.location.href=t.logoutURL}}return n.$inject=["$rootScope","$scope","$filter","$timeout","$interval","SetupWizardService","$q","HelperService","UserManagementService"],n}();n.app.controller("SetupWizardUpdateUsersController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){function e(n){t.verifying=!0,i.Step_VerifyGoDaddyDomainOwnership(t.domain,n).then(function(n){n.IsVerified?(i.OptionSelected(416978,"GoDaddy"),i.NextStep()):i.ShowMessage(n.VerifyMessage,2),r(function(){t.verifying=!1},500)})}this.$rootScope=n,this.$scope=t,this.SetupWizardService=i,this.$timeout=r,this.$window=u;var f={Email:"email",GoDaddy:"godaddy",TxtRecord:"txtRecord"};t.init=function(n){t.strings=n,t.featureStates={},t.verificationType=null,t.domain=null,t.isGoDaddyDomain=!1,t.goDaddyAttempts=0,t.goDaddyLoginWindow=null,t.savedGoDaddyAuthCode=null,t.goDaddyDomainSigninUrl=null,t.domainContacts=null,t.domainContactsLoading=!1,t.verificationCode=null,t.sendingVerificationCode=!1,t.verificationCodeVerifying=!1,t.verifying=!1,t.error=null,i.ShowLoading(!0),i.Step_GetSavedDomain().then(function(n){t.domain=n,t.domainContacts=i.BootstrapData.OwnDomainContactInfo,i.Step_GetFeatureStates().then(function(r){t.featureStates=r,i.Step_GetDomainRegistrarDetails(n).then(function(n){t.isGoDaddyDomain=n.IsGoDaddy,t.goDaddyDomainSigninUrl=n.AuthorizationUrl,t.isGoDaddyDomain&&t.ShowGoDaddyOption()&&i.GetGoDaddyState().then(function(n){!!n&&n.AuthCode&&(t.savedGoDaddyAuthCode=n.AuthCode)}),i.LoadState("VerifyDomain").then(function(n){if(!n)t.verificationType=t.ShowGoDaddyOption()?f.GoDaddy:t.featureStates.VerifyDomainByEmail?f.Email:f.TxtRecord;else switch(n.verificationType){case f.Email:t.verificationType=t.featureStates.VerifyDomainByEmail?f.Email:f.TxtRecord;break;case f.GoDaddy:t.verificationType=t.ShowGoDaddyOption()?f.GoDaddy:f.TxtRecord;break;case f.TxtRecord:t.verificationType=f.TxtRecord}i.ShowLoading(!1)})}),t.featureStates.VerifyDomainByEmail&&!i.BootstrapData.OwnDomainContactInfo&&t.GetDomainContacts()})})},t.GetDomainContacts=function(){t.domainContactsLoading=!0,i.Step_GetDomainContacts(t.domain).then(function(n){!!n&&n.length>0&&(t.domainContacts=n.join(', '),i.BootstrapData.OwnDomainContactInfo=t.domainContacts),t.domainContactsLoading=!1})},t.SendVerificationCode=function(){t.sendingVerificationCode=!0,i.Step_SendVerificationCode(t.domain).then(function(){i.ShowMessage(t.strings.CodeSent+" "+t.domainContacts,0),t.sendingVerificationCode=!1})},t.ShowGoDaddyOption=function(){return t.isGoDaddyDomain&&t.featureStates.GoDaddyIntegration},t.Previous=function(){i.Previous()},u.AcceptAuthCode=function(n){t.verifying=!0,t.goDaddyLoginWindow&&(t.goDaddyLoginWindow.close(),t.goDaddyLoginWindow=null);var u=n.AuthCode;u!=null?(e(u),i.SetGoDaddyState({AuthCode:u})):t.verificationType=f.TxtRecord},t.Next=function(){if(!t.verifying){i.SaveState("VerifyDomain",{verificationType:t.verificationType});switch(t.verificationType){case f.GoDaddy:t.goDaddyAttempts++,t.goDaddyAttempts!=1||!t.savedGoDaddyAuthCode?t.goDaddyLoginWindow=u.open(t.goDaddyDomainSigninUrl,"_blank","height=580,width=750"):e(t.savedGoDaddyAuthCode);break;case f.Email:if(t.error=null,!t.verificationCode){t.error=t.strings.CodeMissing;return}t.verifying=!0,t.verificationCodeVerifying=!0,i.Step_VerifyDomainOwnership(t.domain,t.verificationCode).then(function(n){r(function(){t.verifying=!1,t.verificationCodeVerifying=!1},500),n.IsVerified?(i.OptionSelected(416979,"Email"),i.NextStep()):t.error=n.VerifyMessage});break;case f.TxtRecord:i.OptionSelected(416980,"TxtOrMx"),i.GoToStep(t.currentStep.name,"VerifyDomainTxtRecord")}}},t.Exit=function(){i.Exit()}}return n.$inject=["$rootScope","$scope","SetupWizardService","$timeout","$window"],n}();n.app.controller("SetupWizardVerifyDomainController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){function s(){t.domain=null,t.registrar=null,t.registrars=null,t.records=null,t.isVerified=!1,t.verifyType="txt",t.showRegistrarsDropdown=!1,t.verifying=!1,t.registrars=i.Step_GetPopularRegistrarsCompleteInfo(),i.Step_GetSavedDomain().then(function(n){t.domain=n,i.BootstrapData.SavedRegistrar!==null?t.registrar=i.BootstrapData.SavedRegistrar:i.Step_GetDomainRegistrar(n).then(function(n){t.registrar=i.Step_GetPopularRegistrar(n),i.BootstrapData.SavedRegistrar=t.registrar,t.UpdateConciergeProblemDescription()}),f()})}function h(){t.VerificationMissingRecords=!1,t.VerificationDataChanged=!1,t.ActualDnsRecords=null,t.DnsHealthyList=null}var f,o,e;this.$rootScope=n,this.$scope=t,this.SetupWizardService=i,this.$timeout=r,this.domainService=u,f=function(){return i.Step_GetDomainVerificationData(t.domain).then(function(n){t.records=n.Records,t.isVerified=n.IsVerified,t.isVerified||t.records==null||(t.VerificationDataChanged=t.PreviousVerificationTXTRecord!=null&&t.records.TXTRecord.Data.Value!=t.PreviousVerificationTXTRecord,t.PreviousVerificationTXTRecord=t.records.TXTRecord.Data.Value)})},o=function(){return u.GetActualVerificationDnsRecords(t.domain).then(function(n){t.ActualDnsRecords=n.data.Data},function(n){console.error(n)})},t.ShowRegistrarsDropdown=function(n){t.showRegistrarsDropdown=n},t.SelectRegistrar=function(n){t.registrar=n,i.BootstrapData.SavedRegistrar=t.registrar,t.UpdateConciergeProblemDescription(i.BootstrapData.LastError),t.ShowRegistrarsDropdown(!1),i.Step_SaveDomainRegistrar(t.domain,t.registrar.RegistrarName)},e=function(n){i.SetGoDaddyState(null),i.ShowMessage(n.VerifyMessage,2),r(function(){t.verifying=!1},500)},t.Previous=function(){i.Previous()},t.Next=function(){t.isVerified?i.NextStep():(t.verifying=!0,h(),i.Step_VerifyDomainTxtOrMxRecord(t.domain).then(function(n){n.IsVerified?(t.verifying=!1,i.NextStep()):f().then(function(){t.VerificationMissingRecords=n.VerifyErrorType==="VerificationMissingRecordsAlert",t.VerificationMissingRecords&&t.$root.features&&t.$root.features.ShowCurrentVericationDns?o().then(function(){e(n)}):e(n)})}))},t.Exit=function(){i.Exit()},t.$watchGroup(['records','ActualDnsRecords'],function(){t.DnsHealthyList=u.generateHealthModel(t.ActualDnsRecords,t.records)}),s()}return n.$inject=["$rootScope","$scope","SetupWizardService","$timeout","DomainService"],n}();n.app.controller("SetupWizardVerifyDomainTxtRecordController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){this.$rootScope=n,this.$scope=t,this.SetupWizardService=i,this.$window=r,t.Initializing=!0;var u=function(){t.InstallModel={},t.InstallModel.Valid=!1,t.InstallModel.loading=!0,i.Step_GetIsAoboScenario().then(function(n){n?i.Skip():(t.Initializing=!1,i.LoadState("SetupBannerInfo").then(function(n){i.Step_GetUserProductsModel(n.ProductSkuId).then(function(r){r&&(r.IsSelected||r.HasUnlimitedSeats||r.AvailableUnits>0)?(t.InstallModel.HasOfficeClient=n.HasOfficeClient,t.InstallModel.HasSkype=n.HasSkype,t.InstallModel.HasProject=n.HasProject,t.InstallModel.HasVisio=n.HasVisio,t.InstallModel.ProductSkuId=n.ProductSkuId,i.Step_GetSoftwareInstallData().then(function(n){t.InstallModel.InstallData=n,t.InstallModel.Valid=!0,t.InstallModel.loading=!1})):i.Skip()})}))})};t.OfficeInstallButton=function(n){if(t.InstallModel.InstallData[n]){var u=r.open("../AdminPortal/SetupWizard/SetupLoading","_blank");i.Step_SetCurrentUserLicense(t.InstallModel.ProductSkuId).then(function(i){i?u.location.href=t.InstallModel.InstallData[n]:u.close()})}},t.Previous=function(){i.Previous()},t.Next=function(){i.Next()},t.Exit=function(){i.Exit()},u()}return n.$inject=["$rootScope","$scope","SetupWizardService","$window"],n}();n.app.controller("SetupWizardAdminInstallController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){this.$rootScope=n,this.$scope=t,this.SetupWizardService=i,this.$window=r,this.SendSMSService=u,t.Initializing=!0;var f=function(){t.AppPictures=[],t.PhoneNumber="",t.textSending=!1,i.Step_GetIsAoboScenario().then(function(n){n?i.Skip():(t.Initializing=!1,t.AppPictures.push('~/Smb/images/icon-invoice.png'),t.AppPictures.push('~/Smb/images/icon-bookings.png'),t.AppPictures.push('~/Smb/images/icon-connections.png'))})};t.SendText=function(){t.textSending=!0,t.WasTextSent=!1,u.SendSMS(t.PhoneNumber,"SMBAppDownloadSource","SmbSetup").then(function(n){var r,u;n.data?(t.textSending=!1,r='Mobile App Download link successfully sent\x21',i.ShowMessage(r,4)):(t.textSending=!1,u='Failed to send app download link. Please enter a valid mobile number and try again. ',i.ShowMessage(u,1))},function(){t.textSending=!1;var r='Failed to send app download link. Please enter a valid mobile number and try again. ';i.ShowMessage(r,1)})},t.SendTextButtonEnabled=function(){return t.textSending?!1:!0},t.Previous=function(){i.Previous()},t.Next=function(){i.Next()},t.Exit=function(){i.Exit()},f()}return n.$inject=["$rootScope","$scope","SetupWizardService","$window","SendSMSService"],n}();n.app.controller("SetupWizardBusinessAppInstallController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u,f,e){this.$rootScope=t,this.$scope=i,this.SetupWizardService=r,this.$location=u,this.$window=f,this.ConciergeIntegrationService=e,i.SetupBannerDisplayModel={};var p=function(){var u=t.CurrentUserInfo.SetupBanner,f,e;i.SetupBannerDisplayModel=angular.copy(u),i.SetupBannerDisplayModel.processing=!1,i.SetupBannerDisplayModel.showError=!1,i.SetupBannerDisplayModel.showVideo=null,i.SetupBannerDisplayModel.showIndicator=!1,i.SetupBannerDisplayModel.completedRate=0,i.SetupBannerDisplayModel.bannerText=u.BannerText,i.SetupBannerDisplayModel.loadingComplete=!1,i.completedRate=0,i.enableSetupWizardBannerVideo=!1,i.enableHideSetupBanner=!1,i.ConciergeText=u.ConciergeText,i.SetupBannerDisplayModel.videoLink="9dd4e795-b044-48f3-aebe-eecd1a44d5ae",(u.SetupBannerType==7||u.SetupBannerType==8)&&(u.SetupBannerType==7?(f=c(u.SmbChoiceCompleteStatus),i.SetupBannerDisplayModel.completedRate=(100*f/u.SmbChoiceCompleteStatus.length).toFixed(0)):(e=c(u.E3ChoiceCompleteStatus),i.SetupBannerDisplayModel.completedRate=(100*e/u.E3ChoiceCompleteStatus.length).toFixed(0)),i.SetupBannerDisplayModel.completedRate>0&&i.SetupBannerDisplayModel.completedRate<100&&(i.SetupBannerDisplayModel.showIndicator=!0)),i.SetupBannerDisplayModel.ShowCloseButton=!1,i.SetupBannerDisplayModel.ShowConcierge=function(){var n=$("#conciergeMinState, #cw-min-state, #needHelperTitleV2").filter(function(){return $(this).css("display")=="block"});n&&(Concierge.RestoreWidget(i.ConciergeText),FastTrack.RestoreWidget(i.ConciergeText)),r.StepChanged("Dashboard","Banner",417642,"NeedHelp")},i.$root.features.SetupWizardSettingsBusinessLogic?i.SetupBannerDisplayModel.SimpleMode?(i.SetupBannerDisplayModel.loadingComplete=!0,u.SetupBannerType===2?(i.SetupBannerDisplayModel.typeClass="SetupWizardBanner-Visio",s(u)):u.SetupBannerType===3?(i.SetupBannerDisplayModel.typeClass="SetupWizardBanner-Project",s(u)):u.SetupBannerType===4?(i.SetupBannerDisplayModel.typeClass="SetupWizardBanner-OfficeBusiness",s(u)):u.SetupBannerType===6?(i.SetupBannerDisplayModel.typeClass="SetupWizardBanner-Skype",i.SetupBannerDisplayModel.ShowCloseButton=!0,i.SetupBannerDisplayModel.CloseBanner=function(){r.StepChanged("Dashboard","CloseSkypeSimpleBanner",421684),t.CurrentUserInfo.SetupBanner=0,r.InitialSetupWizardSession(u.SetupBannerType,u.ProductSkuId).then(function(i){r.BootstrapData=new n.BootstrapData,r.BootstrapData.StoreSessionId=i;var f={stepsSet:"OneSeatSkype",history:[]};r.SaveState("wizardframework",f).then(function(){r.SaveState("SetupBannerInfo",h(u)).then(function(){r.Step_SetSessionStatus(i,2).then(function(){t.$broadcast('refreshsetupbannerstatus')})})})})},i.SetupBannerDisplayModel.StartSetupWizard=function(){a("skype",u.ProductSkuId)}):r.Step_GetSetupSettingsAdvanced(!0,h(u)).then(function(n){n?(i.SetupBannerDisplayModel.typeClass=n.typeClass,i.enableSetupWizardBannerVideo=n.EnableSetupWizardBannerVideo,i.enableHideSetupBanner=n.EnableHideSetupBanner,l(u,n)):t.CurrentUserInfo.SetupBanner=0})):r.Step_GetSetupSettingsAdvanced(!0,h(u)).then(function(n){n?(i.SetupBannerDisplayModel.typeClass=n.typeClass,i.enableSetupWizardBannerVideo=n.EnableSetupWizardBannerVideo,i.enableHideSetupBanner=n.EnableHideSetupBanner,l(u,n)):t.CurrentUserInfo.SetupBanner=0,i.SetupBannerDisplayModel.loadingComplete=!0}):r.Step_GetSetupSettings().then(function(f){var y=0,p=0,e=0,c=0,l=0,w=0,v=0;f&&(f.CurrentExchangeStepSetVersion&&(y=f.CurrentExchangeStepSetVersion),f.CurrentSkypeStepSetVersion&&(p=f.CurrentSkypeStepSetVersion),f.CurrentSmbStepSetVersion&&(e=f.CurrentSmbStepSetVersion),f.CurrentE3StepSetVersion&&(c=f.CurrentE3StepSetVersion),f.CurrentWorkloadsStepSetVersion&&(l=f.CurrentWorkloadsStepSetVersion),f.EnableSetupWizardBannerVideo&&(i.enableSetupWizardBannerVideo=f.EnableSetupWizardBannerVideo),f.CurrentVsbStepSetVersion&&(i.currentVsbStepSetVersion=f.CurrentVsbStepSetVersion),f.CurrentBcsStepSetVersion&&(v=f.CurrentBcsStepSetVersion));switch(u.SetupBannerType){case 10:i.SetupBannerDisplayModel.typeClass="SetupWizardBanner-SetupWizard",u.HasBcsExchangeSetupCompleted?o(u,"HideDomainBcs",v,423600):o(u,"OwnDomainBcs",v,422950);break;case 7:i.SetupBannerDisplayModel.typeClass="SetupWizardBanner-SetupWizard",u.SmbChoiceCompleteStatus[0]?o(u,"OwnDomainSmb",e,422451):u.SmbChoiceCompleteStatus[1]?o(u,"SoftwareSmb",e,421973):o(u,"OwnDomainSmb",e,422450);break;case 8:i.SetupBannerDisplayModel.typeClass="SetupWizardBanner-SetupWizard",u.E3ChoiceCompleteStatus[0]?o(u,"OwnDomainE3",c,423134):u.E3ChoiceCompleteStatus[1]?o(u,"SoftwareE3",c,423135):o(u,"OwnDomainE3",c,423136);break;case 9:i.SetupBannerDisplayModel.typeClass="SetupWizardBanner-SetupWizard",o(u,"OwnDomainVsb",w,423141);break;case 1:i.SetupBannerDisplayModel.typeClass="SetupWizardBanner-SetupWizard",i.SetupBannerDisplayModel.videoLink="9dd4e795-b044-48f3-aebe-eecd1a44d5ae",u.HasOfficeClient||u.HasSkype?o(u,"OwnDomainSoftware",y,420446):o(u,"owndomain",0,416229);break;case 2:i.SetupBannerDisplayModel.typeClass="SetupWizardBanner-Visio",i.SetupBannerDisplayModel.SimpleMode?s(u):o(u,"NoDomainSetupSoftware",l,420443);break;case 3:i.SetupBannerDisplayModel.typeClass="SetupWizardBanner-Project",i.SetupBannerDisplayModel.SimpleMode?s(u):o(u,"NoDomainSetupSoftware",l,420444);break;case 4:i.SetupBannerDisplayModel.typeClass="SetupWizardBanner-OfficeBusiness",i.SetupBannerDisplayModel.SimpleMode?s(u):o(u,"NoDomainSetupSoftware",l,420445);break;case 6:i.SetupBannerDisplayModel.typeClass="SetupWizardBanner-Skype",u.SimpleMode?(i.SetupBannerDisplayModel.ShowCloseButton=!0,i.SetupBannerDisplayModel.CloseBanner=function(){r.StepChanged("Dashboard","CloseSkypeSimpleBanner",421684),t.CurrentUserInfo.SetupBanner=0,r.InitialSetupWizardSession(u.SetupBannerType,u.ProductSkuId).then(function(f){r.BootstrapData=new n.BootstrapData,r.BootstrapData.StoreSessionId=f;var e={stepsSet:"OneSeatSkype",history:[]};r.SaveState("wizardframework",e).then(function(){r.SaveState("SetupBannerInfo",h(u)).then(function(){r.Step_SetSessionStatus(f,2).then(function(){t.$broadcast('refreshsetupbannerstatus');var n={message:'Want to install the apps later\x3f Assign a license to yourself and go to the \x22Office software\x22 widget on the admin center\x27s home page to find your download links.',onNextLoad:!1};i.$root.$broadcast('setNavigationInformationBar',n)})})})})},i.SetupBannerDisplayModel.StartSetupWizard=function(){a("skype",u.ProductSkuId)}):o(u,"OwnDomainSkype",p,420646)}i.SetupBannerDisplayModel.loadingComplete=!0})},c=function(n){for(var i=0,t=0;t<n.length;t++)n[t]===!0&&i++;return i},b=function(n,t){r.StepChanged("Dashboard","Resume",t);var i={ProductSkuId:n.ProductSkuId,SetupBannerType:n.SetupBannerType,HasOfficeClient:n.HasOfficeClient,HasProject:n.HasProject,HasSkype:n.HasSkype,HasVisio:n.HasVisio};r.SaveState("SetupBannerInfo",i).then(function(){u.path("/setupwizard")})},a=function(n,t){if(!i.SetupBannerDisplayModel.processing){i.SetupBannerDisplayModel.processing=!0,i.SetupBannerDisplayModel.showError=!1;var u=f.open("../AdminPortal/SetupWizard/SetupLoading","_blank");r.Step_GetSoftwareInstallData().then(function(f){f&&f[n]?r.Step_SetCurrentUserLicense(t).then(function(t){t?u.location.href=f[n]:(i.SetupBannerDisplayModel.showError=!0,u.close()),i.SetupBannerDisplayModel.processing=!1},function(n){console.log(n),i.SetupBannerDisplayModel.showError=!0,i.SetupBannerDisplayModel.processing=!1}):(i.SetupBannerDisplayModel.showError=!0,i.SetupBannerDisplayModel.processing=!1)},function(n){console.log(n),i.SetupBannerDisplayModel.showError=!0,i.SetupBannerDisplayModel.processing=!1})}},w=function(n){n&&i.enableSetupWizardBannerVideo?r.LoadState("SetupBannerInfo").then(function(n){i.SetupBannerDisplayModel.showVideo=n==null?!0:!1}):i.SetupBannerDisplayModel.showVideo=!1},v=function(n){var t=0;n.hasOwnProperty('stepSetVersion')&&(t=n.stepSetVersion),r.BootstrapData.StepsSetVersion=t,r.GetStepsSet(n.stepsSet,t,n.appendedStepsSet).then(function(t){var u,r;for(i.SetupBannerDisplayModel.stepSet=t.steps,u=!1,r=0;r<i.SetupBannerDisplayModel.stepSet.length;++r)i.SetupBannerDisplayModel.stepSet[r].name===n.step&&(i.SetupBannerDisplayModel.currentIndex=r),(i.SetupBannerDisplayModel.stepSet[r].name==='Domain'||i.SetupBannerDisplayModel.stepSet[r].name==='SmbDomain'||i.SetupBannerDisplayModel.stepSet[r].name==='E3Domain')&&(u=!0);w(u)})},h=function(n){return{ProductSkuId:n.ProductSkuId,SetupBannerType:n.SetupBannerType,HasOfficeClient:n.HasOfficeClient,HasProject:n.HasProject,HasSkype:n.HasSkype,HasVisio:n.HasVisio,SimpleMode:n.SimpleMode,SmbChoiceCompleteStatus:n.SmbChoiceCompleteStatus,E3ChoiceCompleteStatus:n.E3ChoiceCompleteStatus,HasBcsExchangeSetupCompleted:n.HasBcsExchangeSetupCompleted,IsEligibleForFreeDomain:n.IsEligibleForFreeDomain}},s=function(n){i.SetupBannerDisplayModel.StartSetupWizard=function(t){if(!i.SetupBannerDisplayModel.processing){if(i.SetupBannerDisplayModel.processing=!0,i.SetupBannerDisplayModel.showError=!1,t||n.SetupBannerType!=4)var u=f.open("../AdminPortal/SetupWizard/SetupLoading","_blank");r.Banner_SetLicenseSimple(n.SetupBannerType).then(function(f){f?n.SetupBannerType!=4||t?u.location.href=n.NavigationData:r.Banner_GetDownloadUrl().then(y):(i.SetupBannerDisplayModel.showError=!0,(t||n.SetupBannerType!=4)&&u.close()),i.SetupBannerDisplayModel.processing=!1})}}},o=function(t,f,o,s){e.InitializeProblemDescriptionsDictionary("setupwizard"),i.SetupBannerDisplayModel.currentIndex=0,r.InitialSetupWizardSession(t.SetupBannerType,t.ProductSkuId).then(function(i){r.BootstrapData=new n.BootstrapData,r.BootstrapData.StoreSessionId=i,r.BootstrapData.ProductDisplayName=t.ProductDisplayName,r.BootstrapData.ProductSkuId=t.ProductSkuId,r.BootstrapData.SetupBannerType=t.SetupBannerType,r.LoadState("wizardframework").then(function(n){n||(n={stepsSet:f,stepSetVersion:o,history:[]},r.SaveState("wizardframework",n)),r.BootstrapData.StepsInfo=n,r.BootstrapData.StepsSetVersion=n.stepSetVersion,v(n)})}),i.SetupBannerDisplayModel.StartSetupWizard=function(){r.StepChanged("Dashboard","Resume",s),r.SaveState("SetupBannerInfo",h(t)).then(function(){u.path("/setupwizard")})}},l=function(t,f){e.InitializeProblemDescriptionsDictionary("setupwizard"),i.SetupBannerDisplayModel.currentIndex=0,r.BootstrapData=new n.BootstrapData,r.BootstrapData.StoreSessionId=f.sid,r.BootstrapData.ProductDisplayName=t.ProductDisplayName,r.BootstrapData.ProductSkuId=t.ProductSkuId,r.BootstrapData.SetupBannerType=t.SetupBannerType,r.LoadState("wizardframework").then(function(n){n||(n={stepsSet:f.stepSet,stepSetVersion:f.stepSetVersion,history:[]},r.SaveState("wizardframework",n)),r.BootstrapData.StepsInfo=n,r.BootstrapData.StepsSetVersion=n.stepSetVersion,v(n)}),i.SetupBannerDisplayModel.StartSetupWizard=function(){r.StepChanged("Dashboard","Resume",f.tagId),r.SaveState("SetupBannerInfo",h(t)).then(function(){u.path("/setupwizard")})},i.$root.features.SetupProducts&&i.enableHideSetupBanner&&(i.SetupBannerDisplayModel.ShowCloseButton=!0),i.SetupBannerDisplayModel.CloseBanner=function(){r.StepChanged("Dashboard","CloseBanner",421700),r.HideSetupBanner().then(function(){i.$root.CurrentUserInfo.HideSetupBanner=!0;var n={message:'To complete setup later, navigate to the \x3ca\x3eProducts page\x3c\x2fa\x3e under Setup.'.replace("<a>","<a href='#/setupproducts'>"),onNextLoad:!1};i.$root.$broadcast('setNavigationInformationBar',n)})}},y=function(n){n.Code==0&&n.Message.Length!=0&&(window.location.href=n.Message,i.$emit('installWizard:showInstallWizard'))};p()}return t.$inject=["$rootScope","$scope","SetupWizardService","$location","$window","ConciergeIntegrationService"],t}();n.app.controller("SetupBannerController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){this.$rootScope=n,this.$scope=t,this.$window=i,this.SetupWizardService=r;var u=function(){t.hasDefaultCustomDomain=!1,t.productSkuId=null,t.wfData={},t.smbChoiceCompleteStatus=[],t.smbChoiceCommunicationCompleted=!1,t.smbChoiceOfficeCompleted=!1,r.ShowLoading(!0),r.Step_GetIsAoboScenario().then(function(n){n?r.Skip():r.LoadState("SetupBannerInfo").then(function(n){t.productSkuId=n.ProductSkuId,t.smbChoiceCompleteStatus=n.SmbChoiceCompleteStatus,t.smbChoiceOfficeCompleted=t.smbChoiceCompleteStatus[0],t.smbChoiceCommunicationCompleted=t.smbChoiceCompleteStatus[1]})}),r.Step_HasDefaultCustomDomain().then(function(n){t.hasDefaultCustomDomain=n,r.ShowLoading(!1)})};t.ChoiceType={OwnDomainSmb:"OwnDomainSmb",OwnDomainSoftwareSmb:"OwnDomainSoftwareSmb",SoftwareSmb:"SoftwareSmb"},t.choiceType=null,t.MakeSoftwareChoiceSetup=function(n){console.log(n.currentTarget.id),n.currentTarget.id==="communication"?(r.BootstrapData.SoftwareChoice=0,r.SaveState("SmbChoice",{softwareChoice:0}),t.choiceType=t.ChoiceType.OwnDomainSmb,t.wfData={stepsSet:"OwnDomainSmb",history:[],stepSetVersion:r.BootstrapData.StepsSetVersion},r.SaveState("wizardframework",t.wfData)):n.currentTarget.id==="office"?(r.BootstrapData.SoftwareChoice=1,r.SaveState("SmbChoice",{softwareChoice:1}),t.smbChoiceCommunicationCompleted?(t.choiceType=t.ChoiceType.SoftwareSmb,t.wfData={stepsSet:"SoftwareSmb",history:[],stepSetVersion:r.BootstrapData.StepsSetVersion}):(t.choiceType=t.ChoiceType.OwnDomainSoftwareSmb,t.wfData={stepsSet:"OwnDomainSoftwareSmb",history:[],stepSetVersion:r.BootstrapData.StepsSetVersion}),r.SaveState("wizardframework",t.wfData)):n.currentTarget.id==="businessapp"&&(r.BootstrapData.SoftwareChoice=2,i.open("/BusinessCenter/Home","_blank"),r.StepChanged("SMB","BusinessCenter",425482)),n.currentTarget.id!="businessapp"&&r.SetCurrentStepsSet(t.choiceType,r.BootstrapData.StepsSetVersion).then(function(){r.Next()})},u()}return n.$inject=["$rootScope","$scope","$window","SetupWizardService"],n}();n.app.controller("SmbSetupController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){this.$rootScope=n,this.$scope=t,this.SetupWizardService=i;var r=function(){t.hasDefaultCustomDomain=!1,t.productSkuId=null,t.wfData={},t.e3ChoiceCompleteStatus=[],t.e3ChoiceCommunicationCompleted=!1,t.e3ChoiceOfficeCompleted=!1,i.ShowLoading(!0),i.Step_GetIsAoboScenario().then(function(n){n?i.Skip():i.LoadState("SetupBannerInfo").then(function(n){t.productSkuId=n.ProductSkuId,t.e3ChoiceCompleteStatus=n.E3ChoiceCompleteStatus,t.e3ChoiceOfficeCompleted=t.e3ChoiceCompleteStatus[0],t.e3ChoiceCommunicationCompleted=t.e3ChoiceCompleteStatus[1]})}),i.Step_HasDefaultCustomDomain().then(function(n){t.hasDefaultCustomDomain=n,i.ShowLoading(!1)})};t.ChoiceType={OwnDomainE3:"OwnDomainE3",OwnDomainSoftwareE3:"OwnDomainSoftwareE3",SoftwareE3:"SoftwareE3"},t.choiceType=null,t.MakeSoftwareChoiceSetup=function(n){console.log(n.currentTarget.id),n.currentTarget.id==="communication"?(i.BootstrapData.SoftwareChoice=0,i.SaveState("E3Choice",{softwareChoice:0}),t.choiceType=t.ChoiceType.OwnDomainE3,t.wfData={stepsSet:"OwnDomainE3",history:[]},i.SaveState("wizardframework",t.wfData)):n.currentTarget.id==="office"&&(i.BootstrapData.SoftwareChoice=1,i.SaveState("E3Choice",{softwareChoice:1}),t.e3ChoiceCommunicationCompleted?(t.choiceType=t.ChoiceType.SoftwareE3,t.wfData={stepsSet:"SoftwareE3",history:[]}):(t.choiceType=t.ChoiceType.OwnDomainSoftwareE3,t.wfData={stepsSet:"OwnDomainSoftwareE3",history:[]}),i.SaveState("wizardframework",t.wfData)),i.SetCurrentStepsSet(t.choiceType,i.BootstrapData.StepsSetVersion).then(function(){i.Next()})},r()}return n.$inject=["$rootScope","$scope","SetupWizardService"],n}();n.app.controller("E3SetupController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){function i(){n.saveinprogress=!1,n.formData.ObjectId=n.objectid,n.formData.PhotoContent=n.formData.PhotoContent,n.formData.IsChanged=!1,n.formData.PhotoUserType=n.formData.PhotoUserType;switch(n.formData.PhotoUserType){case 0:n.formData.UserPrincipalName=n.formData.UserPrincipalName;break;case 1:n.formData.UserPrincipalName=n.formData.GroupSmtp;break;case 3:n.formData.UserPrincipalName=n.formData.SharedMailboxSmtp;break;case 2:n.formData.UserPrincipalName=n.formData.ResourceMailboxPrimarySmtpAddress;break;case 4:n.formData.UserPrincipalName=n.formData.SharedMailboxSmtp}}this.$scope=n,this.PhotoService=t,n.OnPhotoChanged=function(){n.formData.IsChanged=!0,angular.element(document.querySelector('#UploadPhotoBtn')).focus()},n.Close=function(){n.$emit('closeFlyout')},n.Submit=function(){n.$emit('showWaitingIndicator',!0),n.saveinprogress=!0,t.SetPhoto(n.formData.UserPrincipalName,n.formData.PhotoUserType,n.formData.PhotoContent).then(function(i){n.$emit('showWaitingIndicator',!1),t.BroadcastPhotoEvent("UpdatePersonPhoto",i),n.statusMessage='The photo was uploaded',n.showSummary=!0},function(t){n.$emit('showWaitingIndicator',!1),n.statusMessage=t,n.showSummary=!0})},n.ChoosePhoto=function(){angular.element(document.querySelector('#photoFileInput')).click()},i()}return n.$inject=["$scope","PhotoService"],n}();n.app.controller("UpdatePhotoController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function f(){i.GetActiveDomain().success(function(t){var r=t.Data.ActiveDomain;n.$broadcast('UpdateImapCard',r),i.GetImapServerConfiguration(r).then(o,u)})}this.$rootScope=n,this.$scope=t,this.EmailMigrationService=i,t.ImapConfigDataLoaded=!1,t.OperationInProgress=!0,t.LoadingImapConfigs=!0,t.SavingImapConfigs=!1,t.ShowMessage=!1,t.Submit=function(n){n.$valid&&(t.OperationInProgress=!0,t.SavingImapConfigs=!0,i.CheckAndSaveCustomServerConfigs(t.ImapConfig).success(e).error(u))},t.Cancel=function(){r()},t.$on('UpdateImapConfig',function(n,i){t.ImapConfig=i});var r=function(){t.$emit('closeFlyout')},e=function(n){t.OperationInProgress=!1,t.SavingImapConfigs=!1,t.ShowMessage=!0,n.Succeeded?(t.ImapConfig.Valid=!0,t.$emit('UpdateImapConfig',t.ImapConfig),r(),console.log("Succesfully saved IMAP configurations.")):(t.ImapConfig.Valid=!1,console.log("IMAP configuration is not valid: "+t.ImapConfig))},o=function(n){t.OperationInProgress=!1,t.LoadingImapConfigs=!1,t.ImapConfig=n,t.ImapConfigDataLoaded=!0},u=function(){t.OperationInProgress=!1,t.LoadingImapConfigs=!1,t.SavingImapConfigs=!1,console.log("Error calling API.")};f()}return n.$inject=["$rootScope","$scope","EmailMigrationService"],n}();n.app.controller("ImapServerConfigurationController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){this.$scope=n,this.ProfileService=t,n.$on('UpdateImapCard',function(i,r){n.Domain=r,n.IconColor=t.GetProfileImageColor(n.Domain),n.IconText=t.GetSharedMailboxInitials(n.Domain).toUpperCase()})}return n.$inject=["$scope","ProfileService"],n}();n.app.controller("ImapCardController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function r(){typeof n.IntuneModel=='undefined'&&(n.IntuneModel={}),n.IntuneModel.selectedPolicies=n.selectedItem}this.$scope=n,this.PanelService=t,this.IntuneService=i,n.$on(t.GetBroadCastEventName(),function(t,i){n.IntuneModel.selectedPolicies=i}),n.$on('TogglePolicyAction',function(t,i){i.length===0?n.ClosePanel():n.IntuneModel.selectedPolicies=i}),n.ClosePanel=function(){n.$emit('closePanel')},r()}return n.$inject=["$scope",'PanelService','IntuneService'],n}();n.app.controller("BulkPolicyActionsController",t)})(Admin||(Admin={}));//-----------------------------------------------------------------------
// <copyright file="PoliciesController.ts" company="Microsoft">
//     Copyright (c) Microsoft. All rights reserved.
// </copyright>
//-----------------------------------------------------------------------
/// <reference path="../../ext/angular/1.3.15/angular.d.ts" />
/// <reference path='../../AdminBaseControls.ts' />
/// <reference path='../../app.ts' /> 
/// <reference path='../../services/HelperService.ts' />
/// <reference path='../../services/IntuneService.ts' />
/// <reference path='../../services/IntuneHelperService.ts' />
var Admin;
(function (Admin) {
    'use strict';
    /**
     * The controller for Delete Policy Wizard flyout.
     */
    var DeletePolicyWizardController = (function () {
        function DeletePolicyWizardController($scope, $rootScope, $q, IntuneService, IntuneHelperService) {
            this.$scope = $scope;
            this.$rootScope = $rootScope;
            this.$q = $q;
            this.IntuneService = IntuneService;
            this.IntuneHelperService = IntuneHelperService;
            $scope.selectedPolicies = $scope.selecteditem;
            $scope.operationModel = { showSpinner: false, complete: false, errors: [], serverError: false };
            $scope.DeletePolicy = function (selectedPolicies) {
                var appPolicies = [], devicePolicies = [], allTasks = [];
                selectedPolicies.forEach(function (policyToDelete, index, policiesToDelete) {
                    var targetType = IntuneHelperService.GetPolicyTargetType(policyToDelete.SupportedType);
                    if (targetType === 1 /* AppPolicy */) {
                        appPolicies.push(policyToDelete);
                    }
                    else if (targetType === 2 /* DevicePolicy */) {
                        devicePolicies.push(policyToDelete);
                    }
                });
                if (appPolicies.length > 0) {
                    allTasks.push(IntuneService.DeleteAppPolicies(appPolicies.map(function (policy, index, array) {
                        return policy.Id;
                    })));
                }
                if (devicePolicies.length > 0) {
                    allTasks.push(IntuneService.DeleteDevicePolicies(devicePolicies.map(function (policy, index, array) {
                        return policy.Id;
                    })));
                }
                if (allTasks.length > 0) {
                    $scope.operationModel.showSpinner = true;
                    IntuneHelperService.WaitForAllPromises($q, allTasks).promise.then(function () {
                        $rootScope.$broadcast('intunePoliciesDeleted', { policies: selectedPolicies });
                        $scope.operationModel.showSpinner = false;
                        $scope.operationModel.complete = true;
                        $scope.operationModel.serverError = false;
                        return null;
                    }).catch(function () {
                        $scope.operationModel.showSpinner = false;
                        $scope.operationModel.complete = true;
                        $scope.operationModel.serverError = true;
                        allTasks.forEach(function (task, index, array) {
                            if (task.$$state.status === 2) {
                                $scope.operationModel.errors.push(task.$$state.value.data);
                            }
                        });
                        $rootScope.$broadcast('refreshIntunePolicies', null);
                        return null;
                    });
                }
            };
        }
        DeletePolicyWizardController.$inject = ["$scope", "$rootScope", "$q", "IntuneService", "IntuneHelperService"];
        return DeletePolicyWizardController;
    })();
    Admin.DeletePolicyWizardController = DeletePolicyWizardController;
    Admin.app.controller("DeletePolicyWizardController", DeletePolicyWizardController);
})(Admin || (Admin = {}));
;var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u){function s(){o()}function o(){u.GetPoliciesModel().then(function(n){return t.PoliciesModel=n,null})}function f(){t.IntuneModel.selectedItems=t.PoliciesModel.policiesData.filter(function(n){return n.isChecked}),t.IntuneModel.selectedPoliciesCount=t.IntuneModel.selectedItems.length,t.IntuneModel.headerIsChecked=t.IntuneModel.selectedItems.length>0&&t.IntuneModel.selectedItems.length===t.PoliciesModel.policiesData.length}function e(n){var t={};return t=n.length==1?{panelTemplateUrl:"../AdminPortal/Intune/PolicyDetails",panelType:"intunepolicycard",selecteditem:n[0],panelHeaderTitle:'Edit a policy',panelHeaderIcon:i.currentCultureInfo?"ms-Icon ms-Icon--noteEdit g-icon-txt-rtl ss-icon-size":"ms-Icon ms-Icon--noteEdit g-icon-txt ss-icon-size",unselectonclose:!1,unhighlightonclose:!1}:{panelTemplateUrl:"../AdminPortal/Intune/BulkPolicyActions",panelType:"bulkactionintunepolicies",panelHeaderTitle:'Bulk actions',selecteditem:n,panelCustomClass:"panelflyout-xsmall",unselectonclose:!1,unhighlightonclose:!1}}this.$scope=t,this.$rootScope=i,this.LogService=r,this.IntuneHelperService=u,t.InitIntuneModel=function(){t.IntuneModel={},t.IntuneModel.selectedItems={},t.IntuneModel.selectedPoliciesCount=0,t.IntuneModel.headerIsChecked=!1},t.PoliciesModel=new n.PoliciesModel,t.InitIntuneModel(),t.IntuneModel.ToggleHighlight=function(n){$(".gridRow").css("background-color","transparent"),$("#user_list_"+n).css("background-color","#DDEBF7")},t.$on('highlightselectedrow',function(n,i){angular.isDefined(i)&&t.IntuneModel.ToggleHighlight(i)}),t.IntuneModel.GetRowCss=function(n){if(n&&n.isChecked)return{'background-color':'#DDEBF7'}},t.initCallbackPanel=function(n){t.panel=n},t.IntuneModel.UpdateSelectedPolicies=function(n){typeof n.isSelected=="undefined"&&(n.isSelected=!1),n.isSelected=!n.isSelected,n.isChecked=n.isSelected,f(),n.isChecked?(typeof t.panel!='undefined'||t.panel===null)&&t.panel.invoke(e(t.IntuneModel.selectedItems)):t.IntuneModel.selectedItems.length===1?t.panel.invoke(e(t.IntuneModel.selectedItems)):t.IntuneModel.selectedItems.length===0&&t.$broadcast('closePanel'),t.$broadcast('TogglePolicyAction',t.IntuneModel.selectedItems)},t.IntuneModel.HandleCheckboxClick=function(n){typeof n.isSelected=="undefined"&&(n.isSelected=!1),n.isSelected=!n.isSelected,f()},t.IntuneModel.SelectAllPolicies=function(n){for(var i=0;i<t.PoliciesModel.policiesData.length;i++)t.PoliciesModel.policiesData[i].isChecked=n,t.PoliciesModel.policiesData[i].isSelected=n;n?(t.IntuneModel.selectedItems=t.PoliciesModel.policiesData,t.IntuneModel.selectedPoliciesCount=t.IntuneModel.selectedItems.length,(typeof t.panel!='undefined'||t.panel===null)&&t.panel.invoke(e(t.IntuneModel.selectedItems))):(t.IntuneModel.selectedItems=[],t.IntuneModel.selectedPoliciesCount=0,t.$broadcast('closePanel')),t.$broadcast('TogglePolicyAction',t.IntuneModel.selectedItems)},t.$on('intunePolicyCreated',function(n,i){t.PoliciesModel=u.AddNewPolicyToModel(t.PoliciesModel,i.policy)}),t.$on('intunePoliciesDeleted',function(n,i){t.PoliciesModel=u.DeletePoliciesFromModel(t.PoliciesModel,i.policies),f(),t.$broadcast('closePanel')}),t.$on('intunePoliciesGroupsUpdated',function(n,i){t.PoliciesModel=u.UpdatePoliciesGroupsInModel(t.PoliciesModel,i.policies,i.groups)}),t.$on('intunePolicyUpdated',function(n,i){t.PoliciesModel=u.UpdatePolicyInModel(t.PoliciesModel,i.policy)}),t.$on('refreshIntunePolicies',function(){o(),f()}),s()}return t.$inject=["$scope","$rootScope","LogService","IntuneHelperService"],t}();n.PoliciesController=t,n.app.controller("PoliciesController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var i,t;(function(n){n[n.AllOff=0]="AllOff",n[n.AllOn=1]="AllOn",n[n.SomeOn=2]="SomeOn"})(i||(i={})),t=function(){function n(n,t,i,r,u){function e(){n.targetType=u.GetPolicyTargetType(n.policyDetails.SupportedType),n.policyDetailsUpdated=!1,n.RefreshPolicy(n.policyDetails,n.targetType)}function o(n){return n.WindowsDefenderOn&&n.ProtectFromThreats&&n.AllowFingerprintOrFacialLogin&&n.MinutesOfIdleBeforeTurnOffScreen>0&&n.AutoUpdateWin10Devices&&n.PreventAppDownload&&n.PreventCortanaUsage&&n.AllowRecoveryOfCorruptedData?1:n.WindowsDefenderOn||n.ProtectFromThreats||n.AllowFingerprintOrFacialLogin||n.MinutesOfIdleBeforeTurnOffScreen!==0||n.AutoUpdateWin10Devices||n.PreventAppDownload||n.PreventCortanaUsage||n.AllowRecoveryOfCorruptedData?2:0}function s(n){return n.DaysOfflineBeforeWipeIsEnforced>0&&n.OnlyAllowOneDriveForBusinessStorage&&n.EncryptOfficeFiles?1:n.DaysOfflineBeforeWipeIsEnforced!==0||n.OnlyAllowOneDriveForBusinessStorage||n.EncryptOfficeFiles?2:0}function h(n){return n.PinRequiredForOfficeApps&&n.MaxPinRetries>0&&n.MinutesOfIdleBeforePinRequired>0&&n.DoNotAllowJailbrokenOrRootedDevices&&n.DoNotAllowCompanyDataCopyingFromOffice?1:n.PinRequiredForOfficeApps||n.MaxPinRetries!==0||n.MinutesOfIdleBeforePinRequired!==0||n.DoNotAllowJailbrokenOrRootedDevices||n.DoNotAllowCompanyDataCopyingFromOffice?2:0}function f(n){switch(n){case 0:return'All settings are OFF';case 1:return'All settings are ON';case 2:return'Some settings are ON'}}this.$scope=n,this.$rootScope=t,this.LogService=i,this.IntuneService=r,this.IntuneHelperService=u,n.policyDetails=n.selectedItem,n.policyModel={serverError:!1,error:null},n.GetPolicyStates=function(n){var t,i,r;return n.TargetType===1?(t=s(n),i=h(n),n.ProtectAgainstLostOrStolenDevices=t!==0,n.ControlUsersOfficeDocsAccessOnMobileDevices=i!==0,n.LossProtection=f(t),n.OfficeDocs=f(i)):(r=o(n),n.ProtectWindows10Devices=r!==0,n.Win10Protection=f(r)),n},n.RefreshPolicy=function(t,i){n.policyDetailsUpdated=!1,r.GetPolicy(t.Id,i,!1).then(function(i){var r=i.data,f=new Date(r.LastUpdated);r.LastUpdated=f.toLocaleString(),r.GroupAssignments=t.GroupAssignments,r.TargetGroupName=u.GetFormattedTargetGroup(t.GroupAssignments),r.SupportedType=u.GetSupportedPolicyType(r.Type),r.TypeName=u.GetPolicyTypeName(r.SupportedType),r.TargetType=u.GetPolicyTargetType(r.SupportedType),r=n.GetPolicyStates(r),r.AppDeployments!=null&&(r.AppDeploymentsInfo=u.GetDeploymentsInfo(),r.AppDeploymentsInfo.forEach(function(n,t,i){i[t].selected=r.AppDeployments.indexOf(n.id.toLowerCase())>=0})),n.policyDetails=r,n.policyDetailsUpdated=!0},function(t){n.policyModel.serverError=!0,n.policyModel.error=t.data})},n.$on('intunePoliciesGroupsUpdated',function(t,i){n.policyDetails.GroupAssignments=i.groups,n.policyDetails.TargetGroupName=u.GetFormattedTargetGroup(n.policyDetails.GroupAssignments)}),n.$on('intunePolicyUpdated',function(t,i){n.policyDetails=i.policy,n.policyDetails=u.GetPolicyData(n.policyDetails),n.policyDetails=n.GetPolicyStates(n.policyDetails)}),e()}return n.$inject=["$scope","$rootScope","LogService","IntuneService","IntuneHelperService"],n}(),n.PolicyDetailsController=t,n.app.controller("PolicyDetailsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u){function f(){t.Picker={Type:t.selectedItem.Type=="EditPolicy"?0:1,allItemsListTitle:'Policies',selectedItemsListTitle:'Selected Policies',showSelectedItems:t.selectedItem.Type=="DeletePolicy",expandSelectedItems:!1},u.GetPoliciesModel().then(function(n){return t.IntuneModel=n,null}),t.IntuneModel.showSpinner=!0}function e(){return{panelTemplateUrl:"../AdminPortal/Intune/PolicyDetails",panelHeaderTitle:'Edit a policy',panelHeaderIcon:i.currentCultureInfo?"ms-Icon ms-Icon--noteEdit g-icon-txt-rtl ss-icon-size":"ms-Icon ms-Icon--noteEdit g-icon-txt ss-icon-size",selecteditem:t.Picker.selectedPolicies[0],showCloseButton:"false"}}function o(){return{flyoutTemplateUrl:"../AdminPortal/Intune/DeletePolicyWizard",flyoutHeaderTitle:'Delete a policy',flyoutHeaderIcon:i.currentCultureInfo?"ms-Icon-Basel ms-Icon-Basel--DeleteLegacy g-icon-txt-rtl ss-icon-size":"ms-Icon-Basel ms-Icon-Basel--DeleteLegacy g-icon-txt ss-icon-size",selecteditem:t.Picker.selectedPolicies,showCloseButton:"false"}}this.$scope=t,this.$rootScope=i,this.LogService=r,this.IntuneHelperService=u,t.IntuneModel=new n.PoliciesModel,t.IntuneModel.policiesData=[],t.InitCallbackFlyout=function(n){t.flyout=n},t.InitCallbackPanel=function(n){t.panel=n},t.$watch("Picker.selectedPolicies",function(){t.selectedItem.Type=="EditPolicy"&&typeof t.Picker.selectedPolicies!="undefined"&&t.Picker.selectedPolicies.length>0&&(t.Cancel(),t.panel.invoke(e()))}),t.SelectMember=function(n){typeof t.Picker.selectedPolicies=="undefined"&&(t.Picker.selectedPolicies=[]),typeof n.isSelected=="undefined"&&(n.isSelected=!1),n.isSelected=!n.isSelected,n.isChecked=n.isSelected,t.Picker.selectedPolicies=t.IntuneModel.policiesData.filter(function(n){return n.isChecked})},t.InvokeFlyout=function(){t.Cancel(),t.flyout.invoke(o())},t.Cancel=function(){t.$emit('closePanel')},t.ToggleSelectedMembers=function(){t.Picker.expandSelectedItems=!t.Picker.expandSelectedItems},f()}return t.$inject=['$scope','$rootScope','LogService','IntuneHelperService'],t}();n.PolicyPickerController=t,n.app.controller("PolicyPickerController",t)})(Admin||(Admin={}));//-----------------------------------------------------------------------
// <copyright file="TragetGroupsController.ts" company="Microsoft">
//     Copyright (c) Microsoft. All rights reserved.
// </copyright>
//-----------------------------------------------------------------------
/// <reference path="../../ext/angular/1.3.15/angular.d.ts" />
/// <reference path='../../AdminBaseControls.ts' />
/// <reference path='../../app.ts' /> 
/// <reference path='../../services/HelperService.ts' />
/// <reference path='../../services/IntuneHelperService.ts' />
/// <reference path='../../services/IntuneService.ts' />
/// <reference path='../../services/GroupService.ts' />
/// <reference path="../../services/LogService.ts"/>
var Admin;
(function (Admin) {
    'use strict';
    /**
     * The controller for Target Groups page.
     */
    var TargetGroupsController = (function () {
        function TargetGroupsController($scope, $rootScope, $q, HelperService, IntuneHelperService, IntuneService, GroupService, LogService) {
            this.$scope = $scope;
            this.$rootScope = $rootScope;
            this.$q = $q;
            this.HelperService = HelperService;
            this.IntuneHelperService = IntuneHelperService;
            this.IntuneService = IntuneService;
            this.GroupService = GroupService;
            this.LogService = LogService;
            if (!$scope.IntuneModel) {
                $scope.IntuneModel = {};
            }
            if ($scope.selecteditem != null && $scope.selecteditem.mode === "SelectGroups") {
                $scope.mode = "SelectGroups";
            }
            else if ($scope.selecteditem != null && $scope.selecteditem.mode === "AssignGroups") {
                $scope.mode = "AssignGroups";
                $scope.IntuneModel.selectedPolicies = $scope.selecteditem.policies;
                $scope.IntuneModel.groupsData = $scope.selecteditem.groups;
            }
            $scope.IntuneModel.searchTerm = { Value: "" };
            $scope.IntuneModel.serverError = false;
            $scope.IntuneModel.noResults = false;
            $scope.IntuneModel.showSpinner = true;
            $scope.IntuneModel.error = null;
            $scope.operationModel = { serverError: false, showSpinner: false, errors: [], complete: false };
            $scope.IntuneModel.ToggleHighlight = function (id) {
                // Set the background color for the grid row when we select the row    
                $(".gridRow").css("background-color", "transparent");
                $("#user_list_" + id).css("background-color", "#DDEBF7");
            };
            $scope.SetMode = function (value) {
                SetGroups(value.groups);
                $scope.mode = value.mode;
            };
            $scope.$on('highlightselectedrow', function (event, id) {
                if (angular.isDefined(id)) {
                    $scope.ToggleHighlight(id);
                }
            });
            $scope.IntuneModel.GetRowCss = function (item) {
                if (item && item.isChecked) {
                    return { 'background-color': '#DDEBF7' };
                }
            };
            $scope.IntuneModel.ShouldDisable = function () {
                return HelperService.IsDataValid($scope.IntuneModel.groupsData);
            };
            $scope.IntuneModel.UpdateSelectedGroups = function (item) {
                if (item.isChecked) {
                    $scope.IntuneModel.selectedGroupsCount++;
                }
                else {
                    $scope.IntuneModel.selectedGroupsCount--;
                }
            };
            $scope.IntuneModel.SelectTargetGroups = function () {
                if ($scope.mode === "SelectGroups") {
                    $rootScope.$broadcast('intuneGroupsSelected', GetSelectedGroups($scope));
                }
                else {
                    var selectedGroupIds = GetSelectedGroupIds($scope), selectedPolicies = $scope.IntuneModel.selectedPolicies, promises = [];
                    for (var i = 0; i < selectedPolicies.length; i++) {
                        var policyTargetType = IntuneHelperService.GetPolicyTargetType(selectedPolicies[i].SupportedType);
                        switch (policyTargetType) {
                            case 1 /* AppPolicy */:
                                promises.push(IntuneService.AssignAppPolicyTargetGroups(selectedPolicies[i].Id, selectedGroupIds));
                                break;
                            case 2 /* DevicePolicy */:
                                promises.push(IntuneService.AssignDevicePolicyTargetGroups(selectedPolicies[i].Id, selectedGroupIds));
                                break;
                        }
                    }
                    $scope.operationModel.showSpinner = true;
                    $scope.operationModel.complete = false;
                    IntuneHelperService.WaitForAllPromises($q, promises).promise.then(function (result) {
                        $rootScope.$broadcast('intunePoliciesGroupsUpdated', { policies: selectedPolicies, groups: GetSelectedGroups($scope) });
                        $scope.operationModel.serverError = false;
                        $scope.operationModel.complete = true;
                        $scope.operationModel.showSpinner = false;
                        return null;
                    }).catch(function () {
                        $scope.operationModel.serverError = true;
                        $scope.operationModel.complete = true;
                        $scope.operationModel.showSpinner = false;
                        selectedPolicies.forEach(function (policy, index, array) {
                            if (promises[index].$$state.status === 2) {
                                $scope.operationModel.errors.push({
                                    header: 'Could not update target groups for policy \x7b0\x7d'.Format(policy.DisplayName),
                                    error: promises[index].$$state.value.data,
                                    policy: policy
                                });
                            }
                        });
                        $rootScope.$broadcast('refreshIntunePolicies', null);
                        return null;
                    });
                }
            };
            $scope.IntuneModel.SearchList = function (searchTerm) {
                for (var i = 0; i < $scope.IntuneModel.groupsData.length; i++) {
                    $scope.IntuneModel.groupsData[i].isFiltered = ($scope.IntuneModel.groupsData[i].DisplayName.search(searchTerm) < 0);
                }
                $scope.$applyAsync();
            };
            function GetSelectedGroupIds($scope) {
                var selectedGroups = [];
                for (var i = 0; i < $scope.IntuneModel.groupsData.length; i++) {
                    if ($scope.IntuneModel.groupsData[i].isChecked) {
                        selectedGroups.push($scope.IntuneModel.groupsData[i].Id);
                    }
                }
                return selectedGroups;
            }
            function GetSelectedGroups($scope) {
                var selectedGroups = [];
                for (var i = 0; i < $scope.IntuneModel.groupsData.length; i++) {
                    if ($scope.IntuneModel.groupsData[i].isChecked) {
                        selectedGroups.push($scope.IntuneModel.groupsData[i]);
                    }
                }
                return selectedGroups;
            }
            function Init() {
                $scope.IntuneModel.groupsData = [];
                if ($scope.mode === "AssignGroups") {
                    IntuneService.GetTargetGroups().then(function (result) {
                        SetGroups(result.data);
                    }, function (error) {
                        $scope.IntuneModel.serverError = true;
                        $scope.IntuneModel.showSpinner = false;
                        $scope.IntuneModel.error = error.data;
                        LogService.LogError(423425, "Intune_TargetGroupsController: ListGroups error: {0}".Format(error.data));
                    });
                }
                // TODO: this could be non-zero based on already selected list
                $scope.IntuneModel.selectedGroupsCount = 0;
            }
            function SetGroups(groups) {
                if (groups.length > 0) {
                    $scope.IntuneModel.groupsData = groups;
                    $scope.IntuneModel.noResults = false;
                    for (var i = 0; i < $scope.IntuneModel.groupsData.length; i++) {
                        $scope.IntuneModel.groupsData[i].isFiltered = false;
                    }
                }
                else {
                    $scope.IntuneModel.noResults = true;
                }
                $scope.IntuneModel.showSpinner = false;
            }
            Init();
        }
        TargetGroupsController.$inject = ["$scope", "$rootScope", "$q", "HelperService", "IntuneHelperService", "IntuneService", "GroupService", "LogService"];
        return TargetGroupsController;
    })();
    Admin.TargetGroupsController = TargetGroupsController;
    Admin.app.controller("TargetGroupsController", TargetGroupsController);
})(Admin || (Admin = {}));
;var Admin;(function(n){'use strict';;var i,t;(function(n){n[n.Create=0]="Create",n[n.EditPolicyName=1]="EditPolicyName",n[n.EditMamLossprotection=2]="EditMamLossprotection",n[n.EditMamOfficeDocs=3]="EditMamOfficeDocs",n[n.EditMamProtectedApps=4]="EditMamProtectedApps",n[n.EditMdmWin10Protection=5]="EditMdmWin10Protection"})(i||(i={})),t=function(){function n(n,t,i,r,u,f){function c(n){return n===null||n.item===null?0:n.operation==="EditPolicyName"?1:n.operation==="EditMamLossProtection"?2:n.operation==="EditMamOfficeDocs"?3:n.operation==="EditMamProtectedApps"?4:n.operation==="EditMdmWin10Protection"?5:0}function h(t,i){var f={};return f.serverError=!1,f.showSpinner=!1,n.ClearOperationError(),i===0?(f=e(f,!0),f=o(f,!0),f=s(f,!0),f.AppDeploymentsInfo=u.GetDeploymentsInfo(),f.AppDeploymentsInfo.forEach(function(n,t,i){i[t].selected=!0}),f.DisplayName='Enter a policy name',r.GetTargetGroups().then(function(t){var i=t.data.filter(function(n){return n.Type===1});n.GroupsData.selectedGroups=i!=null&&i.length>0?i:[{DisplayName:'All Users',Id:"CreateNew"}],n.GroupsData.allGroups=t.data,n.GroupsData.showSpinner=!1,n.GroupsData.noResults=n.GroupsData.allGroups.length<=0},function(t){n.GroupsData.showSpinner=!1,n.GroupsData.error=t.data,n.GroupsData.serverError=!0})):(f=t.item,(f.SupportedType===1||f.SupportedType===2)&&(f.AppDeploymentsInfo=u.GetDeploymentsInfo(),f.AppDeploymentsInfo.forEach(function(n,t,i){i[t].selected=f.AppDeployments.indexOf(n.id.toLowerCase())>=0}))),f}function e(n,t){return n.ProtectAgainstLostOrStolenDevices=t,n.DaysOfflineBeforeWipeIsEnforced=t?"90":"0",n.OnlyAllowOneDriveForBusinessStorage=t,n.EncryptOfficeFiles=t,n}function o(n,t){return n.ControlUsersOfficeDocsAccessOnMobileDevices=t,n.PinRequiredForOfficeApps=t,n.MaxPinRetries=t?"5":"0",n.MinutesOfIdleBeforePinRequired=t?"30":"0",n.DoNotAllowJailbrokenOrRootedDevices=t,n.DoNotAllowCompanyDataCopyingFromOffice=!1,n}function s(n,t){return n.ProtectWindows10Devices=t,n.WindowsDefenderOn=t,n.ProtectFromThreats=t,n.AllowFingerprintOrFacialLogin=t,n.MinutesOfIdleBeforeTurnOffScreen=t?"5":"0",n.AutoUpdateWin10Devices=t,n.PreventAppDownload=!1,n.PreventCortanaUsage=!1,n}function l(n,t){return t===0?1:n.SupportedType}function a(t){t===0?(n.showDeviceProtection=!0,n.expandDeviceProtection=!1,n.showOfficeDocsOnMobileDevices=!0,n.expandOfficeDocsOnMobileDevices=!1,n.showProtectWindows10Devices=!1,n.expandProtectWindows10Devices=!1,n.showProtectedApps=!0,n.showPolicyName=!0):(n.showDeviceProtection=!1,n.expandDeviceProtection=!1,n.showOfficeDocsOnMobileDevices=!1,n.expandOfficeDocsOnMobileDevices=!1,n.showProtectWindows10Devices=!1,n.expandProtectWindows10Devices=!1,n.showProtectedApps=!1,n.showPolicyName=!1);switch(t){case 2:n.showDeviceProtection=!0,n.expandDeviceProtection=!0;break;case 3:n.showOfficeDocsOnMobileDevices=!0,n.expandOfficeDocsOnMobileDevices=!0;break;case 5:n.showProtectWindows10Devices=!0,n.expandProtectWindows10Devices=!0;break;case 4:n.showProtectedApps=!0;break;case 1:n.showPolicyName=!0}}this.$scope=n,this.$rootScope=t,this.HelperService=i,this.IntuneService=r,this.IntuneHelperService=u,this.LogService=f,n.PolicyTypeSelectionChange=function(){n.showDeviceProtection=u.GetPolicyTargetType(n.formData.SupportedPolicyType)===1,n.showOfficeDocsOnMobileDevices=u.GetPolicyTargetType(n.formData.SupportedPolicyType)===1,n.showProtectedApps=u.GetPolicyTargetType(n.formData.SupportedPolicyType)===1,n.showProtectWindows10Devices=u.GetPolicyTargetType(n.formData.SupportedPolicyType)===2},n.ToggleExpandDeviceProtection=function(){n.expandDeviceProtection=!n.expandDeviceProtection},n.ToggleExpandOfficeDocsOnMobileDevices=function(){n.expandOfficeDocsOnMobileDevices=!n.expandOfficeDocsOnMobileDevices},n.ToggleExpandProtectWindows10Devices=function(){n.expandProtectWindows10Devices=!n.expandProtectWindows10Devices},n.ToggleProtectAgainstLostOrStolenDevices=function(){n.policyModel=e(n.policyModel,n.policyModel.ProtectAgainstLostOrStolenDevices)},n.RestoreDefaultsDeviceProtection=function(){n.policyModel=e(n.policyModel,!0)},n.ToggleOfficeDocsOnMobileDevices=function(){n.policyModel=o(n.policyModel,n.policyModel.ControlUsersOfficeDocsAccessOnMobileDevices)},n.RestoreDefaultsOfficeDocsOnMobileDevices=function(){n.policyModel=o(n.policyModel,!0)},n.ToggleProtectWindows10Devices=function(){n.policyModel=s(n.policyModel,n.policyModel.ProtectWindows10Devices)},n.RestoreDefaultsProtectWindows10Devices=function(){n.policyModel=s(n.policyModel,!0)},n.Submit=function(){var i=u.GetPolicyTargetType(n.formData.SupportedPolicyType),e;if(i===1&&(e=n.policyModel.AppDeploymentsInfo.filter(function(n){return n.selected}),n.policyModel.AppDeployments=e.map(function(n){return n.id})),n.operationModel.operation===0){n.policyModel.Type=u.GetPolicyType(n.formData.SupportedPolicyType),n.policyModel.GroupAssignments=n.GroupsData.selectedGroups;switch(i){case 1:n.StartOperation(),r.CreateAppPolicy(n.policyModel).then(function(i){t.$broadcast('intunePolicyCreated',{policy:i.data}),n.EndOperation()},function(t){n.SetOperationError(t.data)});break;case 2:n.StartOperation(),r.CreateDevicePolicy(n.policyModel).then(function(i){t.$broadcast('intunePolicyCreated',{policy:i.data}),n.EndOperation()},function(t){n.SetOperationError(t.data)});break;default:f.LogError(423426,"While creating policy, type is undefined: {0}".Format(n.formData.SupportedPolicyType))}}else switch(i){case 1:n.StartOperation(),n.showProtectedApps?r.UpdateAppDeployments(n.policyModel.Id,n.policyModel.Type,n.policyModel.AppDeployments).then(function(){t.$broadcast('intunePolicyUpdated',{policy:n.policyModel}),n.EndOperation()},function(t){n.SetOperationError(t.data)}):r.UpdateAppPolicy(n.policyModel).then(function(){t.$broadcast('intunePolicyUpdated',{policy:n.policyModel}),n.EndOperation()},function(t){n.SetOperationError(t.data)});break;case 2:n.StartOperation(),r.UpdateDevicePolicy(n.policyModel).then(function(){t.$broadcast('intunePolicyUpdated',{policy:n.policyModel}),n.EndOperation()},function(t){n.SetOperationError(t.data)});break;default:f.LogError(423426,"While updating policy, type is undefined: {0}".Format(n.formData.SupportedPolicyType))}},n.SetOperationError=function(t){n.operationModel.serverError=!0,n.operationModel.showSpinner=!1,n.operationModel.error=t,n.operationModel.complete=!1},n.ClearOperationError=function(){n.operationModel.serverError=!1,n.operationModel.showSpinner=!1,n.operationModel.complete=!1},n.StartOperation=function(){n.operationModel.serverError=!1,n.operationModel.showSpinner=!0,n.operationModel.complete=!1},n.EndOperation=function(){n.operationModel.serverError=!1,n.operationModel.showSpinner=!1,n.operationModel.complete=!0},n.Cancel=function(){n.$emit('closeFlyout')},n.ChangeTargetGroups=function(){n.changingTargetGroup=!0},n.OfficeDocsPinRequirementChanged=function(){n.policyModel.MaxPinRetries=n.policyModel.PinRequiredForOfficeApps?"5":"0",n.policyModel.MinutesOfIdleBeforePinRequired=n.policyModel.PinRequiredForOfficeApps?"30":"0"},n.$on('intunePoliciesGroupsUpdated',function(){}),n.$on('intunePolicyUpdated',function(t,i){var r=u.GetPolicyData(i.policy);n.policyModel=h({item:r},n.operationModel.operation)}),n.$on('intuneGroupsSelected',function(t,i){i!=null&&i.length>0&&(n.GroupsData.selectedGroups=i,n.changingTargetGroup=!1)}),n.operationModel={operation:c(n.selecteditem),serverError:!1,showSpinner:!1,error:null,complete:!1},n.policyModel=h(n.selecteditem,n.operationModel.operation),n.formData.SupportedPolicyType=l(n.policyModel,n.operationModel.operation),a(n.operationModel.operation),n.GroupsData={allGroups:[],selectedGroups:[],serverError:!1,showSpinner:!0,noResults:!1},n.changingTargetGroup=!1,n.operationModel.operation===0&&(n.RestoreDefaultsDeviceProtection(),n.RestoreDefaultsOfficeDocsOnMobileDevices(),n.RestoreDefaultsProtectWindows10Devices())}return n.$inject=["$scope","$rootScope","HelperService","IntuneService","IntuneHelperService","LogService"],n}(),n.EditPolicyController=t,n.app.controller("EditPolicyController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f){function h(){n.formData.inAddUserMode=!0,n.showContactInfo=!1,n.showPasswordGeneration=!1,n.showAdminSelection=!1,n.showProductsInfo=!1,n.showSkypeMessageCount=0,n.selfgeneratedpassword="********",n.currentAdminRole='User \x28no administrator access\x29',n.perYear='per year',n.perMonth='per month',n.isCurrentRoleLimitedAdmin=!1,n.domainslist=[],n.isProductAvailable=!0,n.saveinprogress=!1,n.saveActionStarted=!0,n.failedGettingPageDefaults=!1,n.NoSubscriptionPrice=!1,n.showCloseButton=!1,n.AddingUser=!1,n.updatingLicensing=!1,n.recoverableUserError=!1,n.ShowSkypeProvisioningMessage=!1,n.ShowSkypeNotification=!1,n.IntervalTimeout=2e3,n.IntervalCount=15,n.DefaultDomain="",n.getProductsCompleted=!1,n.showLastNameFirst=!1,n.products=[],n.locations=[],n.selectedLocation='',n.limitedUserValue={ObjectId:"limited"},n.showEmailConfirmationMessage=!1,n.showSendEmailControl=!0,n.emailSendFailure=!1,n.formData.sendPasswordEmailCheck=!0,n.showCreateUserWithNoLicenseMessage=!0,n.formData.EmailAddress='',n.enableAlternateEmail=!1,n.formData.sendPasswordEmailAddress=n.$root.CurrentUserInfo.UserInfo.UserPrincipalName,n.sendPasswordEmailModel={Recipients:n.formData.sendPasswordEmailAddress,Message:"",EmailTemplate:1,EmailContents:[]},n.clearAdminRole=function(){angular.forEach(n.adminRoles.HighlevelRoles,function(n){n.IsEnabled=!1}),angular.forEach(n.adminRoles.OtherAdminRoles,function(n){n.IsEnabled=!1})},c(),n.showCustomValidationMessage=function(){if(n.isCurrentRoleLimitedAdmin&&n.saveClicked){var t=!1;return angular.forEach(n.adminRoles.OtherAdminRoles,function(n){n.IsEnabled&&(t=!0)}),!t}return!1},n.getCurrentAdminRole=function(t,i){n.clearAdminRole(),n.saveClicked=!1,t.ObjectId=="00000000-0000-0000-0000-000000000001"?(n.currentAdminRole=t.DisplayName,n.adminRoles.HighlevelRoles[i].IsEnabled=!0,n.isCurrentRoleLimitedAdmin=!1):t.ObjectId=="00000000-0000-0000-0000-000000000000"?(n.currentAdminRole=t.DisplayName,n.isCurrentRoleLimitedAdmin=!0,n.adminRoles.HighlevelRoles[i].IsEnabled=!0,n.enableAlternateEmail=!0):(n.currentAdminRole=t.DisplayName,n.isCurrentRoleLimitedAdmin=!1,n.adminRoles.HighlevelRoles[i].IsEnabled=!0,n.enableAlternateEmail=!0)},r.GetAddUserPageDefaults().then(function(t){n.newuserDefaults=t.data,n.formData.SendPasswordEmailAddress=t.data.SendPasswordEmailAddress,n.formData.ForceChangePassword=!0,n.showLastNameFirst=t.data.ShowLastNameFirst,n.showZipCodeFirst=t.data.ShowZipFirst,n.DefaultDomain=t.data.DefaultDomain.Name,angular.forEach(t.data.Domains,function(t){n.domainslist.push(t.Name)})},function(){n.failedGettingPageDefaults=!0}),r.GetAdminRoles().then(function(t){n.adminRoles=t.data,angular.forEach(t.data.HighlevelRoles,function(t){t.ObjectId==="00000000-0000-0000-0000-000000000001"&&(n.userrole=t,n.userrole.IsEnabled=!0)})},function(){n.FailedGettingAdminRoles=!0}),n.productSelected=0,n.genericError=!1,n.getAppIconsForSubscription=function(t,i){r.GetProductAppIcons(i).then(function(i){angular.forEach(n.products,function(n){n.ProductSkuId===t&&(n.appsIcon=[],angular.forEach(i.data,function(t){n.appsIcon.push(t)}))})})},n.GetFullPriceText=function(t,i){var r='';return i&&i.toLowerCase()==="monthly"?r=t+" "+n.perMonth:i&&i.toLowerCase()==="annually"&&(r=t+" "+n.perYear),r},r.GetTenantProducts().then(function(t){n.products=t.data.Products,n.getProductsCompleted=!0,n.products&&n.products.length!==0||(n.formData.CreateUserWithNoLicense=!0),n.ShowSkypeProvisioningMessage=t.data.ShowSkypeProvisioningMessage,n.SkypeAdminCenterUrl=t.data.SkypeAdminCenterUrl,angular.forEach(t.data.Products,function(t){if(t.appsIcon=[],t.eligibleSubscriptions=[],t.ShowDetails=!1,t.subscriptionCap=!1,t.subscriptionError=!1,t.ProductSkuId){if(!n.$root.features.CanBuyLicense){t.additionalQuantity=t.AvailableUnits<=0?1:0,!t.IsSelected&&t.additionalQuantity>0&&(t.IsDisabledDueToError=!0);return}r.GetSubscriptions(t.ProductSkuId,1).then(function(i){var u,h;if(t.additionalQuantity=i.data.additionalQuantity,t.licenseOutOfSync=i.data.licenseOutOfSync,i.data.eligibleSubscriptions&&i.data.eligibleSubscriptions.length>0)u=[],angular.forEach(i.data.eligibleSubscriptions,function(i){i.apps=[],i.IsSubSelected=!1,t.eligibleSubscriptions.push(i),i.Id&&i.State.toLowerCase()==='active'&&(u.push(i.Id),r.GetOfferUnitPrices(i.Id).then(function(r){r.data&&angular.forEach(r.data,function(r){r.OfferId===i.OfferId&&(t.unitPrice=n.GetFullPriceText(r.PriceText,r.BillingCyle))})},function(){n.FailedToGetProductUnitPrice=!0}))}),u&&r.GetSubscriptionPrice(u).then(function(t){n.subscriptionPriceResponse=t.data},function(){n.NoSubscriptionPrice=!0});else if(t.additionalQuantity>0)if(t.licenseOutOfSync=!1,t.subscriptionError=!0,t.IsDisabledDueToError=!0,i.data.ineligibleSubscriptions&&i.data.ineligibleSubscriptions.length===1)t.subscriptionIsTrail=i.data.ineligibleSubscriptions[0].Offer.IsTrial,t.subscriptionIsPrepaid=i.data.ineligibleSubscriptions[0].Offer.IsPrepaid,t.ccOrSubscriptionError=!(i.data.ineligibleSubscriptions[0].Offer.IsTrial||i.data.ineligibleSubscriptions[0].Offer.IsPrepaid);else if(i.data.ineligibleSubscriptions&&i.data.ineligibleSubscriptions.length>1){var e=!1,o=!1,s=!1;angular.forEach(i.data.ineligibleSubscriptions,function(n){e||(e=!(n.Offer.IsTrial||n.Offer.IsPrepaid)),o||(o=n.Offer.IsTrial),s||(s=n.Offer.IsPrePaid)}),e?t.ccOrSubscriptionError=!0:s?t.subscriptionIsPrepaid=!0:o?t.subscriptionIsTrail=!0:t.ccOrSubscriptionError=!0}else t.ccOrSubscriptionError=!0;n.products.length===1?(n.products[0].subscriptionError||n.products[0].additionalQuantity>0?(n.showProductsInfo=!0,n.products[0].IsSelected=!1):(n.showProductsInfo=!1,n.products[0].IsSelected||n.products[0].IsDisabled||(n.products[0].IsSelected=!0)),i.data.eligibleSubscriptions&&i.data.eligibleSubscriptions.length>1&&(n.showProductsInfo=!0)):n.showProductsInfo=!0,t.IsSelected&&(n.productSelected++,f.IsValid(t.PrerequisiteMessage)&&n.showSkypeMessageCount++),h=t.IsSelected,t.ServicePlans!=null&&angular.forEach(t.ServicePlans,function(n){n.ServicePlan.IsDisabled||(n.IsSelected=h)}),i.data.eligibleSubscriptions&&i.data.eligibleSubscriptions.length>0&&(t.eligibleSubscriptions[0].IsSubSelected=!0)},function(n){typeof n.data!="object"&&n.data.toLowerCase()=='subscriptionsreachedmaximumquantity'?t.subscriptionCap=!0:typeof n.data!="object"&&n.data.toLowerCase()=='invalidpaymentinstrument'?t.invalidPaymentOption=!0:t.genericError=!0,t.IsSelected=!1,t.IsDisabledDueToError=!0})}})},function(){n.isProductAvailable=!1})}function c(){r.GetLocations().then(function(t){angular.forEach(t.data,function(t){var r={};r.DisplayName=t.DisplayName,r.CountryCode=t.CountryCode,n.locations.push(r),t.IsDefault==!0&&(n.selectedLocation=r)})})}function l(){n.productSelected=0,angular.forEach(n.products,function(t){t.IsSelected?(t.eligibleSubscriptions&&t.eligibleSubscriptions.length==1&&(t.eligibleSubscriptions[0].IsSubSelected=!0),n.productSelected++):f.IsValid(t.PrerequisiteMessage)&&n.showSkypeMessageCount--})}function o(n,t){return n&&t?n+" "+t:n?n:t?t:undefined}function s(t,i){n.formData.Initials=u.GetInitialsFromFirstAndLastName(t,i)}function a(){var t=!1;return angular.forEach(n.products,function(n){n.IsSelected&&!t&&(t=n.licenseOutOfSync)}),t}this.$scope=n,this.$interval=i,this.UserManagementService=r,this.ProfileService=u,this.HelperService=f,n.ToggleContactInformation=function(t){n.showContactInfo=!n.showContactInfo,angular.element(t.currentTarget).attr("aria-expanded",n.showContactInfo)},n.TogglePasswordGeneration=function(t){n.showPasswordGeneration=!n.showPasswordGeneration,angular.element(t.currentTarget).attr("aria-expanded",n.showPasswordGeneration)},n.ToggleAdminRolesSelection=function(t){n.showAdminSelection=!n.showAdminSelection,angular.element(t.currentTarget).attr("aria-expanded",n.showAdminSelection)},n.ToggleProductInfo=function(t){n.showProductsInfo=!n.showProductsInfo,angular.element(t.currentTarget).attr("aria-expanded",n.showProductsInfo)},n.ToggleProductDetails=function(t,i){n.products[t].ShowDetails=!n.products[t].ShowDetails,angular.element(i.currentTarget).attr("aria-expanded",n.products[t].ShowDetails)},n.ToggleProductSettings=function(n,t){n.ShowDetails=n.IsSelected,angular.element(t.currentTarget).attr("aria-expanded",n.ShowDetails),angular.forEach(n.ServicePlans,function(t,i){n.ServicePlans[i]=n.ShowDetails})},n.ToggleProductSelection=function(t){var r=!0;angular.forEach(t.ServicePlans,function(t){t.IsSelected&&(r=!1),n.formData.CreateUserWithNoLicense=!1}),r?(t.ShowDetails=!1,t.IsSelected=!1):(t.ShowDetails=!0,t.IsSelected=!0),l()},n.UpdatePersonCardDomain=function(){n.formData.UserName&&(n.formData.UserPrincipalName=n.formData.UserName+'@'+n.DefaultDomain)},n.UpdatePersonCardInitials=function(){if(n.formData.FirstName&&n.formData.LastName&&n.formData.DisplayName)n.showLastNameFirst?s(n.formData.LastName,n.formData.FirstName):s(n.formData.FirstName,n.formData.LastName);else if(n.formData.DisplayName){var t=n.formData.DisplayName.substring(0,n.formData.DisplayName.length>1?2:n.formData.DisplayName.length);n.formData.Initials=t.toUpperCase()}else n.formData.Initials='NU'},n.PopulateDisplayName=function(){n.formData.DisplayName||(n.formData.DisplayName=n.showLastNameFirst?o(n.formData.LastName,n.formData.FirstName):o(n.formData.FirstName,n.formData.LastName)),n.UpdatePersonCardInitials()},n.DeSelectAllProductsServicesAndSubscription=function(){n.formData.CreateUserWithNoLicense&&(angular.forEach(n.products,function(t,i){t.IsSelected=!1,n.DeSelectAllSubscriptions(i),t.ServicePlans!=null&&angular.forEach(t.ServicePlans,function(n){n.IsSelected=!1})}),n.productSelected=0)},n.SetProductSelected=function(t,i){$("#"+t).is(":checked")?(n.productSelected++,n.products[i].IsSelected=!0,n.products[i].ShowDetails=!0,n.products[i].eligibleSubscriptions&&n.products[i].eligibleSubscriptions.length==1&&(n.products[i].eligibleSubscriptions[0].IsSubSelected=!0),n.products[i].ServicePlans!=null&&angular.forEach(n.products[i].ServicePlans,function(n){n.IsSelected=!0}),f.IsValid(n.products[i].PrerequisiteMessage)&&n.showSkypeMessageCount++,n.ShowSkypeNotification=n.products[i].HasSkypeNotificationMessage):(n.productSelected--,n.products[i].IsSelected=!1,n.products[i].ShowDetails=!1,n.DeSelectAllSubscriptions(i),f.IsValid(n.products[i].PrerequisiteMessage)&&n.showSkypeMessageCount--,n.products[i].ServicePlans!=null&&angular.forEach(n.products[i].ServicePlans,function(n){n.IsSelected=!1})),n.formData.CreateUserWithNoLicense=!1},n.disabledProductStyle=function(n){var t='';return t=n.IsDisabled||n.IsDisabledDueToError?'f-prdts-disabled':''},n.IsAdditionalQuantityRequired=function(){var t=!1;return n.AddtionalLicenseRequired=0,n.SelectedSubscription='',angular.forEach(n.products,function(i){i.IsSelected&&angular.forEach(i.eligibleSubscriptions,function(r){r.IsSubSelected&&i.additionalQuantity>0&&!i.licenseOutOfSync&&(t=!0,n.AddtionalLicenseRequired+=i.additionalQuantity,n.SelectedSubscription+=i.unitPrice?i.ProductDisplayName+" ("+i.unitPrice+"), ":i.ProductDisplayName+", ")})}),t},n.DeSelectAllSubscriptions=function(t){angular.forEach(n.products[t].eligibleSubscriptions,function(n){n.IsSubSelected=!1})},n.ToggleSubscriptionSelected=function(t,i){angular.forEach(t.eligibleSubscriptions,function(r,u){u!=i&&(t.eligibleSubscriptions[u].IsSubSelected=!1,t.eligibleSubscriptions[u].HasSkypeNotificationMessage&&(n.ShowSkypeNotification=!0))})},n.UpdateQuantityPostData=function(){n.Subscriptions=[],n.ProductSkuids='',angular.forEach(n.products,function(t){t.IsSelected&&angular.forEach(t.eligibleSubscriptions,function(i){if(i.IsSubSelected&&t.additionalQuantity>0){var u={SubscriptionId:i.Id,NewQuantity:t.additionalQuantity+i.CurrentQuantity};n.Subscriptions.push(u),n.ProductSkuids+=t.ProductSkuId+','}})})},n.GetAdminRolesData=function(){n.formData.AdminRoles=[],angular.forEach(n.adminRoles.HighlevelRoles,function(t){t.ObjectId!="00000000-0000-0000-0000-000000000000"&&n.formData.AdminRoles.push(t)}),angular.forEach(n.adminRoles.OtherAdminRoles,function(t){n.formData.AdminRoles.push(t)})},n.CreateDataForPost=function(){n.GetAdminRolesData(),n.formData.Domains=n.domainslist,n.formData.DefaultDomain=n.DefaultDomain,n.formData.PrimaryEmailAddress=n.formData.UserName+'@'+n.DefaultDomain,n.formData.isSelfgeneratePassword?n.formData.Password=n.formData.NewPassword:(n.formData.Password=null,n.formData.NewPassword=null),n.formData.Products=n.products,n.formData.UserPrincipalName=n.formData.UserName+'@'+n.DefaultDomain,n.formData.UsageLocation=n.selectedLocation.CountryCode},n.Cancel=function(){n.$emit('closeFlyout'),ModalFeedbackV2.ShowModal("AddUser","admin")},n.CreateUserHelper=function(){i.cancel(n.timeoutpromise),n.updatingLicensing=!1,n.AddingUser=!0,n.addUserModel=angular.copy(n.formData),n.addUserModel.Initials="",r.CreateUser(n.addUserModel).then(function(t){var t=t.data,i;n.createdUserObject=t.UserInfo,n.createdUserWithNoLicense=t.Code==101,n.AddingUser=!1,n.saveActionStarted=!1,n.statusMessage=t.Message,n.showCloseButton=!0,n.formData.refreshListArgs={},i={UserPrincipalName:t.AdditionalMessageInfo.EncryptedUPN,Password:t.AdditionalMessageInfo.EncryptedPassword},n.sendPasswordEmailModel.EmailContents.push(i),n.sendPasswordEmailModel.EmailTemplate=1,angular.element(".flyoutClose").focus(),n.formData.title=n.createdUserWithNoLicense?'User was added, but there was a problem':'User was added',n.createdUserWithNoLicense&&O365.Instrument.ClientInstrument.getInstance().logClientDataAndValue("AddUser:CreatedUser","PurchasedLicense-FailedToAssignLicense")},function(t){var t=t.data;n.AddingUser=!1,n.saveActionStarted=!1,t.Code>=300&&t.Code<500?(n.recoverableUserError=!0,n.saveinprogress=!1):(n.formData.sendPasswordEmailCheck=!1,n.formData.title='Failed to add user'),n.statusErrorMessage=t.Message,n.showCloseButton=!0,angular.element(".flyoutClose").focus()})},n.IsSubscriptionError=function(){var t=!1;return angular.forEach(n.products,function(n){n.IsSelected&&(t||(t=n.subscriptionError))}),t},n.IsAdditionalQuantityUpdated=function(){n.IntervalCount--,n.IntervalCount<=0?n.CreateUserHelper():r.IsAdditionalQuantityUpdated(n.ProductSkuids.substr(0,n.ProductSkuids.length-1)).then(function(t){angular.forEach(t.data,function(t){t.PurchasedQuantity>t.ConsumedQuantity&&n.CreateUserHelper()})})},n.IsSubscriptionSelected=function(t){var i=!1;return angular.forEach(n.products[t].eligibleSubscriptions,function(n){i||(i=n.IsSubSelected)}),i},n.ShouldDisableSubmit=function(){return!((n.productSelected>0||n.formData.CreateUserWithNoLicense)&&n.isProductAvailable&&!n.FailedGettingAdminRoles&&!n.failedGettingPageDefaults&&n.domainslist.length>0&&!n.genericError)};var e=function(){n.productModelCount=n.formData.CreateUserWithNoLicense?1:n.productSelected};e(),n.$watch("productSelected",e),n.$watch("formData.CreateUserWithNoLicense",e),n.$watch("AddUserForm.$invalid",function(t){n.recoverableUserError&&(n.recoverableUserError=t?!0:!1)}),n.GetSelectedProduct=function(){var t='';return angular.forEach(n.products,function(n){n.IsSelected&&(t=n.ProductDisplayName)}),t},n.SetIntervalandCount=function(){var i=parseInt($("#OcpBecReconcileIntervalTimeoutInSec").text())*1e3,t;isNaN(i)||(n.IntervalTimeout=i),t=parseInt($("#OcpBecReconcileIntervalCount").text()),isNaN(t)||(n.IntervalCount=t)},n.SendPasswordEmail=function(){n.sendPasswordEmailModel.Recipients=n.formData.sendPasswordEmailAddress,r.SendSingleUserPasswordEmail(n.sendPasswordEmailModel).then(function(t){t.data.Status!=0?(n.showEmailConfirmationMessage=!0,n.emailConfirmationMessage=t.data.Message,n.emailSendFailure=!0,n.showSendEmailControl=!0,n.formData.sendPasswordEmailCheck=!1):n.Cancel()},function(t){n.showEmailConfirmationMessage=!0,n.emailConfirmationMessage=t.data.Message,n.emailSendFailure=!0,n.showSendEmailControl=!0,n.formData.sendPasswordEmailCheck=!1})},n.Submit=function(t){(n.saveClicked=!0,n.showCustomValidationMessage())||(t.$valid?(n.statusMessage=null,n.statusErrorMessage=null,n.saveinprogress=!0,n.saveActionStarted=!0,n.CreateDataForPost(),n.IsAdditionalQuantityRequired()?(n.SetIntervalandCount(),n.updatingLicensing=!0,n.UpdateQuantityPostData(),r.UpdateQuantity(n.Subscriptions).then(function(t){n.quantityUpdateMessage=t.data,O365.Instrument.ClientInstrument.getInstance().logClientDataAndValue("AddUser:PurchaseLicense","Success"),n.timeoutpromise=i(n.IsAdditionalQuantityUpdated,n.IntervalTimeout,n.IntervalCount)},function(){O365.Instrument.ClientInstrument.getInstance().logClientDataAndValue("AddUser:PurchaseLicense","Failure"),n.genericError=!0,n.updatingLicensing=!1,n.saveinprogress=!1,n.saveActionStarted=!1,n.AddingUser=!1,n.updatingLicensing=!1,n.formData.sendPasswordEmailCheck=!1})):a()?(n.AddingUser=!0,n.timeoutpromise=i(n.IsAdditionalQuantityUpdated,n.IntervalTimeout,n.IntervalCount)):n.CreateUserHelper()):(n.showProductsInfo||(n.showProductsInfo=!0),n.AddUserForm.displayname.$setTouched(),n.AddUserForm.username.$setTouched(),n.recoverableUserError=!0,n.saveinprogress=!1,$(document.getElementById("flyout")).scrollTop(0)),n.GetRecoverableErrorMessage=function(){return n.AddUserForm.$invalid?'Please provide all required fields.':n.statusErrorMessage},n.ShowPassword=function(){n.selfgeneratedpassword=n.statusMessage},n.HidePassword=function(){n.selfgeneratedpassword="********"},n.$on("$destroy",function(){i.cancel(n.timeoutpromise)}))},n.sendEmailForRelatedTasks=function(i){n.formData.refreshListArgs={},t.$broadcast('RefreshList',n.formData.refreshListArgs),n.formData.sendPasswordEmailCheck&&(n.sendPasswordEmailModel.Recipients=n.formData.sendPasswordEmailAddress,r.SendSingleUserPasswordEmail(n.sendPasswordEmailModel).then(function(){console.log("Email sent successfully"),O365.Log.WriteLog(419088,O365.LogLevel.Info,O365.LogArea.UserManagement,O365.LogParameter.Empty,"Email sent succesfully")},function(n){console.log("Error sending email:",n),O365.Log.WriteLog(419087,O365.LogLevel.Error,O365.LogArea.UserManagement,O365.LogParameter.Empty,"Error sending the email and the response is "+n)})),i&&n.$emit('closeFlyout')},h()}return n.$inject=["$scope","$rootScope","$interval","UserManagementService","ProfileService","HelperService"],n}();n.AddUserController=t,n.app.controller("AddUserController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function r(t){n.localScope.domains=t;var i={Name:'Any domain',Status:"Invalid"};n.localScope.domains.unshift(i),n.localScope.domain=i}function u(t){n.localScope.usageLocations=t;var i={DisplayName:'Any location',CountryCode:"Invalid"};n.localScope.usageLocations.unshift(i),n.localScope.location=i}function f(t){n.localScope.products=t;var i={AccountName:"Invalid",SkuPartNumber:"Invalid",ProductDisplayName:'Select a license'};n.localScope.products.unshift(i),n.localScope.product=i}function e(){t.GetCurrentUserview(n.selecteditem).then(function(t){var i=t.data;n.formData.customView=i,n.formData,i.Domain&&angular.forEach(n.localScope.domains,function(t){i.Domain==t.Name&&(n.localScope.domain=t)}),i.UsageLocationCode&&angular.forEach(n.localScope.usageLocations,function(t){i.UsageLocationCode==t.CountryCode&&(n.localScope.location=t)}),i.Asi&&i.Asi.SkuPartNumber!="InValid"&&angular.forEach(n.localScope.products,function(t){i.Asi.SkuPartNumber==t.SkuPartNumber&&(n.localScope.product=t)}),angular.forEach(n.localScope.signInStatusOptions,function(t){i.SignInStatus==t.Status&&(n.localScope.signInStatus=t),n.loadInProgress=!1})},function(){})}function o(){n.isEdit=n.selecteditem?!0:!1,n.loadInProgress=!0,n.loadingMessage='Loading',n.saveInProgress=!1,n.saveCompleted=!1,n.viewValidationError=!1,n.statusErrorMessage=null,n.localScope={},n.formData.customView={},n.formData.customView.Asi={},n.localScope.signInStatusOptions=[{Name:'Any status',Status:0},{Name:'Sign-in allowed',Status:1},{Name:'Sign-in blocked',Status:2}],n.localScope.signInStatus=n.localScope.signInStatusOptions[0],t.GetCustomViewFilterDefaults().then(function(t){r(t.data.Domains),u(t.data.Locations),f(t.data.Products),n.isEdit?e():(n.loadInProgress=!1,n.$root.refreshList=!0,n.$root.refreshFilterView=!0)},function(){})}this.$scope=n,this.UserManagementService=t,this.HelperService=i,n.Save=function(){if(!n.AddorEditCustomViewFilterForm.$valid){n.AddorEditCustomViewFilterForm.viewname.$setTouched(),n.viewValidationError=!0,n.statusErrorMessage='Please provide all required fields.';return}n.saveInProgress=!0,n.statusErrorMessage=null,n.loadingMessage='Saving the custom view',n.localScope.domain.Status!="Invalid"&&(n.formData.customView.Domain=n.localScope.domain.Name),n.formData.customView.UsageLocationCode=n.localScope.location.CountryCode!="Invalid"?n.localScope.location.CountryCode:null,n.localScope.product.SkuPartNumber!="Invalid"?(n.formData.customView.Asi==null?n.formData.customView.Asi={}:null,n.formData.customView.Asi.AccountName=n.localScope.product.AccountName,n.formData.customView.Asi.SkuPartNumber=n.localScope.product.SkuPartNumber):n.formData.customView.Asi=null,n.formData.customView.SignInStatus=n.localScope.signInStatus.Status,n.isEdit?t.EditCustomFilter(n.formData.customView).then(function(){n.saveInProgress=!1,n.saveCompleted=!0,n.successMessage='Your custom view has been updated\x3a  '+n.formData.customView.UserViewName,n.$root.refreshList=!0,n.$root.refreshFilterView=!0},function(t){n.saveInProgress=!1,n.saveCompleted=!0,n.failureMessage=t.data.Message}):t.AddCustomFilter(n.formData.customView).then(function(){n.saveInProgress=!1,n.saveCompleted=!0,n.successMessage='Your custom view is ready to use. You can find it in the view list\x3a '+n.formData.customView.UserViewName},function(t){n.saveInProgress=!1,n.saveCompleted=!1,n.viewValidationError=!0,n.statusErrorMessage=t.data.Message})},n.DeleteView=function(){n.saveInProgress=!0,t.DeleteView(n.selecteditem).then(function(){n.saveInProgress=!1,n.saveCompleted=!0,n.successMessage='This custom view was deleted\x3a  '+n.formData.customView.UserViewName,n.$root.refreshList=!0,n.$root.refreshFilterView=!0},function(t){n.saveInProgress=!1,n.saveCompleted=!0,n.failureMessage=t.data.Message})},n.Cancel=function(){n.$emit('closeFlyout')},o()}return n.$inject=["$scope","UserManagementService"],n}();n.app.controller("CustomViewFilter",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r){function f(){t.saveinprogress=!1,t.formData.ObjectId=t.objectid,t.formData.FirstName=t.selecteditem.FirstName,t.formData.LastName=t.selecteditem.LastName,t.formData.DisplayName=t.selecteditem.DisplayName,t.showContactInfo=t.data.JobTitle?!0:!1,t.formData.JobTitle=t.data.JobTitle,t.showContactInfo=t.showContactInfo||t.data.Department?!0:!1,t.formData.Department=t.data.Department,t.showContactInfo=t.showContactInfo||t.data.Office?!0:!1,t.formData.Office=t.data.Office,t.showContactInfo=t.showContactInfo||t.data.OfficePhone?!0:!1,t.formData.OfficePhone=t.data.OfficePhone,t.showContactInfo=t.showContactInfo||t.data.MobilePhone?!0:!1,t.formData.MobilePhone=t.data.MobilePhone,t.showContactInfo=t.showContactInfo||t.data.FaxNumber?!0:!1,t.formData.FaxNumber=t.data.FaxNumber,t.showContactInfo=t.showContactInfo||t.data.StreetAddress?!0:!1,t.formData.StreetAddress=t.data.StreetAddress,t.showContactInfo=t.showContactInfo||t.data.City?!0:!1,t.formData.City=t.data.City,t.showContactInfo=t.showContactInfo||t.data.StateProvince?!0:!1,t.formData.StateProvince=t.data.StateProvince,t.showContactInfo=t.showContactInfo||t.data.ZipOrPostalCode?!0:!1,t.formData.ZipOrPostalCode=t.data.ZipOrPostalCode,t.showContactInfo=t.showContactInfo||t.data.CountryRegion?!0:!1,t.formData.CountryRegion=t.data.CountryRegion,t.formData.SignInStatus=t.data.SignInStatus,t.formData.SignInStatusVal=t.formData.SignInStatus?"allowed":"blocked",t.DirSyncEnabled=t.data.IsDirSyncEnabled,t.showLastNameFirst=!1,t.editSigninStatusPage||i.GetAddUserPageDefaults().then(function(n){t.newuserDefaults=n.data,t.emailAdmin=n.data.SendPasswordEmailAddress,t.showLastNameFirst=n.data.ShowLastNameFirst,t.showZipCodeFirst=n.data.ShowZipFirst})}this.$scope=t,this.UserManagementService=i,this.PanelService=r,t.setInputParams=function(n){t.editSigninStatus=n,t.objectid&&i.GetUserDetails(t.objectid).then(function(n){t.data=n.data,f()})},t.ToggleContactInformation=function(){t.showContactInfo=!t.showContactInfo},t.Cancel=function(){t.$emit('closeFlyout')},t.Close=function(){t.$emit('closeFlyout')};var e=function(){angular.isDefined(t.$root.selectedViewFilterId)&&(t.$root.selectedViewFilterId==n.UserView.AllEnabledUsersViewId||t.$root.selectedViewFilterId==n.UserView.AllDisabledUsersViewId)&&(t.formData.refreshListArgs={})},u=function(){r.SetSelectedItem(t.formData),t.$root.ActiveUserData&&t.$root.ActiveUserData.ListModel&&angular.forEach(t.$root.ActiveUserData.ListModel,function(n,i){n.ObjectId===t.formData.ObjectId&&(t.$root.ActiveUserData.ListModel[i].DisplayName=t.formData.DisplayName,t.$root.ActiveUserData.ListModel[i].FirstName=t.formData.FirstName,t.$root.ActiveUserData.ListModel[i].Initials=t.formData.Initials,t.$root.ActiveUserData.ListModel[i].InitialsColor=t.formData.InitialsColor,t.$root.ActiveUserData.ListModel[i].LastName=t.formData.LastName,t.$root.ActiveUserData.ListModel[i].UserPrincipalName=t.formData.UserPrincipalName,t.$root.ActiveUserData.ListModel[i].JobTitle=t.formData.JobTitle,t.$root.ActiveUserData.ListModel[i].Department=t.formData.Department)})};t.UpdateSignInStatus=function(n){n.$valid&&(t.$emit('showWaitingIndicator',!0),t.saveinprogress=!0,t.formData.SignInStatus=t.formData.SignInStatusVal=="allowed"?!0:!1,i.UpdateSigninStatus(t.selecteditem.ObjectId,t.formData.SignInStatus).then(function(){t.$emit('showWaitingIndicator',!1),t.statusMessage=t.formData.SignInStatus?'Sign-in status was updated from blocked to allowed.':'Sign-in status was updated from allowed to blocked.',e(),angular.isDefined(t.$root.UpdateUserStatus)&&t.$root.UpdateUserStatus(t.formData.ObjectId),t.showSummary=!0,u()},function(n){t.$emit('showWaitingIndicator',!1),t.statusMessage=n.data,t.showSummary=!0}))},t.UpdateContactInformation=function(n){if(n.$valid)t.editUserDetailsError=!1,t.$emit('showWaitingIndicator',!0),t.saveinprogress=!0,i.UpdateContactInformation(t.selecteditem.ObjectId,t.formData).then(function(n){t.$emit('showWaitingIndicator',!1),t.statusMessage=n.data,t.showSummary=!0,u(),t.$root.setCloseButtonFocus()},function(n){t.$emit('showWaitingIndicator',!1),t.statusMessage=n.data,t.showSummary=!0,t.$root.setCloseButtonFocus()});else{t.editUserDetailsError=!0,t.editUserDetailsErrorMessage='Please provide all required fields.';return}}}return t.$inject=["$scope","UserManagementService","PanelService"],t}();n.EditUserController=t,n.app.controller("EditUserController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){function a(t){var r={},f=0;i.GetLocations().then(function(e){if(angular.forEach(e.data,function(t,i){var u={};u.DisplayName=t.DisplayName,u.CountryCode=t.CountryCode,n.locations.push(u),t.IsDefault==!0&&(r=u,f=i)}),n.locations.splice(f,1),n.locations.unshift(r),t){var o={};o.DisplayName='\x5bNo change\x5d',o.CountryCode='',n.locations.unshift(o),n.selectedLocation=o}else i.GetUserUsageLocation(n.selecteditem.ObjectId).then(function(t){if(u.IsValid(t)&&u.IsValid(t.data))angular.forEach(n.locations,function(i){i.CountryCode==t.data&&(n.selectedLocation=i)});else{var i={};i.DisplayName='\x5bSelect a location\x5d',i.CountryCode='',n.locations.unshift(i),n.selectedLocation=i}})},function(){})}function c(){i.GetTenantProducts().then(function(t){n.products=t.data.Products,n.getProductsCompleted=!0,n.ShowSkypeProvisioningMessage=t.data.ShowSkypeProvisioningMessage,n.SkypeAdminCenterUrl=t.data.SkypeAdminCenterUrl,angular.forEach(n.products,function(i){i.additionalQuantity=0,i.ServicePlans!=null&&i.ServicePlans.length>0&&angular.forEach(i.ServicePlans,function(n){n.IsSelected=!1}),i.IsSelected&&i.HasSkypeNotificationMessage&&(n.ShowSkypeNotification=!0),f(t)}),n.enableAssignButton=!0},function(){n.isProductAvailable=!1,n.enableAssignButton=!1})}function y(){n.enableAssignButton=!1,n.isMultiUser=n.selecteditem&&n.selecteditem.constructor==Array,n.isMaxUserLimit=!1,n.showSkypeMessageCount=0,n.isMultiUser&&(n.isMaxUserLimit=n.selecteditem.length>100),n.products=[],n.locations=[],n.getProductsCompleted=!1,n.selectedLocation='',n.isProductAvailable=!0,n.productSelected=0,n.updatingLicensing=!1,n.editingProducts=!1,n.saveActionStarted=!1,n.ShowSkypeProvisioningMessage=!1,n.SkypeAdminCenterUrl=null,n.ShowSkypeNotification=!1,n.productAssignmentSuccess=[],n.productsAssignmentFailure=[],n.perYear='per year',n.perMonth='per month',n.genericError=!1,n.intervalTimeout=2e3,n.intervalCount=15,n.csvFileContent=[],n.csvFileHeaderContent=['Display name','User name','Error'],n.productsSelected=[],n.productsRemoved=[],n.showProductDetails=!1,n.formData.LicenseChangeMode=2,n.submitButtonText='Save'}function f(t){angular.forEach(t.data.Products,function(t){if(t.eligibleSubscriptions=[],t.ShowDetails=!1,t.subscriptionCap=!1,t.subscriptionError=!1,t.previousSelected=!1,t.ProductSkuId){if(!n.$root.features.CanBuyLicense){t.additionalQuantity=t.AvailableUnits<=0?1:0,!t.IsSelected&&t.additionalQuantity>0&&(t.IsDisabledDueToError=!0);return}i.GetSubscriptions(t.ProductSkuId,1).then(function(r){var u,s;if(t.additionalQuantity=r.data.additionalQuantity,t.licenseOutOfSync=r.data.licenseOutOfSync,r.data.eligibleSubscriptions&&r.data.eligibleSubscriptions.length>0)u=[],angular.forEach(r.data.eligibleSubscriptions,function(n){n.apps=[],n.IsSubSelected=!1,t.eligibleSubscriptions.push(n),n.Id&&n.State.toLowerCase()==='active'&&u.push(n.Id)}),u&&i.GetSubscriptionPrice(u).then(function(t){n.subscriptionPriceResponse=t.data},function(){n.NoSubscriptionPrice=!0});else if(t.additionalQuantity>0)if(t.licenseOutOfSync=!1,t.subscriptionError=!0,t.IsSelected||(t.IsDisabledDueToError=!0),r.data.ineligibleSubscriptions&&r.data.ineligibleSubscriptions.length===1)t.subscriptionIsTrail=r.data.ineligibleSubscriptions[0].Offer.IsTrial,t.subscriptionIsPrepaid=r.data.ineligibleSubscriptions[0].Offer.IsPrepaid,t.ccOrSubscriptionError=!(r.data.ineligibleSubscriptions[0].Offer.IsTrial||r.data.ineligibleSubscriptions[0].Offer.IsPrepaid);else if(r.data.ineligibleSubscriptions&&r.data.ineligibleSubscriptions.length>1){var f=!1,e=!1,o=!1;angular.forEach(r.data.ineligibleSubscriptions,function(n){f||(f=!(n.Offer.IsTrial||n.Offer.IsPrepaid)),e||(e=n.Offer.IsTrial),o||(o=n.Offer.IsPrePaid)}),f?t.ccOrSubscriptionError=!0:o?t.subscriptionIsPrepaid=!0:e?t.subscriptionIsTrail=!0:t.ccOrSubscriptionError=!0}else t.ccOrSubscriptionError=!0;t.IsSelected&&(t.previouslySelected=!0,n.productSelected++),s=t.IsSelected,t.ServicePlans!=null&&angular.forEach(t.ServicePlans,function(n){n.IsSelected=n.IsSelected&&s}),r.data.eligibleSubscriptions&&r.data.eligibleSubscriptions.length==1&&(t.eligibleSubscriptions[0].IsSubSelected=!0)},function(n){typeof n.data!="object"&&n.data.toLowerCase()=='subscriptionsreachedmaximumquantity'?t.subscriptionCap=!0:typeof n.data!="object"&&n.data.toLowerCase()=='invalidpaymentinstrument'?t.invalidPaymentOption=!0:t.genericError=!0,t.IsSelected=!1,t.IsDisabledDueToError=!0})}})}function h(){i.GetUserProducts(n.selecteditem.ObjectId).then(function(t){n.getinprogress=!1,n.products=t.data.Products,n.getProductsCompleted=!0,n.ShowSkypeProvisioningMessage=t.data.ShowSkypeProvisioningMessage,n.SkypeAdminCenterUrl=t.data.SkypeAdminCenterUrl,n.assignedproducts=[],angular.forEach(t.data.Products,function(t,i){t.IsSelected?(n.assignedproducts.push(t.ProductSkuId),u.IsValid(t.PrerequisiteMessage)&&n.showSkypeMessageCount++,t.HasSkypeNotificationMessage&&(n.ShowSkypeNotification=!0)):t.ServicePlans!=null&&angular.forEach(n.products[i].ServicePlans,function(n){n.IsSelected=!1}),n.enableAssignButton=!0},function(){n.enableAssignButton=!1,n.isProductAvailable=!1}),f(t),n.products.length===1?(n.showProductsInfo=n.products[0].subscriptionError||n.products[0].additionalQuantity>0?!0:!1,n.products[0].ShowDetails=!0):n.showProductsInfo=!0},function(){n.isProductAvailable=!1})}function s(){y(),a(n.isMultiUser),n.isMultiUser?(c(),$('#location').attr({id:'multiLocation'})):(h(),$('#location').attr({id:'location'}))}function o(){var t=!1;return angular.forEach(n.products,function(n){n.IsSelected&&!t&&(t=n.licenseOutOfSync)}),t}function e(){n.productSelected=0,angular.forEach(n.products,function(t){t.IsSelected?(t.eligibleSubscriptions&&t.eligibleSubscriptions.length==1&&(t.eligibleSubscriptions[0].IsSubSelected=!0),n.productSelected++):u.IsValid(t.PrerequisiteMessage)&&n.showSkypeMessageCount--})}function l(t){var i=n.assignedproducts?!0:!1;return i&&(i=n.assignedproducts.indexOf(t)!=-1?!0:!1),i}function p(){angular.forEach(n.products,function(t){t.IsSelected&&n.productsSelected.push(t)}),angular.forEach(n.products,function(t){l(t.ProductSkuId)&&!t.IsSelected&&n.productsRemoved.push(t)})}this.$scope=n,this.$interval=t,this.UserManagementService=i,this.PanelService=r,this.HelperService=u;var w={None:0,Append:1,Replace:2},v={Success:0,Failed:1,Skipped:2,ResolveConflict:3};n.GetFullPriceText=function(t,i){var r='';return i&&i.toLowerCase()==="monthly"?r=t+" "+n.permonth:i&&i.toLowerCase()==="annually"&&(r=t+" "+n.peryear),r},n.IsAdditionalQuantityRequired=function(){var t=!1;return n.AddtionalLicenseRequired=0,n.SelectedSubscription='',angular.forEach(n.products,function(i){i.IsSelected&&$.inArray(i.ProductSkuId,n.assignedproducts)<0&&angular.forEach(i.eligibleSubscriptions,function(r){r.IsSubSelected&&i.additionalQuantity>0&&!i.licenseOutOfSync&&(t=!0,n.AddtionalLicenseRequired+=i.additionalQuantity,n.SelectedSubscription+=i.ProductDisplayName+", ")})}),t},n.disabledProductStyle=function(n){var t='';return t=n.IsDisabled||n.IsDisabledDueToError?'f-prdts-disabled':''},n.UpdateQuantityPostData=function(){n.Subscriptions=[],n.ProductSkuids='',angular.forEach(n.products,function(t){t.IsSelected&&angular.forEach(t.eligibleSubscriptions,function(i){if(i.IsSubSelected&&t.additionalQuantity>0){var u={SubscriptionId:i.Id,NewQuantity:t.additionalQuantity+i.CurrentQuantity};n.Subscriptions.push(u),n.ProductSkuids+=t.ProductSkuId+','}})})},n.ToggleProductSettings=function(n){n.ShowDetails=n.IsSelected,angular.forEach(n.ServicePlans,function(t,i){n.ServicePlans[i]=n.ShowDetails})},n.ToggleProductSelection=function(t){var r=!0;angular.forEach(t.ServicePlans,function(n){n.IsSelected&&(r=!1)}),r?(t.ShowDetails=!1,t.IsSelected=!1):(t.ShowDetails=!0,t.IsSelected=!0),e(),n.formData.removeLicense=!1},n.SetProductSelected=function(t,i){$("#"+t).is(":checked")?(n.productSelected++,n.products[i].IsSelected=!0,n.products[i].ShowDetails=!0,n.products[i].eligibleSubscriptions&&n.products[i].eligibleSubscriptions.length==1&&(n.products[i].eligibleSubscriptions[0].IsSubSelected=!0),n.products[i].ServicePlans!=null&&angular.forEach(n.products[i].ServicePlans,function(n){n.IsSelected=!0}),u.IsValid(n.products[i].PrerequisiteMessage)&&n.showSkypeMessageCount++,n.ShowSkypeNotification=n.products[i].HasSkypeNotificationMessage):(n.productSelected--,n.products[i].IsSelected=!1,n.products[i].ShowDetails=!1,n.DeSelectAllSubscriptions(i),u.IsValid(n.products[i].PrerequisiteMessage)&&n.showSkypeMessageCount--,n.products[i].ServicePlans!=null&&angular.forEach(n.products[i].ServicePlans,function(n){n.IsSelected=!1})),n.formData.removeLicense=!1},n.DeSelectAllProductsServicesAndSubscription=function(){angular.forEach(n.products,function(t,i){t.IsSelected=!1,n.DeSelectAllSubscriptions(i),t.ServicePlans!=null&&angular.forEach(t.ServicePlans,function(n){n.IsSelected=!1})}),n.productSelected=0},n.UpdateProducts=function(){if(n.updatingLicensing=!1,n.editingProducts=!0,n.listOfUserProductsModel=[],n.isMultiUser)angular.forEach(n.selecteditem,function(t){var r={};r.UserId=t.ObjectId,r.Products=n.products,n.listOfUserProductsModel.push(r)});else{var t={};t.UserId=n.selecteditem.ObjectId,t.Products=n.products,n.listOfUserProductsModel.push(t)}i.UpdateProducts(n.listOfUserProductsModel,n.selectedLocation.CountryCode,n.formData.LicenseChangeMode).then(function(t){p(),n.saveActionStarted=!1,n.editingProducts=!1,n.showCloseButton=!0,n.IsSetUserLocation=t.data[0].Code=="setuserlocation",!n.isMultiUser&&n.IsSetUserLocation&&(n.formData.title=t.data[0].Message),angular.forEach(t.data,function(t){if(t.Status==v.Success)n.productAssignmentSuccess.push(t);else{n.productsAssignmentFailure.push(t);var u={a:t.UserInfo.DisplayName,b:t.UserInfo.UserPrincipalName,c:t.Message};n.csvFileContent.push(u)}n.isMultiUser||(n.formData.data=n.data,n.formData.ObjectId=n.data.ObjectId,r.SetSelectedItem(n.formData)),n.$root.UpdateUserStatus(t.UserInfo.ObjectId)})},function(t){n.editingProducts=!1,n.saveActionStarted=!1,n.statusMessage=t.data,n.showCloseButton=!0,n.formData.title='Failed to assign product licenses'})},n.DeSelectAllSubscriptions=function(t){angular.forEach(n.products[t].eligibleSubscriptions,function(n){n.IsSubSelected=!1})},n.ToggleSubscriptionSelected=function(n,t){angular.forEach(n.eligibleSubscriptions,function(i,r){r!=t&&(n.eligibleSubscriptions[r].IsSubSelected=!1)})},n.UpdateQuantityPostData=function(){n.Subscriptions=[],n.ProductSkuids='',angular.forEach(n.products,function(t){t.IsSelected&&angular.forEach(t.eligibleSubscriptions,function(i){if(i.IsSubSelected&&t.additionalQuantity>0){var u={SubscriptionId:i.Id,NewQuantity:t.additionalQuantity+i.CurrentQuantity};n.Subscriptions.push(u),n.ProductSkuids+=t.ProductSkuId+','}})})},n.ToggleProductDetails=function(t){n.products[t].ShowDetails=!n.products[t].ShowDetails},n.Cancel=function(){n.$emit('closeFlyout')},n.IsAdditionalQuantityUpdated=function(){n.intervalCount--,n.intervalCount<=0?n.UpdateProducts():i.IsAdditionalQuantityUpdated(n.ProductSkuids.substr(0,n.ProductSkuids.length-1)).then(function(i){angular.forEach(i.data,function(i){i.PurchasedQuantity>i.ConsumedQuantity&&(t.cancel(n.timeoutpromise),n.UpdateProducts())})})},n.IsSubscriptionError=function(){var t=!1;return angular.forEach(n.products,function(n){n.IsSelected&&!n.previouslySelected&&(t||(t=n.subscriptionError))}),t},n.ShouldDisableSubmit=function(){return!(!n.subscriptionCap&&n.isProductAvailable&&!n.genericError&&n.enableAssignButton)||n.editProductsForm&&!n.editProductsForm.$valid||n.IsSubscriptionError()||n.isMaxUserLimit||n.isMultiUser&&n.productSelected==0&&!n.formData.removeLicense||!n.$root.features.EditProducts},n.GetSelectedProduct=function(){var t='';return angular.forEach(n.products,function(n){n.IsSelected&&(t=n.ProductDisplayName)}),t},n.SetIntervalandCount=function(){var i=parseInt($("#OcpBecReconcileIntervalTimeoutInSec").text())*1e3,t;isNaN(i)||(n.intervalTimeout=i),t=parseInt($("#OcpBecReconcileIntervalCount").text()),isNaN(t)||(n.intervalCount=t)},n.IsSubscriptionSelected=function(t){var i=!1;return angular.forEach(n.products[t].eligibleSubscriptions,function(n){i||(i=n.IsSubSelected)}),i},n.ToggleLocationRequiredFlag=function(){n.isLocationEmtpy=!n.isMultiUser&&n.selectedLocation.CountryCode.length<=0},n.ShowMultiUserOptions=function(){return n.isMultiUser&&!n.showProductDetails},n.ShowProductLicenses=function(){var t=!n.isMultiUser;return t||(t=n.isMultiUser&&n.showProductDetails),t},n.GoToShowProductDetails=function(){n.showProductDetails=!0,n.isMultiUser&&(n.formData.LicenseChangeMode==1?(n.$parent.$parent.headerTitle='Add to existing products',n.formData.multiUserDesc='Turn on products you want to add to selected users product configuration',n.submitButtonText='Add'):(n.$parent.$parent.headerTitle='Replace existing products',n.formData.multiUserDesc='Select product licenses you want to replace for selected users',n.submitButtonText='Replace'))},n.GoToCheckBoxSelection=function(){n.showProductDetails=!1},n.Submit=function(r){!n.isMultiUser&&n.selectedLocation.CountryCode.length<=0?n.isLocationEmpty=!0:r.$valid&&(n.saveinprogress=!0,n.saveActionStarted=!0,n.IsAdditionalQuantityRequired()?(n.SetIntervalandCount(),n.updatingLicensing=!0,n.UpdateQuantityPostData(),i.UpdateQuantity(n.Subscriptions).then(function(i){n.quantityUpdateMessage=i.data,O365.Instrument.ClientInstrument.getInstance().logClientDataAndValue("AssignLicense:PurchaseLicense","Success"),n.timeoutpromise=t(n.IsAdditionalQuantityUpdated,n.intervalTimeout,n.intervalCount)},function(){n.genericError=!0,O365.Instrument.ClientInstrument.getInstance().logClientDataAndValue("AssignLicense:PurchaseLicense","Failure"),n.updatingLicensing=!1})):o()?(n.editingProducts=!0,n.timeoutpromise=t(n.IsAdditionalQuantityUpdated,n.intervalTimeout,n.intervalCount)):n.UpdateProducts())},s()}return n.$inject=["$scope","$interval","UserManagementService","PanelService","HelperService"],n}();n.app.controller("EditProductsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function o(){u=!0,n.Picker={isFromPanelPicker:"true",Type:0,allItemsListTitle:'Users',selectedItemsListTitle:'Selected',inputLabel:'Search for a user',placeholderText:'Search'};switch(n.selectedItem.Type){case"BlockUser":f='Sign-in status',u=!0,r="../AdminPortal/Users/EditSigninStatus";break;case"EditUser":u=!1,r="../AdminPortal/Users/UserItemDetailsTemplate";break;case"DeleteUser":f='Delete user',e="ms-Icon-Basel ms-Icon-Basel--DeleteLegacy",u=!0,r="../AdminPortal/Users/deleteusers",n.Picker.Type=1;break;case"ResetUser":f='Reset password',e="ms-Icon-Basel ms-Icon-Basel--PermissionsLegacy",u=!0,r="../AdminPortal/Users/userpasswordreset",n.Picker.Type=1;break;default:this.LogService.LogError(419666,n.selectedItem.Type+' is not a valid type')}}this.$scope=n,this.PanelService=t,this.LogService=i;var r,f,e,u;n.initCallbackFlyout=function(t){n.flyout=t},n.initCallbackPanel=function(t){n.panel=t},n.$watch("Picker.selectedItem",function(){if(n.Picker.selectedItem&&n.Picker.Type===0){var i;u?(i={flyoutTemplateUrl:r,flyoutType:"user",flyoutHeaderTitle:"",flyoutHeaderIcon:"",flyoutTitle:f,waitingIndicatorMessage:'Saving changes',selecteditem:n.Picker.selectedItem.Item},n.flyout.invoke(i),n.$emit('closePanel')):(t.SetSelectedItem(n.Picker.selectedItem.Item),i={panelTemplateUrl:r,panelType:"user",selecteditem:n.Picker.selectedItem.Item},n.panel.invoke(i))}}),n.InvokeFlyout=function(){if(n.Picker.selectedItems<1){n.noUserError=!0,n.UserErrorValidation='Please select a user.';return}var t={flyoutTemplateUrl:r,flyoutType:"multiuser",flyoutHeaderTitle:f,flyoutHeaderIcon:e,flyoutTitle:"",waitingIndicatorMessage:'Saving changes',selecteditem:n.Picker.selectedItems};n.Picker.selectedItems&&n.Picker.selectedItems.length===1&&(t.selecteditem=n.Picker.selectedItems[0].Item,t.flyoutType="user"),n.flyout.invoke(t),n.$emit('closePanel')},o()}return n.$inject=['$scope','PanelService','LogService'],n}();n.EditUserPickerController=t,n.app.controller("EditUserPickerController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function e(){u=!0,n.ShowSuccessMessageForDnsHealth=!1,n.ShowErrorMessageForDnsHealth=!1,n.ShowErrorCanManageDomains=!1,n.ShowErrorEnableTroubleshootingFeature=!1;switch(n.selectedItem.Type){case"EditDomain":u=!1,r="../AdminPortal/DomainList/DomainDetail";break;case"DeleteDomain":u=!0,r="../AdminPortal/DomainList/RemoveDomain";break;case"CheckHealth":u=!0,r="../AdminPortal/DomainList/DnsHealthReport";break;default:i.LogError(420088,n.selectedItem.Type+' is not a valid type')}n.Picker={isFromPanelPicker:"true",Type:0,SearchTypes:[7],allItemsListTitle:'Domains',inputLabel:'Search for a domain',placeholderText:'Search'}}this.$scope=n,this.PanelService=t,this.LogService=i;var r,f,u;n.initCallbackFlyout=function(t){n.flyout=t},n.initCallbackPanel=function(t){n.panel=t},n.$watch("Picker.selectedItem",function(){if(n.Picker.selectedItem){var i;u?(i={flyoutTemplateUrl:r,flyoutType:"domain",flyoutHeaderTitle:"",flyoutHeaderIcon:"",flyoutTitle:f,waitingIndicatorMessage:'Saving changes',selecteditem:n.Picker.selectedItem.Item,source:n.selectedItem.Source,entry:"panel"},n.flyout.invoke(i),n.$emit('closePanel')):(t.SetSelectedItem(n.Picker.selectedItem.Item),i={panelTemplateUrl:r,panelType:"domain",selecteditem:n.Picker.selectedItem.Item},n.panel.invoke(i))}}),e()}return n.$inject=['$scope','PanelService','LogService'],n}();n.EditDomainPickerController=t,n.app.controller("EditDomainPickerController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f){function s(){n.InviteUserModel={},n.InviteUserModel.showInviteUserForm=!0,n.InviteUserModel.saveInProgress=!1,n.InviteUserModel.saveFinished=!1,n.InviteUserModel.inviteUserError=!1,n.InviteUserModel.productWithLicenses=null,n.InviteUserModel.productWithEligibleSubscription=null,n.InviteUserModel.redirectToCommerce=!1,n.InviteUserModel.redirectToCommerceMessage="",n.InviteUserModel.updatingLicensing=!1,n.InviteUserModel.quantityUpdateMessage="",n.InviteUserModel.timeoutpromise=null,n.InviteUserModel.IntervalTimeout=2e3,n.InviteUserModel.IntervalCount=15,n.InviteUserModel.productSelected=null,a()}var e,o;this.$scope=n,this.$interval=i,this.UserManagementService=r,this.ProfileService=u,this.HelperService=f,e=function(){var i=parseInt($("#OcpBecReconcileIntervalTimeoutInSec").text())*1e3,t;isNaN(i)||(n.InviteUserModel.IntervalTimeout=i),t=parseInt($("#OcpBecReconcileIntervalCount").text()),isNaN(t)||(n.InviteUserModel.IntervalCount=t)},o=function(){n.InviteUserModel.Subscriptions=[],n.InviteUserModel.ProductSkuIds='';var t=n.InviteUserModel.productWithEligibleSubscription,i={SubscriptionId:t.eligibleSubscription.Id,NewQuantity:t.additionalQuantity+t.eligibleSubscription.CurrentQuantity};n.InviteUserModel.Subscriptions.push(i),n.InviteUserModel.ProductSkuId=t.ProductSkuId},n.Submit=function(){n.InviteUserModel.productWithLicenses!=null?l():n.InviteUserModel.productWithEligibleSubscription?h():n.InviteUserModel.inviteUserError="##Not enough licenses and not available subscription. This should not happen."};var h=function(){n.InviteUserModel.updatingLicensing=!0,e(),o(),r.UpdateQuantity(n.InviteUserModel.Subscriptions).then(function(t){n.InviteUserModel.quantityUpdateMessage=t.data,O365.Instrument.ClientInstrument.getInstance().logClientDataAndValue("InviteUser:PurchaseLicense","Success"),n.timeoutpromise=i(c,n.InviteUserModel.IntervalTimeout,n.InviteUserModel.IntervalCount)},function(){O365.Instrument.ClientInstrument.getInstance().logClientDataAndValue("InviteUser:PurchaseLicense","Failure"),n.InviteUserModel.updatingLicensing=!1,n.InviteUserModel.showInviteUserForm=!0,n.InviteUserModel.saveInProgress=!1,n.InviteUserModel.inviteUserError=!0,n.InviteUserModel.inviteUserErrorMessage="##failed purchase license."})},c=function(){n.InviteUserModel.IntervalCount--,n.InviteUserModel.IntervalCount<=0?(n.InviteUserModel.updatingLicensing=!1,n.InviteUserModel.showInviteUserForm=!0,n.InviteUserModel.saveInProgress=!1,n.InviteUserModel.inviteUserError=!0,n.InviteUserModel.inviteUserErrorMessage="##failed purchase license (time out)."):r.IsAdditionalQuantityUpdated(n.InviteUserModel.ProductSkuId).then(function(t){angular.forEach(t.data,function(t){t.PurchasedQuantity>t.ConsumedQuantity&&(i.cancel(n.timeoutpromise),n.InviteUser())})})},l=function(){n.InviteUserModel.showInviteUserForm=!1,n.InviteUserModel.saveInProgress=!0,n.InviteUserModel.saveFinished=!1,n.InviteUserModel.inviteUserError=!1,n.updatingLicensing=!1,r.InviteUser(n.formData).then(function(){n.InviteUserModel.saveInProgress=!1,n.InviteUserModel.saveFinished=!0},function(t){n.InviteUserModel.showInviteUserForm=!0,n.InviteUserModel.saveInProgress=!1,n.InviteUserModel.inviteUserError=!0,n.InviteUserModel.inviteUserErrorMessage=t.data})},a=function(){r.GetTenantProducts().then(function(t){if(n.InviteUserModel.products=t.data.Products,!n.InviteUserModel.products||n.InviteUserModel.products.length===0){n.InviteUserModel.redirectToCommerce=!0,n.InviteUserModel.redirectToCommerceMessage="##No products available.";return}angular.forEach(t.data.Products,function(t){t.ProductSkuId&&r.GetSubscriptions(t.ProductSkuId,1).then(function(i){if(t.additionalQuantity=i.data.additionalQuantity,t.additionalQuantity==0)n.InviteUserModel.productWithLicenses=t;else if(i.data.eligibleSubscriptions&&i.data.eligibleSubscriptions.length>0){var u=i.data.eligibleSubscriptions[0],f=[u.Id];r.GetSubscriptionPrice(f).then(function(n){t.subscriptionPriceResponse=n.data},function(){t.NoSubscriptionPrice=!0}),t.eligibleSubscription=u,n.InviteUserModel.productWithEligibleSubscription=t}else n.InviteUserModel.redirectToCommerce=!0,n.InviteUserModel.redirectToCommerceMessage="##No eligible subscription."},function(){n.InviteUserModel.redirectToCommerce=!0,n.InviteUserModel.redirectToCommerceMessage="##Can't get subscriptions."})})},function(){n.InviteUserModel.redirectToCommerce=!0,n.InviteUserModel.redirectToCommerceMessage="##Can't get products."})};n.initCallbackPanel=function(t){n.panel=t},n.Close=function(){n.Cancel()},n.Cancel=function(){n.$emit('closeFlyout')},s()}return n.$inject=["$scope","$rootScope","$interval","UserManagementService","ProfileService","HelperService"],n}();n.InviteUserController=t,n.app.controller("InviteUserController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n){function t(){n.formData.isSelfgeneratePassword=!1,n.formData.ForceChangePassword=!0,n.formData.NewPassword=null,n.formData.autogenerateValue={id:"0",value:'Auto-generated'},n.formData.selfgenerateValue={id:"1",value:'Admin-created'},n.formData.passwordchoice=n.formData.autogenerateValue,n.formData.ShowPasswordChoice=angular.isUndefined(n.selecteditem)?!1:!0,n.formData.currentPasswordChoice=n.formData.autogenerateValue.value,n.getCurrentPasswordChoice=function(t){t.id==="0"?(n.formData.currentPasswordChoice=n.formData.autogenerateValue.value,n.formData.isSelfgeneratePassword=!1,n.formData.NewPassword=null):(n.formData.currentPasswordChoice=n.formData.selfgenerateValue.value,n.formData.NewPassword=null,n.formData.isSelfgeneratePassword=!0)}}this.$scope=n,n.TogglePasswordPeek=function(n){angular.element($('#'+n)).attr("type")=="password"?angular.element($('#'+n)).attr("type","text"):angular.element($('#'+n)).attr("type","password")},n.IsPasswordStrengthWeak=function(){return n.form&&n.form.newpassword?n.form.newpassword.$error.pwdstrength:!0},t()}return n.$inject=["$scope"],n}();n.PasswordGenerationController=t,n.app.controller("PasswordGenerationController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){function u(){n.formData.AD={},n.formData.AD.getCallError=!1,n.saveCompleted=!1,n.saveprogress=!1,n.getCallCompleted=!1,i.GetDapGrantData(n.selecteditem.partnerId,n.selecteditem.msppid,n.selecteditem.resellerflag).then(function(t){n.formData.AD=t.data,r.IsValid(n.formData.AD.AcceptDAPDialogTitle)&&(n.$parent.$parent.headerTitle=n.formData.AD.AcceptDAPDialogTitle),n.formData.title=n.formData.AD.DescriptionText,n.getCallCompleted=!0},function(t){n.getFailureMessage=r.IsValid(t.data)&&r.IsValid(t.data.ExceptionMessage)?t.data.ExceptionMessage:'Something went wrong. Try again later. If this continues, contact support.',n.getCallCompleted=!0})}this.$scope=n,this.$rootScope=t,this.PartnerService=i,this.HelperService=r,n.Save=function(){n.saveInProgress=!0,n.loadingMessage='Saving ...';var r={};r.PartnerId=n.selecteditem.partnerId,r.MsppId=n.selecteditem.msppid,r.ResellerFlag=n.selecteditem.resellerflag,r.GrantDAP=n.formData.AD.GrantDAP,i.AuthorizeDelegateAdmin(r).then(function(){n.formData.title="",n.saveInProgress=!1,n.saveCompleted=!0,n.successMessage='Successfully accepted delegated administration offer.',t.$broadcast('refreshPartnerList')},function(){n.saveInProgress=!1,n.saveCompleted=!0,n.failureMessage='Failed to accept delegated administration offer.'})},n.Cancel=function(){n.$emit('closeFlyout')},u()}return n.$inject=["$scope","$rootScope","PartnerService","HelperService"],n}();n.app.controller("AuthorizeDelegationController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(i,r,u,f,e){function l(){var t=f.partnerId,n;t&&(n={flyoutTemplateUrl:"../AdminPortal/partners/authorizedelegation",flyoutHeaderTitle:'Authorize delegated administration',flyoutHeaderIcon:"",flyoutTitle:'',waitingIndicatorMessage:'Saving changes'},e(function(){i.$apply(function(){i.flyout.invoke(n,f)})}))}function a(){l(),i.PartnerListConfig=t.GetPartnerListConfig(),i.PartnerLayoutConfig=t.GetPartnerLayoutConfig(),i.GetPartners(),i.SelectedPartners=[],$(document).mouseup(function(n){var t=$(".userlistActions"),i=$(".userlistActions li"),r=$(".userlistActions li a"),u=$(".userlistActions li a i"),f=$("#actionButton"),e=$("#actionButton span"),o=$("#actionButton span i");return f.is(n.target)||e.is(n.target)||o.is(n.target)?!1:t.is(n.target)||i.is(n.target)||r.is(n.target)||u.is(n.target)?void 0:($(".userlistActions").hide(),n.stopPropagation(),!1)})}var s,h,c,o;this.$scope=i,this.$rootScope=r,this.PartnerService=u,this.$stateParams=f,this.$timeout=e,i.DeletePartners=function(n){u.DeletePartners(n)},i.GetPartners=function(){i.ResetConfig(),u.GetPartners().then(s,h)},s=function(n){i.PartnerListConfig.EndOfList=!0,(n.data==null||n.data.length==0)&&(i.PartnerListConfig.NoResults=!0),i.PartnerData=n.data,i.$emit("autoscrolltotop")},h=function(){i.PartnerListConfig.EndOfList=!0,i.PartnerListConfig.ServerListError=!0},i.DeletePartners=function(n){n!=null&&u.DeletePartners(n)},i.RemoveDap=function(n){n!=null&&u.RemoveDap(n)},i.UpdateDisableRemoveDap=function(){t.IsCollectionNullOrEmpty(i.SelectedPartners)?i.PartnerLayoutConfig.DisableRemoveDap=!0:(i.PartnerLayoutConfig.DisableRemoveDap=!1,i.SelectedPartners.forEach(function(n){if(!n.CanRemoveDap){i.PartnerLayoutConfig.DisableRemoveDap=!0;return}}))},i.UpdateDisableDeletePartners=function(){t.IsCollectionNullOrEmpty(i.SelectedPartners)?i.PartnerLayoutConfig.DisableRemoveDap=!0:(i.PartnerLayoutConfig.DisableRemoveDap=!1,i.SelectedPartners.forEach(function(n){if(!n.CanDelete){i.PartnerLayoutConfig.DisableDeletePartners=!0;return}}))},i.RefreshList=function(){i.PartnerListConfig=t.GetPartnerListConfig(),i.GetPartners(),i.SelectedPartners=[],$(".dataListField").prop('checked',!1)},i.CloseActionLinks=function(){$(".userlistActions").hide();return},i.getRowCss=function(n){if(n.isChecked)return{'background-color':'#DDEBF7'}},i.UpdatedSelectedPartners=function(n){var r,t;if(i.CloseActionLinks(),n==null){console.log("Error in UpdatedSelectedPartners in PartnerController.ts");return}n.isChecked?(i.SelectedPartners.push(n),t=o(i.SelectedPartners),i.panel.invoke(t,f)):(r=i.SelectedPartners.indexOf(n),r!==-1&&i.SelectedPartners.splice(r,1),i.SelectedPartners.length===1&&(t=o(i.SelectedPartners),i.panel.invoke(t)),i.SelectedPartners.length===0&&i.$broadcast('closePanel'),i.selectedHeader.isChecked=!1),i.$broadcast('TogglePartnerAction',i.SelectedPartners)},i.SelectedAllPartners=function(t){if(t){i.PartnerData.forEach(function(n){i.SelectedPartners.indexOf(n.Identity)==-1&&i.SelectedPartners.push(n)}),$(".dataListField").prop('checked',!0),angular.forEach(i.PartnerData,function(n){n.isChecked=!0});var r=o(i.SelectedPartners);i.panel.invoke(r),$(".gridRow").css("background-color",n.gridRowCheckedBgColor)}else i.selectedHeader.isChecked=t,i.SelectedPartners=[],$(".dataListField").prop('checked',!1),angular.forEach(i.PartnerData,function(n){n.isChecked=!1})},i.ToggleActionLinks=function(){if($(".userlistActions:visible").length>0){$(".userlistActions").hide(),$('#actionButton').attr('aria-expanded','false');return}i.UpdateDisableRemoveDap(),i.UpdateDisableDeletePartners(),$('.userlistActions').show(),$('#actionButton').attr('aria-expanded','true')},i.ToggleHighlight=function(n){$(".gridRow").css("background-color","transparent"),$("#user_list_"+n).css("background-color","#DDEBF7"),i.SelectedAllPartners(!1)},i.ToggleSortOption=function(n){i.PartnerListConfig.sortField=n,i.PartnerListConfig.sortDirection=i.PartnerListConfig.sortDirection===1?0:1,i.GetPartners()},i.$on('resetSelection',function(){i.SelectedAllPartners(!1)}),i.selectedHeader={isChecked:!1},i.ResetConfig=function(){i.PartnerData=[],i.SelectedPartners=[],i.PartnerListConfig.EndOfList=!1,i.PartnerListConfig.ServerListError=!1,i.PartnerListConfig.NoResults=!1},i.initCallbackFlyout=function(n){i.flyout=n},i.initCallbackPanel=function(n){i.panel=n},c='Bulk actions',o=function(n){var t={};return t=n.length==1?{panelTemplateUrl:"../AdminPortal/partners/partnerdetailstemplate",panelType:"partner",selecteditem:n[0],unselectonclose:!1,unhighlightonclose:!1}:{panelTemplateUrl:"../AdminPortal/Partner/bulkpartneractions",panelType:"multiPartner",panelHeaderTitle:c,selecteditem:n,unselectonclose:!0,unhighlightonclose:!0}},i.ShowContextualHelpCard=function(){return i.PartnerData.length==0},i.$on('refreshPartnerList',function(){i.RefreshList()}),a()}return t.GetPartnerListConfig=function(){return{IsPreviousRequestPending:!1,EndOfList:!1,NoResults:!1,ServerError:!1,SortDirection:0,SortField:"DisplayName",PartnerTypeFilter:"AllPartners",PageToken:null,EmptyListViewTitle:'There\x27s nothing here',EmptyListBodyLabel:'And that\x27s probably OK.'}},t.GetPartnerLayoutConfig=function(){return{DisableRemoveDap:!0,DisableDeletePartners:!0}},t.IsCollectionNullOrEmpty=function(n){return n==null||n.length==0},t.$inject=["$rootScope","$scope","PartnerService","$stateParams","$timeout"],t}();n.PartnersController=t,n.app.controller("PartnersController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(t,i,r,u){function s(){if(t.$parent==null||t.$parent.selectedItem==null||t.$parent.selectedItem.AllDataRetrieved==null){console.log("Error in init in PartnerDetailsController");return}t.selectedItem=t.$parent.$parent.selectedItem,t.selectedItem.AllDataRetrieved=!0,t.waitingExtraDataToLoad=!1,t.serverError=!1,t.selectedItem&&(o(),e())}function o(){t.PartnerDetailsConfig=n.GetPartnerDetailsConfig()}var e,f;this.$scope=t,this.$rootScope=i,this.PanelService=r,this.PartnerService=u,e=function(){if(t.selectedItem.AllDataRetrieved==null){console.log("Error in GetPartnerDetails in PartnerDetailsController");return}t.waitingExtraDataToLoad=t.selectedItem.AllDataRetrieved?!1:!0},s(),t.$on('panelclosed',function(){f&&(f(),f=null)}),f=t.$on(r.GetBroadCastEventName(),function(n,r){t.selectedItem=r,i.$broadcast('UpdatePersonCard',t.selectedItem),o(),t.$apply(function(){e()})})}return n.GetPartnerDetailsConfig=function(){return{}},n.$inject=["$scope",'$rootScope','PanelService','PartnerService'],n}();n.app.controller("PartnerDetailsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){function i(){n.deletePartnerStep="confirm",n.deleteSuccessful=!1,n.deleteinprogress=!1,n.$root.refreshList=!1,n.hasRemoved=!1}this.$scope=n,this.PartnerService=t,n.deletePartnerStep="confirm",n.deleteSuccessful=!1,n.hasRemoved=!1,n.$root.refreshList=!1,n.DeletePartners=function(){n.deleteinprogress=!0,t.DeletePartners([n.selecteditem]).then(function(t){n.deleteinprogress=!1,t.data[n.selecteditem.Identity]==200?(n.deletePartnerStep="summary",n.deleteSuccessful=!0,n.$root.refreshList=!0,n.$emit('closePanel')):(n.deletePartnerStep="confirm",n.deletePartnerError=!0,n.deletePartnerErrorMessage="Unable to delete partner. Error code:"+t.data[n.selecteditem.Identity],console.log("Can't delete partner. error code:"+t.data[n.selecteditem.Identity]))},function(){n.deletePartnerStep="summary",n.deletePartnerError=!0,n.deletePartnerErrorMessage="Internal server error. Please try again later",console.log("Can't delete partner. ")})},n.RemovePartnerFromList=function(){var t=n.getIndex(n.selecteditem,n.$root.PartnerData);t!=-1&&(n.$root.PartnerData.splice(t,1),n.hasRemoved=!0)},n.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.Identity==t[i].Identity)return i;return-1},n.Cancel=function(){n.$emit('closeFlyout')},n.Close=function(){n.$emit('closeFlyout'),n.deleteSuccessful&&!n.hasRemoved&&n.RemovePartnerFromList()},n.$on('closeFlyout',function(){n.deleteSuccessful&&!n.hasRemoved&&n.RemovePartnerFromList()}),i()}return n.$inject=["$scope","PartnerService"],n}();n.app.controller("DeletePartnerController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){function i(){n.removeDapStep="confirm",n.removeSuccessful=!1}this.$scope=n,this.PartnerService=t,n.removeDapStep="confirm",n.removeSuccessful=!1,n.RemoveDap=function(){n.removeinprogress=!0,t.RemoveDap([n.selecteditem]).then(function(t){n.removeinprogress=!1,t.data[n.selecteditem.Identity]==200?(n.removeDapStep="summary",n.removeSuccessful=!0,n.$root.refreshList=!0,n.$emit('closePanel')):(n.removeDapStep="confirm",n.removeDapError=!0,n.removeDapErrorMessage="Unable to remove dap. Error code:"+t.data[n.selecteditem.Identity],console.log("Can't remove dap. error code:"+t.data[n.selecteditem.Identity]))},function(){n.removeDapStep="summary",n.removeDapError=!0,n.removeDapErrorMessage="Internal server error. Please try again later",console.log("Can't remove dap.")})},n.Cancel=function(){n.$emit('closeFlyout')},n.Close=function(){n.$emit('closeFlyout')},i()}return n.$inject=["$scope","PartnerService"],n}();n.app.controller("RemoveDapController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(n,t,i,r,u){this.tileDataProperty='',this.tileDataProperty=r,this.Init(n,i,u)}return t.prototype.Init=function(n,t,i){var r=this;r.ResetScopeStateForWidgets(n),n.daysBackFilter=t.GetDaysBackFilter(),n.widgetDataError=!1,n.widgetErrorText='',n.widget?r.FinishInit(n,t,i):t.GetWidgetConfigData().then(function(u){r.SetWidgetInScope(n,u),r.FinishInit(n,t,i)},function(t){r.SetErrorClearWidgetData(n,t)})},t.prototype.FinishInit=function(t,i,r){var u=this;u.SetWidgetClasses(t,r),u.SetLocalizedStrings(t),u.SetChartOptions(t,r),u.UpdateWidgetData(i,t,r),t.$on(n.ReportEventNames.TimeSelectorChangeBroadcastEvent,function(){u.UpdateWidgetData(i,t,r)})},t.prototype.SetWidgetClasses=function(n,t){var i=t.currentCultureInfo;n.widget.chartWidgetContainerClass=i?"rw-chart-rtl rw-item-rtl rw-background":"rw-chart rw-item rw-background",n.widget.chartWidgetClass="chart-widget",n.widget.rwKpiClass=i?"rw-kpi rw-item-rtl":"rw-kpi rw-item"},t.prototype.SetWidgetInScope=function(n,t){if(!n.widget){var r=this,i=$.grep(t,function(n){return n.WidgetId&&n.WidgetId===r.tileDataProperty});i&&i.length>0&&(n.widget=i[0])}},t.prototype.ResetScopeStateForWidgets=function(n){n.activeEntityPercent=0,n.activeEntityText='',n.widget&&(n.widget.DisplayTrend=!1,n.widget.KpiData='',n.widget.KpiDataActivity='',n.widget.KpiTrend='',n.widget.AriaLabel='')},t.prototype.SetLocalizedStrings=function(t){if(!t.noUsageMessage){var i=n.ReportsLocStrings.GetInstance();t.noUsageMessage=i.RdwNoUsageData,t.ReportProductNotBeingUsed=i.RdwProductNotBeingUsed,t.ReportProductNotAssigned=i.RdwProductNotAssigned}},t.prototype.GetNoDataErrorMessage=function(t){return t.noUsageMessage&&t.widget.Title?n.ReportsLocStrings.GetInstance().format(t.noUsageMessage,t.widget.Title):null},t.prototype.UpdateKpiTrend=function(t,i,r){var u,f;t.widget.AriaLabel=t.widget.Title+" "+t.widget.KpiDataActivity+":"+t.widget.KpiTooltip+" ",r?(t.widget.DisplayTrend=!0,u=n.ReportsLocStrings.GetInstance(),i<0?(t.widget.KpiTrendClass=["widget-trend-upDown","widget-trend-down"],t.widget.KpiTrendIconClass=["ms-Icon","ms-Icon--arrowDown"],t.widget.AriaLabel+=u.RdwPercentDecrease+" "):(t.widget.KpiTrendClass=["widget-trend-upDown","widget-trend-up"],t.widget.KpiTrendIconClass=["ms-Icon","ms-Icon--arrowUp"],t.widget.AriaLabel+=u.RdwPercentIncrease+" "),f=Math.abs(i),t.widget.KpiTrend=(f*100).toFixed(1),t.widget.AriaLabel+=t.widget.KpiTrend+" "+u.RdwPercent,t.widget.AriaLabel+=t.activeEntityText):t.widget.DisplayTrend=!1},t.prototype.AssignColorsToSeries=function(t){if(t&&t.length>0)for(var i=0;i<t.length;i++)t[i].color=n.ChartOptions.GetWidgetColorFromSeriesIndex(i)},t.prototype.UpdateWidgetData=function(t,i,r){var u=this,f;u.tileDataProperty&&u.tileDataProperty.length!=0&&(f=n.ReportsUtils.GetReportTileDataProperty(u.tileDataProperty),t.GetReportTileData(f).then(function(n){n?u.PopulateWidgetData(i,n,r):u.SetErrorClearWidgetData(i)},function(n){u.SetErrorClearWidgetData(i,n)}))},t.prototype.GetDaysBackObjectName=function(n){return n.daysBackFilter.value?"M"+n.daysBackFilter.value:''},t.prototype.SetErrorClearWidgetData=function(n,t){t===void 0&&(t=''),n.widgetErrorText=t&&t.length>0?t:this.GetNoDataErrorMessage(n),n.widgetDataError=!0,this.ResetScopeStateForWidgets(n)},t.prototype.PopulateWidgetData=function(t,i,r){if(i=this.CheckDataPopulated(t,i),i){if(n.ChartOptions.SetChartValueAxisType(this.chartOptions,i),this.PopulateWidget(t,i,r),t.widget.KpiData=="0"&&!parseInt(i.ActiveUsers)){this.SetDataPopulatedIncorrectly(t),t.widgetErrorText=parseInt(i.EnabledUsers)?t.ReportProductNotBeingUsed:t.ReportProductNotAssigned;return}this.OnPopulateDataSuccess(t)}},t.prototype.CheckDataPopulated=function(n,t){var i=this.GetDaysBackObjectName(n);return t[i]?(t=t[i],n.widgetDataError=!1,t):(this.SetDataPopulatedIncorrectly(n),undefined)},t.prototype.SetDataPopulatedIncorrectly=function(n){n.widget.DisplayUsageSummary=!1,this.SetErrorClearWidgetData(n)},t.prototype.PopulateWidget=function(){},t.prototype.OnPopulateDataSuccess=function(n){n.widgetDataError=!1},t.prototype.SetActiveEntityText=function(t,i,r){var u=n.ReportsLocStrings.GetInstance();t.activeEntityText=u.format(u.RdwActiveEntityProgressFormat,t.widget.UsageSummaryTitle,i,r)},t.prototype.SetChartOptions=function(){},t.prototype.GetChartOptions=function(t,i,r){var f=this,u=r.currentCultureInfo;return this.AssignColorsToSeries(i),this.chartOptions={legend:{position:'top',labels:{color:'#939598',font:'11px Segoe UI Semibold,Segoe UI,Segoe,Tahoma,Helvetica,Arial,Sans-Serif'}},seriesDefaults:{type:'column',overlay:{gradient:'none'},border:{width:0},spacing:1},series:i,dataSource:{data:[]},categoryAxis:[{majorGridLines:{visible:!1},majorTicks:{visible:!1},baseUnit:"date"}],valueAxis:[{line:{visible:!1},labels:{template:"#= Admin.ReportsUtils.FormatLongNumber(value, Admin.ReportConstants.DefaultDecimalpoints) #",color:'#939598'}}],tooltip:n.ChartOptions.GetBarChartTooltipOptions(),name:t.widget.WidgetId,render:function(n){f.RenderWidget(t.widget.WidgetId,n)}},u&&(this.chartOptions.categoryAxis[0].reverse=!0),this.chartOptions.tooltip.template=function(t){return n.ReportsUtils.GetToolTipTemplate(t,!1,u,!0)},this.chartOptions},t.prototype.RenderWidget=function(t,i){if(n.ReportConstants.FirstTimeRendered)try{var r=i.sender.options.name;n.ReportConstants.FirstTimeRendered=!1,this.SetValueAxisLabelTemplate(r,n.ChartOptions.GetNumDecForYAxisLabels(i.sender._model._plotArea.axisY.labels)),n.ChartOptions.RedrawKendoChartById(r)}catch(u){n.ReportConstants.FirstTimeRendered=!0}else n.ReportConstants.FirstTimeRendered=!0},t.prototype.SetValueAxisLabelTemplate=function(n,t){this.SetChartOptionsTemplate(n,"#= Admin.ReportsUtils.FormatLongNumber(value, "+t+") #")},t.prototype.SetChartOptionsTemplate=function(t,i){n.ChartOptions.SetChartValueAxisTemplate(t,i)},t}();n.BaseWidgetController=t})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u,f){this.tileDataProperty='',this.helpLink=n.ReportConstants.PBIHelpLink,this.PBILink="",this.tileDataProperty=n.WidgetIds.RDWPowerBI,this.Init(t,r,u,f)}return t.prototype.Init=function(n,t,i,r){var u=this;u.ResetScopeStateForWidgets(n),n.widgetDataError=!1,n.widgetErrorText='',n.widget?u.FinishInit(n,t,i,r):t.GetWidgetConfigData().then(function(f){u.SetWidgetInScope(n,f),u.FinishInit(n,t,i,r)},function(t){u.SetErrorClearWidgetData(n,t)})},t.prototype.FinishInit=function(t,i,r,u){var f=this;f.SetWidgetClasses(t,u),f.SetLocalizedStrings(t),f.UpdateWidgetData(i,r,t,u),t.$on(n.ReportEventNames.TimeSelectorChangeBroadcastEvent,function(){f.UpdateWidgetData(i,r,t,u)}),t.redirect=function(){window.open(f.PBILink,'_blank')},t.redirectHelpLink=function(){window.open(f.helpLink,'_blank')}},t.prototype.SetWidgetInScope=function(n,t){if(!n.widget){var r=this,i=$.grep(t,function(n){return n.WidgetId&&n.WidgetId===r.tileDataProperty});i&&i.length>0&&(n.widget=i[0])}},t.prototype.ResetScopeStateForWidgets=function(n){n.PBIStatus="",n.PBIStatusUpdateDate="",n.PBIButtonDisabled=!0},t.prototype.SetWidgetClasses=function(n,t){n.widget.chartWidgetContainerClass=t.currentCultureInfo?"rw-item-summary-rtl rw-pbi-widget-padding":"rw-item-summary rw-pbi-widget-padding",n.widget.chartWidgetClass="chart-widget",n.widget.rwKpiClass=t.currentCultureInfo?"rw-pbi-title-container-height rw-item-summary-rtl":"rw-pbi-title-container-height rw-item-summary"},t.prototype.SetLocalizedStrings=function(t){var i=n.ReportsLocStrings.GetInstance();t.noUsageMessage=i.RdwNoUsageData,t.description=i.PBIDescription,t.DataPreperation=i.PBIDataPreperation,t.LearnMore=i.PBILearnMore,t.GoToPowerBI=i.PBIGoToPowerBI},t.prototype.GetNoDataErrorMessage=function(t){return t.noUsageMessage&&t.widget.Title?n.ReportsLocStrings.GetInstance().format(t.noUsageMessage,t.widget.Title):null},t.prototype.UpdateWidgetData=function(t,i,r){var f=this;f.tileDataProperty&&f.tileDataProperty.length!=0&&i.GetReportsSettings().then(function(t){if(t.data&&t.data.Output&&t.data.Output.length>0){var i=n.ReportsLocStrings.GetInstance(),u=JSON.parse(t.data.Output[0]),e=n.ReportsUtils.ConvertToLocalizedDateString(u.PBIStatusUpdateDate,n.ReportConstants.PBIDateFormat);r.PBIStatus=u.PBIStatus,r.PBIStatusUpdateDate=i.format(i.PBILastedUpdate,e),r.PBIStatus==n.ReportConstants.PBIBackfillcompleted?(r.PBIButtonDisabled=!1,f.PBILink=n.ReportConstants.PBIUrl,r.widget.GotoState=f.PBILink):(r.PBIButtonDisabled=!0,f.PBILink="",r.widget.GotoState=f.PBILink),f.OnPopulateDataSuccess(r)}else f.SetErrorClearWidgetData(r)},function(n){f.SetErrorClearWidgetData(r,n)})},t.prototype.SetErrorClearWidgetData=function(n,t){t===void 0&&(t=''),n.widgetErrorText=t&&t.length>0?t:this.GetNoDataErrorMessage(n),n.widgetDataError=!0,this.ResetScopeStateForWidgets(n)},t.prototype.OnPopulateDataSuccess=function(n){n.widgetDataError=!1},t}();n.PowerBIWidgetController=t,n.app.controller("PowerBIWidgetController",t)})(Admin||(Admin={}));var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Admin;(function(n){'use strict';;var t=function(t){function i(i,r,u,f){t.call(this,i,r,u,n.WidgetIds.RDWEmailTraffic,f)}return __extends(i,t),i.prototype.SetChartOptions=function(t,i){var r=n.ReportsLocStrings.GetInstance();t.emailActivityOptions=this.GetChartOptions(t,[{field:'EmailSent',name:r.RdwEmailTrafficSent},{field:'EmailReceived',name:r.RdwEmailTrafficReceived},{field:'EmailRead',name:r.RdwEmailTrafficRead}],i)},i.prototype.PopulateWidget=function(t,i){t.emailActivityOptions.dataSource.data=[],t.emailActivityOptions.dataSource.data.push(i),t.widget.KpiData=n.ReportsUtils.FormatLongNumber(i.TotalSentReceivedActivity,1),t.widget.KpiDataActivity=i.TotalSentReceivedActivity,!isNaN(i.EnabledUsers)&&!isNaN(i.ActiveUsers)&&parseInt(i.EnabledUsers)>0&&(t.activeEntityPercent=parseInt(i.ActiveUsers)/parseInt(i.EnabledUsers)*100,this.SetActiveEntityText(t,i.ActiveUsers,i.EnabledUsers));var u=i&&i.PercentChangeInActivity&&!isNaN(i.PercentChangeInActivity);this.UpdateKpiTrend(t,u?i.PercentChangeInActivity:0,u)},i.$inject=["$scope","$http","ReportService","$rootScope"],i}(n.BaseWidgetController);n.EmailTrafficWidgetController=t,n.app.controller("EmailTrafficWidgetController",t)})(Admin||(Admin={}));var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Admin;(function(n){'use strict';;var t=function(t){function i(i,r,u,f){t.call(this,i,r,u,n.WidgetIds.RDWActiveUsers,f),this.dashboardData={categories:[]},this.drawNotes=!0}return __extends(i,t),i.prototype.SetWidgetClasses=function(n,t){n.widget.chartWidgetContainerClass=t.currentCultureInfo?"rw-item-summary-rtl rw-summary-chart-rtl":"rw-item-summary rw-summary-chart",n.widget.chartWidgetClass="rw-summary-chart-widget",n.widget.rwKpiClass=t.currentCultureInfo?"rw-kpi rw-item-summary-rtl":"rw-kpi rw-item-summary"},i.prototype.SetWidgetInScope=function(n,i){t.prototype.SetWidgetInScope.call(this,n,i),this.drawNotes=!1},i.prototype.SetChartOptions=function(){},i.prototype.PopulateWidgetData=function(n,t,r){var f,u,e,o,s;if(t&&t!=null&&(this.dashboardData=i.PopulateActiveUsersData(n.widget.Legend,t,n),this.dashboardData.categories=i.GetReportCategories(t,n)),n.AriaLabel=n.widget.Title,this.dashboardData&&this.dashboardData.categories&&n.widget.Legend){for(f=n.daysBackFilter.value,u=0;u<n.widget.Legend.length;u++)n.widget.Legend[u]&&(e=this.dashboardData[n.widget.Legend[u].Field],e&&(n.widget.Legend[u].data=e[f],o=n.widget.Legend[u].data.length,n.AriaLabel+=" "+n.widget.Legend[u].Name+": "+(o>0?n.widget.Legend[u].data[o-1]:"0")+"."));n.chartOptionsObject||(n.chartOptionsObject=i.GetChartOptions(this.dashboardData.categories,n,r.currentCultureInfo?!0:!1)),s=this,n.chartOptionsObject.optionsObject.render=function(t){s.RenderWidget(n.widget.WidgetId,t)},n.chartOptionsObject.optionsObject=i.UpdateChartOptions(n.chartOptionsObject,this.dashboardData.categories,n.widget.Legend,f),this.drawNotes&&i.DrawOldestContentDate(n,n.chartOptionsObject.optionsObject),n.heroChartOptions=n.chartOptionsObject.optionsObject,this.OnPopulateDataSuccess(n)}},i.prototype.UpdateWidgetData=function(n,i,r){this.dashboardData&&this.dashboardData.categories&&this.dashboardData.categories.length!=0?this.PopulateWidgetData(i,undefined,r):t.prototype.UpdateWidgetData.call(this,n,i,r)},i.DrawOldestContentDate=function(t,i){var r=n.ReportsLocStrings.GetInstance();t.oldestContentDate&&i&&i.categoryAxis&&i.categoryAxis.length>0&&(i.categoryAxis[0].notes=n.ChartOptions.GetVerticalSeriesClicklineOptions(Date.parse(t.oldestContentDate),t.oldestContentDate,r.format(r.RdwDataAsOfTextTitle,n.ReportsUtils.ConvertToLocalizedDateString(t.oldestContentDate)),185))},i.PopulateActiveUsersData=function(t,i,r){var y={},h,c,o,l,e,u,s,a,v,f;if(r.widget&&r.widget.Legend&&!(r.widget.Legend.length<=0)&&i){for(h=new Date,c=new Date(2015,0),o=r.widget.Legend.length-1;o>-1;o--)if(l=r.widget.Legend[o],e=l.Field,i.ActiveUserCount[e]&&i.ActiveUserCount[e].ActiveUsersPerDay){for(u=i.ActiveUserCount[e].ActiveUsersPerDay,s=u.length-1;s>-1;s--)a=u[s],a&&(a<0||a==="-1")&&(u[s]=null);v=u.length,y[e]={"7":7>v?u:u.slice(-7),"30":30>v?u:u.slice(-30),"90":90>v?u:u.slice(-90),"180":u},l.data=y[e][r.daysBackFilter],l.color=n.ChartOptions.GetWidgetColorFromSeriesIndex(o),f=i.ActiveUserCount[e].Date,f&&(f=n.ReportsUtils.ParseKendoDate(n.ReportsUtils.ToUTCDateString(f)),f<h&&(h=f,r.oldestContentDate=h),f>c&&(c=f,r.latestContentDate=c))}return y}},i.UpdateChartOptions=function(n,t,i,r){for(var u in n.optionsObject.categoryAxis)n.optionsObject.categoryAxis[u].categories=t.slice(-r);return n.optionsObject.series=n.GenerateChartSeries(i),n.SetStepCountForChart(r),n.optionsObject},i.GetChartOptions=function(t,i,r){var e=this,u=new n.ChartOptions(i.widget.Legend,r),f;return u.optionsObject.name=n.WidgetIds.RDWActiveUsers,f=u.optionsObject.categoryAxis[0],f.crosshair={visible:!0},u.optionsObject.tooltip.border.color="black",u.optionsObject.tooltip.shared=!0,u.optionsObject.tooltip.template=function(t){return n.ReportsUtils.GetToolTipTemplate(t,!0,r,!1)},f.categories=t.slice(-i.daysBackFilter),u},i.GetReportCategories=function(t,i){var r=[],s,f,e,u,o,h;if(!t||!t.ActiveUserCount||!t.ActiveUserCount)return r;for(s in t.ActiveUserCount)if(f=t.ActiveUserCount[s],f&&f.ActiveUsersPerDay){for(e=f.ActiveUsersPerDay.length,r=new Array(e),u=i.latestContentDate,o=e;o>-1;o--)r[o]=u,h=new Date(u.getTime()),u=new Date(h.setDate(u.getDate()-1));if(e>0)break}return r.length==0&&n.ReportsUtils.LogError('GetReportTileData date categories are empty','GetReportTileData',412657),r},i.$inject=["$scope","$http","ReportService","$rootScope","$window","$stateParams","$rootScope"],i}(n.BaseWidgetController);n.HeroChartController=t,n.app.controller("HeroChartController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u,f){this.$scope=t,this.$http=i,this.ReportService=r,this.$state=u,this.$rootScope=f,t.isDashboardSelected=u.current.name==n.ReportConstants.BaseState?!0:!1,t.selectedReport={report:{}},t.reportList=[],t.filterList=[],t.selectedFilter={},t.GetSelectedReport=function(){try{return t.selectedReport.report}catch(i){n.ReportsUtils.LogError('Unable to get selected report from scope')}return undefined},t.$on(n.ReportEventNames.ReportIdChanged,function(){var i=t.GetSelectedReport();(i!=null||i!=undefined)&&(t.resetReportFilter(i),t.changeReportView())}),t.$watch('reportList',function(){o(u.current.name)}),t.gotoReportState=function(i){var r=i.GotoState,f;if(r&&r!=null&&r.length!=0){if(i.WidgetId=="RDWPowerBI"){window.open(r,'_blank');return}for(f=0;f<t.reportList.length;f++)if(e(t.reportList[f].id)==r){t.selectedReport.report=t.reportList[f],t.resetReportFilter(t.selectedReport.report);break}t.isDashboardSelected=t.isDashboardReport(t.selectedReport.report.id),t.SetReportHelpLink(),u.go(i.GotoState),n.ReportsUtils.LogInfo("Changing report state...",t.selectedReport.report.id,412673)}},t.$on(n.ReportEventNames.FilterChangeBroadcastEventNeeded,function(i,r){r&&r!=t.selectedFilter.filter&&(t.selectedFilter.filter=r,t.$broadcast(n.ReportEventNames.FilterChangeBroadcastEvent,t.selectedFilter.filter))}),t.resetReportFilter=function(n){t.filterList=[],t.selectedFilter={};var i=n.selectedViewIndex>=0?n.views[n.selectedViewIndex]:undefined;t.filterList=i&&i.Filters?i.Filters:undefined,t.selectedFilter.filter=t.filterList&&t.filterList.length>0?t.filterList[0]:null},t.isDashboardReport=function(t){return t&&t.length>0&&t===n.ReportConstants.BaseState},t.SetReportHelpLink=function(){t.selectedReport&&t.selectedReport.report.helpId?O365.HyperLink.SetLinkHref(n.ReportConstants.HelpLinkId,"javascript:Shared.ShowHelpPopup('"+t.selectedReport.report.helpId+"')"):O365.HyperLink.SetLinkHref(n.ReportConstants.HelpLinkId,"javascript:Shared.ShowHelpPopup('"+n.ReportConstants.HelpLinkDashboardHelpId+"')")},t.changeReportView=function(){var i=t.selectedReport.report,f,r;i.externalUrl&&i.externalUrl.length>0?(f=window.open(i.externalUrl,'_blank'),f.focus(),n.ReportsUtils.LogInfo(i.id,'externalReportOpened',420078)):(t.isDashboardSelected=t.isDashboardReport(i.id),t.SetReportHelpLink(),r=e(i.id),n.ReportsUtils.LogInfo(r,i.id,412660),u.go(r))},f.$on('$stateChangeStart',function(t,i){i.name==n.ReportConstants.BaseState&&o(i.name)});var e=function(t){return t===n.ReportConstants.BaseState?n.ReportConstants.BaseState:n.ReportConstants.BaseState+"."+t},o=function(i){var r,u;if(i&&i.length>0)for(r=0;r<t.reportList.length;r++)if(u=e(t.reportList[r].id),u==i){t.selectedReport.report=t.reportList[r],t.resetReportFilter(t.selectedReport.report),t.isDashboardSelected=t.isDashboardReport(t.selectedReport.report.id),t.SetReportHelpLink(),n.ReportsUtils.LogInfo("Set report from state",t.selectedReport.report.id,418915);break}}}return t.$inject=["$scope","$http","ReportService","$state","$rootScope"],t}();n.ReportSelectorController=t,n.app.controller("ReportSelectorController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u){var f,s,l;this.$scope=t,this.$rootScope=i,this.$http=r,this.ReportService=u,i.$on('$stateChangeStart',function(t,i,r,u){var o,e;if(u.name.indexOf(n.ReportConstants.BaseState)>=0&&i.name.indexOf(n.ReportConstants.BaseState)==-1)for(o=document.getElementsByTagName(n.ReportConstants.DetailsGridElement),e=0;e<o.length;e++)o[e]&&kendo.destroy(o[e])}),t.showTenantExport=!1,u.IsFeatureEnabled("TenantExportLink").then(function(n){t.showTenantExport=n}),t.hideDetailsGrid=!1,t.showDetailChart=!1,t.chartWidth=angular.element(document.querySelectorAll(".rd-dtl-chart")[0])[0].clientWidth,t.exportText||(f=n.ReportsLocStrings.GetInstance(),t.exportText=f.RdExport,t.loadingText=f.RdLoading,t.loadMoreText=f.RdLoadMore,t.manageColumnsTitle=f.RdManageColumns,t.noDataMessage=f.RemNoDataMessage),t.$watch('selectedReport.report.id',function(){var f=t.GetSelectedReport();(f!=null||f!=undefined)&&f.url&&f.url.length>0&&(t.reportDisplayOptions=n.ReportDisplayFactory.GetReportDisplayOptions(f,t,i),u.GetSummaryData(f.url).success(h),o())}),t.$on(n.ReportEventNames.FilterChangeBroadcastEvent,function(){t.reportDisplayOptions.promoteFilteredChartData(t.chartSummaryDataValue,t.selectedFilter.filter),t.reportDisplayOptions.updateChartViewOptions(t.chartSummaryDataValue,u.GetDaysBackFilter().value),o()}),t.$on(n.ReportEventNames.TimeSelectorChangeBroadcastEvent,function(){t.detailData.daysBackFilter=u.GetDaysBackFilter().value,t.chartOptions={},t.chartOptions=t.reportDisplayOptions.updateChartViewOptions(t.chartSummaryDataValue,t.detailData.daysBackFilter).optionsObject,l(t.detailData.daysBackFilter)}),t.$on(n.ReportEventNames.SeriesClickBroadcastEvent,function(i,r){t.detailData.clickThruBuiltinODataFilter=r.seriesClickFilter,t.detailData.chartDetailSkipToken="",t.detailData.daysBackFilter=1,t.detailData.gridOptions=null,c();var u=t.GetSelectedReport();n.ReportsUtils.LogInfo('SeriesClick event recorded with filter: '+t.detailData.clickThruBuiltinODataFilter,u?u.id:'',415143)});var e=function(n){var i={metadata:'',value:null,error:'',nextLink:''},t;return n&&n.Output&&n.Output.length>0&&(t=JSON.parse(n.Output),i.metadata=t["odata.metadata"]||t["@odata.context"],i.nextLink=t["odata.nextLink"]||t["@odata.nextLink"],i.value=t.value),n&&n.ErrorRecords&&n.ErrorRecords.length>0&&(i.error=n.ErrorRecords[0].Message),i},h=function(i){var r=e(i),s=t.GetSelectedReport(),o,f;t.chartSummaryDataValue=t.reportDisplayOptions.processChartData(r.value,t.selectedFilter.filter),o=!r.value||r.value.length==0,t.chartSummaryErrorMessage=r.error?r.error:o?n.ReportsLocStrings.GetInstance().RemNoDataMessage:"",f=s.GetSelectedView(),t.reportOptions=t.reportDisplayOptions.getChartViewOptions(t.chartSummaryDataValue,u.GetDaysBackFilter().value),t.chartOptions=t.reportOptions.optionsObject,a(r),t.viewDescription=f&&f.Description?f.Description:''},a=function(i){if(i!=null&&i.value!=null&&i.value.length>0){var u=n.ReportsUtils.ToUTCDateString(i.value[i.value.length-1].Date),f=n.ReportsUtils.ConvertToLocalizedDateString(u),r=n.ReportsLocStrings.GetInstance();t.dataAsOf=r.format(r.RdwDataAsOfTextTitle,f)}},v=function(n){if(!t.detailData.gridOptions){var i=e(n),r=t.reportDisplayOptions.processGridData(i.value,"M"+t.detailData.daysBackFilter);i.value=r?r.rows:[],t.detailData.chartDetailDataMetadata=i.metadata,t.detailData.chartDetailSkipToken='',t.detailData.gridOptions||(t.detailData.gridOptions=t.reportDisplayOptions.getGridOptions(!1,!0,i.value))}},y=function(i,r){var f=n.ReportsLocStrings.GetInstance(),c=t.detailData.daysBackFilter,u=e(i),o=t.reportDisplayOptions.processGridData(u.value,"M"+t.detailData.daysBackFilter),s=0,h;u.value=[],o&&(u.value=o.rows,s=o.missingUserNames),t.detailData.chartDetailDataMetadata=u.metadata,t.detailData.chartDetailErrorMessage=u.error,t.detailData.chartDetailSkipToken=u.nextLink?n.ReportsUtils.GetODataQueryParam('skiptoken',u.nextLink):"",r||(h=t.detailData.chartDetailSkipToken.length==0,(h||!t.detailData.gridOptions)&&(t.detailData.gridOptions=t.reportDisplayOptions.getGridOptions(h,!1,u.value))),t.detailData.gridOptions&&r?(t.detailData.gridOptions.AppendData(u.value),t.detailData.missingUserNames+=s,t.kendoGrid.refresh()):(t.detailData.gridOptions.UpdateData(u.value),t.detailData.missingUserNames=s),t.hideDetailsGrid=t.detailData.gridOptions.GetDataLength()==0?!0:!1,!t.detailData.chartDetailErrorMessage&&t.detailData.missingUserNames>0&&(t.detailData.chartDetailErrorMessage=f.RemMissingUserNamesPartOne+t.detailData.missingUserNames+f.RemMissingUserNamesPartTwo),t.detailData.chartDetailStatusMessage=f.format(f.RsmRecordsLoadedFormat,t.detailData.gridOptions.GetDataLength(),t.detailData.chartDetailSkipToken.length>0?f.RsmRecordsLoadedOfMany:''),t.chartDetailRequestPending=!1,t.detailData.chartDetailErrorMessage&&t.detailData.chartDetailErrorMessage.length!=0||u.value&&u.value.length!=0||(t.detailData.chartDetailErrorMessage=t.noDataMessage)},o=function(){t.detailData=new n.DetailsDataConfig,t.detailData.daysBackFilter=u.GetDaysBackFilter().value,t.reportDisplayOptions.preprocessGridConfig(t.detailData),c()},c=function(){s(!0,!1)};t.getMoreDetailData=function(){s(!1,!0)},s=function(i,r){i===void 0&&(i=!1),r===void 0&&(r=!1),t.chartDetailRequestPending=!0;var f=n.ReportsUtils.GetPageSizesForReport(t.selectedReport.report.id);i&&u.GetDetailData(t.selectedReport.report.url,t.detailData.chartDetailSkipToken,t.selectedFilter.filter,t.detailData.clickThruBuiltinODataFilter,f.prefetch.toString()).success(function(n){v(n)}),u.GetDetailData(t.selectedReport.report.url,t.detailData.chartDetailSkipToken,t.selectedFilter.filter,t.detailData.clickThruBuiltinODataFilter,r?f.addMore.toString():f.initial.toString()).success(function(n){y(n,r)})},l=function(n){t.detailData.clickThruBuiltinODataFilter&&t.detailData.clickThruBuiltinODataFilter.length>0?o():!t.chartDetailRequestPending&&t.detailData.gridOptions&&t.updateDetailData(t.detailData.gridOptions.GetData(),n),t.hideDetailsGrid=t.detailData.gridOptions.GetDataLength()==0?!0:!1},t.exportDetailsData=function(){t.selectedReport.report.url&&u.ExportReportData(t.selectedReport.report.url,t.selectedFilter.filter,t.detailData.clickThruBuiltinODataFilter,t.detailData.daysBackFilter)},t.exportSummaryData=function(){if(t.selectedReport.report.url){var n=t.selectedReport.report.selectedViewIndex;u.ExportReportSummaryData(t.selectedReport.report.url,t.selectedReport.report.views[n].Title,t.detailData.daysBackFilter)}},t.GetSelectedReport=function(){try{return t.selectedReport.report}catch(i){n.ReportsUtils.LogError('Unable to get selected report from scope')}return undefined},t.isActiveView=function(n){try{if(t.GetSelectedReport().selectedViewIndex==n)return'rv-active-tab'}catch(i){}return'rv-inactive-tab'},t.setActiveView=function(n){var i=t.GetSelectedReport();n==i.selectedViewIndex||n>i.views.length-1||(i.selectedViewIndex=n,u.GetSummaryData(i.url).success(h))},t.updateDetailData=function(n){t.reportDisplayOptions.promoteGridData(n,"M"+t.detailData.daysBackFilter),t.kendoGrid.refresh()}}return t.$inject=["$scope","$rootScope","$http","ReportService"],t}();n.ReportDetailsController=t,n.app.controller("ReportDetailsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u){this.$scope=t,this.$rootScope=i,this.$http=r,this.ReportService=u,t.externalReportItemList=[],t.reportListLoading=!0,t.externalReportError=!1,t.loadingText||(t.loadingText=n.ReportsLocStrings.GetInstance().RdLoading),u.GetExternalReportCategoryDetails().then(function(i){t.reportListLoading=!1,i.data.Error&&i.data.Error.length>0?(t.externalReportError=!0,t.loadingError=i.data.Error):(t.externalReportItemList=i.data.ReportCategories,t.externalReportError=!1,t.loadingError=n.ReportsLocStrings.GetInstance().RemErrLoadMessage)},function(){n.ReportsUtils.LogError("Failed to retrieve report category list details from ReportService"),t.reportListLoading=!1,t.externalReportError=!0}),t.showExternalReportLinkKeyPress=function(n,i){i.which===13&&t.showExternalReport(n)},t.showExternalReport=function(n){var t=860,i=810,r=window.outerWidth?window.outerWidth:document.documentElement.clientWidth,u=window.outerHeight?window.outerHeight:document.documentElement.clientHeight,f=window.screenX?window.screenX:window.screenLeft,e=window.screenY?window.screenY:window.screenTop,o=Math.max((r-i)/2,0)+f,s=Math.max((u-t)/2,0)+e,h="yes";window.open(n,'','height='+t+',width='+i+',left='+o+',top='+s+',location=no,menubar=no,status=yes,toolbar=no,resizable=yes,scrollbars='+h)}}return t.$inject=["$scope","$rootScope","$http","ReportService"],t}();n.SecurityAndComplianceController=t,n.app.controller("SecurityAndComplianceController",t)})(Admin||(Admin={}));var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Admin;(function(n){'use strict';;var t=function(t){function i(i,r,u,f){t.call(this,i,r,u,n.WidgetIds.RDWOneDriveFilesV1,f)}return __extends(i,t),i.prototype.SetChartOptions=function(i,r){var f=n.ReportsLocStrings.GetInstance(),u=t.prototype.GetChartOptions.call(this,i,[{field:'value',categoryField:'date',name:f.RdwOneDriveStorageUsed,color:'#BFCAE4',opacity:1}],r);u.seriesDefaults={type:'area'},u.categoryAxis[0]&&(u.categoryAxis[0].labels={step:6,dateFormats:{days:kendo.culture().calendar.patterns.d}}),u.valueAxis=[{line:{visible:!1},labels:{template:"#= Admin.ReportsUtils.FormatBytes(value, Admin.ReportConstants.DefaultDecimalpoints)#",color:'#939598'}}],u.tooltip.visible=!0,u.tooltip.template="#= Admin.ReportsUtils.FormatBytes(value, 1)# "+f.RdWidgetUsed,i.oneDriveStorageAreaOptions=u},i.prototype.CheckDataPopulated=function(n,t){return n.oneDriveStorageAreaOptions.dataSource.data=[],t&&t.DiskStatisticsByDate&&t.DiskStatisticsByDate.length>0?t:(this.SetDataPopulatedIncorrectly(n),undefined)},i.prototype.PopulateWidget=function(t,i){for(var c=n.ReportsUtils.ToUTCDateString(i.Date),f=new Date(c),l=[],e=i.DiskStatisticsByDate,o,h,u,s,r=e.length-1;r>=e.length-t.daysBackFilter.value;r--)o=e[r].DiskUsedBytes==null?0:e[r].DiskUsedBytes,t.oneDriveStorageAreaOptions.dataSource.data.push({value:o,date:f}),l.push(parseInt(o)),h=new Date(f.getTime()),f=new Date(h.setDate(f.getDate()-1));t.widget.KpiData=n.ReportsUtils.FormatLongNumber(i.CurrentDocumentCount,1),t.widget.KpiDataActivity=i.CurrentDocumentCount,u=this.GetDaysBackObjectName(t),this.UpdateOneDriveActiveEntity(t,i,u),t.oneDriveStorageAreaOptions.categoryAxis[0].labels.step=t.daysBackFilter.value-1,s=i&&i[u].PercentChangeDocuments&&!isNaN(i[u].PercentChangeDocuments),this.UpdateKpiTrend(t,s?i[u].PercentChangeDocuments:0,s)},i.prototype.UpdateOneDriveActiveEntity=function(n,t,i){t[i]&&!isNaN(t[i].EnabledUsers)&&!isNaN(t[i].ActiveUsers)&&parseInt(t[i].EnabledUsers)>0?(n.activeEntityPercent=parseInt(t[i].ActiveUsers)/parseInt(t[i].EnabledUsers)*100,this.SetActiveEntityText(n,t[i].ActiveUsers,t[i].EnabledUsers),t.ActiveUsers=t[i].ActiveUsers,t.EnabledUsers=t[i].EnabledUsers):n.activeEntityPercent=null},i.prototype.SetValueAxisLabelTemplate=function(n,t){this.SetChartOptionsTemplate(n,"#= Admin.ReportsUtils.FormatBytes(value,"+t+") #")},i.$inject=["$scope","$http","ReportService","$rootScope"],i}(n.BaseWidgetController);n.OneDriveFilesWidgetControllerV1=t,n.app.controller("OneDriveFilesWidgetControllerV1",t)})(Admin||(Admin={}));var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Admin;(function(n){'use strict';;var t=function(t){function i(i,r,u,f){t.call(this,i,r,u,n.WidgetIds.RDWSharePointActivity,f)}return __extends(i,t),i.prototype.SetChartOptions=function(t,i){var r=n.ReportsLocStrings.GetInstance();t.spoActivityOptions=this.GetChartOptions(t,[{field:'ActiveFiles',name:r.RdwSpoActivityActiveLegendText},{field:'FilesSynced',name:r.RdwSpoActivityFilesSyncdLegendText},{field:'FilesSharedInternally',name:r.RdwSpoActivityFilesSharedInternallyLegendText},{field:'FilesSharedExternally',name:r.RdwSpoActivityFilesSharedExternallyLegendText}],i)},i.prototype.CheckDataPopulated=function(n,i){var r=i.CurrentDocumentCount;return i=t.prototype.CheckDataPopulated.call(this,n,i),r&&(i.CurrentDocumentCount=r),i},i.prototype.PopulateWidget=function(t,i){t.spoActivityOptions.dataSource.data=[],t.spoActivityOptions.dataSource.data.push(i),t.widget.KpiData=n.ReportsUtils.FormatLongNumber(i.CurrentDocumentCount,1),t.widget.KpiDataActivity=i.CurrentDocumentCount,!isNaN(i.EnabledUsers)&&!isNaN(i.ActiveUsers)&&parseInt(i.EnabledUsers)>0&&(t.activeEntityPercent=parseInt(i.ActiveUsers)/parseInt(i.EnabledUsers)*100,this.SetActiveEntityText(t,i.ActiveUsers,i.EnabledUsers));var r=i&&i.PercentChangeDocuments&&!isNaN(i.PercentChangeDocuments);this.UpdateKpiTrend(t,r?i.PercentChangeDocuments:0,r)},i.$inject=["$scope","$http","ReportService","$rootScope"],i}(n.BaseWidgetController);n.SharePointActivityWidgetController=t,n.app.controller("SharePointActivityWidgetController",t)})(Admin||(Admin={}));var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Admin;(function(n){'use strict';;var t=function(t){function i(i,r,u,f){t.call(this,i,r,u,n.WidgetIds.RDWSkypeActivity,f),this.$scope=i,this.$http=r,this.reportService=u}return __extends(i,t),i.prototype.SetChartOptions=function(t,i){var r=n.ReportsLocStrings.GetInstance();t.skypeActivityOptions=this.GetChartOptions(t,[{field:'PeerSession',name:r.RdwSkypeP2PLegend},{field:'OrganizeConference',name:r.RdwSkypeOrganizedLegend},{field:'ParticipateConference',name:r.RdwSkypeParticipatedLegend},],i)},i.prototype.PopulateWidget=function(t,i){t.skypeActivityOptions.dataSource.data=[],t.skypeActivityOptions.dataSource.data.push(i),t.widget.KpiData=n.ReportsUtils.FormatLongNumber(i.TotalActivity,1),t.widget.KpiDataActivity=i.TotalActivity,!isNaN(i.EnabledUsers)&&!isNaN(i.ActiveUsers)&&parseInt(i.EnabledUsers)>0&&(t.activeEntityPercent=parseInt(i.ActiveUsers)/parseInt(i.EnabledUsers)*100,this.SetActiveEntityText(t,i.ActiveUsers,i.EnabledUsers));var r=i&&i.PercentChangeInActivity&&!isNaN(i.PercentChangeInActivity);this.UpdateKpiTrend(t,r?i.PercentChangeInActivity:0,r)},i.$inject=["$scope","$http","ReportService","$rootScope"],i}(n.BaseWidgetController);n.SkypeActivityWidgetController=t,n.app.controller("SkypeActivityWidgetController",t)})(Admin||(Admin={}));var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Admin;(function(n){'use strict';;var t=function(t){function i(i,r,u,f){t.call(this,i,r,u,n.WidgetIds.RDWTotalActivations,f)}return __extends(i,t),i.prototype.SetChartOptions=function(t,i){var r=n.ReportsLocStrings.GetInstance();t.totalActivationsOptions=this.GetChartOptions(t,[{field:'DesktopActivations',name:r.RdwTotalActivationsDesktop},{field:'DeviceActivations',name:r.RdwTotalActivationsDevices}],i)},i.prototype.CheckDataPopulated=function(n,t){return n.totalActivationsOptions.dataSource.data=[],t&&t.TotalActivations&&t.EnabledUsers&&t.ActiveUsers?t:(this.SetErrorClearWidgetData(n),undefined)},i.prototype.PopulateWidget=function(t,i){t.totalActivationsOptions.dataSource.data.push(i),t.widget.KpiData=n.ReportsUtils.FormatLongNumber(i.TotalActivations,1),t.widget.KpiDataActivity=i.TotalActivations,!isNaN(i.EnabledUsers)&&!isNaN(i.ActiveUsers)&&parseInt(i.EnabledUsers)>0&&(t.activeEntityPercent=parseInt(i.ActiveUsers)/parseInt(i.EnabledUsers)*100,this.SetActiveEntityText(t,i.ActiveUsers,i.EnabledUsers))},i.$inject=["$scope","$http","ReportService","$rootScope"],i}(n.BaseWidgetController);n.TotalActivationsWidgetController=t,n.app.controller("TotalActivationsWidgetController",t)})(Admin||(Admin={}));var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Admin;(function(n){'use strict';;var t=function(t){function i(i,r,u,f){t.call(this,i,r,u,n.WidgetIds.RDWTotalSeats,f),this.$scope=i,this.$http=r,this.reportService=u,i.activeUsers=341}return __extends(i,t),i.prototype.SetChartOptions=function(t,i){var r=n.ReportsLocStrings.GetInstance(),u=this.GetChartOptions(t,[{field:'emailsReceived',name:r.RdwEmailTrafficReceived},{field:'emailsSent',name:r.RdwEmailTrafficSent},{field:'emailsRead',name:r.RdwEmailTrafficRead},{field:'emailsFiltered',name:r.RdwEmailTrafficFiltered}],i);u.dataSource=this.GetDataSource(),t.totalActivationsOptions=u},i.prototype.GetDataSource=function(){return new kendo.data.DataSource({data:[{emailsReceived:3e3,emailsSent:2e3,emailsRead:1e3,emailsFiltered:500}]})},i.$inject=["$scope","$http","ReportService","$rootScope"],i}(n.BaseWidgetController);n.TotalSeatsWidgetController=t,n.app.controller("TotalSeatsWidgetController",t)})(Admin||(Admin={}));var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Admin;(function(n){'use strict';;var t=function(t){function i(i,r,u,f){t.call(this,i,r,u,n.WidgetIds.RDWYammerMessages,f),this.$scope=i,this.$http=r,this.reportService=u}return __extends(i,t),i.prototype.SetChartOptions=function(t,i){var r=n.ReportsLocStrings.GetInstance();t.yammerMessagesOptions=this.GetChartOptions(t,[{field:'MessageCreated',name:r.RdwYammerPosted},{field:'MessageViewed',name:r.RdwYammerRead},{field:'Liked',name:r.RdwYammerLiked}],i)},i.prototype.PopulateWidget=function(t,i){t.yammerMessagesOptions.dataSource.data=[],t.yammerMessagesOptions.dataSource.data.push(i),t.widget.KpiData=n.ReportsUtils.FormatLongNumber(i.TotalActivity,1),t.widget.KpiDataActivity=i.TotalActivity,!isNaN(i.EnabledUsers)&&!isNaN(i.ActiveUsers)&&parseInt(i.EnabledUsers)>0&&(t.activeEntityPercent=parseInt(i.ActiveUsers)/parseInt(i.EnabledUsers)*100,this.SetActiveEntityText(t,i.ActiveUsers,i.EnabledUsers));var u=i&&i.PercentChangeInActivity&&!isNaN(i.PercentChangeInActivity);this.UpdateKpiTrend(t,u?i.PercentChangeInActivity:0,u)},i.$inject=["$scope","$http","ReportService","$rootScope"],i}(n.BaseWidgetController);n.YammerMessagesWidgetController=t,n.app.controller("YammerMessagesWidgetController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(){if(t.instance)throw new Error("Use Processor.GetInstance()");}return t.GetInstance=function(){return t.instance||(t.instance=new t),t.instance},t.ProcessVanillaResult=function(t,i,r){return t&&t!=null&&t.length!=0||n.ReportsUtils.LogError("Checking raw returned array, and it is empty!",i,r),t},t.ProcessVanillaResultCheckUserNames=function(i,r,u,f){if(t.ProcessVanillaResult(i,r.id,f)){t.NormalizeDataTypesWithEncoding(i,u);var e=t.RemoveEmptyUserNames(i,u);return e.missingUserNames>0&&n.ReportsUtils.LogError(e.missingUserNames+" rows have been removed due to invalid or missing row ids.",r.id,412663),e}},t.ProcessStateMetricSummaryData=function(n,i,r){if(!n||n==null)return[];var u=t.GetRequiredStateMetricFields(i,r);return u==null?[]:(t.SortArrayByField(n,u.dateField),t.PromoteStateMetricSummaryData(n,r,t.GetMetricColumns(i.columns),u.dateField,u.seriesDataField,u.seriesDataValueField),n)},t.PromoteNameValuePairsFromSummaryData=function(t,i){var r=i.GetSelectedView(),u,f;if(!t||t.length==0||!r||!r.YAxis)return n.ReportsUtils.LogError("PromoteNameValuePairsFromSummaryData: Invalid data or report view parameter (DataField or view list) detected",i.id),{};var e={},o=r.YAxis.DataField,s=r.YAxis.DataValueField;for(u=0;u<t.length;u++)f=t[u],f[o]&&(e[f[o]]=f[s]);return e},t.PromoteStateMetricSummaryDataFromReport=function(n,i,r){var u=t.GetRequiredStateMetricFields(r,i);u!=null&&t.PromoteStateMetricSummaryData(n,i,t.GetMetricColumns(r.columns),u.dateField,u.seriesDataField,u.seriesDataValueField)},t.GetRequiredStateMetricFields=function(n,i){var r={},u;return!t.CheckRequiredStateMetricSummaryParameters(n)||i==null?null:(u=n.GetSelectedView(),r.seriesDataField=u.YAxis.DataField,r.seriesDataValueField=u.YAxis.DataValueField,r.dateField=u.XAxis.DataField,r)},t.PromoteStateMetricSummaryData=function(n,i,r,u,f,e){for(var o,h,c,l,a,s=0;s<n.length;s++)if(o=n[s],t.TreatRowDateAsLocalDate(o,u),o[f]&&o[f][e])if(h=$.grep(o[f][e],function(n){return n[i.Name]===i.Value}),h&&h.length>0){c=h[0];for(l in c)a=parseFloat(c[l]),o[l]=isNaN(a)?c[l]:a}else t.WipeMetricsColumnsFromRow(o,r)},t.GetRequiredRawDataFields=function(t){var r=t.selectedViewIndex,i,u;return r<0||!t.views||t.views.length==0?(n.ReportsUtils.LogError("ProcessRawData: An invalid report view parameter (index or view list) was detected",t.id),null):(i=t.views[r],r<0||!t.views||t.views.length==0||!i.XAxis||!i.YAxis||!i.XAxis.DataField||!i.YAxis.DataField)?(n.ReportsUtils.LogError("ProcessRawData: missing required meta data to process data",t.id),null):u={dateField:i.XAxis.DataField,seriesDataField:i.YAxis.DataField}},t.ProcessRawData=function(i,r){var s=[],h,f,a=t.GetRequiredRawDataFields(r),c,l,u,e,o;if(a){if(h=a.dateField,f=a.seriesDataField,i&&i.length>0){for(t.SortArrayByField(i,h),c=0,l=0;l<i.length;l++){if(u=i[l],u[f]&&u[f]!=null){for(e in u)e!==f&&e!==h&&(u[e]=u[e]==null||isNaN(u[e])?null:parseFloat(u[e]));for(o in u[f])u[f][o]==null||isNaN(u[f][o])?(c++,u[o]=null):u[o]=parseFloat(u[f][o]);delete u[f]}t.TreatRowDateAsLocalDate(u,h),s.push(u)}c>0&&n.ReportsUtils.LogError("Chart response contains "+c+" fields that cannot be parsed to numeric entries",r.id,412659)}return s.length>0?n.ReportsUtils.CheckStaleData(r.id,s[s.length-1][h]):n.ReportsUtils.LogError("ProcessRawData: No data has been returned.",r.id,412657),s}},t.ProcessPreAggregateDetails=function(n,i,r,u){return t.ProcessPreAggregateDetailsWithNormalization(n,i,r,u,t.NormalizeSingleObjectAggregate)},t.ProcessPreAggregateDetailsWithNormalization=function(i,r,u,f,e){if(t.ProcessVanillaResult(i,r.id,412661)){t.NormalizeDataTypesWithEncoding(i,u,e),t.PromoteDetailsData(i,r,u,f);var o=t.RemoveEmptyUserNames(i,u);return o.missingUserNames>0&&n.ReportsUtils.LogError(o.missingUserNames+" rows have been removed due to invalid or missing row ids",r.id,412663),o}},t.NormalizeDataTypesWithEncoding=function(n,i,r){return r===void 0&&(r=t.NormalizeSingleObjectAggregate),t.NormalizeDataTypes(n,i,r,!0)},t.NormalizeDataTypes=function(n,i,r,u){var o,c,s,e,f,h;for(r===void 0&&(r=t.NormalizeSingleObjectAggregate),u===void 0&&(u=!1),o={},i.forEach(function(n){o[n.DataField]={Type:n.DataType,ConversionFactor:n.FieldConversionFactor}}),s=0;s<n.length;s++){e=n[s];for(f in e)h=o[f],h&&e[f]?e[f]=t.NormalizeDataValue(h.Type,e[f],u,h.ConversionFactor):$.inArray(f,t.aggregateCollections)>-1?r(e,f,c,o):e[f]==null&&(e[f]='')}},t.NormalizeSingleObjectAggregate=function(n,i,r,u){var f,e;for(f in n[i])r=n[i][f],u[f]&&(e=t.NormalizeDataValue(u[f].Type,r,!1,u[f].ConversionFactor),e!=undefined&&(n[i][f]=e))},t.RemoveEmptyUserNames=function(n,i){var r={},u;return r.rows=n,r.missingUserNames=0,u=$.grep(i,function(n){return n.IsRowId&&n.IsRowId==!0}),u&&u.length>0&&t.RemoveEmptyRowIds(u[0].DataField,r),r},t.RemoveEmptyRowIds=function(n,t){var i,r;if(!t||!t.rows||t.rows.length<1)return t;for(i=t.rows.length;i--;)r=t.rows[i],r[n]&&r[n]!=null&&r[n].length!=0||(t.missingUserNames++,t.rows.splice(i,1));return t},t.PromoteDetailsData=function(n,i,r,u){(n=t.ProcessVanillaResult(n,i.id,412661),n&&n!=null)&&t.PromoteDetailsDefaultData(n,r,u)},t.SortArrayByField=function(n,t){n.sort(function(n,i){return n[t]==i[t]?0:+(n[t]>i[t])||-1})},t.GetAggregateCollectionNameFromDaysFilter=function(n){return"M"+n.toString()},t.NormalizeDataValue=function(t,i,r,u){r===void 0&&(r=!1),u===void 0&&(u=1);switch(t){case"number":return(i=i?n.ReportsUtils.ParseToFloat(i):0,u&&u!=1)?i*u:i;case"date":return i?n.ReportsUtils.ToUTCDateFormat(i):i;case"array":return i.join();case"checkmark":return i&&(typeof i=="number"&&i>0||isNaN(i)&&i.length>0)?!0:!1;default:return r&&i?encodeURI(i):i}},t.PromoteDetailsDefaultData=function(n,i,r){for(var e=t.GetMetricColumns(i),f,u=0;u<n.length;u++)f=n[u],t.PromoteRowMetric(f,e,r)},t.PromoteRowMetric=function(n,i,r){if(n[r]&&n[r]!=null){var u;i.forEach(function(t){u=n[r][t],u!=null?n[t]=u:delete n[t]})}else t.WipeMetricsColumnsFromRow(n,i)},t.CheckRequiredStateMetricSummaryParameters=function(t){var r=t.selectedViewIndex,i;if(r<0||!t.views||t.views.length==0){n.ReportsUtils.LogError("CheckRequiredStateMetricSummaryParameters: An invalid report view parameter (index or view list) was detected",t.id);return}return(i=t.views[r],r>-1&&i&&t.views&&t.views.length>0&&i.XAxis&&i.YAxis&&i.YAxis.DataField&&i.XAxis.DataField&&i.YAxis.DataField)?!0:!1},t.GetMetricColumns=function(n){var t=[];return n.forEach(function(n){n.IsMetric&&t.push(n.DataField)}),t},t.WipeMetricsColumnsFromRow=function(n,t){for(var i=0;i<t.length;i++)delete n[t[i]]},t.TreatRowDateAsLocalDate=function(n,t){n[t]=n[t].replace("Z","")},t.aggregateCollections=["M1","M7","M30","M90","M180"],t}();n.Processor=t})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(){this.chartdetailDataMetadata="",this.chartDetailErrorMessage="",this.chartDetailStatusMessage="",this.chartDetailSkipToken="",this.clickThruBuiltinODataFilter="",this.daysBackFilter="",this.missingUserNames=0,this.gridOptions=null}return n}();n.DetailsDataConfig=t})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(n,t,i){this.report=n,this.isRightToLeft=i?!0:!1,this.scope=t}return t.prototype.processChartData=function(t,i){i===void 0&&(i=null);var r=this.report.GetSelectedViewDataProperty();return r&&t.length>0?n.Processor.ProcessRawData(t[0][r],this.report):n.Processor.ProcessRawData(t,this.report)},t.prototype.getChartViewOptions=function(t,i){var r=this;return r.chartOptions=new n.ChartOptions(this.report.GetSelectedView()?this.report.GetSelectedView().Legend:[],this.isRightToLeft,this.report.selectedViewIndex),r.chartOptions.optionsObject.legend={visible:!0,position:"bottom",align:"center",labels:{color:'#505050',font:'15px Segoe UI Large Plus,Segoe UI Large,Segoe UI,Segoe,Tahoma,Helvetica,Arial,Sans-Serif'}},r.SetReportDisplayChartData(t,i),r.SetReportDisplayChartOptions(t,i),r.SetSeriesClickEvent(),r.chartOptions.optionsObject.render=function(n){r.RenderChart(n)},this.chartOptions},t.prototype.RenderChart=function(t){if(n.ReportConstants.FirstTimeRendered)try{var i=t.sender.options.name;t.sender.$angular_scope.showDetailChart=!1,n.ReportConstants.FirstTimeRendered=!1,this.SetValueAxisLabelTemplate(i,n.ChartOptions.GetNumDecForYAxisLabels(t.sender._model._plotArea.axisY.labels)),t.sender.$angular_scope.showDetailChart=!0,n.ChartOptions.RedrawKendoChartById(t.sender.options.name)}catch(r){t.sender.$angular_scope.showDetailChart=!0,n.ReportConstants.FirstTimeRendered=!0}else n.ReportConstants.FirstTimeRendered=!0,t.sender.$angular_scope.showDetailChart=!0},t.prototype.SetValueAxisLabelTemplate=function(n,t){this.report.IsStorageView()?this.SetChartOptionsTemplate(n,"#= Admin.ReportsUtils.FormatBytes(value,"+t+") #"):this.SetChartOptionsTemplate(n,"#= Admin.ReportsUtils.FormatLongNumber(value, "+t+") #")},t.prototype.SetChartOptionsTemplate=function(t,i){n.ChartOptions.SetChartValueAxisTemplate(t,i)},t.prototype.SetReportDisplayChartOptions=function(t,i){var u=this,r=this.chartOptions.optionsObject.categoryAxis[0];this.chartOptions.optionsObject.chartArea={height:this.chartOptions.defaultChartAreaHeight},r.field="Date",r.type="date",r.crosshair={visible:!0},this.chartOptions.optionsObject.tooltip.border.color="black",this.chartOptions.optionsObject.tooltip.shared=!0,this.chartOptions.optionsObject.tooltip.template=function(t){return n.ReportsUtils.GetToolTipTemplate(t,!0,u.isRightToLeft,!1)},this.chartOptions.SetStepCountForChart(i),this.report.IsStorageView()&&this.chartOptions.SetStorageViewOptions(this.chartOptions.optionsObject.valueAxis[0],this.isRightToLeft)},t.prototype.SetReportDisplayChartData=function(n,t){this.chartOptions.optionsObject.dataSource=n.slice(-t)},t.prototype.SetSeriesClickEvent=function(){var t=this;t.chartOptions.optionsObject.seriesClick=function(i){var r=Date.parse(i.category),u={seriesClickFilter:n.ReportsUtils.GetDateFilter(new Date(r))};t.scope.$broadcast(n.ReportEventNames.SeriesClickBroadcastEvent,u),t.scope.kendochart.options.categoryAxis.notes=n.ChartOptions.GetVerticalSeriesClicklineOptions(r,i.category),t.scope.kendochart.refresh()}},t.prototype.SetDefaultBarChartData=function(t,i){var u,r;if(i===void 0&&(i=[]),i.length==0)for(u=this.report.GetSelectedView()?this.report.GetSelectedView().Legend:[],r=0;r<u.length;r++){var f={},e=u[r].Field,o=t[e];f[this.chartOptions.defaultFieldName]=u[r].Name,f[e]=o?o:0,i.push(f)}this.chartOptions.optionsObject.dataSource=i,n.ChartOptions.SetChartValueAxisType(this.chartOptions.optionsObject,this.chartOptions.optionsObject.dataSource,2)},t.prototype.DecorateGrid=function(){},t.prototype.updateChartViewOptions=function(n,t){return this.chartOptions.optionsObject.series=this.chartOptions.GenerateChartSeries(this.report.GetSelectedView().Legend),this.chartOptions.SetStepCountForChart(t),this.SetReportDisplayChartData(n,t),this.chartOptions},t.prototype.promoteFilteredChartData=function(t,i){n.Processor.PromoteStateMetricSummaryDataFromReport(t,i,this.report)},t.prototype.processGridData=function(t,i){return n.Processor.ProcessPreAggregateDetails(t,this.report,this.report.columns,i)},t.prototype.promoteGridData=function(t,i){n.Processor.PromoteDetailsData(t,this.report,this.report.columns,i)},t.prototype.getGridOptions=function(t,i,r){var u=new n.GridOptions(this.report,t,i,r);return this.DecorateGrid(u),u},t.prototype.preprocessGridConfig=function(){},t}();n.BaseReportDisplayOptions=t})(Admin||(Admin={}));var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Admin;(function(n){'use strict';;var t=function(t){function i(n,i,r){t.call(this,n,i,r),this.barChartViewIndex=1}return __extends(i,t),i.prototype.processChartData=function(i,r){r===void 0&&(r=null);switch(this.report.selectedViewIndex){case 0:return t.prototype.processChartData.call(this,i,r);case this.barChartViewIndex:case 2:if(i&&i.length>0)return n.Processor.ProcessVanillaResult(i[0][this.report.GetSelectedViewDataProperty()],this.report.id,412657);default:return[]}},i.prototype.SetReportDisplayChartOptions=function(n,i){switch(this.report.selectedViewIndex){case 0:t.prototype.SetReportDisplayChartOptions.call(this,n,i);break;case this.barChartViewIndex:this.chartOptions.SetDefaultBarChartOptions();break;case 2:this.chartOptions.SetDefaultBarChartOptions()}},i.prototype.SetReportDisplayChartData=function(i,r){var f,u;switch(this.report.selectedViewIndex){case 0:t.prototype.SetReportDisplayChartData.call(this,i,r);break;case this.barChartViewIndex:f=n.Processor.PromoteNameValuePairsFromSummaryData(i[n.Processor.GetAggregateCollectionNameFromDaysFilter(r)],this.report),t.prototype.SetDefaultBarChartData.call(this,f),this.chartOptions.SetStepCountForChart(1);break;case 2:u=this.PromoteClientVersionsFromSummaryData(i[n.Processor.GetAggregateCollectionNameFromDaysFilter(r)],this.report),this.chartOptions.optionsObject.series=this.chartOptions.GenerateChartSeries(u.legend),t.prototype.SetDefaultBarChartData.call(this,null,u.data),this.chartOptions.SetStepCountForChart(1)}},i.prototype.SetSeriesClickEvent=function(){this.report.selectedViewIndex==0&&t.prototype.SetSeriesClickEvent.call(this)},i.prototype.PromoteClientVersionsFromSummaryData=function(t,r){var o={data:[],legend:[]},f=r.GetSelectedView(),h,l,a,s,u,c,e,v;if(!t||t.length==0||!f||!f.YAxis)return n.ReportsUtils.LogError("PromoteNameValuePairsFromSummaryData: Invalid data or report view parameter (DataField or view list) detected",r.id),{};var p=f.XAxis.DataField,w=f.YAxis.DataField,y=f.YAxis.DataValueField,b=n.ReportsLocStrings.GetInstance().RcvUnknownVersion;for(h=0;h<t.length;h++)if(l=t[h],a=$.grep(f.Legend,function(n){return n.Field===l[p]}),a&&a.length>0)for(s=l[w],e=0;e<s.length;e++)u=s[e].Version,u&&u.length!=0||(u=b),c={},v=i.MapVersionNumberToOutlookFriendlyName(u),c[this.chartOptions.defaultFieldName]=v,c["Version"+u]=s[e][y]?s[e][y]:0,o.data.push(c),o.legend.push({Name:v,Field:"Version"+u});return n.Processor.SortArrayByField(o.data,this.chartOptions.defaultFieldName),n.Processor.SortArrayByField(o.legend,"Name"),o},i.NormalizeAggregates=function(t,r){var e={},y=n.ReportsLocStrings.GetInstance().RcvUnknownVersion,h=t[r],s,o,c,l,a,v;if(!h){t[r]=e;return}for(s=0;s<h.length;s++)if(o=h[s].ClientId,e[o]=h[s].TotalActivity,e[o+"VersionsUsed"]=[],e[o+"VersionActivity"]={},c=h[s].TotalActivityPerVersion,c)for(l=0;l<c.length;l++)a=c[l],v=a.Version===''?y:i.MapVersionNumberToOutlookFriendlyName(n.Processor.NormalizeDataValue("string",a.Version),o),e[o+"VersionActivity"][v]=n.Processor.NormalizeDataValue("number",a.TotalActivity),e[o+"VersionsUsed"].push(v);t[r]=e},i.prototype.processGridData=function(t,r){return n.Processor.ProcessPreAggregateDetailsWithNormalization(t,this.report,this.report.columns,r,i.NormalizeAggregates)},i.prototype.getGridOptions=function(n,i,r){var f=this,u=t.prototype.getGridOptions.call(this,n,i,r);return u.kendoGridOptions.detailInit=this.initializeDetailGridEvent,u.kendoGridOptions.columnHide=function(n){f.handleColumnHide(n.sender.element,n.column.field)},u.kendoGridOptions.columnShow=function(n){f.handleColumnShow(n.sender.element,n.column.field)},u.kendoGridOptions.columnResize=function(n){f.handleColumnResize(n)},u.kendoGridOptions.columnReorder=function(n){f.handleColumnReorder(n)},u},i.prototype.initializeDetailGridEvent=function(t){var e=JSON.parse(JSON.stringify(t.sender.columns)),f={},o=t.data[n.Processor.GetAggregateCollectionNameFromDaysFilter(t.sender.$angular_scope.detailData.daysBackFilter)],s="UserName",r,u;for(f[s]=n.ReportsLocStrings.GetInstance().RcvVersionsUsed,r=0;r<t.sender.columns.length;r++)e[r].template=null,u=t.sender.columns[r],o[u.field]&&(f[u.field]=o[u.field+"VersionsUsed"].join(", "));$("<div/>").appendTo(t.detailCell).kendoGrid({dataSource:[f],scrollable:!1,sortable:!1,pageable:!1,columns:e}),i.ResizeDetailGrid(t.sender.element)},i.prototype.handleColumnResize=function(n){var f=this.getDetailGridsFromElement(n.sender.element),r,t,u,i;if(f)for(r=0;r<f.length;r++)if(t=$(f[r]).data("kendoGrid"),t){for(u=0,i=0;i<t.columns.length;i++)if(!t.columns[i].hidden){if(t.columns[i].field===n.column.field){var o=kendo.format('colgroup col:nth-child({0})',u+1),s=kendo.format('colgroup col:nth-child({0})',u+2),e=$(n.sender.table).find(s).width();e&&$(t.table).find(o).width(e);break}u++}t.resize(),t.refresh(),t.dataSource.read()}},i.prototype.handleColumnHide=function(n,t){var u=this.getDetailGridsFromElement(n),r,f;if(u)for(r=0;r<u.length;r++)(f=$(u[r]).data("kendoGrid"),f)&&f.hideColumn(t);i.ResizeDetailGrid(n)},i.prototype.handleColumnShow=function(n,t){var u=this.getDetailGridsFromElement(n),r,f;if(u)for(r=0;r<u.length;r++)(f=$(u[r]).data("kendoGrid"),f)&&f.showColumn(t);i.ResizeDetailGrid(n)},i.prototype.getDetailGridsFromElement=function(n){var t=n.find('.k-detail-cell .k-grid');return t&&t.length>0?t:undefined},i.ResizeDetailGrid=function(n){n.find('.k-detail-cell tbody tr td').each(function(t){var i,r,u,f;u=kendo.format('.k-master-row td:nth-child({0})',t+2),f=kendo.format('.k-detail-cell tbody tr td:nth-child({0})',t+1),i=n.find(u).first(),r=n.find(f),r.width(i.width())})},i.MapVersionNumberToOutlookFriendlyName=function(t,i){if(i===void 0&&(i="Outlook"),i==="Outlook"){var r=n.ReportsLocStrings.GetInstance();switch(t){case"12":return r.RcvOutlook2007;case"14":return r.RcvOutlook2010;case"15":return r.RcvOutlook2013;case"16":return r.RcvOutlook2016;default:return t}}return t},i.prototype.handleColumnReorder=function(n){var r=this.getDetailGridsFromElement(n.sender.element),t,i;if(r)for(t=0;t<r.length;t++)(i=$(r[t]).data("kendoGrid"),i)&&i.reorderColumn(n.newIndex,i.columns[n.oldIndex])},i}(n.BaseReportDisplayOptions);n.EmailClientsDisplayOptions=t})(Admin||(Admin={}));var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Admin;(function(n){'use strict';;var t=function(t){function i(n,i,r){t.call(this,n,i,r)}return __extends(i,t),i.prototype.processChartData=function(t,i){return i===void 0&&(i=null),n.Processor.ProcessStateMetricSummaryData(t,this.report,i)},i}(n.BaseReportDisplayOptions);n.SiteUsageDisplayOptions=t})(Admin||(Admin={}));var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Admin;(function(n){'use strict';;var t=function(t){function i(n,i,r){t.call(this,n,i,r)}return __extends(i,t),i.prototype.processChartData=function(t,i){i===void 0&&(i=null),n.Processor.ProcessVanillaResult(t,this.report.id,412657),n.Processor.NormalizeDataTypesWithEncoding(t,this.report.columns);var r=n.Processor.GetRequiredRawDataFields(this.report);return r&&n.Processor.SortArrayByField(t,r.dateField),t},i.prototype.SetReportDisplayChartOptions=function(){this.chartOptions.optionsObject.chartArea={height:this.chartOptions.defaultChartAreaHeight};var i=this.chartOptions.optionsObject.categoryAxis[0];i.field="ServicePlanName",i.labels.template="#: (value) ? decodeURI(value) : '' #",i.type="category",i.crosshair={visible:!1},this.chartOptions.optionsObject.seriesDefaults.type='column',this.chartOptions.optionsObject.seriesDefaults.stack=this.report.selectedViewIndex==0?!0:!1,this.chartOptions.optionsObject.tooltip.shared=!1,this.chartOptions.SetStepCountForChart(1)},i.prototype.SetReportDisplayChartData=function(n){this.chartOptions.optionsObject.dataSource=n},i.prototype.SetSeriesClickEvent=function(){},i.prototype.updateChartViewOptions=function(){return this.chartOptions},i.prototype.promoteFilteredChartData=function(){},i.prototype.processGridData=function(t){return n.Processor.ProcessVanillaResultCheckUserNames(t,this.report,this.report.columns,412661)},i.prototype.promoteGridData=function(){},i}(n.BaseReportDisplayOptions);n.O365ProPlusDisplayOptions=t})(Admin||(Admin={}));var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Admin;(function(n){'use strict';;var i=function(i){function r(n,t,r){i.call(this,n,t,r),this.mailboxQuotaViewIndex=2,this.storageViewIndex=1}return __extends(r,i),r.prototype.processChartData=function(t,i){return i===void 0&&(i=null),n.Processor.ProcessStateMetricSummaryData(t,this.report,i)},r.prototype.SetReportDisplayChartOptions=function(n,t){switch(this.report.selectedViewIndex){case 0:i.prototype.SetReportDisplayChartOptions.call(this,n,t);break;case 1:i.prototype.SetReportDisplayChartOptions.call(this,n,t),this.chartOptions.SetStorageViewOptions(this.chartOptions.optionsObject.valueAxis[0],this.isRightToLeft);break;case this.mailboxQuotaViewIndex:this.chartOptions.SetDefaultBarChartOptions()}},r.prototype.SetReportDisplayChartData=function(t,r){this.report.selectedViewIndex==this.mailboxQuotaViewIndex?(this.SetMailboxQuotaColumnViewData(t),n.ChartOptions.SetChartValueAxisType(this.chartOptions.optionsObject,this.chartOptions.optionsObject.dataSource,1)):i.prototype.SetReportDisplayChartData.call(this,t,r)},r.prototype.SetSeriesClickEvent=function(){this.report.selectedViewIndex==this.mailboxQuotaViewIndex},r.prototype.updateChartViewOptions=function(n,t){return this.report.selectedViewIndex==this.mailboxQuotaViewIndex?(this.SetMailboxQuotaColumnViewData(n),this.chartOptions):i.prototype.updateChartViewOptions.call(this,n,t)},r.prototype.SetValueAxisLabelTemplate=function(n,t){this.report.selectedViewIndex==this.storageViewIndex?this.SetChartOptionsTemplate(n,"#= Admin.ReportsUtils.FormatBytes(value,"+t+") #"):i.prototype.SetValueAxisLabelTemplate.call(this,n,t)},r.prototype.getGridOptions=function(n,i,r){return new t(this.report,n,i,r,this.isRightToLeft)},r.prototype.SetMailboxQuotaColumnViewData=function(n){var r=n.length-1,t=n[r];if(t&&t.length!=0)i.prototype.SetDefaultBarChartData.call(this,t);else return},r}(n.BaseReportDisplayOptions),t;n.ExchangeMailboxStorageDisplayOptions=i,t=function(t){function i(n,i,r,u,f){t.call(this,n,i,r,u),this.isRightToLeft=f}return __extends(i,t),i.prototype.SetColumnFormatTemplate=function(n,i){var r=this;n.DataField==="MailboxQuotaCategory"?i.template=function(n){return r.GetItemSizeColumnTemplateString(n,n[i.field])}:t.prototype.SetColumnFormatTemplate.call(this,n,i)},i.prototype.GetItemSizeColumnTemplateString=function(t){var r=n.ReportsLocStrings.GetInstance(),u='',f='',e='';switch(t.MailboxQuotaCategory){case 3:f='rd-square-20px-1',u=r.RttBelowWarningQuota,e=r.RltBelowWarning;break;case 2:f='rd-square-20px-2',u=r.RttAboveWarningQuota,e=r.RltAboveWarning;break;case 1:f='rd-square-20px-3',u=r.RttAboveSendQuota,e=r.RltAboveSend;break;case 0:f='rd-square-20px-4',u=r.RttAboveSendReceiveQuota,e=r.RltAboveSendReceive}return this.isRightToLeft?'<span title="'+u+'"><div style="float:right;margin-left:5px" class="'+f+'">&nbsp;</div><span>'+e+'</span></span>':'<span title="'+u+'"><div style="float:left;margin-right:5px" class="'+f+'">&nbsp;</div><span>'+e+'</span></span>'},i}(n.GridOptions),n.MailboxStorageGridOptions=t})(Admin||(Admin={}));var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Admin;(function(n){'use strict';;var t=function(t){function i(n,i,r){t.call(this,n,i,r),this.barChartViewIndex=1}return __extends(i,t),i.prototype.processChartData=function(t,i){return i===void 0&&(i=null),t&&t.length>0?this.report.selectedViewIndex==0?n.Processor.ProcessRawData(t[0].UsersPerDay,this.report):n.Processor.ProcessVanillaResult(t[0].UserAggregate,this.report.id,412657):[]},i.prototype.SetReportDisplayChartOptions=function(n,i){switch(this.report.selectedViewIndex){case 0:t.prototype.SetReportDisplayChartOptions.call(this,n,i);break;case this.barChartViewIndex:this.chartOptions.SetDefaultBarChartOptions()}},i.prototype.SetReportDisplayChartData=function(n,i){this.report.selectedViewIndex==this.barChartViewIndex?(this.SetSkypeClientUsedBarDataSource(n,i),this.chartOptions.SetStepCountForChart(1)):t.prototype.SetReportDisplayChartData.call(this,n,i)},i.prototype.SetSeriesClickEvent=function(){this.report.selectedViewIndex!=this.barChartViewIndex&&t.prototype.SetSeriesClickEvent.call(this)},i.prototype.DecorateGrid=function(n){n.kendoGridColumns.forEach(function(n){switch(n.field){case"UserName":n.attributes={style:"white-space:nowrap"};break;case"LastActivityDate":n.width="165px",n.headerAttributes={style:"width:165px"}}})},i.prototype.ConvertToBooleanForCheckMark=function(n){n&&(n.WindowsPC=n.WindowsPC>0,n.WindowsMobile=n.WindowsMobile>0,n.IPhone=n.IPhone>0,n.IPad=n.IPad>0,n.Android=n.Android>0)},i.prototype.SetSkypeClientUsedBarDataSource=function(i,r){var u=i[n.Processor.GetAggregateCollectionNameFromDaysFilter(r)];u&&t.prototype.SetDefaultBarChartData.call(this,u)},i}(n.BaseReportDisplayOptions);n.SkypeClientsDisplayOptions=t})(Admin||(Admin={}));var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Admin;(function(n){'use strict';;var t=function(t){function i(n,i,r){t.call(this,n,i,r),this.barChartViewIndex=1}return __extends(i,t),i.prototype.processChartData=function(t,i){if(i===void 0&&(i=null),t&&t.length>0){if(this.report.selectedViewIndex==0)return n.Processor.ProcessRawData(t[0].UsersPerDay,this.report);var r=412657;return n.Processor.ProcessVanillaResult(t[0].UserAggregate,this.report.id,r)}return[]},i.prototype.SetReportDisplayChartOptions=function(n,i){switch(this.report.selectedViewIndex){case 0:t.prototype.SetReportDisplayChartOptions.call(this,n,i);break;case this.barChartViewIndex:this.chartOptions.SetDefaultBarChartOptions()}},i.prototype.SetReportDisplayChartData=function(n,i){this.report.selectedViewIndex==this.barChartViewIndex?(this.SetYammerClientUsedBarDataSource(n,i),this.chartOptions.SetStepCountForChart(1)):t.prototype.SetReportDisplayChartData.call(this,n,i)},i.prototype.SetSeriesClickEvent=function(){this.report.selectedViewIndex!=this.barChartViewIndex&&t.prototype.SetSeriesClickEvent.call(this)},i.prototype.DecorateGrid=function(n){n.kendoGridColumns.forEach(function(n){switch(n.field){case"UserName":n.attributes={style:"white-space:nowrap"};break;case"LastActivityDate":n.width="165px",n.headerAttributes={style:"width:165px"}}})},i.prototype.SetYammerClientUsedBarDataSource=function(i,r){var u=i[n.Processor.GetAggregateCollectionNameFromDaysFilter(r)];u&&t.prototype.SetDefaultBarChartData.call(this,u)},i}(n.BaseReportDisplayOptions);n.YammerClientsDisplayOptions=t})(Admin||(Admin={}));var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Admin;(function(n){'use strict';;var t=function(t){function i(n,i,r){t.call(this,n,i,r),this.barChartViewIndex=1}return __extends(i,t),i.prototype.processChartData=function(t,i){return i===void 0&&(i=null),t&&t.length>0?this.report.selectedViewIndex==this.barChartViewIndex?n.Processor.ProcessVanillaResult(t[0].UserAggregate,this.report.id,412657):n.Processor.ProcessRawData(t[0].DailyActiveUsers,this.report):[]},i.prototype.preprocessGridConfig=function(n){n.clickThruBuiltinODataFilter="MinTimeFrame le "+n.daysBackFilter},i.prototype.SetReportDisplayChartData=function(n,i){this.report.selectedViewIndex==this.barChartViewIndex?this.SetBarChartDataSource(n,i):t.prototype.SetReportDisplayChartData.call(this,n,i)},i.prototype.SetReportDisplayChartOptions=function(i,r){if(this.report.selectedViewIndex==this.barChartViewIndex){this.chartOptions.optionsObject.seriesDefaults.type='column',this.chartOptions.optionsObject.seriesDefaults.stack=!0,this.chartOptions.optionsObject.chartArea={height:this.chartOptions.defaultChartAreaHeight};var u=this.chartOptions.optionsObject.categoryAxis[0];u.type="category",u.field="ApplicationName",n.ChartOptions.SetChartValueAxisType(this.chartOptions.optionsObject,this.chartOptions.optionsObject.dataSource,2),this.chartOptions.SetStepCountForChart(1)}else t.prototype.SetReportDisplayChartOptions.call(this,i,r)},i.prototype.SetSeriesClickEvent=function(){var t=this;t.chartOptions.optionsObject.seriesClick=function(i){if(t.report.selectedViewIndex!=t.barChartViewIndex){var r=Date.parse(i.category),u="("+n.ReportsUtils.GetDateFilter(new Date(r))+")",f="("+i.series.field+"/ActivityTimeFrame eq 1)",e={seriesClickFilter:u+"and"+f};t.scope.$broadcast(n.ReportEventNames.SeriesClickBroadcastEvent,e),t.scope.kendochart.options.categoryAxis.notes=n.ChartOptions.GetVerticalSeriesClicklineOptions(r,i.category),t.scope.kendochart.refresh()}}},i.prototype.DecorateGrid=function(n){var t=this;n.kendoGridOptions.columnMenuInit=function(n){t.ManipulateMenuItem("LicenseFor","License For",n),t.ManipulateMenuItem("LastActivityDate","Last Activity Date",n),t.ManipulateMenuItem("LicenseAssignedDate","License Assigned Date",n)}},i.prototype.ManipulateMenuItem=function(n,t,i){var s=i.container.find(".k-menu").data("kendoMenu"),o=n+"Container_"+i.field,h="<div id='"+o+"'>"+t+"</div>",u,r,f,e;for(s.append({text:h,encoded:!1},$("li.k-first")),u=[],f=i.container.find("li[role=menuitem]"),r=f.length-1;r>=0;r--)e=$(f[r]).find("input[data-field!='']"),e&&e.attr('data-field')&&e.attr('data-field').indexOf(n)>=0&&u.push($(f[r]).detach());for(r=u.length-1;r>=0;r--)$("#"+o).append(u[r])},i.prototype.SetBarChartDataSource=function(n,t){var i=n["M"+t.toString()];i&&(this.chartOptions.optionsObject.dataSource=i,this.chartOptions.SetStepCountForChart(1))},i}(n.BaseReportDisplayOptions);n.LicenseActivityDisplayOptions=t})(Admin||(Admin={}));var Admin;(function(){'use strict';})(Admin||(Admin={}));var Admin;(function(){'use strict';})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(){}return t.GetReportDisplayOptions=function(t,i,r){r===void 0&&(r=null),!t||!t.id;var u=r.currentCultureInfo;switch(t.id){case n.ReportIds.YammerActivityReportId:case n.ReportIds.EmailActivityReportId:case n.ReportIds.SkypeActivityReportId:case n.ReportIds.SkypeP2PActivityReportId:case n.ReportIds.SkypeOrganizerActivityReportId:case n.ReportIds.SkypeParticipantActivityReportId:case n.ReportIds.SharePointActivityReportId:case n.ReportIds.OneDriveActivityReportId:case n.ReportIds.O365GroupsReportId:return new n.BaseReportDisplayOptions(t,i,u);case n.ReportIds.ProPlusReportId:return new n.O365ProPlusDisplayOptions(t,i,u);case n.ReportIds.OneDriveSiteUsageReportId:case n.ReportIds.SharePointSiteUsageReportId:return new n.SiteUsageDisplayOptions(t,i,u);case n.ReportIds.EmailStorageReportId:return new n.ExchangeMailboxStorageDisplayOptions(t,i,u);case n.ReportIds.SkypeClientsUsedReportId:return new n.SkypeClientsDisplayOptions(t,i,u);case n.ReportIds.EmailClientsUsedReportId:return new n.EmailClientsDisplayOptions(t,i,u);case n.ReportIds.LicenseActivityReportId:return new n.LicenseActivityDisplayOptions(t,i,u);case n.ReportIds.YammerClientsUsedReportId:return new n.YammerClientsDisplayOptions(t,i,u);default:return null}},t}();n.ReportDisplayFactory=t})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(i,r,u,f,e,o,s,h,c){function w(){u.GetAddGroupDefaults().then(function(n){u.SetAddGroupDefaultOptions(n),angular.forEach(n.data.GroupTypes,function(n){i.groupTypeList.push(n)}),angular.forEach(n.data.ViewGroupTypeOptions,function(n){i.viewGroupTypeList.push(n)})},function(){})}function k(){var u,n;i.groupTypeList=[],i.viewGroupTypeList=[],i.GroupsData=[],i.disableRefreshAction=!1,i.GroupListConfig=t.GetGroupListConfig(),i.GroupListConfig.ItemsCountOnInit=0,document.getElementById("ShellBodyAndFooterContainer").style.overflow="auto",w(),i.GetGroupsList(),u=document.getElementById('ShellBodyAndFooterContainer'),angular.element(u).bind('scroll',a),n=o.GetDeepLinkAttributes(h.action),n==undefined||n==null||c(function(){i.OpenFlyoutOrPanel(n)},500),r.$on('$stateChangeStart',function(n,t,i,r){if(r.name==='groups'){var f=document.getElementById('ShellBodyAndFooterContainer');angular.element(f).unbind('scroll',a)}}),$(document).mouseup(function(n){var t=$(".userlistActions"),i=$(".userlistActions li"),r=$(".userlistActions li a"),u=$(".userlistActions li a i"),f=$("#actionButton"),e=$("#actionButton span"),o=$("#actionButton span i");return f.is(n.target)||e.is(n.target)||o.is(n.target)?!1:t.is(n.target)||i.is(n.target)||r.is(n.target)||u.is(n.target)?void 0:($(".userlistActions").hide(),n.stopPropagation(),!1)})}var y,l;this.$scope=i,this.$rootScope=r,this.GroupService=u,this.ProfileService=f,this.PhotoService=e,this.HelperService=o,this.UserManagementService=s,this.$stateParams=h,this.$timeout=c,i.searchTerm={Value:""},i.GetGroupImageColor=function(n){return f.GetProfileImageColor(n)},i.GetGroupInitials=function(n){return f.GetGroupInitials(n)},i.CloseActionLinks=function(){$(".userlistActions").hide();return},i.CloseActionLinks=function(){$(".userlistActions").hide();return},i.ToggleHighlight=function(n){$(".gridRow").css("background-color","transparent"),$("#user_list_"+n).css("background-color","#DDEBF7"),i.SelectedAllGroups(!1)},i.$on('highlightselectedrow',function(n,t){angular.isDefined(t)&&i.ToggleHighlight(t)}),i.getRowCss=function(n){if(n&&n.isChecked)return{'background-color':'#DDEBF7'}},i.ToggleActionLinks=function(){if($(".userlistActions:visible").length>0){$(".userlistActions").hide(),$('#actionButton').attr('aria-expanded','false');return}$('.userlistActions').show(),$('#actionButton').attr('aria-expanded','true')},i.initCallbackPanel=function(n){i.panel=n},y='Bulk actions',l=function(n){var t={};return t=n.length==1?{panelTemplateUrl:"../AdminPortal/Groups/GroupSummary",panelType:"bulkactiongroup",selecteditem:n[0],unselectonclose:!1,unhighlightonclose:!1}:{panelTemplateUrl:"../AdminPortal/Groups/bulkgroupactions",panelType:"multigroup",panelHeaderTitle:y,selecteditem:n,unselectonclose:!0,unhighlightonclose:!0}},i.UpdatedSelectedGroups=function(n){var r,t;i.$root.focusOnPanel=!1,i.CloseActionLinks(),n.isChecked?(i.SelectedGroups.push(n),t=l(i.SelectedGroups),i.panel.invoke(t)):(r=i.SelectedGroups.indexOf(n),r!==-1&&i.SelectedGroups.splice(r,1),i.SelectedGroups.length===1&&(t=l(i.SelectedGroups),i.panel.invoke(t)),i.SelectedGroups.length===0&&i.$broadcast('closePanel'),i.selectedHeader.isChecked=!1),i.$broadcast('ToggleGroupAction',i.SelectedGroups)},i.ShouldDisable=function(){return o.IsDataValid(i.GroupsData)},i.SelectedAllGroups=function(t){if(t){i.GroupsData.forEach(function(n){i.SelectedGroups.indexOf(n.GroupId)==-1&&i.SelectedGroups.push(n)}),$(".dataListField").prop('checked',!0),angular.forEach(i.GroupsData,function(n){n.isChecked=!0});var r=l(i.SelectedGroups);i.panel.invoke(r),$(".gridRow").css("background-color",n.gridRowCheckedBgColor)}else i.selectedHeader.isChecked=t,i.SelectedGroups=[],$(".dataListField").prop('checked',!1),angular.forEach(i.GroupsData,function(n){n.isChecked=!1})},i.$on('resetSelection',function(){i.SelectedAllGroups(!1)}),i.ToggleSortOption=function(n){i.GroupListConfig.sortField=n,i.GroupListConfig.sortDirection=i.GroupListConfig.sortDirection===1?0:1,i.GetGroupsList()},i.GetGroupsList=function(){i.disableRefreshAction||i.Search(i.searchTerm.Value)},i.RefreshGroupsList=function(){i.GroupListConfig.ItemsCountOnInit>i.GroupListConfig.ShowContextualHelpItemCount&&(i.GroupListConfig.ItemsCountOnInit=undefined),i.Search(i.searchTerm.Value)},i.SearchList=function(n){i.GroupListConfig.ItemsCountOnInit>i.GroupListConfig.ShowContextualHelpItemCount&&(i.GroupListConfig.ItemsCountOnInit=undefined),i.Search(n)},i.Search=function(t){i.disableRefreshAction=!0,i.GroupsData=[],i.SelectedGroups=[],i.selectedHeader.isChecked=!1,$(".dataListField").prop('checked',!1),i.GroupListConfig.EndOfList=!1,i.GroupListConfig.showContextualHelp=!1;var r=i.GroupListConfig.groupTypeFilter=="AllGroups"?null:[n.GroupType[i.GroupListConfig.groupTypeFilter]];u.GetGroups(i.GroupListConfig.sortDirection,i.GroupListConfig.sortField,t,r,null).then(p,v),i.GroupListConfig.EmptyListViewTitle=i.IsValid(t)||i.IsValid(r)?'No results found':'Nothing here yet.',i.GroupListConfig.EmptyListBodyLabel=''},i.IsValid=function(n){return n===null||n===""||n===" "||n===undefined?!1:!0},i.GetGroupPhotos=function(n){i.$root.features&&i.$root.features.EnableUserPhotoInList&&n&&n.forEach(function(n){e.GetPhoto(n.GroupSmtp,1).then(function(t){t&&n.GroupSmtp==t.Identity&&i.IsValid(t.PhotoContent)&&(n.PhotoContent=t.PhotoContent)})})};var p=function(n){var t;i.disableRefreshAction=!1,t=n.data,i.GroupsData=t.Groups,i.GroupListConfig.IsDirSyncEnabled=t.IsDirSyncEnabled,i.GroupListConfig.ExchangeUrl=t.ExchangeUrl,i.GroupListConfig.NoResults=i.GroupsData==null||i.GroupsData.length===0,angular.isDefined(i.GroupListConfig.ItemsCountOnInit)&&(i.GroupListConfig.ItemsCountOnInit=i.GroupsData.length),i.GroupListConfig.pageToken=t.PageToken?t.PageToken:null,i.GroupListConfig.EndOfList=t.PageToken===null||t.PageToken===undefined,document.getElementById("ShellBodyAndFooterContainer").style.overflow="hidden",i.$emit("autoscrolltotop"),i.GetGroupPhotos(i.GroupsData),t=o.ShowLoadButtonsforListItems(),i.GroupListConfig.showLoad=t.showLoad,i.GroupListConfig.showSpinner=t.showSpinner,i.GroupListConfig.showContextualHelp=!0},b=function(n){var t=n.data;i.GroupsData=i.GroupsData.concat(t.Groups),i.GroupListConfig.pageToken=t.PageToken?t.PageToken:null,i.GroupListConfig.EndOfList=t.PageToken===null||t.PageToken===undefined,i.GroupListConfig.IsPreviousRequestPending=!1,i.GetGroupPhotos(t.Groups)},d=function(){i.GroupListConfig.EndOfList=!0,i.GroupListConfig.serverListError=!0},g=function(){i.GroupListConfig.detailsLoaded=!0,i.GroupListConfig.serverListError=!0,i.disableRefreshAction=!1},v=function(){document.getElementById("ShellBodyAndFooterContainer").style.overflow="auto",i.GroupListConfig.serverListError=!0,i.GroupListConfig.showContextualHelp=!0},a=function(){var t,f,e,r;i.disableRefreshAction||(t=$("#gridRowsContainer .gridRow:last").offset().top,!i.GroupListConfig.IsPreviousRequestPending&&t<$(window).height()&&(i.GroupListConfig.EndOfList||(i.GroupListConfig.IsPreviousRequestPending=!0,r=i.GroupListConfig.groupTypeFilter=="AllGroups"?null:[n.GroupType[i.GroupListConfig.groupTypeFilter]],u.GetGroups(i.GroupListConfig.sortDirection,i.GroupListConfig.sortField,i.searchTerm.Value,r,i.GroupListConfig.pageToken).then(b,v))))};i.GetNextGroups=function(){i.GroupListConfig.showSpinner=!0,i.GroupListConfig.showLoad=!1,a()},i.selectedHeader={isChecked:!1},i.OpenFlyoutOrPanel=function(n){n!=undefined&&(o.IsValid(n.flyoutTemplateUrl)?i.flyout.invoke(n):o.IsValid(n.panelTemplateUrl)&&i.panel.invoke(n))},i.RemoveGroupFromList=function(n){var t=i.getIndex(n,i.GroupsData);t!=-1&&i.GroupsData.splice(t,1),o.IsDataValid(i.GroupsData)&&(i.GroupListConfig.NoResults=!0,i.GroupListConfig.EmptyListViewTitle='No results found')},i.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.GroupId==t[i].GroupId)return i;return-1},i.$on('RefreshList',function(n,t){if(t&&t.Action)switch(t.Action){case'delete':i.SelectedGroups.splice(0,1),i.RemoveGroupFromList(t.SelectedItem);break;case'reload':i.GetGroupsList()}}),i.initCallbackFlyout=function(n){i.flyout=n},i.SetGroupType=function(n){i.GroupListConfig.groupTypeFilter=n;var t={flyoutTemplateUrl:"../AdminPortal/Groups/Add",flyoutType:"group",flyoutHeaderTitle:'Add a group',flyoutTitle:'Add a group',waitingIndicatorMessage:'Adding Group',selecteditem:{}};i.flyout.invoke(t)},i.ShowCard=function(n){var t=!1;return angular.forEach(i.groupTypeList,function(i){i.Value==n&&(t=!0)}),t},i.ShowContextualHelpCard=function(){return i.GroupListConfig.showContextualHelp&&i.GroupListConfig.ItemsCountOnInit<=i.GroupListConfig.ShowContextualHelpItemCount},k()}return t.GetGroupListConfig=function(){return{IsPreviousRequestPending:!1,EndOfList:!1,NoResults:!1,serverError:!1,sortDirection:0,sortField:"GroupName",groupTypeFilter:"AllGroups",pageToken:null,serverListError:!1,showSpinner:!0,showContextualHelp:!1,ItemsCountOnInit:undefined,EmptyListViewTitle:'It\x27s lonely here.',EmptyListBodyLabel:'Which group should I use\x3f',ShowContextualHelpItemCount:3}},t.$inject=["$rootScope","$scope","GroupService","ProfileService","PhotoService","HelperService","UserManagementService","$stateParams","$timeout"],t}();n.GroupsController=t,n.app.controller("GroupsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(t,i,r,u,f,e,o){function a(){t.selectedItem=t.$parent.$parent.selectedItem,t.isDetailsGetCallComplete=!1,t.isMemberGetCallComplete=!1,t.isOwnerGetCallComplete=!1,t.waitingGroupMembers=!1,t.waitingGroupOwners=!1,t.selectedItem.GroupModel={},t.selectedItem.GroupModel.GroupManagementStatus={},t.getDetailsErrorMessage="",t.getMembersErrorMessage="",t.getOwnersErrorMessage="",t.MembersListDisplayLimit=7,t.selectedItem&&(v(),c(),l()),t.isRefresh=!1}function v(){if(t.GroupSummaryConfig=n.prototype.GroupSummaryConfig(),t.isDetailsGetCallComplete=!1,t.selectedItem){switch(t.selectedItem.GroupType){case 0:t.GroupSummaryConfig.IsO365Group=!0;break;case 1:t.GroupSummaryConfig.IsSecurityGroup=!0;break;case 2:t.GroupSummaryConfig.IsDistributionGroup=!0;break;case 3:t.GroupSummaryConfig.IsMailEnabledSecurityGroup=!0}t.isRefresh?(r.GetGroupDetails(t.selectedItem.GroupId).then(function(n){t.selectedItem.GroupModel.GroupDisplayName=n.data.GroupDisplayName,t.selectedItem.GroupModel.GroupName=n.data.GroupName,t.selectedItem.GroupModel.GroupDescription=n.data.GroupDescription,t.selectedItem.GroupModel.ProxyAddresses=n.data.ProxyAddresses,t.selectedItem.GroupModel.DirSyncEnabled=n.data.DirSyncEnabled,t.selectedItem.GroupModel.IsDynamicGroup=n.data.IsDynamicGroup,t.selectedItem.GroupModel.GroupId=n.data.GroupId,t.selectedItem.GroupModel.PrimaryOwners=n.data.PrimaryOwner,t.selectedItem.GroupModel.Members=n.data.Members,t.selectedItem.GroupModel.EditExchangeSettingsUrl=n.data.EditExchangeSettingsUrl,t.selectedItem.GroupModel.IsWellKnownObject=n.data.IsWellKnownObject}),i.$broadcast('UpdatePersonCard',t.selectedItem)):(t.selectedItem.GroupModel.GroupDisplayName=t.selectedItem.GroupDisplayName,t.selectedItem.GroupModel.GroupName=t.selectedItem.GroupName,t.selectedItem.GroupModel.ProxyAddresses=t.selectedItem.ProxyAddresses,t.selectedItem.GroupModel.DirSyncEnabled=t.selectedItem.DirSyncEnabled,t.selectedItem.GroupModel.IsDynamicGroup=t.selectedItem.IsDynamicGroup,t.selectedItem.GroupModel.GroupId=t.selectedItem.GroupId,t.selectedItem.GroupModel.PrimaryOwners=t.selectedItem.PrimaryOwners,t.selectedItem.GroupModel.Members=t.selectedItem.Members,t.selectedItem.GroupModel.EditExchangeSettingsUrl=t.selectedItem.EditExchangeSettingsUrl,t.selectedItem.GroupModel.IsWellKnownObject=t.selectedItem.IsWellKnownObject),r.GetGroupInformation(t.selectedItem.GroupId,t.selectedItem.GroupSmtp,t.selectedItem.GroupType).then(function(n){t.selectedItem.GroupModel=n.data,o.IsValid(t.selectedItem.GroupModel.GroupName)||(t.selectedItem.GroupModel.GroupName=t.selectedItem.GroupName),o.IsValid(t.selectedItem.GroupModel.ProxyAddresses)||(t.selectedItem.GroupModel.ProxyAddresses=t.selectedItem.ProxyAddresses),o.IsValid(t.selectedItem.GroupModel.EditExchangeSettingsUrl)||(t.selectedItem.GroupModel.EditExchangeSettingsUrl=t.selectedItem.EditExchangeSettingsUrl),t.selectedItem.GroupModel.DirSyncEnabled=t.selectedItem.DirSyncEnabled,t.selectedItem.GroupModel.IsDynamicGroup=t.selectedItem.IsDynamicGroup,t.selectedItem.GroupModel.IsWellKnownObject=t.selectedItem.IsWellKnownObject,t.selectedItem.GroupModel.DirSyncEnabled?(t.GroupSummaryConfig.CanManageGroup=!1,t.GroupSummaryConfig.GroupManagementMessage='You can only manage this group in your on-premises environment. Use \x27Active directory users \x26 groups\x27 or \x27Exchange Admin Center\x27 tools to edit or delete this group.',t.GroupSummaryConfig.CanManageMembers=!1,t.GroupSummaryConfig.CanManageOwners=!1):(t.GroupSummaryConfig.CanManageGroup=t.selectedItem.GroupModel.GroupManagementStatus.CanBeManaged,t.GroupSummaryConfig.GroupManagementMessage=t.selectedItem.GroupModel.GroupManagementStatus.LocalizedMessage,t.GroupSummaryConfig.CanManageMembers=!t.selectedItem.GroupModel.IsDynamicGroup&&t.GroupSummaryConfig.CanManageGroup,t.GroupSummaryConfig.CanManageOwners=t.GroupSummaryConfig.CanManageGroup),t.selectedItem.GroupModel.GroupManagementStatus.CanManageMembers=t.GroupSummaryConfig.CanManageMembers,t.selectedItem.GroupModel.GroupManagementStatus.CanManageOwners=t.GroupSummaryConfig.CanManageOwners,t.isDetailsGetCallComplete=!0},function(n){t.isDetailsGetCallComplete=!0,t.getDetailsErrorMessage=n.data})}}var c,l,s,h;this.$scope=t,this.$rootScope=i,this.GroupService=r,this.PanelService=u,this.PhotoService=f,this.$timeout=e,this.HelperService=o,c=function(){t.isMemberGetCallComplete=!1,t.isOwnerGetCallComplete=!1,t.waitingGroupMembers=!0,t.waitingGroupOwners=!0,t.selectedItem.Members=[],r.GetGroupMembers(t.selectedItem.GroupType,t.selectedItem.GroupId,t.selectedItem.GroupSmtp,null,null).then(function(n){n.data&&n.data.Members&&(t.selectedItem.Members=n.data.Members,t.selectedItem.GroupModel.Members=t.selectedItem.Members),t.waitingGroupMembers=!1,t.isMemberGetCallComplete=!0},function(){t.waitingGroupMembers=!1,t.loadingMembersFailed=!0,t.isMemberGetCallComplete=!0,t.getMembersErrorMessage='You don\x27t have permission to see members.'}),t.GroupSummaryConfig.IsSecurityGroup||(t.selectedItem.PrimaryOwners=[],r.GetGroupOwners(t.selectedItem.GroupType,t.selectedItem.GroupId,t.selectedItem.GroupSmtp,null,null).then(function(n){n.data&&n.data.Owners&&(t.selectedItem.PrimaryOwners=n.data.Owners,t.selectedItem.GroupModel.PrimaryOwners=t.selectedItem.PrimaryOwners),t.waitingGroupOwners=!1,t.isOwnerGetCallComplete=!0},function(){t.waitingGroupOwners=!1,t.loadingOwnersFailed=!0,t.isOwnerGetCallComplete=!0,t.getOwnersErrorMessage='You don\x27t have permission to see owners.'}))},l=function(){t.selectedItem&&!o.IsValid(t.selectedItem.PhotoContent)&&t.$root.features&&t.$root.features.ShowPersonPhoto&&f.GetPhoto(t.selectedItem.GroupSmtp,1).then(function(n){f.BroadcastPhotoEvent("UpdatePersonPhoto",n)})},t.getPrivacyLocalized=function(n){return n=="Public"?'Public - Anyone can see group content':n=="Private"?'Private - Only members can see group content':void 0},a(),t.$on('panelclosed',function(){s&&(s(),s=null),h&&(h(),h=null)}),s=t.$on(u.GetBroadCastEventName(),function(n,r){t.selectedItem=angular.copy(r),i.$broadcast('UpdatePersonCard',t.selectedItem),t.$applyAsync(function(){t.selectedItem.GroupModel=angular.copy(r),l(),angular.isDefined(t.selectedItem.doNotMakeAGetCall)&&(!angular.isDefined(t.selectedItem.doNotMakeAGetCall)||t.selectedItem.doNotMakeAGetCall)||(v(),c())})}),h=t.$on('UpdateGroupPanelDetails',function(n,i){i&&(t.isRefresh=!0,r.Invalidate(t.selectedItem.GroupId,t.selectedItem.GroupSmtp,t.selectedItem.GroupType),a())})}return n.prototype.GroupSummaryConfig=function(){return{IsDistributionGroup:!1,IsMailEnabledSecurityGroup:!1,IsSecurityGroup:!1,IsO365Group:!1,CanManageGroup:!0,CanManageOwners:!0,CanManageMembers:!0,GroupManagementMessage:""}},n.$inject=['$scope','$rootScope','GroupService','PanelService','PhotoService','$timeout','HelperService'],n}();n.GroupSummaryController=t,n.app.controller("GroupSummaryController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;(function(n){n[n.Disabled=1]="Disabled",n[n.InvitedOnly=2]="InvitedOnly",n[n.AllowAnonymous=16]="AllowAnonymous",n[n.ExistingUsersOnly=32]="ExistingUsersOnly"})(n.CollaborationType||(n.CollaborationType={}));var i=n.CollaborationType,t=function(){function n(t,i,r,u,f){function c(){r.GetSitesListDefaults().then(function(n){t.createSiteUrl=n.data}),t.ListViewConfig=n.GetListViewConfig(),t.GetSitesList(t.ListViewConfig.pageToken,t.searchTerm.Value);var u=document.getElementById('ShellBodyAndFooterContainer');angular.element(u).bind('scroll',e),i.$on('$stateChangeStart',function(n,t,i,r){if(r.name==='SitesList'){var f=document.getElementById('ShellBodyAndFooterContainer');angular.element(f).unbind('scroll',e)}}),$(document).mouseup(function(n){var t=$(".userlistActions"),i=$(".userlistActions li"),r=$(".userlistActions li a"),u=$(".userlistActions li a i"),f=$("#actionButton"),e=$("#actionButton span"),o=$("#actionButton span i");return f.is(n.target)||e.is(n.target)||o.is(n.target)?!1:t.is(n.target)||i.is(n.target)||r.is(n.target)||u.is(n.target)?void 0:($(".userlistActions").hide(),n.stopPropagation(),!1)})}this.$scope=t,this.$rootScope=i,this.SitesService=r,this.ProfileService=u,this.HelperService=f,t.OpenCreateSitePage=function(n){window.open(n)},t.searchTerm={Value:""},t.GetProfileImageColor=function(n){return u.GetProfileImageColor(n)},t.GetProfileInitials=function(n){return u.GetSitesInitials(n)},t.GetSiteDisplayName=function(n){return angular.isUndefined(n.Name)||n.Name===null||n.Name===""?n.Url:n.Name},t.CloseActionLinks=function(){$(".userlistActions").hide();return},t.ToggleHighlight=function(n){$(".gridRow").css("background-color","transparent"),$("#list_item_"+n).css("background-color","#DDEBF7")},t.ToggleActionLinks=function(){if($(".userlistActions:visible").length>0){$(".userlistActions").hide(),$('#actionButton').attr('aria-expanded','false');return}$('.userlistActions').show(),$('#actionButton').attr('aria-expanded','true')},t.ToggleSortOption=function(n){t.ListViewConfig.sortField=n,t.ListViewConfig.sortDirection=t.ListViewConfig.sortDirection===1?0:1,t.GetSitesList()},t.GetSitesList=function(){t.Search(t.searchTerm.Value)},t.Search=function(n){t.SitesList=[],t.ListViewConfig.pageToken=0,t.ListViewConfig.EndOfList=!1,r.GetSitesList(t.ListViewConfig.pageToken,n).then(s,o)};var s=function(n){var i=n.data;t.SitesList=i.Sites,angular.forEach(t.SitesList,function(n){n.InitialsColor=t.GetProfileImageColor(n.Name),n.Initials=t.GetProfileInitials(n.Name),n.DisplayName=t.GetSiteDisplayName(n),n.AllowEditing=i.TenantCollaborationType!=1,n.AllowAnonymousOption=i.TenantCollaborationType==16,n.TenantCollaborationType=i.TenantCollaborationType}),t.ListViewConfig.NoResults=t.SitesList==null||t.SitesList.length===0,t.ListViewConfig.EndOfList=i.PageToken===null||i.PageToken===undefined||i.PageToken==t.ListViewConfig.pageToken||i.PageToken<50,t.ListViewConfig.pageToken=t.ListViewConfig.EndOfList?0:i.PageToken,t.$emit("autoscrolltotop"),i=f.ShowLoadButtonsforListItems(),t.ListViewConfig.showLoad=i.showLoad,t.ListViewConfig.showSpinner=i.showSpinner},h=function(n){var i=n.data;t.SitesList=t.SitesList.concat(i.Sites),t.ListViewConfig.EndOfList=i.PageToken===null||i.PageToken===undefined||i.PageToken==t.ListViewConfig.pageToken,t.ListViewConfig.pageToken=t.ListViewConfig.EndOfList?0:i.PageToken,t.ListViewConfig.IsPreviousRequestPending=!1},o=function(n){t.ListViewConfig.serverListError=!0,t.ListViewConfig.serverMessage=n.data},e=function(){var n=$("#gridRowsContainer .gridRow:last").offset().top,i,u;!t.ListViewConfig.IsPreviousRequestPending&&n<$(window).height()&&(t.ListViewConfig.EndOfList||(t.ListViewConfig.IsPreviousRequestPending=!0,r.GetSitesList(t.ListViewConfig.pageToken,t.searchTerm.Value).then(h,o)))};t.GetNextSites=function(){t.ListViewConfig.showSpinner=!0,t.ListViewConfig.showLoad=!1,e()},t.$on('RefreshList',function(){t.GetSitesList()}),c()}return n.GetListViewConfig=function(){return{IsPreviousRequestPending:!1,EndOfList:!1,NoResults:!1,serverError:!1,sortDirection:0,sortField:"Identity",pageToken:0,showSpinner:!0,showLoad:!1}},n.$inject=["$rootScope","$scope","SitesService","ProfileService","HelperService"],n}();n.SitesController=t,n.app.controller("SitesController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){function e(){if(n.selectedItem=n.$parent.$parent.selectedItem,n.waitingExtraDataToLoad=!0,n.SharingSettingDescription="",n.AllowSharing=!0,n.selectedItem){switch(n.selectedItem.CollaborationType){case 1:n.SharingSettingDescription='This site can\x27t be shared with external users',n.AllowSharing=!1;break;case 32:n.SharingSettingDescription='This site can only be shared with existing external users who sign in';break;case 2:n.SharingSettingDescription='This site can be shared with new and existing external users who sign in';break;case 16:n.SharingSettingDescription='This site can be shared with anyone, including via anonymous access links'}f()}n.sitesSettingItem={TemplateName:"../AdminPortal/Settings/sitessharing",Title:'Sites',Icon:"ms-Icon ms-Icon--sharepoint ss-sites-icon"}}var f,u;this.$scope=n,this.$rootScope=t,this.SitesService=i,this.PanelService=r,f=function(){n.selectedItem.AdditionalDataRetrieved||i.GetSiteExternalUsers(n.selectedItem.Url,"").then(function(t){n.selectedItem.ExternalMembers=t.data.ExternalUsers,n.selectedItem.PageToken=t.data.PageToken,n.selectedItem.AllItemsLoaded=t.data.AllItemsLoaded,n.selectedItem.AdditionalDataRetrieved=!0}),n.waitingExtraDataToLoad=!1},e(),n.ClosePanel=function(){n.$emit('closePanel')},n.$on('panelclosed',function(){u&&(u(),u=null)}),u=n.$on(r.GetBroadCastEventName(),function(i,r){n.selectedItem=r,n.selectedItem.DisplayName=n.selectedItem.DisplayName,n.selectedItem.UserPrincipalName=n.selectedItem.Url,n.selectedItem.InitialsColor=n.selectedItem.InitialsColor,n.selectedItem.Initials=n.selectedItem.Initials,t.$broadcast('UpdatePersonCard',n.selectedItem),n.$apply(function(){f()})}),n.$on('UpdateSitePanelDetails',function(n,t){t&&e()})}return n.$inject=['$scope','$rootScope','SitesService','PanelService'],n}();n.app.controller("SiteSummaryController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){function i(){n.originalData={},n.saveInProgress=!1,n.ExternalMembers=[],angular.forEach(n.selecteditem.ExternalMembers,function(t){n.ExternalMembers.push(t)}),n.Picker={Type:1,action:1,MemberType:0,clientId:"SearchExternalUsers",inputLabel:'Search external members to remove',allItemsListTitle:'External members',placeholderText:'Search',SearchCategories:[{SearchCategory:4,Filter:{MaxResults:-1,Identity:n.selecteditem.Url}}]}}this.$scope=n,this.SitesService=t,n.SaveSiteExternalUsers=function(){n.saveInProgress=!0,n.saveActionStarted=!0;var i={Url:n.selecteditem.Url,ExternalUsersToRemove:n.Picker.GetSelectedItems()};t.SetSiteExternalUsers(i).then(function(t){n.selecteditem.ExternalMembers=t.data.ExternalUsers,n.selecteditem.PageToken=t.data.PageToken,n.selecteditem.AllItemsLoaded=t.data.AllItemsLoaded,n.saveActionStarted=!1,n.showCloseButton=!0,n.statusMessageSuccess='The external members have been removed from the site.'},function(){n.saveActionStarted=!1,n.showCloseButton=!0,n.statusMessageError='An error occurred while trying to remove external members from the site.'})},n.Cancel=function(){n.$emit('closeFlyout')},i()}return n.$inject=["$scope","SitesService"],n}();n.EditSiteExternalMembersController=t,n.app.controller("EditSiteExternalMembersController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){function i(){n.originalData={},n.formData.TenantCollaborationType=n.selecteditem.TenantCollaborationType,n.originalData.EnableSharing=n.selecteditem.EnableSharing,n.originalData.CollaborationType=n.selecteditem.CollaborationType,n.formData.EnableSharing=n.selecteditem.EnableSharing,n.formData.CollaborationType=n.selecteditem.CollaborationType,n.formData.Url=n.selecteditem.Url,n.CollabTypes={},n.CollabTypes.NotAllowed=1,n.CollabTypes.ExistingOnly=32,n.CollabTypes.Invited=2,n.CollabTypes.Anonymous=16,n.sitesSettingItem={TemplateName:"../AdminPortal/Settings/sitessharing",Title:'Sites',Icon:"ms-Icon ms-Icon--sharepoint ss-sites-icon"},n.saveInProgress=!1}this.$scope=n,this.SitesService=t,n.SaveSiteSharingSettings=function(){n.saveInProgress=!0,n.saveActionStarted=!0,n.formData.EnableSharing||(n.formData.CollaborationType=1),t.SetSiteSharingSettings(n.formData).then(function(t){n.selecteditem.CollaborationType=t.data.CollaborationType,n.selecteditem.EnableSharing=t.data.EnableSharing,n.selecteditem.SharingSetting=t.data.SharingSetting,n.$root.SitesList&&angular.forEach(n.$root.SitesList,function(i,r){i.Url===n.formData.Url&&(n.$root.SitesList[r].SharingSetting=t.data.SharingSetting,n.$root.SitesList[r].CollaborationType=t.data.CollaborationType,n.$root.SitesList[r].EnableSharing=t.data.EnableSharing)}),n.saveActionStarted=!1,n.showCloseButton=!0,n.statusMessageSuccess='The external sharing settings for sites are updated.'},function(t){n.saveActionStarted=!1,n.showCloseButton=!0,n.statusMessageError=t.data.ExceptionMessage})},n.Cancel=function(){n.$emit('closeFlyout')},n.CloseToSettings=function(){n.$emit('closePanel')},i()}return n.$inject=["$scope","SitesService"],n}();n.EditSiteSharingController=t,n.app.controller("EditSiteSharingController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(i,r,u,f,e,o,s,h){function w(){var u,n;i.SharedMailboxListConfig=t.GetSharedMailboxListConfig(),i.SharedMailboxListConfig.ItemsCountOnInit=0,document.getElementById("ShellBodyAndFooterContainer").style.overflow="hidden",i.GetSharedMailboxesList(),u=document.getElementById('ShellBodyAndFooterContainer'),angular.element(u).bind('scroll',l),n=o.GetDeepLinkAttributes(s.action),n==undefined||n==null||h(function(){i.OpenFlyoutOrPanel(n)},500),r.$on('$stateChangeStart',function(n,t,i,r){if(r.name==='SharedMailbox'){var f=document.getElementById('ShellBodyAndFooterContainer');angular.element(f).unbind('scroll',l)}}),$(document).mouseup(function(n){var t=$(".userlistActions"),i=$(".userlistActions li"),r=$(".userlistActions li a"),u=$(".userlistActions li a i"),f=$("#actionButton"),e=$("#actionButton span"),o=$("#actionButton span i");return f.is(n.target)||e.is(n.target)||o.is(n.target)?!1:t.is(n.target)||i.is(n.target)||r.is(n.target)||u.is(n.target)?void 0:($(".userlistActions").hide(),n.stopPropagation(),!1)})}var v,c;this.$scope=i,this.$rootScope=r,this.SharedMailboxService=u,this.ProfileService=f,this.PhotoService=e,this.HelperService=o,this.$stateParams=s,this.$timeout=h,i.searchTerm={Value:""},i.GetSharedMailboxImageColor=function(n){return f.GetProfileImageColor(n)},i.GetSharedMailboxInitials=function(n){return f.GetSharedMailboxInitials(n)},i.CloseActionLinks=function(){$(".userlistActions").hide();return},i.CloseActionLinks=function(){$(".userlistActions").hide();return},i.ToggleHighlight=function(n){$(".gridRow").css("background-color","transparent"),$("#user_list_"+n).css("background-color","#DDEBF7"),i.SelectedAllSharedMailboxes(!1)},i.getRowCss=function(n){if(n&&n.isChecked)return{'background-color':'#DDEBF7'}},i.ToggleActionLinks=function(){if($(".userlistActions:visible").length>0){$(".userlistActions").hide(),$('#actionButton').attr('aria-expanded','false');return}$('.userlistActions').show(),$('#actionButton').attr('aria-expanded','true')},i.initCallbackPanel=function(n){i.panel=n},v='Bulk actions',c=function(n){var t={};return t=n.length==1?{panelTemplateUrl:"../AdminPortal/SharedMailbox/SharedMailboxSummary",panelType:"bulkactionsharedmailbox",selecteditem:n[0],unselectonclose:!1,unhighlightonclose:!1}:{panelTemplateUrl:"/AdminPortal/SharedResource/BulkSharedMailboxActions",panelType:"multisharedmailbox",panelHeaderTitle:v,selecteditem:n,unselectonclose:!0,unhighlightonclose:!0}},i.UpdatedSelectedSharedMailboxes=function(n){var r,t;i.$root.focusOnPanel=!1,i.CloseActionLinks(),n.isChecked?(i.SelectedSharedMailboxes.push(n),t=c(i.SelectedSharedMailboxes),i.panel.invoke(t)):(r=i.SelectedSharedMailboxes.indexOf(n),r!==-1&&i.SelectedSharedMailboxes.splice(r,1),i.SelectedSharedMailboxes.length===1&&(t=c(i.SelectedSharedMailboxes),i.panel.invoke(t)),i.SelectedSharedMailboxes.length===0&&i.$broadcast('closePanel'),i.selectedHeader.isChecked=!1),i.$broadcast('ToggleSharedMailboxAction',i.SelectedSharedMailboxes)},i.ShouldDisable=function(){return o.IsValid(i.SharedMailboxesData)&&i.SharedMailboxesData.length===0},i.SelectedAllSharedMailboxes=function(t){if(t){i.selectedHeader.isChecked=t,i.SharedMailboxesData.forEach(function(n){i.SelectedSharedMailboxes.indexOf(n.SharedMailboxId)==-1&&i.SelectedSharedMailboxes.push(n)}),$(".dataListField").prop('checked',!0),angular.forEach(i.SharedMailboxesData,function(n){n.isChecked=!0});var r=c(i.SelectedSharedMailboxes);i.panel.invoke(r),$(".gridRow").css("background-color",n.gridRowCheckedBgColor)}else i.SelectedSharedMailboxes=[],i.selectedHeader.isChecked=t,$(".dataListField").prop('checked',!1),angular.forEach(i.SharedMailboxesData,function(n){n.isChecked=!1})},i.$on('resetSelection',function(){i.SelectedAllSharedMailboxes(!1)}),i.ToggleSortOption=function(n){i.SharedMailboxListConfig.sortField=n,i.SharedMailboxListConfig.sortDirection=i.SharedMailboxListConfig.sortDirection===1?0:1,i.GetSharedMailboxesList()},i.GetSharedMailboxesList=function(){i.Search(i.searchTerm.Value)},i.SearchList=function(n){i.SharedMailboxListConfig.ItemsCountOnInit>i.SharedMailboxListConfig.ShowContextualHelpItemCount&&(i.SharedMailboxListConfig.ItemsCountOnInit=undefined),i.SharedMailboxListConfig.EmptyListViewTitle=i.IsValid(n)?'No results found':'Nothing here yet.',i.SharedMailboxListConfig.EmptyListBodyLabel='',i.Search(n)},i.Search=function(){i.SharedMailboxesData=[],i.SelectedSharedMailboxes=[],$(".dataListField").prop('checked',!1),i.selectedHeader.isChecked=!1,i.SharedMailboxListConfig.EndOfList=!1,i.SharedMailboxListConfig.showContextualHelp=!1,i.IsValid(i.nextLink)&&(i.nextLink=null),u.GetSharedMailboxes(i.SharedMailboxListConfig.sortDirection,i.SharedMailboxListConfig.sortField,i.searchTerm.Value,i.NextLink).then(y,a)},i.IsValid=function(n){return n===null||n===""||n===" "||n===undefined?!1:!0},i.GetSharedMailboxPhotos=function(){i.$root.features&&i.$root.features.EnableUserPhotoInList&&i.ResourceMailboxesData&&i.ResourceMailboxesData.forEach(function(n){e.GetPhoto(n.SharedMailboxSmtp,3).then(function(t){t&&n.SharedMailboxSmtp==t.Identity&&i.IsValid(t.PhotoContent)&&(n.PhotoContent=t.PhotoContent)})})};var y=function(n){var t=n.data;i.SharedMailboxesData=t.SharedMailboxes,i.SharedMailboxListConfig.NoResults=i.SharedMailboxesData==null||i.SharedMailboxesData.length===0,i.SharedMailboxListConfig.searchTerm=i.searchTerm.Value,angular.isDefined(i.SharedMailboxListConfig.ItemsCountOnInit)&&(i.SharedMailboxListConfig.ItemsCountOnInit=i.SharedMailboxesData.length),t.IsLastPage&&(i.SharedMailboxListConfig.EndOfList=!0),i.nextLink=t.NextLink?t.NextLink:null,document.getElementById("ShellBodyAndFooterContainer").style.overflow="auto",i.$emit("autoscrolltotop"),i.GetSharedMailboxPhotos(i.SharedMailboxesData),t=o.ShowLoadButtonsforListItems(),i.SharedMailboxListConfig.showLoad=t.showLoad,i.SharedMailboxListConfig.showSpinner=t.showSpinner,i.SharedMailboxListConfig.showContextualHelp=!0},p=function(n){var t=n.data;i.SharedMailboxesData=i.SharedMailboxesData.concat(t.SharedMailboxes),i.nextLink=t.NextLink?t.NextLink:null,i.SharedMailboxListConfig.EndOfList=t.IsLastPage,i.SharedMailboxListConfig.IsPreviousRequestPending=!1,i.GetSharedMailboxPhotos(i.SharedMailboxesData)},b=function(){i.SharedMailboxListConfig.EndOfList=!0,i.SharedMailboxListConfig.serverListError=!0},k=function(){i.SharedMailboxListConfig.detailsLoaded=!0,i.SharedMailboxListConfig.serverListError=!0},a=function(){document.getElementById("ShellBodyAndFooterContainer").style.overflow="auto",i.SharedMailboxListConfig.serverListError=!0,i.SharedMailboxListConfig.showContextualHelp=!0},l=function(){var n=$("#gridRowsContainer .gridRow:last").offset().top;!i.SharedMailboxListConfig.IsPreviousRequestPending&&n<$(window).height()&&i.SharedMailboxListConfig.searchTerm==i.searchTerm.Value&&(i.SharedMailboxListConfig.searchTerm==i.searchTerm.Value,!i.SharedMailboxListConfig.EndOfList&&i.IsValid(i.nextLink)&&(i.SharedMailboxListConfig.IsPreviousRequestPending=!0,u.GetSharedMailboxes(i.SharedMailboxListConfig.sortDirection,i.SharedMailboxListConfig.sortField,i.searchTerm.Value,i.nextLink).then(p,a)))};i.GetGetSharedMailboxes=function(){i.SharedMailboxListConfig.showSpinner=!0,i.SharedMailboxListConfig.showLoad=!1,l()},i.selectedHeader={isChecked:!1},i.OpenFlyoutOrPanel=function(n){n!=undefined&&(o.IsValid(n.flyoutTemplateUrl)?i.flyout.invoke(n):o.IsValid(n.panelTemplateUrl)&&i.panel.invoke(n))},i.RemoveSharedMailboxFromList=function(n){var t=i.getIndex(n,i.SharedMailboxesData);t!=-1&&i.SharedMailboxesData.splice(t,1)},i.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.SharedMailboxId==t[i].SharedMailboxId)return i;return-1},i.RefreshList=function(){i.GetSharedMailboxesList()},i.$on('RefreshList',function(n,t){if(t&&t.Action)switch(t.Action){case'delete':i.SelectedSharedMailboxes.splice(0,1),i.RemoveSharedMailboxFromList(t.SelectedItem)}}),i.initCallbackFlyout=function(n){i.flyout=n},i.OpenAddSharedMailboxFlyout=function(){var n={flyoutTemplateUrl:"../AdminPortal/SharedMailbox/Add",flyoutType:"sharedmailbox",flyoutTitle:'Add a mailbox',waitingIndicatorMessage:'Adding resource mailbox',selecteditem:{}};i.flyout.invoke(n)},i.ShowContextualHelpCard=function(){return i.SharedMailboxListConfig.showContextualHelp&&i.SharedMailboxListConfig.ItemsCountOnInit<=i.SharedMailboxListConfig.ShowContextualHelpItemCount},w()}return t.GetSharedMailboxListConfig=function(){return{IsPreviousRequestPending:!1,EndOfList:!1,NoResults:!1,serverError:!1,sortDirection:0,sortField:"SharedMailboxDisplayName",searchTerm:null,showSpinner:!0,showLoad:!1,showContextualHelp:!1,ItemsCountOnInit:undefined,EmptyListViewTitle:'Nothing here yet',EmptyListBodyLabel:'Let\u2019s get you started',ShowContextualHelpItemCount:3}},t.$inject=["$rootScope","$scope","SharedMailboxService","ProfileService","PhotoService","HelperService","$stateParams","$timeout"],t}();n.SharedMailboxController=t,n.app.controller("SharedMailboxController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f){function o(){n.selectedItem=n.$parent.$parent.selectedItem,n.waitingMemberDataToLoad=!0,n.waitingConnectivityDataToLoad=!0,n.waitingAutoReplyConfigDataToLoad=!0,n.selectedItem&&(s(),h(),c(),l())}var e;this.$scope=n,this.$rootScope=t,this.SharedMailboxService=i,this.PanelService=r,this.PhotoService=u,this.HelperService=f;var s=function(){n.selectedItem.SharedMailboxMembershipRetrieved?n.waitingMemberDataToLoad=!1:(n.waitingMemberDataToLoad=!0,i.GetPermissions(n.selectedItem.SharedMailboxId,null,n.isRefresh).then(function(t){t.data&&(n.selectedItem.SharedMailboxMembers=t.data.SharedMailboxMembers,n.selectedItem.MailboxFullAccessMembers=t.data.MailboxFullAccessMembers,n.selectedItem.MailboxSendAsMembers=t.data.MailboxSendAsMembers,n.selectedItem.MailboxSendOnBehalfMembers=t.data.MailboxSendOnBehalfMembers),n.updateSharedMailboxListForAdvancedPermission(),n.waitingMemberDataToLoad=!1}))},h=function(){n.selectedItem.SharedMailboxConnectivityRetrieved?n.waitingConnectivityDataToLoad=!1:(n.waitingConnectivityDataToLoad=!0,i.GetSharedMailboxConnectivity(n.selectedItem.SharedMailboxId,n.isRefresh).then(function(t){t.data&&(n.selectedItem.SharedMailboxConnectivity=t.data),n.updateSharedMailboxListForConnectivity(),n.waitingConnectivityDataToLoad=!1}))},c=function(){n.selectedItem.SharedMailboxAutoReplyConfigurationRetrieved?n.waitingAutoReplyConfigDataToLoad=!1:(n.waitingAutoReplyConfigDataToLoad=!0,i.GetSharedMailboxAutoReplyConfiguration(n.selectedItem.SharedMailboxId,n.isRefresh).then(function(t){t.data&&(n.selectedItem.SharedMailboxAutoReplyConfiguration=t.data),n.updateSharedMailboxListForAutoReplyConfig(),n.waitingAutoReplyConfigDataToLoad=!1}))},l=function(){n.selectedItem&&!f.IsValid(n.selectedItem.PhotoContent)&&n.$root.features&&n.$root.features.ShowPersonPhoto&&u.GetPhoto(n.selectedItem.SharedMailboxSmtp,3).then(function(n){u.BroadcastPhotoEvent("UpdatePersonPhoto",n)})};n.updateSharedMailboxListForAdvancedPermission=function(){var i=n.getIndex(n.selectedItem,n.$root.SharedMailboxesData),t;i!=-1&&(t=n.$root.SharedMailboxesData[i],t.MailboxFullAccessMembers=n.selectedItem.MailboxFullAccessMembers,t.MailboxSendAsMembers=n.selectedItem.MailboxSendAsMembers,t.MailboxSendOnBehalfMembers=n.selectedItem.MailboxSendOnBehalfMembers,t.SharedMailboxMembers=n.selectedItem.SharedMailboxMembers,t.SharedMailboxMembershipRetrieved=!0)},n.updateSharedMailboxListForConnectivity=function(){var i=n.getIndex(n.selectedItem,n.$root.SharedMailboxesData),t;i!=-1&&(t=n.$root.SharedMailboxesData[i],t.SharedMailboxConnectivity=n.selectedItem.SharedMailboxConnectivity,t.SharedMailboxConnectivityRetrieved=!0)},n.updateSharedMailboxListForAutoReplyConfig=function(){var i=n.getIndex(n.selectedItem,n.$root.SharedMailboxesData),t;i!=-1&&(t=n.$root.SharedMailboxesData[i],t.SharedMailboxAutoReplyConfiguration=n.selectedItem.SharedMailboxAutoReplyConfiguration,t.SharedMailboxAutoReplyConfigurationRetrieved=!0)},n.getIndex=function(n,t){if(t)for(var i=0,r=t.length;i<r;i++)if(n.SharedMailboxId==t[i].SharedMailboxId)return i;return-1},o(),n.$on('panelclosed',function(){e&&(e(),e=null)}),e=n.$on(r.GetBroadCastEventName(),function(i,r){n.selectedItem=r,t.$broadcast('UpdatePersonCard',n.selectedItem),n.$apply(function(){s(),h(),c(),l()})}),n.$on('UpdateMailboxPanelDetails',function(t,i){i&&(n.isRefresh=!0,o())})}return n.$inject=['$scope','$rootScope','SharedMailboxService','PanelService','PhotoService',"HelperService"],n}();n.app.controller("SharedMailboxSummaryController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){function e(){n.showSharedMailboxform=!0,n.saveinprogress=!1,n.savefinished=!1,n.saveSharedMailboxError=!1,n.intervalTimeout=3e3,n.intervalCount=60,n.updateSharedMailboxListDone=!1,n.domainList=[],r.GetAddSharedMailboxDefaults().then(function(t){n.selectedDomain=t.data.DefaultDomain,angular.forEach(t.data.Domains,function(t){n.domainList.push(t.Name)})},function(){}),n.UpdateSelectedDomain=function(t){n.selectedDomain=t},n.SaveSharedMailbox=function(i){if(i.$valid){n.saveSharedMailboxError=!1,n.showSharedMailboxform=!1,n.saveinprogress=!0,n.savefinished=!1,n.saveSharedMailboxError=!1,n.formData.SharedMailboxDomain=n.selectedDomain,n.formData.SharedMailboxSmtp=n.formData.SharedMailboxAlias+"@"+n.selectedDomain;var u={SharedMailboxId:n.formData.SharedMailboxId,SharedMailboxDisplayName:n.formData.SharedMailboxDisplayName,SharedMailboxAlias:n.formData.SharedMailboxAlias,SharedMailboxDomain:n.formData.SharedMailboxDomain,SharedMailboxSmtp:n.formData.SharedMailboxSmtp};n.formData=u,r.SaveSharedMailbox(n.formData).then(function(i){i.data.Status==0?(n.saveinprogress=!1,n.savefinished=!0,n.formData.SharedMailboxId=i.data.MailboxId,n.formData.SharedMailboxSmtp=n.formData.SharedMailboxAlias+"@"+n.formData.SharedMailboxDomain,n.formData.SharedMailboxEmailAddresses=[],n.formData.SharedMailboxEmailAddresses.push("SMTP:"+n.formData.SharedMailboxSmtp),n.updateSharedMailboxList()):i.status==503?n.timeoutpromise=t(n.IsSharedMailboxCreated,n.intervalTimeout,n.intervalCount):(n.showSharedMailboxform=!0,n.saveinprogress=!1,n.saveSharedMailboxError=!0,n.saveSharedMailboxErrorMessage=i.data.Message)},function(i){i.status==503?n.timeoutpromise=t(n.IsSharedMailboxCreated,n.intervalTimeout,n.intervalCount):(n.showSharedMailboxform=!0,n.saveinprogress=!1,n.saveSharedMailboxError=!0,n.saveSharedMailboxErrorMessage=i.data.Message)})}else n.saveSharedMailboxError=!0,n.saveSharedMailboxErrorMessage='Please provide all required fields.'}}this.$scope=n,this.$interval=t,this.$timeout=i,this.SharedMailboxService=r,this.HelperService=u,n.contentLoaded=!1,n.$on('$includeContentLoaded',function(){n.contentLoaded=!0});var f=function(n){return n===null||n===""||n===" "||n===undefined?!1:!0};$(document).mousedown(function(t){$(t.target).attr("id")=="btnAddSharedMailboxClose"&&n.$emit('closeFlyout')}),n.updateSharedMailboxList=function(){var t={SharedMailboxId:n.formData.SharedMailboxId,SharedMailboxDisplayName:n.formData.SharedMailboxDisplayName,SharedMailboxAlias:n.formData.SharedMailboxAlias,SharedMailboxDomain:n.formData.SharedMailboxDomain,SharedMailboxSmtp:n.formData.SharedMailboxSmtp,SharedMailboxEmailAddresses:n.formData.SharedMailboxEmailAddresses};n.formData=t,n.$root.SharedMailboxesData.unshift(n.formData),n.$root.SharedMailboxListConfig.NoResults=!1,n.updateSharedMailboxListDone=!0},n.lockAlias=!1,n.UpdateSharedMailboxAlias=function(){n.lockAlias?console.log("Should not update: shared mailbox alias is locked"):n.formData.SharedMailboxDisplayName&&(n.formData.SharedMailboxAlias=n.formData.SharedMailboxDisplayName.replace(/ /g,'').toLowerCase())},n.LockAlias=function(){console.log('Lock alias'),n.lockAlias=!0},n.RemoveValidation=function(){n.saveResourceMailboxError=u.GetvalidaitonValue(n.formData.SharedMailboxAlias)},n.Cancel=function(){n.$emit('closeFlyout')},n.IsSharedMailboxCreated=function(){n.intervalCount--,n.intervalCount<=0?(n.showSharedMailboxform=!0,n.saveinprogress=!1,n.saveSharedMailboxError=!0,n.saveSharedMailboxErrorMessage="Timeout"):r.CheckSharedMailboxWasCreated(n.formData.SharedMailboxAlias+"@"+n.formData.SharedMailboxDomain).then(function(i){f(i.data)&&(t.cancel(n.timeoutpromise),n.saveinprogress=!1,n.savefinished=!0,n.formData.SharedMailboxId=i.data,n.formData.SharedMailboxSmtp=n.formData.SharedMailboxAlias+"@"+n.formData.SharedMailboxDomain,n.formData.SharedMailboxEmailAddresses=[],n.formData.SharedMailboxEmailAddresses.push("SMTP:"+n.formData.SharedMailboxSmtp),n.updateSharedMailboxListDone||n.updateSharedMailboxList())})},n.$on("$destroy",function(){t.cancel(n.timeoutpromise)}),e()}return n.$inject=["$scope","$interval","$timeout","SharedMailboxService","HelperService"],n}();n.app.controller("AddSharedMailboxController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function r(){}this.$scope=n,this.$rootScope=t,this.SharedMailboxService=i,n.showSharedMailboxform=!0,n.saveInProgress=!1,n.saveFinished=!1,n.deleteSharedMailboxError=!1,n.DeleteSharedMailboxes=function(){n.showSharedMailboxform=!1,n.saveInProgress=!0,n.saveFinished=!1,n.$emit('showWaitingIndicator',!0),i.DeleteSharedMailbox(n.selecteditem).then(function(t){t.data[n.selecteditem.SharedMailboxId].Status==0?(n.$emit('showWaitingIndicator',!1),n.saveInProgress=!1,n.saveFinished=!0,n.$root.refreshList=!0,n.$emit('closePanel')):(n.$emit('showWaitingIndicator',!1),n.showSharedMailboxform=!0,n.saveInProgress=!1,n.deleteSharedMailboxError=!0,n.deleteSharedMailboxStatusMessage=t.data[n.selecteditem.SharedMailboxId].Message)},function(t){n.$emit('showWaitingIndicator',!1),n.showSharedMailboxform=!0,n.saveInProgress=!1,n.deleteSharedMailboxError=!0,n.deleteSharedMailboxStatusMessage=t.data.Message})},n.Cancel=function(){n.$emit('closeFlyout')},n.Close=function(){n.formData.refreshListArgs={Action:"delete",SelectedItem:n.selecteditem},n.$emit('closeFlyout')},r()}return n.$inject=["$scope","$rootScope","SharedMailboxService"],n}();n.app.controller("DeleteSharedMailboxController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f){function e(){function t(n,t){var i=!1;return n.some(function(n){t.toLowerCase()===String(n).toLowerCase()&&(i=!0)}),i}n.showSharedMailboxform=!0,n.saveinprogress=!1,n.savefinished=!1,n.isSharedMailboxEdit=!0,n.saveSharedMailboxError=!1,n.isAliasDuplicate=!1,n.domainList=[],n.hasActiveChange=!1,n.showWaitingIndicator=!1,n.emailAddresses=[],n.smtpProxyEmailAddresses=[],n.nonSmtpProxyEmailAddresses=[],n.smtpProxyEmailAddressesWithoutPrimary=[],n.formData.SharedMailboxId=n.selecteditem.SharedMailboxId,n.formData.SharedMailboxDisplayName=n.selecteditem.SharedMailboxDisplayName,n.primaryemailaddress=n.selecteditem.SharedMailboxSmtp,n.emailAddresses=n.selecteditem.SharedMailboxEmailAddresses,angular.forEach(n.selecteditem.SharedMailboxEmailAddresses,function(t){t.substr(0,4)=="smtp"||t.substr(0,4)=="SMTP"?(n.smtpProxyEmailAddresses.push(t),t.substr(0,4)=="smtp"&&n.smtpProxyEmailAddressesWithoutPrimary.push(t)):n.nonSmtpProxyEmailAddresses.push(t)}),i.GetAddSharedMailboxDefaults().then(function(t){angular.forEach(t.data.Domains,function(t){n.domainList.push(t.Name)}),n.aliasDomain=t.data.DefaultDomain},function(){}),n.UpdateSelectedDomain=function(t){n.selectedDomain=t},n.UpdateSharedMailboxAlias=function(){n.hasActiveChange=!0},n.LockAlias=function(){return},n.UpdateAliasDomain=function(t){n.aliasDomain=t},n.AddAlias=function(){var i="smtp:"+n.newalias+'@'+n.aliasDomain;t(n.smtpProxyEmailAddresses,i)?(n.isAliasDuplicate=!0,n.AddDupProxyAddressWarningMsg='The email address you\u2019re trying to add already exists.'):(n.smtpProxyEmailAddresses.push(i),n.smtpProxyEmailAddressesWithoutPrimary.push(i),n.hasActiveChange=!0,n.isAliasDuplicate=!1),n.UpdateEmailAddresses(),n.newEmailAlias=''},n.RemoveAlias=function(t){var r=n.smtpProxyEmailAddresses.indexOf(t),i;r!=-1&&n.smtpProxyEmailAddresses.splice(r,1),i=n.smtpProxyEmailAddressesWithoutPrimary.indexOf(t),i!=-1&&n.smtpProxyEmailAddressesWithoutPrimary.splice(i,1),n.UpdateEmailAddresses(),n.hasActiveChange=!0},n.UpdateEmailAddresses=function(){n.emailAddresses=n.smtpProxyEmailAddresses.concat(n.nonSmtpProxyEmailAddresses)},n.SetAsPrimary=function(t){var e="SMTP:"+n.primaryemailaddress,i="smtp:"+n.primaryemailaddress,o="SMTP:"+t.substring(5),r,u,f;i!=t&&(r=n.smtpProxyEmailAddressesWithoutPrimary.indexOf(t),r!=-1&&(n.smtpProxyEmailAddressesWithoutPrimary.splice(r,1),n.smtpProxyEmailAddressesWithoutPrimary.indexOf(i)===-1&&n.smtpProxyEmailAddressesWithoutPrimary.push(i)),n.smtpProxyEmailAddresses.indexOf(i)===-1&&(u=n.smtpProxyEmailAddresses.indexOf(e),u!=-1&&(n.smtpProxyEmailAddresses.splice(u,1),n.smtpProxyEmailAddresses.push(i)),f=n.smtpProxyEmailAddresses.indexOf(t),f!=-1&&(n.smtpProxyEmailAddresses.splice(f,1),n.smtpProxyEmailAddresses.push(o))),n.UpdateEmailAddresses(),n.primaryemailaddress=t.substring(5),n.hasActiveChange=!0)},n.SaveSharedMailbox=function(){n.showSharedMailboxform=!1,n.saveinprogress=!0,n.savefinished=!1,n.saveSharedMailboxError=!1,n.formData.Domain=n.selectedDomain,n.formData.SharedMailboxEmailAddresses=n.emailAddresses,n.formData.SharedMailboxSmtp=n.primaryemailaddress,n.formData.SharedMailboxEmailAliases=n.smtpProxyEmailAddressesWithoutPrimary,i.UpdateSharedMailboxInformation(n.formData).then(function(t){t.data.Status==0?(n.saveinprogress=!1,n.savefinished=!0,n.showCloseButton=!0,n.updateSharedMailboxList()):(n.showSharedMailboxform=!0,n.saveinprogress=!1,n.saveSharedMailboxError=!0,n.saveSharedMailboxErrorMessage=t.data.Message)},function(t){n.showSharedMailboxform=!0,n.saveinprogress=!1,n.saveSharedMailboxError=!0,n.saveSharedMailboxErrorMessage=t.data.Message})},n.updateSharedMailboxList=function(){var i=n.getIndex(n.selecteditem,n.$root.SharedMailboxesData),t;i!=-1&&(t=n.$root.SharedMailboxesData[i],t.SharedMailboxDisplayName=n.formData.SharedMailboxDisplayName,t.SharedMailboxEmailAddresses=n.formData.SharedMailboxEmailAddresses,t.SharedMailboxSmtp=n.formData.SharedMailboxSmtp,t.SharedMailboxEmailAliases=n.formData.SharedMailboxEmailAliases),n.formData=t,r.SetSelectedItem(n.formData)},n.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.SharedMailboxId==t[i].SharedMailboxId)return i;return-1}}this.$scope=n,this.$timeout=t,this.SharedMailboxService=i,this.PanelService=r,this.$window=u,this.$location=f,n.contentLoaded=!1,n.$on('$includeContentLoaded',function(){n.contentLoaded=!0}),n.Cancel=function(){n.$emit('closeFlyout')};var o=function(n){return!(n===null||n===""||n===" "||n===undefined)};e()}return n.$inject=["$scope","$timeout","SharedMailboxService","PanelService","$window","$location"],n}();n.app.controller("EditSharedMailboxController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(t,i,r,u){function e(){t.SharedMailboxMailForwardingConfig=n.prototype.GetForwardingConfig(),t.SharedMailboxForwardingAddressResolved=null,t.formData.SharedMailboxForwardingAddressToDisplay=null,t.formData.SharedMailboxForwardingAddress=t.selecteditem.SharedMailboxForwardingAddress,t.formData.SharedMailboxForwardingSmtpAddress=t.selecteditem.SharedMailboxForwardingSmtpAddress,t.formData.SharedMailboxDeliverToMailboxAndForward=t.selecteditem.SharedMailboxDeliverToMailboxAndForward,t.formData.SharedMailboxForwardingEnabled=t.selecteditem.SharedMailboxForwardingEnabled,f(t.selecteditem.SharedMailboxForwardingSmtpAddress)?(t.formData.SharedMailboxForwardingAddressToDisplay=t.selecteditem.SharedMailboxForwardingSmtpAddress,f(t.selecteditem.SharedMailboxForwardingAddress)&&r.GetResolvedForwardAddress(t.selecteditem).then(function(n){f(n.data)?(t.SharedMailboxForwardingAddressResolved=n.data,t.SharedMailboxMailForwardingConfig.TwoEmailForwardingMessage='\x3cp\x3eThis mailbox has two types of email forwarding turned on\x3c\x2fp\x3e\x3cp\x3eTo continue, remove the forwarding address below.\x3c\x2fp\x3e\x3cp\x3eTo forward email to multiple addresses, go to \x3ca href\x3d\x22http\x3a\x2f\x2fgo.microsoft.com\x2ffwlink\x2fp\x2f\x3fLinkId\x3d784998\x22 target\x3d\x27_blank\x27\x3etransport rules\x3c\x2fa\x3e.\x3c\x2fp\x3e '):t.SharedMailboxForwardingAddressResolved=null})):f(t.selecteditem.SharedMailboxForwardingAddress)&&r.GetResolvedForwardAddress(t.selecteditem).then(function(n){f(n.data)?(t.formData.SharedMailboxForwardingAddressToDisplay=n.data,t.SharedMailboxMailForwardingConfig.convertEmailForwardingMessage='\x3cp\x3eThe email in this mailbox is already being forwarded. When you click Save, the forwarding format will change and the mailbox owner will be able to see and edit the forwarding settings.\x3c\x2fp\x3e\x3cp\x3eTo forward email without the mailbox owner\x27s knowledge, go to \x3ca href\x3d\x22http\x3a\x2f\x2fgo.microsoft.com\x2ffwlink\x2fp\x2f\x3fLinkId\x3d784998\x22 target\x3d\x27_blank\x27\x3etransport rules\x3c\x2fa\x3e.\x3c\x2fp\x3e '):t.SharedMailboxForwardingAddressResolved=null}),t.RemoveConflictingFowardAddress=function(){t.SharedMailboxForwardingAddressResolved=null,t.selecteditem.SharedMailboxForwardingAddress=null,t.SharedMailboxMailForwardingConfig.TwoEmailForwardingMessage=null},angular.isDefined(t.setSaveCancelButtonsPosition)&&t.setSaveCancelButtonsPosition(),t.SetDeliverToMailboxAndForwardOn=function(){t.formData.SharedMailboxForwardingEnabled&&(t.formData.SharedMailboxDeliverToMailboxAndForward=!0)},t.SaveSharedMailbox=function(){t.SharedMailboxMailForwardingConfig.showSharedMailboxform=!1,t.SharedMailboxMailForwardingConfig.saveinprogress=!0,t.SharedMailboxMailForwardingConfig.savefinished=!1,t.SharedMailboxMailForwardingConfig.saveSharedMailboxError=!1,t.formData.SharedMailboxId=t.selecteditem.SharedMailboxId,t.formData.SharedMailboxFowardingAddress=null,t.formData.SharedMailboxForwardingEnabled?(t.formData.SharedMailboxForwardingSmtpAddress=t.formData.SharedMailboxForwardingAddressToDisplay,t.formData.SharedMailboxDeliverToMailboxAndForward=t.formData.SharedMailboxDeliverToMailboxAndForward):(t.formData.SharedMailboxForwardingSmtpAddress=null,t.formData.SharedMailboxDeliverToMailboxAndForward=!1),r.UpdateSharedMailboxMailForwarding(t.formData).then(function(n){n.data.Status==0?(t.SharedMailboxMailForwardingConfig.saveinprogress=!1,t.SharedMailboxMailForwardingConfig.savefinished=!0,t.SharedMailboxMailForwardingConfig.showCloseButton=!0,t.updateSharedMailboxListOnForwarding()):(t.SharedMailboxMailForwardingConfig.showSharedMailboxform=!0,t.SharedMailboxMailForwardingConfig.saveinprogress=!1,t.SharedMailboxMailForwardingConfig.saveSharedMailboxError=!0,t.SharedMailboxMailForwardingConfig.saveSharedMailboxErrorMessage=n.data.Message)},function(n){t.SharedMailboxMailForwardingConfig.showSharedMailboxform=!0,t.SharedMailboxMailForwardingConfig.saveinprogress=!1,t.SharedMailboxMailForwardingConfig.saveSharedMailboxError=!0,t.SharedMailboxMailForwardingConfig.saveSharedMailboxErrorMessage=n.data.Message})},t.updateSharedMailboxListOnForwarding=function(){var i=t.getIndex(t.selecteditem,t.$root.SharedMailboxesData),n;i!=-1&&(n=t.$root.SharedMailboxesData[i],n.SharedMailboxDeliverToMailboxAndForward=t.formData.SharedMailboxDeliverToMailboxAndForward,n.SharedMailboxForwardingSmtpAddress=t.formData.SharedMailboxForwardingSmtpAddress,n.SharedMailboxForwardingAddress=null,n.SharedMailboxForwardingEnabled=t.formData.SharedMailboxForwardingEnabled),t.formData=n,u.SetSelectedItem(t.formData)},t.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.SharedMailboxId==t[i].SharedMailboxId)return i;return-1}}this.$scope=t,this.$timeout=i,this.SharedMailboxService=r,this.PanelService=u,t.contentLoaded=!1,t.$on('$includeContentLoaded',function(){t.contentLoaded=!0}),t.Cancel=function(){t.$emit('closeFlyout')},t.SaveDisabled=function(){var n=!1;return t.formData.SharedMailboxForwardingEnabled&&t.SharedMailboxMailForwardingConfig.TwoEmailForwardingMessage!=null&&(n=!0),n};var f=function(n){return!(n===null||n===""||n===" "||n===undefined)};e()}return n.prototype.GetForwardingConfig=function(){return{showSharedMailboxform:!0,saveinprogress:!1,savefinished:!1,isSharedMailboxEdit:!0,saveSharedMailboxError:!1,saveSharedMailboxErrorMessage:null,convertEmailForwardingMessage:null,TwoEmailForwardingMessage:null}},n.$inject=["$scope","$timeout","SharedMailboxService","PanelService"],n}();n.app.controller("EditSharedMailboxForwardingController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(t,i,r,u){function f(){t.SharedMailboxConnectivityConfig=n.prototype.GetConnectivityConfig(),t.formData.SharedMailboxObjectId=t.selecteditem.SharedMailboxObjectId,t.formData.SharedMailboxEwsEnabled=t.selecteditem.SharedMailboxConnectivity.SharedMailboxEwsEnabled,t.formData.SharedMailboxPopEnabled=t.selecteditem.SharedMailboxConnectivity.SharedMailboxPopEnabled,t.formData.SharedMailboxOWAEnabled=t.selecteditem.SharedMailboxConnectivity.SharedMailboxOWAEnabled,t.formData.SharedMailboxMAPIEnabled=t.selecteditem.SharedMailboxConnectivity.SharedMailboxMAPIEnabled,t.formData.SharedMailboxImapEnabled=t.selecteditem.SharedMailboxConnectivity.SharedMailboxImapEnabled,t.formData.SharedMailboxActiveSyncEnabled=t.selecteditem.SharedMailboxConnectivity.SharedMailboxActiveSyncEnabled,t.CountConnectivityEnabled=0}this.$scope=t,this.$timeout=i,this.SharedMailboxService=r,this.PanelService=u,t.contentLoaded=!1,t.$on('$includeContentLoaded',function(){t.contentLoaded=!0}),t.SaveSharedMailboxConnectivity=function(){t.SharedMailboxConnectivityConfig.showSharedMailboxform=!1,t.SharedMailboxConnectivityConfig.saveinprogress=!0,t.SharedMailboxConnectivityConfig.savefinished=!1,t.SharedMailboxConnectivityConfig.saveSharedMailboxError=!1;var n={SharedMailboxObjectId:t.selecteditem.SharedMailboxId,SharedMailboxEwsEnabled:t.formData.SharedMailboxEwsEnabled,SharedMailboxPopEnabled:t.formData.SharedMailboxPopEnabled,SharedMailboxOWAEnabled:t.formData.SharedMailboxOWAEnabled,SharedMailboxMAPIEnabled:t.formData.SharedMailboxMAPIEnabled,SharedMailboxImapEnabled:t.formData.SharedMailboxImapEnabled,SharedMailboxActiveSyncEnabled:t.formData.SharedMailboxActiveSyncEnabled};t.formData=n,r.SetSharedMailboxConnectivity(t.formData.SharedMailboxObjectId,t.formData).then(function(n){n.data.Status==0?(t.SharedMailboxConnectivityConfig.saveinprogress=!1,t.SharedMailboxConnectivityConfig.savefinished=!0,t.SharedMailboxConnectivityConfig.showCloseButton=!0,t.updateSharedMailboxConnectivity()):(t.SharedMailboxConnectivityConfig.showSharedMailboxform=!0,t.SharedMailboxConnectivityConfig.saveinprogress=!1,t.SharedMailboxConnectivityConfig.saveSharedMailboxError=!0,t.SharedMailboxConnectivityConfig.saveSharedMailboxErrorMessage=n.data.Message)},function(n){t.SharedMailboxConnectivityConfig.showSharedMailboxform=!0,t.SharedMailboxConnectivityConfig.saveinprogress=!1,t.SharedMailboxConnectivityConfig.saveSharedMailboxError=!0,t.SharedMailboxConnectivityConfig.saveSharedMailboxErrorMessage=n.data.Message})},t.updateSharedMailboxConnectivity=function(){var i=t.getIndex(t.selecteditem,t.$root.SharedMailboxesData),n;i!=-1&&(n=t.$root.SharedMailboxesData[i],t.formData.SharedMailboxEwsEnabled&&t.CountConnectivityEnabled++,t.formData.SharedMailboxPopEnabled&&t.CountConnectivityEnabled++,t.formData.SharedMailboxOWAEnabled&&t.CountConnectivityEnabled++,t.formData.SharedMailboxMAPIEnabled&&t.CountConnectivityEnabled++,t.formData.SharedMailboxImapEnabled&&t.CountConnectivityEnabled++,t.formData.SharedMailboxActiveSyncEnabled&&t.CountConnectivityEnabled++,n.SharedMailboxConnectivity.SharedMailboxEwsEnabled=t.formData.SharedMailboxEwsEnabled,n.SharedMailboxConnectivity.SharedMailboxPopEnabled=t.formData.SharedMailboxPopEnabled,n.SharedMailboxConnectivity.SharedMailboxOWAEnabled=t.formData.SharedMailboxOWAEnabled,n.SharedMailboxConnectivity.SharedMailboxMAPIEnabled=t.formData.SharedMailboxMAPIEnabled,n.SharedMailboxConnectivity.SharedMailboxImapEnabled=t.formData.SharedMailboxImapEnabled,n.SharedMailboxConnectivity.SharedMailboxActiveSyncEnabled=t.formData.SharedMailboxActiveSyncEnabled,n.SharedMailboxConnectivity.CountConnectivityEnabled=t.CountConnectivityEnabled),n.SharedMailboxConnectivityRetrieved=!0,t.selecteditem=n,u.SetSelectedItem(t.selecteditem)},t.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.SharedMailboxId==t[i].SharedMailboxId)return i;return-1},t.Cancel=function(){t.$emit('closeFlyout')},t.IsValid=function(n){return!angular.isDefined(n)||n==null||n==""?!1:!0},f()}return n.prototype.GetConnectivityConfig=function(){return{showSharedMailboxform:!0,saveinprogress:!1,savefinished:!1,isSharedMailboxEdit:!0,saveSharedMailboxError:!1,saveSharedMailboxErrorMessage:null}},n.$inject=["$scope","$timeout","SharedMailboxService","PanelService"],n}();n.app.controller("EditSharedMailboxConnectivityController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(t,i,r,u){function f(){t.SharedMailboxSentItemsConfig=n.prototype.GetSentItemsConfig(),t.formData.SharedMailboxMessageCopyForSentAsEnabled=t.selecteditem.SharedMailboxMessageCopyForSentAsEnabled,angular.isDefined(t.setSaveCancelButtonsPosition)&&t.setSaveCancelButtonsPosition(),t.SaveSharedMailbox=function(){t.SharedMailboxSentItemsConfig.showSharedMailboxform=!1,t.SharedMailboxSentItemsConfig.saveinprogress=!0,t.SharedMailboxSentItemsConfig.savefinished=!1,t.SharedMailboxSentItemsConfig.saveSharedMailboxError=!1,t.formData.SharedMailboxId=t.selecteditem.SharedMailboxId,r.UpdateSharedMailboxSentItems(t.formData).then(function(n){n.data.Status==0?(t.SharedMailboxSentItemsConfig.saveinprogress=!1,t.SharedMailboxSentItemsConfig.savefinished=!0,t.SharedMailboxSentItemsConfig.showCloseButton=!0,t.updateSharedMailboxListOnSentItems()):(t.SharedMailboxSentItemsConfig.showSharedMailboxform=!0,t.SharedMailboxSentItemsConfig.saveinprogress=!1,t.SharedMailboxSentItemsConfig.saveSharedMailboxError=!0,t.SharedMailboxSentItemsConfig.saveSharedMailboxErrorMessage=n.data.Message)},function(n){t.SharedMailboxSentItemsConfig.showSharedMailboxform=!0,t.SharedMailboxSentItemsConfig.saveinprogress=!1,t.SharedMailboxSentItemsConfig.saveSharedMailboxError=!0,t.SharedMailboxSentItemsConfig.saveSharedMailboxErrorMessage=n.data.Message})},t.updateSharedMailboxListOnSentItems=function(){var i=t.getIndex(t.selecteditem,t.$root.SharedMailboxesData),n;i!=-1&&(n=t.$root.SharedMailboxesData[i],n.SharedMailboxMessageCopyForSentAsEnabled=t.formData.SharedMailboxMessageCopyForSentAsEnabled),t.formData=n,u.SetSelectedItem(t.formData)},t.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.SharedMailboxId==t[i].SharedMailboxId)return i;return-1}}this.$scope=t,this.$timeout=i,this.SharedMailboxService=r,this.PanelService=u,t.contentLoaded=!1,t.$on('$includeContentLoaded',function(){t.contentLoaded=!0}),t.Cancel=function(){t.$emit('closeFlyout')};var e=function(n){return!(n===null||n===""||n===" "||n===undefined)};f()}return n.prototype.GetSentItemsConfig=function(){return{showSharedMailboxform:!0,saveinprogress:!1,savefinished:!1,isSharedMailboxEdit:!0,saveSharedMailboxError:!1,saveSharedMailboxErrorMessage:null}},n.$inject=["$scope","$timeout","SharedMailboxService","PanelService"],n}();n.app.controller("EditSharedMailboxSentItemsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(t,i,r,u,f){function e(){t.SharedMailboxAutoReplyConfigurationConfig=n.prototype.GetAutoReplyConfig(),t.SharedMailboxAutoReplyEnabled=!1,t.formData.SharedMailboxObjectId=t.selecteditem.SharedMailboxId,t.formData.SharedMailboxAutoReplyState=t.selecteditem.SharedMailboxAutoReplyConfiguration.SharedMailboxAutoReplyState,t.formData.SharedMailboxExternalAudience=t.selecteditem.SharedMailboxAutoReplyConfiguration.SharedMailboxExternalAudience,t.formData.SharedMailboxExternalMessage=t.selecteditem.SharedMailboxAutoReplyConfiguration.SharedMailboxExternalMessage,t.formData.SharedMailboxInternalMessage=t.selecteditem.SharedMailboxAutoReplyConfiguration.SharedMailboxInternalMessage,t.SharedMailboxExternalAudienceEnabled=t.selecteditem.SharedMailboxAutoReplyConfiguration.SharedMailboxExternalAudience=="None"?!1:!0,(t.selecteditem.SharedMailboxAutoReplyConfiguration.SharedMailboxAutoReplyState=="Enabled"||t.selecteditem.SharedMailboxAutoReplyConfiguration.SharedMailboxAutoReplyState=="Scheduled")&&(t.SharedMailboxAutoReplyEnabled=!0),t.CheckSharedMailboxAutoReplySaveCondition()}this.$scope=t,this.$timeout=i,this.SharedMailboxService=r,this.PanelService=u,this.HelperService=f,t.contentLoaded=!1,t.$on('$includeContentLoaded',function(){t.contentLoaded=!0}),t.SetExternalAudienceAll=function(){t.SharedMailboxAutoReplyEnabled&&t.formData.SharedMailboxExternalAudience=="None"&&(t.formData.SharedMailboxExternalAudience="All"),t.CheckSharedMailboxAutoReplySaveCondition()},t.CheckSharedMailboxAutoReplySaveCondition=function(){t.SharedMailboxAutoReplyConfigurationConfig.canSaveAutoReply=!0,(t.SharedMailboxAutoReplyEnabled&&!f.IsValid(t.formData.SharedMailboxInternalMessage)||t.SharedMailboxAutoReplyEnabled&&t.SharedMailboxExternalAudienceEnabled&&!f.IsValid(t.formData.SharedMailboxExternalMessage))&&(t.SharedMailboxAutoReplyConfigurationConfig.canSaveAutoReply=!1)},t.SaveSharedMailboxAutoReplyConfiguration=function(){t.SharedMailboxAutoReplyConfigurationConfig.showSharedMailboxform=!1,t.SharedMailboxAutoReplyConfigurationConfig.saveinprogress=!0,t.SharedMailboxAutoReplyConfigurationConfig.savefinished=!1,t.SharedMailboxAutoReplyConfigurationConfig.saveSharedMailboxError=!1,t.formData.SharedMailboxAutoReplyState=t.SharedMailboxAutoReplyEnabled?"Enabled":"Disabled",t.SharedMailboxExternalAudienceEnabled||(t.formData.SharedMailboxExternalAudience="None");var n={SharedMailboxObjectId:t.selecteditem.SharedMailboxId,SharedMailboxAutoReplyState:t.formData.SharedMailboxAutoReplyState,SharedMailboxExternalAudience:t.formData.SharedMailboxExternalAudience,SharedMailboxExternalMessage:t.formData.SharedMailboxExternalMessage,SharedMailboxInternalMessage:t.formData.SharedMailboxInternalMessage};t.formData=n,r.SetSharedMailboxAutoReplyConfiguration(t.formData.SharedMailboxObjectId,t.formData).then(function(n){n.data.Status==0?(t.SharedMailboxAutoReplyConfigurationConfig.saveinprogress=!1,t.SharedMailboxAutoReplyConfigurationConfig.savefinished=!0,t.SharedMailboxAutoReplyConfigurationConfig.showCloseButton=!0,t.updateSharedMailboxAutoReplyConfiguration()):(t.SharedMailboxAutoReplyConfigurationConfig.showSharedMailboxform=!0,t.SharedMailboxAutoReplyConfigurationConfig.saveinprogress=!1,t.SharedMailboxAutoReplyConfigurationConfig.saveSharedMailboxError=!0,t.SharedMailboxAutoReplyConfigurationConfig.saveSharedMailboxErrorMessage=n.data.Message)},function(n){t.SharedMailboxAutoReplyConfigurationConfig.showSharedMailboxform=!0,t.SharedMailboxAutoReplyConfigurationConfig.saveinprogress=!1,t.SharedMailboxAutoReplyConfigurationConfig.saveSharedMailboxError=!0,t.SharedMailboxAutoReplyConfigurationConfig.saveSharedMailboxErrorMessage=n.data.Message})},t.updateSharedMailboxAutoReplyConfiguration=function(){var i=t.getIndex(t.selecteditem,t.$root.SharedMailboxesData),n;i!=-1&&(n=t.$root.SharedMailboxesData[i],n.SharedMailboxAutoReplyConfiguration.SharedMailboxAutoReplyState=t.formData.SharedMailboxAutoReplyState,n.SharedMailboxAutoReplyConfiguration.SharedMailboxExternalAudience=t.formData.SharedMailboxExternalAudience,n.SharedMailboxAutoReplyConfiguration.SharedMailboxExternalMessage=t.formData.SharedMailboxExternalMessage,n.SharedMailboxAutoReplyConfiguration.SharedMailboxInternalMessage=t.formData.SharedMailboxInternalMessage),n.SharedMailboxAutoReplyConfigurationRetrieved=!0,t.selecteditem=n,u.SetSelectedItem(t.selecteditem)},t.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.SharedMailboxId==t[i].SharedMailboxId)return i;return-1},t.Cancel=function(){t.$emit('closeFlyout')},t.IsValid=function(n){return!angular.isDefined(n)||n==null||n==""?!1:!0},e()}return n.prototype.GetAutoReplyConfig=function(){return{showSharedMailboxform:!0,saveinprogress:!1,savefinished:!1,isSharedMailboxEdit:!0,canSaveAutoReply:!0,saveSharedMailboxError:!1,saveSharedMailboxErrorMessage:null}},n.$inject=["$scope","$timeout","SharedMailboxService","PanelService","HelperService"],n}();n.app.controller("EditSharedMailboxAutoReplyConfigurationController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f){var e,o;this.$scope=n,this.SharedMailboxService=t,this.PanelService=i,this.PhotoService=r,this.HelperService=u,this.$filter=f,n.init=function(){n.SharedMailboxMembersModel={},n.SharedMailboxMembersModel.showAddMembers=!1,n.SharedMailboxMembersModel.showRemoveMembers=!1,n.SharedMailboxMembersModel.showViewMembers=!0,n.Picker={Type:2,inputLabel:'Search members',placeholderText:'Search',allItemsListTitle:'Members',SearchCategories:[{SearchCategory:0,Filter:{Membership:3,ObjectId:n.selecteditem.SharedMailboxId}}]},n.showform=!0,n.saveinprogress=!1,n.savefinished=!1,n.saveMembersError=!1},n.Cancel=function(){n.$emit('closeFlyout')},e=function(t){t.data.Status==0?(n.saveinprogress=!1,n.savefinished=!0,n.updateSharedMailboxMembership()):(n.showform=!0,n.saveinprogress=!1,n.saveMembersError=!0,n.saveMembersErrorMessage=t.data.Message)},n.updateSharedMailboxMembership=function(){var r=n.getIndex(n.selecteditem,n.$root.SharedMailboxesData),t,f,e;r!=-1&&(t=n.$root.SharedMailboxesData[r],t.SharedMailboxMembers=n.Picker.allItems,u.IsValid(t.MailboxFullAccessMembers)||(t.MailboxFullAccessMembers=[]),u.IsValid(t.MailboxSendAsMembers)||(t.MailboxSendAsMembers=[]),u.IsValid(n.RemovePicker)&&u.IsValid(n.RemovePicker.selectedItems)&&(n.deleteRemovedMembers(t.MailboxFullAccessMembers,n.RemovePicker.selectedItems),n.deleteRemovedMembers(t.MailboxSendAsMembers,n.RemovePicker.selectedItems),t.SharedMailboxMembers=t.MailboxFullAccessMembers),u.IsValid(n.AddPicker)&&u.IsValid(n.AddPicker.selectedItems)&&(f=n.extendAddedMembers(t.MailboxFullAccessMembers.concat(n.AddPicker.selectedItems)),t.MailboxFullAccessMembers=f,e=n.extendAddedMembers(t.MailboxSendAsMembers.concat(n.AddPicker.selectedItems)),t.MailboxSendAsMembers=e,t.SharedMailboxMembers=t.MailboxFullAccessMembers)),t.SharedMailboxMembershipRetrieved=!0,n.selecteditem=t,i.SetSelectedItem(n.selecteditem),n.Picker.RefreshList()},n.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.SharedMailboxId==t[i].SharedMailboxId)return i;return-1},o=function(t){n.showform=!0,n.saveinprogress=!1,n.saveMembersError=!0,n.saveMembersErrorMessage=t.data.Message},n.deleteRemovedMembers=function(n,t){if(t)for(var i=n.length-1;i>=0;i-=1)angular.forEach(t,function(t){n[i].ObjectId===t.ObjectId&&n.splice(i,1)})},n.extendAddedMembers=function(n){for(var t=n.concat(),r,i=0;i<t.length;++i)for(r=i+1;r<t.length;++r)t[i].ObjectId===t[r].ObjectId&&t.splice(r--,1);return t},n.OpenRemoveMembers=function(){n.RemovePicker={Type:1,action:1,existingItems:n.Picker.allItems,allItemsListTitle:n.Picker.allItemsListTitle,inputLabel:n.Picker.inputLabel,placeholderText:n.Picker.placeholderText,SearchCategories:n.Picker.SearchCategories},n.SharedMailboxMembersModel.showViewMembers=!1,n.SharedMailboxMembersModel.showAddMembers=!1,n.SharedMailboxMembersModel.showRemoveMembers=!0},n.OpenAddMembers=function(){n.AddPicker={Type:1,action:0,allItemsListTitle:n.Picker.allItemsListTitle,originalItems:n.Picker.allItems,inputLabel:'Search to add members',placeholderText:n.Picker.placeholderText,SearchCategories:[{SearchCategory:0,Filter:{MaxResults:-1,CheckMembership:2,CheckMembershipDetails:{SharedMailboxId:n.selecteditem.SharedMailboxId}}}]},n.SharedMailboxMembersModel.showViewMembers=!1,n.SharedMailboxMembersModel.showRemoveMembers=!1,n.SharedMailboxMembersModel.showAddMembers=!0},n.CloseSummary=function(){n.SharedMailboxMembersModel.showRemoveMembers=!1,n.SharedMailboxMembersModel.showAddMembers=!1,n.savefinished=!1,n.SharedMailboxMembersModel.showViewMembers=!0,n.showform=!0},n.CancelMembershipEdit=function(){n.SharedMailboxMembersModel.showAddMembers=!1,n.SharedMailboxMembersModel.showRemoveMembers=!1,n.SharedMailboxMembersModel.showViewMembers=!0,n.saveMembersError=!1},n.SaveDisabled=function(n){return n.selectedItems==null||n.selectedItems.length===0},n.SaveSharedMailbox=function(i){n.showform=!1,n.saveinprogress=!0,n.savefinished=!1,n.saveSharedMailboxError=!1;var r={ObjectId:n.selecteditem.SharedMailboxId,SmtpAddress:n.selecteditem.SharedMailboxSmtp,MembersToAdd:[],MembersToRemove:[]};i?r.MembersToAdd=n.AddPicker.GetSelectedItems():r.MembersToRemove=n.RemovePicker.GetSelectedItems(),t.UpdateSharedMailboxMembers(n.selecteditem.SharedMailboxId,r).then(e,o)}}return n.$inject=["$scope","SharedMailboxService","PanelService","PhotoService","HelperService","$filter"],n}();n.app.controller("EditSharedMailboxMembersController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t,i;(function(n){n[n.FullAccess=0]="FullAccess",n[n.SendAs=1]="SendAs",n[n.SendOnBehalf=2]="SendOnBehalf"})(t||(t={})),i=function(){function n(n,t,i,r){var u,f;this.$scope=n,this.SharedMailboxService=t,this.PanelService=i,this.PhotoService=r,n.init=function(){n.MailboxFullAccessMembers=[],n.MailboxSendAsMembers=[],n.MailboxSendOnBehalfMembers=[],n.SharedMailboxMembers=[],n.selecteditem.MailboxFullAccessMembers===undefined||n.selecteditem.MailboxFullAccessMembers==null||angular.forEach(n.selecteditem.MailboxFullAccessMembers,function(t){n.MailboxFullAccessMembers.push(t)}),n.selecteditem.MailboxSendAsMembers===undefined||n.selecteditem.MailboxSendAsMembers==null||angular.forEach(n.selecteditem.MailboxSendAsMembers,function(t){n.MailboxSendAsMembers.push(t)}),n.selecteditem.MailboxSendOnBehalfMembers===undefined||n.selecteditem.MailboxSendOnBehalfMembers==null||angular.forEach(n.selecteditem.MailboxSendOnBehalfMembers,function(t){n.MailboxSendOnBehalfMembers.push(t)}),n.selecteditem.SharedMailboxMembers===undefined||n.selecteditem.SharedMailboxMembers==null||angular.forEach(n.selecteditem.SharedMailboxMembers,function(t){n.SharedMailboxMembers.push(t)}),n.GetDelegateMemberPhotos(0),n.FullAccessPicker={clientId:"EditUserFullAccessPermission",Type:1,existingItems:n.MailboxFullAccessMembers,placeholderText:'Search by display name or email address',SearchCategories:[{SearchCategory:0,Filter:{MaxResults:-1,CheckMembership:4,CheckMembershipDetails:{MailboxId:n.selecteditem.SharedMailboxId}}}]},n.GetDelegateMemberPhotos(1),n.SendAsPicker={clientId:"EditUserSendAsPermission",Type:1,existingItems:n.MailboxSendAsMembers,placeholderText:'Search by display name or email address',SearchCategories:[{SearchCategory:0,Filter:{MaxResults:-1,CheckMembership:4,CheckMembershipDetails:{MailboxId:n.selecteditem.SharedMailboxId}}}]},n.GetDelegateMemberPhotos(2),n.SendOnBehalfPicker={clientId:"EditUserSendOnBehalfToPermission",Type:1,existingItems:n.MailboxSendOnBehalfMembers,placeholderText:'Search by display name or email address',SearchCategories:[{SearchCategory:0,Filter:{MaxResults:-1,CheckMembership:5,CheckMembershipDetails:{MailboxId:n.selecteditem.SharedMailboxId}}}]},n.showform=!0,n.saveinprogress=!1,n.savefinished=!1,n.saveMembersError=!1},n.Cancel=function(){n.$emit('closeFlyout')},n.Close=function(){n.$emit('closeFlyout')},u=function(t){t.data.Status==0?(n.$emit('showWaitingIndicator',!1),n.savefinished=!0,n.showSummary=!0,n.updateMailboxPermission()):(n.$emit('showWaitingIndicator',!1),n.showform=!0,n.saveinprogress=!1,n.saveMembersError=!0,n.saveMembersErrorMessage=t.data.Code)},n.updateMailboxPermission=function(){var r=n.getIndex(n.selecteditem,n.$root.SharedMailboxesData),t;r!=-1&&(t=n.$root.SharedMailboxesData[r],t.MailboxFullAccessMembers=n.FullAccessPicker.selectedItems,t.MailboxSendAsMembers=n.SendAsPicker.selectedItems,t.MailboxSendOnBehalfMembers=n.SendOnBehalfPicker.selectedItems,t.SharedMailboxMembers=n.FullAccessPicker.selectedItems),t.SharedMailboxMembershipRetrieved=!0,n.selecteditem=t,i.SetSelectedItem(n.selecteditem)},n.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.SharedMailboxId==t[i].SharedMailboxId)return i;return-1},f=function(t){n.$emit('showWaitingIndicator',!1),n.showform=!0,n.saveinprogress=!1,n.saveMembersError=!0,n.saveMembersErrorMessage=t.data.Code},n.SaveDisabled=function(){var t=n.FullAccessPicker.addedItems==null||n.FullAccessPicker.addedItems.length==0&&n.FullAccessPicker.removedItems.length==0,i=n.SendAsPicker.addedItems==null||n.SendAsPicker.addedItems.length==0&&n.SendAsPicker.removedItems.length==0,r=n.SendOnBehalfPicker.addedItems==null||n.SendOnBehalfPicker.addedItems.length==0&&n.SendOnBehalfPicker.removedItems.length==0;return t&&i&&r},n.SaveMailboxPermission=function(){n.$emit('showWaitingIndicator',!0),n.showform=!1,n.saveinprogress=!0,n.savefinished=!1,n.saveMailboxError=!1;var i={ObjectId:n.selecteditem.SharedMailboxId,FullAccessMembersToAdd:n.FullAccessPicker.addedItems,FullAccessMembersToRemove:n.FullAccessPicker.removedItems,SendAsMembersToAdd:n.SendAsPicker.addedItems,SendAsMembersToRemove:n.SendAsPicker.removedItems,SendOnBehalfMembersToAdd:n.SendOnBehalfPicker.addedItems,SendOnBehalfMembersToRemove:n.SendOnBehalfPicker.removedItems};t.UpdateSharedMailboxPermissions(n.selecteditem.SharedMailboxId,i).then(u,f)},n.IsValid=function(n){return!angular.isDefined(n)||n==null||n==""?!1:!0},n.GetDelegateMemberPhotos=function(t){if(n.$root.features&&n.$root.features.ShowUserPhoto)switch(t){case 0:n.GetMemberPhotos(n.MailboxFullAccessMembers);break;case 1:n.GetMemberPhotos(n.MailboxSendAsMembers);break;case 2:n.GetMemberPhotos(n.MailboxSendOnBehalfMembers)}},n.GetMemberPhotos=function(t){t&&angular.forEach(t,function(i,u){r.GetPhoto(i.PrimarySmtpAddress,0).then(function(r){r&&i.PrimarySmtpAddress==r.Identity&&n.IsValid(r.PhotoContent)&&(t[u].PhotoContent=r.PhotoContent)})})}}return n.$inject=["$scope","SharedMailboxService","PanelService","PhotoService"],n}(),n.app.controller("EditSharedMailboxPermissionsController",i)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(i,r,u,f,e,o){function y(){var u,n;i.ContactListConfig=t.GetContactListConfig(),i.ContactListConfig.ItemsCountOnInit=0,document.getElementById("ShellBodyAndFooterContainer").style.overflow="hidden",i.GetContactsList(),u=document.getElementById('ShellBodyAndFooterContainer'),angular.element(u).bind('scroll',l),n=r.$on('$stateChangeStart',function(t,i,r,u){if(u.name==='Contact'){var e=document.getElementById('ShellBodyAndFooterContainer');angular.element(e).unbind('scroll',l)}c&&(c(),c=null),h&&(h(),h=null),n&&(n(),n=null)}),$(document).mouseup(function(n){var t=$(".userlistActions"),i=$(".userlistActions li"),r=$(".userlistActions li a"),u=$(".userlistActions li a i"),f=$("#actionButton"),e=$("#actionButton span"),o=$("#actionButton span i");return f.is(n.target)||e.is(n.target)||o.is(n.target)?!1:t.is(n.target)||i.is(n.target)||r.is(n.target)||u.is(n.target)?void 0:($(".userlistActions").hide(),n.stopPropagation(),!1)})}var v,s,h,c;this.$scope=i,this.$rootScope=r,this.ContactService=u,this.ProfileService=f,this.PhotoService=e,this.HelperService=o,i.searchTerm={Value:""},i.GetContactImageColor=function(n){return f.GetProfileImageColor(n)},i.GetContactInitials=function(n){return f.GetContactInitials(n)},i.CloseActionLinks=function(){$(".userlistActions").hide();return},i.ToggleHighlight=function(n){$(".gridRow").css("background-color","transparent"),$("#user_list_"+n).css("background-color","#DDEBF7"),i.SelectedAllContacts(!1)},i.getRowCss=function(n){if(n.isChecked)return{'background-color':'#DDEBF7'}},i.ToggleActionLinks=function(){if($(".userlistActions:visible").length>0){$(".userlistActions").hide(),$('#actionButton').attr('aria-expanded','false');return}$('.userlistActions').show(),$('#actionButton').attr('aria-expanded','true')},i.initCallbackPanel=function(n){i.panel=n},v='Bulk actions',s=function(n){var t={};return n.length==1?t={panelTemplateUrl:"../AdminPortal/Contact/ContactSummary",panelType:"bulkactioncontact",selecteditem:n[0],unselectonclose:!1,unhighlightonclose:!1}:n.length>1&&(t={panelTemplateUrl:"../AdminPortal/Contact/BulkContactActions",panelType:"multicontact",panelHeaderTitle:v,selecteditem:n,unselectonclose:!0,unhighlightonclose:!0}),t},i.UpdatedSelectedContacts=function(n){var r,t;i.$root.focusOnPanel=!1,i.CloseActionLinks(),n.isChecked?(i.SelectedContacts.push(n),t=s(i.SelectedContacts),i.panel.invoke(t)):(r=i.SelectedContacts.indexOf(n),r!==-1&&i.SelectedContacts.splice(r,1),i.SelectedContacts.length===1&&(t=s(i.SelectedContacts),i.panel.invoke(t)),i.SelectedContacts.length===0&&i.$broadcast('closePanel'),i.selectedHeader.isChecked=!1),i.$broadcast('ToggleContactAction',i.SelectedContacts)},i.ShouldDisable=function(){return o.IsDataValid(i.ContactsData)},i.SelectedAllContacts=function(t){if(t){i.ContactsData.forEach(function(n){i.SelectedContacts.indexOf(n.ContactId)==-1&&i.SelectedContacts.push(n)}),$(".dataListField").prop('checked',!0),angular.forEach(i.ContactsData,function(n){n.isChecked=!0});var r=s(i.SelectedContacts);i.panel.invoke(r),$(".gridRow").css("background-color",n.gridRowCheckedBgColor)}else i.selectedHeader.isChecked=t,i.SelectedContacts=[],$(".dataListField").prop('checked',!1),angular.forEach(i.ContactsData,function(n){n.isChecked=!1})},h=i.$on('resetSelection',function(){i.SelectedAllContacts(!1)}),i.ToggleSortOption=function(n){i.ContactListConfig.sortField=n,i.ContactListConfig.sortDirection=i.ContactListConfig.sortDirection===1?0:1,i.GetContactsList()},i.GetContactsList=function(){i.Search(i.searchTerm.Value)},i.SearchList=function(n){i.ContactListConfig.ItemsCountOnInit>i.ContactListConfig.ShowContextualHelpItemCount&&(i.ContactListConfig.ItemsCountOnInit=undefined),i.Search(n)},i.Search=function(n){$(".dataListField").prop('checked',!1),i.selectedHeader.isChecked=!1,i.ContactsData=[],i.SelectedContacts=[],i.ContactListConfig.EndOfList=!1,i.ContactListConfig.showContextualHelp=!1,i.IsValid(i.nextLink)&&(i.nextLink=null),u.GetContacts(i.ContactListConfig.sortDirection,i.ContactListConfig.sortField,i.searchTerm.Value,null).then(p,a),i.ContactListConfig.EmptyListViewTitle=i.IsValid(n)?'No results found':'Nothing here yet.',i.ContactListConfig.EmptyListBodyLabel=''},i.IsValid=function(n){return n===null||n===""||n===" "||n===undefined?!1:!0},i.GetContactPhotos=function(n){i.$root.features&&i.$root.features.EnableUserPhotoInList&&n&&n.forEach(function(n){e.GetPhoto(n.ContactExternalEmailAddress,4).then(function(t){t&&n.ContactExternalEmailAddress==t.Identity&&i.IsValid(t.PhotoContent)&&(n.PhotoContent=t.PhotoContent)})})};var p=function(n){var t=n.data;i.ContactsData=t.Contacts,i.ContactListConfig.NoResults=i.ContactsData==null||i.ContactsData.length===0,angular.isDefined(i.ContactListConfig.ItemsCountOnInit)&&(i.ContactListConfig.ItemsCountOnInit=i.ContactsData.length),i.ContactListConfig.searchTerm=i.searchTerm.Value,t.IsLastPage&&(i.ContactListConfig.EndOfList=!0),i.nextLink=t.NextLink?t.NextLink:null,document.getElementById("ShellBodyAndFooterContainer").style.overflow="auto",i.$emit("autoscrolltotop"),i.GetContactPhotos(t.Contacts),t=o.ShowLoadButtonsforListItems(),i.ContactListConfig.showLoad=t.showLoad,i.ContactListConfig.showSpinner=t.showSpinner,i.ContactListConfig.showContextualHelp=!0},w=function(n){var t=n.data;i.ContactsData=i.ContactsData.concat(t.Contacts),i.nextLink=t.NextLink?t.NextLink:null,i.ContactListConfig.EndOfList=t.IsLastPage,i.ContactListConfig.IsPreviousRequestPending=!1,i.GetContactPhotos(t.Contacts)},b=function(){document.getElementById("ShellBodyAndFooterContainer").style.overflow="auto",i.ContactListConfig.EndOfList=!0,i.ContactListConfig.serverError=!0},k=function(){i.ContactListConfig.detailsLoaded=!0,i.ContactListConfig.serverError=!0},a=function(){i.serverListError=!0,i.ContactListConfig.showContextualHelp=!0},l=function(){var n=$("#gridRowsContainer .gridRow:last").offset().top;!i.ContactListConfig.IsPreviousRequestPending&&n-$(window).height()<300&&i.ContactListConfig.searchTerm==i.searchTerm.Value&&(i.ContactListConfig.searchTerm==i.searchTerm.Value,!i.ContactListConfig.EndOfList&&i.IsValid(i.nextLink)&&(i.ContactListConfig.IsPreviousRequestPending=!0,u.GetContacts(i.ContactListConfig.sortDirection,i.ContactListConfig.sortField,i.searchTerm.Value,i.nextLink).then(w,a)))};i.GetNextContacts=function(){i.ContactListConfig.showSpinner=!0,i.ContactListConfig.showLoad=!1,l()},i.selectedHeader={isChecked:!1},i.RemoveContactFromList=function(n){var t=i.getIndex(n,i.ContactsData);t!=-1&&i.ContactsData.splice(t,1)},i.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.ContactId==t[i].ContactId)return i;return-1},i.RefreshList=function(){i.ContactListConfig.ItemsCountOnInit=undefined,i.GetContactsList()},c=i.$on('RefreshList',function(n,t){if(t&&t.Action)switch(t.Action){case'delete':i.SelectedContacts.splice(0,1),i.RemoveContactFromList(t.SelectedItem)}}),i.initCallbackFlyout=function(n){i.flyout=n},i.OpenAddContactFlyout=function(){var n={flyoutTemplateUrl:"../AdminPortal/Contact/Add",flyoutType:"contact",flyoutHeaderTitle:'Add a contact',flyoutTitle:'Add a contact',waitingIndicatorMessage:'Adding contact',selecteditem:{}};i.flyout.invoke(n)},i.ShowContextualHelpCard=function(){return i.ContactListConfig.showContextualHelp&&i.ContactListConfig.ItemsCountOnInit<=i.ContactListConfig.ShowContextualHelpItemCount},y()}return t.GetContactListConfig=function(){return{IsPreviousRequestPending:!1,EndOfList:!1,NoResults:!1,serverError:!1,sortDirection:0,sortField:"ContactDisplayName",searchTerm:null,showSpinner:!0,showLoad:!1,showContextualHelp:!1,ItemsCountOnInit:undefined,EmptyListViewTitle:'Nothing here yet.',EmptyListBodyLabel:'How can I use contacts for people outside my organization\x3f',ShowContextualHelpItemCount:3}},t.$inject=["$rootScope","$scope","ContactService","ProfileService","PhotoService","HelperService"],t}();n.ContactController=t,n.app.controller("ContactController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){function o(){n.selectedItem=n.$parent.$parent.selectedItem,s(),n.isRefresh&&c()}var f,e;this.$scope=n,this.$rootScope=t,this.ContactService=i,this.PanelService=r,this.PhotoService=u,n.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.ContactId==t[i].ContactId)return i;return-1};var h=function(n){return n===null||n===""||n===" "||n===undefined?!1:!0},s=function(){n.selectedItem&&!h(n.selectedItem.PhotoContent)&&n.$root.features&&n.$root.features.ShowPersonPhoto&&u.GetPhoto(n.selectedItem.ContactExternalEmailAddress,4).then(function(n){u.BroadcastPhotoEvent("UpdatePersonPhoto",n)})},c=function(){var t=i.GetContacts(null,null,n.selectedItem.ContactDisplayName,null).data.Contacts;n.selectedItem.ContactDisplayName=t.ContactDisplayName,n.selectedItem.ContactExternalEmailAddress=t.ContactExternalEmailAddress,n.selectedItem.ContactCompany=t.ContactCompany,n.selectedItem.ContactPhone=t.ContactPhone,n.selectedItem.ContactMobilePhone=t.ContactMobilePhone,n.isRefresh=!1};o(),n.$on('panelclosed',function(){f&&(f(),f=null),e&&(e(),e=null)}),f=n.$on(r.GetBroadCastEventName(),function(i,r){n.selectedItem=r,t.$broadcast('UpdatePersonCard',n.selectedItem),s()}),e=n.$on('UpdateContactPanelDetails',function(t,i){i&&(n.isRefresh=!0,o())})}return n.$inject=['$scope','$rootScope','ContactService','PanelService','PhotoService'],n}();n.app.controller("ContactSummaryController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function u(){n.showContactInfo=!1,n.showContactMailTip=!1,n.showContactform=!0,n.saveInProgress=!1,n.saveFinished=!1,n.saveContactError=!1,n.updateContactListDone=!1,n.showContactLastNameFirst=!1,n.showContactZipCodeFirst=!1,n.countryList=[],t.GetContactCountryInfo().then(function(t){angular.forEach(t.data,function(t){n.countryList.push(t)})},function(){}),n.UpdateSelectedCountry=function(t){n.selectedCountry=t},i.GetAddUserPageDefaults().then(function(t){n.showContactLastNameFirst=t.data.ShowLastNameFirst,n.showContactZipCodeFirst=t.data.ShowZipFirst,angular.forEach(t.data.Domains,function(t){n.domainslist.push(t.Name)})},function(){n.failedGettingPageDefaults=!0}),n.PopulateDisplayName=function(){n.formData.ContactDisplayName||(n.formData.ContactDisplayName=f(n.formData.ContactFirstName,n.formData.ContactLastName,n.showContactLastNameFirst))},n.SaveContact=function(i){if(i.$valid){n.showContactform=!1,n.saveInProgress=!0,n.saveFinished=!1,n.saveContactError=!1,n.formData.ContactCountryOrRegion=n.selectedCountry,n.formData.ContactExternalEmailAddress=n.formData.ContactExternalEmailAddress;var r={ContactId:n.formData.ContactId,ContactFirstName:n.formData.ContactFirstName,ContactLastName:n.formData.ContactLastName,ContactDisplayName:n.formData.ContactDisplayName,ContactExternalEmailAddress:n.formData.ContactExternalEmailAddress,ContactTitle:n.formData.ContactTitle,ContactCompany:n.formData.ContactCompany,ContactWebPage:n.formData.ContactWebPage,ContactPhone:n.formData.ContactPhone,ContactMobilePhone:n.formData.ContactMobilePhone,ContactFax:n.formData.ContactFax,ContactStreetAddress:n.formData.ContactStreetAddress,ContactCity:n.formData.ContactCity,ContactStateOrProvince:n.formData.ContactStateOrProvince,ContactPostalCode:n.formData.ContactPostalCode,ContactCountryOrRegion:n.formData.ContactCountryOrRegion,ContactHiddenFromAddressListsEnabled:n.formData.ContactHiddenFromAddressListsEnabled,ContactMailTip:n.formData.ContactMailTip};n.formData=r,t.SaveContact(n.formData).then(function(t){t.data.Status==0?(n.saveInProgress=!1,n.saveFinished=!0,n.formData.ContactId=t.data.MailboxId,n.formData.ContactExternalEmailAddress=n.formData.ContactExternalEmailAddress,n.updateContactList()):(n.showContactform=!0,n.saveInProgress=!1,n.saveContactError=!0,n.saveContactErrorMessage=t.data.Message)},function(t){n.showContactform=!0,n.saveInProgress=!1,n.saveContactError=!0,n.saveContactErrorMessage=t.data.Message})}else n.saveContactError=!0,n.saveContactErrorMessage='Please provide all required fields.'}}function f(n,t,i){return n&&t&&i?t+" "+n:n&&t?n+" "+t:n?n:t?t:undefined}this.$scope=n,this.ContactService=t,this.UserManagementService=i,n.contentLoaded=!1;var r=n.$on('$includeContentLoaded',function(){n.contentLoaded=!0}),e=function(n){return n===null||n===""||n===" "||angular.isDefined(n)?!1:!0};n.updateContactList=function(){var t={ContactId:n.formData.ContactId,ContactDisplayName:n.formData.ContactDisplayName,ContactExternalEmailAddress:n.formData.ContactExternalEmailAddress,ContactFirstName:n.formData.ContactFirstName,ContactLastName:n.formData.ContactLastName,ContactTitle:n.formData.ContactTitle,ContactCompany:n.formData.ContactCompany,ContactWebPage:n.formData.ContactWebPage,ContactPhone:n.formData.ContactPhone,ContactMobilePhone:n.formData.ContactMobilePhone,ContactFax:n.formData.ContactFax,ContactStreetAddress:n.formData.ContactStreetAddress,ContactCity:n.formData.ContactCity,ContactStateOrProvince:n.formData.ContactStateOrProvince,ContactPostalCode:n.formData.ContactPostalCode,ContactCountryOrRegion:n.formData.ContactCountryOrRegion,ContactHiddenFromAddressListsEnabled:n.formData.ContactHiddenFromAddressListsEnabled,ContactMailTip:n.formData.ContactMailTip};n.formData=t,n.$root.ContactsData.unshift(n.formData),n.$root.ContactListConfig.NoResults=!1,n.updateContactListDone=!0},n.ToggleContactInformation=function(){n.showContactInfo=!n.showContactInfo},n.ToggleContactMailTip=function(){n.showContactMailTip=!n.showContactMailTip},n.$on('$destroy',function(){r&&(r(),r=null)}),n.Cancel=function(){n.$emit('closeFlyout'),n.$destroy()},u()}return n.$inject=["$scope","ContactService","UserManagementService"],n}();n.app.controller("AddContactController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function r(){}this.$scope=n,this.$rootScope=t,this.ContactService=i,n.showContactForm=!0,n.saveInProgress=!1,n.saveFinished=!1,n.deleteContactError=!1,n.showWaitingIndicator=!1,n.DeleteContacts=function(){n.showContactForm=!1,n.saveInProgress=!0,n.saveFinished=!1,n.$emit('showWaitingIndicator',!0),i.DeleteContact(n.selecteditem).then(function(t){t.data[n.selecteditem.ContactId].Status==0?(n.$emit('showWaitingIndicator',!1),n.saveInProgress=!1,n.saveFinished=!0,n.$root.refreshList=!0,n.$emit('closePanel')):(n.$emit('showWaitingIndicator',!1),n.showContactForm=!0,n.saveInProgress=!1,n.deleteContactError=!0,n.deleteContactStatusMessage=t.data[n.selecteditem.ContactId].Message)},function(t){n.$emit('showWaitingIndicator',!1),n.showContactForm=!0,n.saveInProgress=!1,n.deleteContactError=!0,n.deleteContactStatusMessage=t.data.Message})},n.Cancel=function(){n.$emit('closeFlyout')},n.Close=function(){n.formData.refreshListArgs={Action:"delete",SelectedItem:n.selecteditem},n.$emit('closeFlyout')},r()}return n.$inject=["$scope","$rootScope","ContactService"],n}();n.app.controller("DeleteContactController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function u(){n.showContactInfo=!1,n.showContactForm=!0,n.saveInprogress=!1,n.saveFinished=!1,n.hasActiveChange=!1,n.isContactEdit=!0,n.saveContactError=!1,n.formData.ContactId=n.selecteditem.ContactId,n.formData.ContactDisplayName=n.selecteditem.ContactDisplayName,n.formData.ContactEmailAddresses=n.selecteditem.ContactEmailAddresses,n.formData.ContactFirstName=n.selecteditem.ContactFirstName,n.formData.ContactLastName=n.selecteditem.ContactLastName,n.formData.ContactTitle=n.selecteditem.ContactTitle,n.formData.ContactCompany=n.selecteditem.ContactCompany,n.formData.ContactWebPage=n.selecteditem.ContactWebPage,n.formData.ContactPhone=n.selecteditem.ContactPhone,n.formData.ContactMobilePhone=n.selecteditem.ContactMobilePhone,n.formData.ContactFax=n.selecteditem.ContactFax,n.formData.ContactStreetAddress=n.selecteditem.ContactStreetAddress,n.formData.ContactCity=n.selecteditem.ContactCity,n.formData.ContactStateOrProvince=n.selecteditem.ContactStateOrProvince,n.formData.ContactPostalCode=n.selecteditem.ContactPostalCode,n.formData.ContactCountryOrRegion=n.selecteditem.ContactCountryOrRegion,n.countryList=[],t.GetContactCountryInfo().then(function(t){angular.forEach(t.data,function(t){n.countryList.push(t)}),n.selectedCountry=n.selecteditem.ContactCountryOrRegion},function(){}),n.UpdateSelectedCountry=function(t){n.selectedCountry=t,n.hasActiveChange=!0},n.UpdateContactInfo=function(){n.hasActiveChange=!0},n.SaveContact=function(){n.showContactForm=!1,n.saveinprogress=!0,n.savefinished=!1,n.saveContactError=!1,n.formData.ContactExternalEmailAddress=n.formData.ContactExternalEmailAddress,n.formData.ContactCountryOrRegion=n.selectedCountry,t.UpdateContact(n.formData).then(function(t){t.data.Status==0?(n.saveinprogress=!1,n.savefinished=!0,n.showCloseButton=!0,n.updateContactList()):(n.showContactForm=!0,n.saveinprogress=!1,n.saveContactError=!0,n.saveContactErrorMessage=t.data.Message)},function(t){n.showContactForm=!0,n.saveinprogress=!1,n.saveContactError=!0,n.saveContactErrorMessage=t.data.Message})},n.updateContactList=function(){var r=n.getIndex(n.selecteditem,n.$root.ContactsData),t;r!=-1&&(t=n.$root.ContactsData[r],t.ContactDisplayName=n.formData.ContactDisplayName,t.ContactExternalEmailAddress=n.formData.ContactExternalEmailAddress,t.ContactFirstName=n.formData.ContactFirstName,t.ContactLastName=n.formData.ContactLastName,t.ContactDisplayName=n.formData.ContactDisplayName,t.ContactExternalEmailAddress=n.formData.ContactExternalEmailAddress,t.ContactTitle=n.formData.ContactTitle,t.ContactCompany=n.formData.ContactCompany,t.ContactWebPage=n.formData.ContactWebPage,t.ContactPhone=n.formData.ContactPhone,t.ContactMobilePhone=n.formData.ContactMobilePhone,t.ContactFax=n.formData.ContactFax,t.ContactStreetAddress=n.formData.ContactStreetAddress,t.ContactCity=n.formData.ContactCity,t.ContactStateOrProvince=n.formData.ContactStateOrProvince,t.ContactPostalCode=n.formData.ContactPostalCode,t.ContactCountryOrRegion=n.formData.ContactCountryOrRegion),n.formData=t,i.SetSelectedItem(n.formData)},n.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.ContactId==t[i].ContactId)return i;return-1}}this.$scope=n,this.ContactService=t,this.PanelService=i,n.contentLoaded=!1;var r=n.$on('$includeContentLoaded',function(){n.contentLoaded=!0});n.ToggleContactInformation=function(){n.showContactInfo=!n.showContactInfo},n.$on('$destroy',function(){r&&(r(),r=null)}),n.Cancel=function(){n.$emit('closeFlyout'),n.$destroy()},u()}return n.$inject=["$scope","ContactService","PanelService"],n}();n.app.controller("EditContactController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function r(){n.showContactOptionsForm=!0,n.saveinprogress=!1,n.savefinished=!1,n.optionScope={},n.isContactOptionsEdit=!0,n.saveContactOptionsError=!1,n.optionScope.ContactId=n.selecteditem.ContactId,n.optionScope.ContactMailTip=n.selecteditem.ContactMailTip,n.optionScope.ContactHiddenFromAddressListsEnabled=n.selecteditem.ContactHiddenFromAddressListsEnabled,n.SaveContactOptions=function(){n.showContactOptionsForm=!1,n.saveinprogress=!0,n.savefinished=!1,n.saveContactOptionsError=!1,t.UpdateContactOptions(n.optionScope).then(function(t){t.data.Status==0?(n.saveinprogress=!1,n.savefinished=!0,n.showCloseButton=!0,n.updateContactList()):(n.showContactOptionsForm=!0,n.saveinprogress=!1,n.saveContactOptionsError=!0,n.saveContactOptionsErrorMessage=t.data.Message)},function(t){n.showContactOptionsForm=!0,n.saveinprogress=!1,n.saveContactOptionsError=!0,n.saveContactOptionsErrorMessage=t.data.Message})},n.updateContactList=function(){var r=n.getIndex(n.selecteditem,n.$root.ContactsData),t;r!=-1&&(t=n.$root.ContactsData[r],t.ContactMailTip=n.optionScope.ContactMailTip,t.ContactHiddenFromAddressListsEnabled=n.optionScope.ContactHiddenFromAddressListsEnabled),n.optionScope=t,i.SetSelectedItem(n.optionScope)},n.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.ContactId==t[i].ContactId)return i;return-1}}this.$scope=n,this.ContactService=t,this.PanelService=i,n.contentLoaded=!1,n.$on('$includeContentLoaded',function(){n.contentLoaded=!0}),$(".ms-Toggle-input").bind('keypress keydown',function(t){t.which===n.$root.KeyCodes.EnterKey&&(t.preventDefault(),$(this).prop('checked',!$(this).prop('checked')))}),n.Cancel=function(){n.$emit('closeFlyout')},r()}return n.$inject=["$scope","ContactService","PanelService"],n}();n.app.controller("EditContactOptionsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(i,r,u,f,e,o){function y(){i.ResourceMailboxListConfig=t.GetResourceMailboxListConfig(),i.ResourceMailboxListConfig.ItemsCountOnInit=0,i.GetResourceMailboxesList();var n=document.getElementById('ShellBodyAndFooterContainer');angular.element(n).bind('scroll',h),r.$on('$stateChangeStart',function(n,t,i,r){if(r.name==='ResourceMailbox'){var f=document.getElementById('ShellBodyAndFooterContainer');angular.element(f).unbind('scroll',h)}}),$(document).mouseup(function(n){var t=$(".userlistActions"),i=$(".userlistActions li"),r=$(".userlistActions li a"),u=$(".userlistActions li a i"),f=$("#actionButton"),e=$("#actionButton span"),o=$("#actionButton span i");return f.is(n.target)||e.is(n.target)||o.is(n.target)?!1:t.is(n.target)||i.is(n.target)||r.is(n.target)||u.is(n.target)?void 0:($(".userlistActions").hide(),n.stopPropagation(),!1)})}var c,s;this.$scope=i,this.$rootScope=r,this.ResourceMailboxService=u,this.ProfileService=f,this.PhotoService=e,this.HelperService=o,i.searchTerm={Value:""},i.GetResourceMailboxImageColor=function(n){return f.GetProfileImageColor(n)},i.GetResourceMailboxInitials=function(n){return f.GetResourceMailboxInitials(n)},i.CloseActionLinks=function(){$(".userlistActions").hide();return},i.ToggleHighlight=function(n){$(".gridRow").css("background-color","transparent"),$("#user_list_"+n).css("background-color","#DDEBF7"),i.SelectedAllResourceMailboxes(!1)},i.getRowCss=function(n){if(n&&n.isChecked)return{'background-color':'#DDEBF7'}},i.ToggleActionLinks=function(){if($(".userlistActions:visible").length>0){$(".userlistActions").hide(),$('#actionButton').attr('aria-expanded','false');return}$('.userlistActions').show(),$('#actionButton').attr('aria-expanded','true')},i.initCallbackPanel=function(n){i.panel=n},c='Bulk actions',s=function(n){var t={};return n.length==1?t={panelTemplateUrl:"../AdminPortal/ResourceMailbox/ResourceMailboxSummary",panelType:"resourcemailbox",selecteditem:n[0],unselectonclose:!1,unhighlightonclose:!1}:n.length>1&&(t={panelTemplateUrl:"ResourceMailbox/BulkResourceMailboxActions",panelType:"multiresourcemailbox",panelHeaderTitle:c,selecteditem:n,unselectonclose:!0,unhighlightonclose:!0}),t},i.UpdatedSelectedResourceMailboxes=function(n){var r,t;i.$root.focusOnPanel=!1,i.CloseActionLinks(),n.isChecked?(i.SelectedResourceMailboxes.push(n),t=s(i.SelectedResourceMailboxes),i.panel.invoke(t)):(r=i.SelectedResourceMailboxes.indexOf(n),r!==-1&&i.SelectedResourceMailboxes.splice(r,1),i.SelectedResourceMailboxes.length===1&&(t=s(i.SelectedResourceMailboxes),i.panel.invoke(t)),i.SelectedResourceMailboxes.length===0&&i.$broadcast('closePanel'),i.selectedHeader.isChecked=!1),i.$broadcast('ToggleResourceMailboxAction',i.SelectedResourceMailboxes)},i.ShouldDisable=function(){return o.IsDataValid(i.ResourceMailboxesData)},i.SelectedAllResourceMailboxes=function(t){if(t){i.ResourceMailboxesData.forEach(function(n){i.SelectedResourceMailboxes.indexOf(n.ResourceMailboxObjectId)==-1&&i.SelectedResourceMailboxes.push(n.ResourceMailboxObjectId)}),$(".dataListField").prop('checked',!0),angular.forEach(i.ResourceMailboxesData,function(n){n.isChecked=!0});var r=s(i.SelectedResourceMailboxes);i.panel.invoke(r),$(".gridRow").css("background-color",n.gridRowCheckedBgColor)}else i.selectedHeader.isChecked=t,i.SelectedResourceMailboxes=[],$(".dataListField").prop('checked',!1),angular.forEach(i.ResourceMailboxesData,function(n){n.isChecked=!1})},i.$on('resetSelection',function(){i.SelectedAllResourceMailboxes(!1)}),i.ToggleSortOption=function(n){i.ResourceMailboxListConfig.sortField=n,i.ResourceMailboxListConfig.sortDirection=i.ResourceMailboxListConfig.sortDirection===1?0:1,i.GetResourceMailboxesList()},i.GetResourceMailboxesList=function(){i.Search(i.searchTerm.Value)},i.SearchList=function(n){i.ResourceMailboxListConfig.ItemsCountOnInit>i.ResourceMailboxListConfig.ShowContextualHelpItemCount&&(i.ResourceMailboxListConfig.ItemsCountOnInit=undefined),i.Search(n)},i.Search=function(n){i.ResourceMailboxesData=[],i.SelectedResourceMailboxes=[],i.ResourceMailboxListConfig.EndOfList=!1,i.ResourceMailboxListConfig.showContextualHelp=!1;var t=i.ResourceMailboxListConfig.resourceMailboxTypeFilter=="All"?null:i.ResourceMailboxListConfig.resourceMailboxTypeFilter;i.IsValid(i.nextLink)&&(i.nextLink=null),u.GetResourceMailboxList(i.ResourceMailboxListConfig.sortDirection,i.ResourceMailboxListConfig.sortField,i.searchTerm.Value,t,null).then(a,l),i.ResourceMailboxListConfig.EmptyListViewTitle=i.IsValid(n)||i.IsValid(t)?'No results found':'Nothing here yet.',i.ResourceMailboxListConfig.EmptyListBodyLabel='',$(".dataListField").prop('checked',!1),i.selectedHeader.isChecked=!1},i.IsValid=function(n){return n===null||n===""||n===" "||n===undefined?!1:!0},i.GetResourceMailboxPhotos=function(){i.$root.features&&i.$root.features.EnableUserPhotoInList&&i.ResourceMailboxesData&&i.ResourceMailboxesData.forEach(function(n){e.GetPhoto(n.ResourceMailboxPrimarySmtpAddress,2).then(function(t){t&&n.ResourceMailboxPrimarySmtpAddress==t.Identity&&i.IsValid(t.PhotoContent)&&(n.PhotoContent=t.PhotoContent)})})};var a=function(n){var t=n.data;i.ResourceMailboxesData=t.ResourceMailboxList,i.ResourceMailboxListConfig.NoResults=i.ResourceMailboxesData==null||i.ResourceMailboxesData.length===0,i.ResourceMailboxListConfig.searchTerm=i.searchTerm.Value,i.ResourceMailboxListConfig.viewFilterType=i.ResourceMailboxListConfig.resourceMailboxTypeFilter,angular.isDefined(i.ResourceMailboxListConfig.ItemsCountOnInit)&&(i.ResourceMailboxListConfig.ItemsCountOnInit=i.ResourceMailboxesData.length),t.IsLastPage&&(i.ResourceMailboxListConfig.EndOfList=!0),i.nextLink=t.NextLink?t.NextLink:null,i.$emit("autoscrolltotop"),i.GetResourceMailboxPhotos(i.ResourceMailboxesData),t=o.ShowLoadButtonsforListItems(),i.ResourceMailboxListConfig.showLoad=t.showLoad,i.ResourceMailboxListConfig.showSpinner=t.showSpinner,i.ResourceMailboxListConfig.showContextualHelp=!0},v=function(n){var t=n.data;i.ResourceMailboxesData=i.ResourceMailboxesData.concat(t.ResourceMailboxList),i.nextLink=t.NextLink?t.NextLink:null,i.ResourceMailboxListConfig.EndOfList=t.IsLastPage,i.ResourceMailboxListConfig.IsPreviousRequestPending=!1,i.GetResourceMailboxPhotos(i.ResourceMailboxesData)},p=function(){i.ResourceMailboxListConfig.EndOfList=!0,i.ResourceMailboxListConfig.serverListError=!0},w=function(){i.ResourceMailboxListConfig.detailsLoaded=!0,i.ResourceMailboxListConfig.serverListError=!0},l=function(){i.ResourceMailboxListConfig.serverListError=!0,i.ResourceMailboxListConfig.showContextualHelp=!0},h=function(){var t=$("#gridRowsContainer .gridRow:last").offset().top,n;!i.ResourceMailboxListConfig.IsPreviousRequestPending&&t<$(window).height()&&i.ResourceMailboxListConfig.searchTerm==i.searchTerm.Value&&i.ResourceMailboxListConfig.viewFilterType==i.ResourceMailboxListConfig.resourceMailboxTypeFilter&&!i.ResourceMailboxListConfig.EndOfList&&i.IsValid(i.nextLink)&&(i.ResourceMailboxListConfig.searchTerm==i.searchTerm.Value,i.ResourceMailboxListConfig.viewFilterType=i.ResourceMailboxListConfig.resourceMailboxTypeFilter,i.ResourceMailboxListConfig.IsPreviousRequestPending=!0,n=i.ResourceMailboxListConfig.resourceMailboxTypeFilter=="All"?null:i.ResourceMailboxListConfig.resourceMailboxTypeFilter,u.GetResourceMailboxList(i.ResourceMailboxListConfig.sortDirection,i.ResourceMailboxListConfig.sortField,i.searchTerm.Value,n,i.nextLink).then(v,l))};i.GetNextResourceMailboxes=function(){i.ResourceMailboxListConfig.showSpinner=!0,i.ResourceMailboxListConfig.showLoad=!1,h()},i.selectedHeader={isChecked:!1},i.RemoveResourceMailboxFromList=function(n){var t=i.getIndex(n,i.ResourceMailboxesData);t!=-1&&i.ResourceMailboxesData.splice(t,1)},i.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.ResourceMailboxObjectId==t[i].ResourceMailboxObjectId)return i;return-1},i.RefreshList=function(){i.GetResourceMailboxesList()},i.$on('RefreshList',function(n,t){if(t&&t.Action)switch(t.Action){case'delete':i.SelectedResourceMailboxes.splice(0,1),i.RemoveResourceMailboxFromList(t.SelectedItem)}}),i.initCallbackFlyout=function(n){i.flyout=n},i.SetResourceType=function(n){var t={flyoutTemplateUrl:"../AdminPortal/ResourceMailbox/Add",flyoutType:"resourcemailbox",flyoutTitle:'Add',waitingIndicatorMessage:'Adding shared mailbox',selecteditem:{}};i.ResourceMailboxListConfig.resourceType=n,i.flyout.invoke(t)},i.ShowContextualHelpCard=function(){return i.ResourceMailboxListConfig.showContextualHelp&&i.ResourceMailboxListConfig.ItemsCountOnInit<=i.ResourceMailboxListConfig.ShowContextualHelpItemCount},y()}return t.GetResourceMailboxListConfig=function(){return{IsPreviousRequestPending:!1,EndOfList:!1,NoResults:!1,serverError:!1,sortDirection:0,sortField:"ResourceMailboxDisplayName",resourceMailboxTypeFilter:"All",searchTerm:null,viewFilterType:"All",showSpinner:!0,showLoad:!1,showContextualHelp:!1,ItemsCountOnInit:undefined,EmptyListViewTitle:'Nothing here yet',EmptyListBodyLabel:'Let\u2019s get you started',ShowContextualHelpItemCount:3,resourceType:undefined}},t.$inject=["$rootScope","$scope","ResourceMailboxService","ProfileService","PhotoService","HelperService"],t}();n.ResourceMailboxController=t,n.app.controller("ResourceMailboxController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){function s(){if(n.selectedItem=n.$parent.$parent.selectedItem,n.waitingCalendarConfigurationDataToLoad=!0,n.isRefresh=!1,n.selectedItem&&(e(),o()),n.isRefresh){c();var t=i.GetResourceMailboxList(null,null,n.selectedItem.ResourceMailboxDisplayName,null,null)}n.ResourceMailBoxTypeRoom='Room',n.ResourceMailboxTypeEquipment='Equipment'}var f;this.$scope=n,this.$rootScope=t,this.ResourceMailboxService=i,this.PanelService=r,this.PhotoService=u,n.GetWaitingMessage=function(){var t='Deleting \x7b0\x7d Mailbox';return n.selectedType.value=="Room"?t.Format(n.ResourceMailBoxTypeRoom):t.Format(n.ResourceMailboxTypeEquipment)};var h=function(n){return n===null||n===""||n===" "||n===undefined?!1:!0},e=function(){n.selectedItem.ResourceMailboxMembershipRetrieved?n.waitingCalendarConfigurationDataToLoad=!1:(n.waitingCalendarConfigurationDataToLoad=!0,i.GetResourceMailboxCalendarProcessing(n.selectedItem.ResourceMailboxObjectId).then(function(t){t.data&&(n.selectedItem.ResourceMailboxCalendarConfiguration=t.data),n.updateResourceMailboxListForCalendarConfiguration(),n.waitingCalendarConfigurationDataToLoad=!1}))},o=function(){n.selectedItem&&!h(n.selectedItem.PhotoContent)&&n.$root.features&&n.$root.features.ShowPersonPhoto&&u.GetPhoto(n.selectedItem.ResourceMailboxPrimarySmtpAddress,2).then(function(n){u.BroadcastPhotoEvent("UpdatePersonPhoto",n)})},c=function(){var t=i.GetResourceMailboxList(null,null,n.selectedItem.ResourceMailboxDisplayName,null,null).data.ResourceMailboxList;n.selectedItem.ResourceMailboxDisplayName=t.ResourceMailboxDisplayName,n.selectedItem.ResourceMailboxPrimarySmtpAddress=t.ResourceMailboxPrimarySmtpAddress,n.selectedItem.ResourceMailboxResourceCapacity=t.ResourceMailboxResourceCapacity,n.selectedItem.ResourceMailboxOffice=t.ResourceMailboxOffice,n.selectedItem.ResourceMailboxPhone=t.ResourceMailboxPhone,n.isRefresh=!1};n.updateResourceMailboxListForCalendarConfiguration=function(){var i=n.getIndex(n.selectedItem,n.$root.ResourceMailboxesData),t;i!=-1&&(t=n.$root.ResourceMailboxesData[i],t.ResourceMailboxCalendarConfiguration=n.selectedItem.ResourceMailboxCalendarConfiguration,t.ResourceMailboxMembershipRetrieved=!0)},n.getIndex=function(n,t){if(t)for(var i=0,r=t.length;i<r;i++)if(n.ResourceMailboxObjectId==t[i].ResourceMailboxObjectId)return i;return-1},s(),n.$on('panelclosed',function(){f&&(f(),f=null)}),f=n.$on(r.GetBroadCastEventName(),function(i,r){n.selectedItem=r,t.$broadcast('UpdatePersonCard',n.selectedItem),n.$apply(function(){e(),o()})})}return n.$inject=['$scope','$rootScope','ResourceMailboxService','PanelService','PhotoService'],n}();n.app.controller("ResourceMailboxSummaryController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function r(){n.ResourceMailBoxTypeRoom='Room',n.ResourceMailboxTypeEquipment='Equipment'}this.$scope=n,this.$rootScope=t,this.ResourceMailboxService=i,n.showResourceMailboxform=!0,n.saveInProgress=!1,n.saveFinished=!1,n.deleteResourceMailboxError=!1,n.GetSuccessMessage=function(){var t='\x7b0\x7d Mailbox was deleted';return n.selectedType.value=="Room"?t.Format(n.ResourceMailBoxTypeRoom):t.Format(n.ResourceMailboxTypeEquipment)},n.DeleteResourceMailboxes=function(){n.showResourceMailboxform=!1,n.saveInProgress=!0,n.saveFinished=!1,n.$emit('showWaitingIndicator',!0),i.RemoveResourceMailboxList(n.selecteditem).then(function(t){t.data[n.selecteditem.ResourceMailboxObjectId].Status==0?(n.$emit('showWaitingIndicator',!1),n.saveInProgress=!1,n.saveFinished=!0,n.$root.refreshList=!0,n.$emit('closePanel')):(n.$emit('showWaitingIndicator',!1),n.showResourceMailboxform=!0,n.saveInProgress=!1,n.deleteResourceMailboxError=!0,n.deleteResourceMailboxErrorMessage=t.data[n.selecteditem.ResourceMailboxObjectId].Code)},function(t){n.$emit('showWaitingIndicator',!1),n.showResourceMailboxform=!0,n.saveInProgress=!1,n.deleteResourceMailboxError=!0,n.deleteResourceMailboxErrorMessage=t.data.Code})},n.Cancel=function(){n.$emit('closeFlyout')},n.Close=function(){n.formData.refreshListArgs={Action:"delete",SelectedItem:n.selecteditem},n.$emit('closeFlyout')},r()}return n.$inject=["$scope","$rootScope","ResourceMailboxService"],n}();n.app.controller("DeleteResourceMailboxController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){function u(){n.showResourceMailboxform=!0,n.saveinprogress=!1,n.savefinished=!1,n.saveResourceMailboxError=!1,n.hasActiveChange=!1,n.isResourceMailboxEdit=!0,n.checkingAlias=null,n.domainList=[],n.formData.ResourceMailboxObjectId=n.selecteditem.ResourceMailboxObjectId,n.formData.ResourceMailboxRecipientTypeDetails=n.selecteditem.ResourceMailboxRecipientTypeDetails,n.formData.ResourceMailboxDisplayName=n.selecteditem.ResourceMailboxDisplayName,n.formData.ResourceMailboxResourceCapacity=n.selecteditem.ResourceMailboxResourceCapacity,n.formData.ResourceMailboxOffice=n.selecteditem.ResourceMailboxOffice,n.formData.ResourceMailboxPhone=n.selecteditem.ResourceMailboxPhone,n.formData.ResourceMailboxEmailAddresses=n.selecteditem.ResourceMailboxEmailAddresses,i.GetAddResourceMailboxDefaults().then(function(t){n.formData.ResourceMailboxAlias=n.selecteditem.ResourceMailboxAlias,angular.forEach(t.data.Domains,function(t){n.domainList.push(t.Name)}),n.selectedDomain=n.selecteditem.ResourceMailboxDomain},function(){}),n.UpdateSelectedDomain=function(t){n.selectedDomain=t,n.hasActiveChange=!0},n.UpdateResourceMailboxAlias=function(){n.hasActiveChange=!0;return},n.UpdateResourceMailboxInfo=function(){n.hasActiveChange=!0},n.LockAlias=function(){n.hasActiveChange=!0;return},n.SaveResourceMailbox=function(){n.showResourceMailboxform=!1,n.saveinprogress=!0,n.savefinished=!1,n.saveResourceMailboxError=!1,n.formData.ResourceMailboxObjectId=n.selecteditem.ResourceMailboxObjectId,n.formData.Domain=n.selectedDomain,n.formData.ResourceMailboxPrimarySmtpAddress=n.formData.ResourceMailboxAlias+"@"+n.selectedDomain,n.formData.ResourceMailboxResourceCapacity=n.formData.ResourceMailboxResourceCapacity,n.formData.ResourceMailboxOffice=n.formData.ResourceMailboxOffice,n.formData.ResourceMailboxPhone=n.formData.ResourceMailboxPhone,i.SetResourceMailbox(n.formData).then(function(t){t.data.Status==0?(n.showResourceMailboxform=!1,n.saveinprogress=!1,n.savefinished=!0,n.updateResourceMailboxDetails()):(n.showResourceMailboxform=!0,n.saveinprogress=!1,n.saveResourceMailboxError=!0,n.saveResourceMailboxErrorMessage=t.data.Message)},function(t){n.showResourceMailboxform=!0,n.saveinprogress=!1,n.saveResourceMailboxError=!0,n.saveResourceMailboxErrorMessage=t.data.Message})},n.updateResourceMailboxDetails=function(){var i=n.getIndex(n.selecteditem,n.$root.ResourceMailboxesData),t;i!=-1&&(t=n.$root.ResourceMailboxesData[i],t.ResourceMailboxDisplayName=n.formData.ResourceMailboxDisplayName,t.ResourceMailboxResourceCapacity=n.formData.ResourceMailboxResourceCapacity,t.ResourceMailboxOffice=n.formData.ResourceMailboxOffice,t.ResourceMailboxPhone=n.formData.ResourceMailboxPhone,t.ResourceMailboxAlias=n.formData.ResourceMailboxAlias,t.ResourceMailboxPrimarySmtpAddress=n.formData.ResourceMailboxAlias+"@"+n.formData.Domain),n.formData=t,r.SetSelectedItem(n.formData)},n.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.ResourceMailboxObjectId==t[i].ResourceMailboxObjectId)return i;return-1}}this.$scope=n,this.$timeout=t,this.ResourceMailboxService=i,this.PanelService=r,n.contentLoaded=!1,n.$on('$includeContentLoaded',function(){n.contentLoaded=!0}),n.Cancel=function(){n.$emit('closeFlyout')},u()}return n.$inject=["$scope","$timeout","ResourceMailboxService","PanelService"],n}();n.app.controller("EditResourceMailboxDetailsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){var r,u;this.$scope=n,this.ResourceMailboxService=t,this.PanelService=i,n.init=function(){n.formData.ResourceMailboxAutoProcessing=n.selecteditem.ResourceMailboxAutoProcessing,n.ResourceMailboxResourceDelegates=[],n.selecteditem.ResourceMailboxResourceDelegates===undefined||n.selecteditem.ResourceMailboxResourceDelegates==null||angular.forEach(n.selecteditem.ResourceMailboxResourceDelegates,function(t){n.ResourceMailboxResourceDelegates.push(t)}),n.Picker={Type:1,existingItems:n.ResourceMailboxResourceDelegates,placeholderText:'Search for users to add or remove',allItemsListTitle:'Delegates',SearchCategories:[{SearchCategory:0,Filter:{MaxResults:-1,CheckMembership:3,CheckMembershipDetails:{ResourceMailboxId:n.selecteditem.ResourceMailboxObjectId}}}]},n.showResourceMailboxMembersForm=!0,n.saveinprogress=!1,n.savefinished=!1,n.saveMembersError=!1},n.Cancel=function(){n.$emit('closeFlyout')},r=function(t){t.data.Status==0?(n.saveinprogress=!1,n.savefinished=!0,n.updateResourceMailboxMembership()):(n.showResourceMailboxMembersForm=!0,n.saveinprogress=!1,n.saveMembersError=!0,n.saveMembersErrorMessage=t.data.Message)},n.updateResourceMailboxMembership=function(){var u=n.getIndex(n.selecteditem,n.$root.ResourceMailboxesData),t,r;u!=-1&&(t=n.$root.ResourceMailboxesData[u],r=[],angular.forEach(n.Picker.selectedItems,function(n){n.EmailAddress?r.push(n.EmailAddress):r.push(n)}),t.ResourceMailboxAutoProcessing=n.formData.ResourceMailboxAutoProcessing,t.ResourceMailboxResourceDelegates=r),t.ResourceMailboxMembershipRetrieved=!0,n.selecteditem=t,i.SetSelectedItem(n.selecteditem)},n.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.ResourceMailboxObjectId==t[i].ResourceMailboxObjectId)return i;return-1},u=function(t){n.showResourceMailboxMembersForm=!0,n.saveinprogress=!1,n.saveMembersError=!0,n.saveMembersErrorMessage=t.data.Message},n.SaveDisabled=function(){var t=!1;return n.formData.ResourceMailboxAutoProcessing||(n.Picker.addedItems===null||n.Picker.addedItems.length===0)&&(n.Picker.removedItems===null||n.Picker.removedItems.length===0)&&(t=!0),t},n.SaveResourceMailboxMembers=function(){n.showResourceMailboxMembersForm=!1,n.saveinprogress=!0,n.savefinished=!1,n.saveResourceMailboxError=!1,n.ResourceDelegates=[],angular.forEach(n.Picker.selectedItems,function(t){t.EmailAddress?n.ResourceDelegates.push(t.EmailAddress):n.ResourceDelegates.push(t)});var i={ResourceMailboxObjectId:n.selecteditem.ResourceMailboxObjectId,ResourceMailboxAutoProcessing:n.formData.ResourceMailboxAutoProcessing,ResourceMailboxResourceDelegates:n.ResourceDelegates};t.SetResourceMailboxCalendarProcessing(i).then(r,u)}}return n.$inject=["$scope","ResourceMailboxService","PanelService"],n}();n.app.controller("EditResourceMailboxMembersController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){function f(){n.showResourceMailboxOptionsform=!0,n.showResourceMailboxMembersForm=!0,n.saveinprogress=!1,n.savefinished=!1,n.saveResourceMailboxError=!1,n.formData.ResourceMailboxAutoProcessing=n.selecteditem.ResourceMailboxCalendarConfiguration.ResourceMailboxAutoProcessing,n.ResourceMailboxResourceDelegates=[],n.ResourceMailboxResourceDelegateObjects=[],n.selecteditem.ResourceMailboxCalendarConfiguration.ResourceMailboxResourceDelegates===undefined||n.selecteditem.ResourceMailboxCalendarConfiguration.ResourceMailboxResourceDelegates===null?i.GetResourceMailboxCalendarProcessing(n.selecteditem.ResourceMailboxObjectId).then(function(t){t.data&&(n.selecteditem.ResourceMailboxCalendarConfiguration=t.data,angular.forEach(n.selecteditem.ResourceMailboxCalendarConfiguration.ResourceMailboxResourceDelegates,function(t){n.ResourceMailboxResourceDelegates.push(t)}),angular.forEach(n.selecteditem.ResourceMailboxCalendarConfiguration.ResourceMailboxResourceDelegateObjects,function(t){n.ResourceMailboxResourceDelegateObjects.push(t)}))}):(angular.forEach(n.selecteditem.ResourceMailboxCalendarConfiguration.ResourceMailboxResourceDelegates,function(t){n.ResourceMailboxResourceDelegates.push(t)}),angular.forEach(n.selecteditem.ResourceMailboxCalendarConfiguration.ResourceMailboxResourceDelegateObjects,function(t){n.ResourceMailboxResourceDelegateObjects.push(t)})),n.GetResourceDelegatePhotos(),n.Picker={Type:1,existingItems:n.ResourceMailboxResourceDelegateObjects,placeholderText:'Search for users to add or remove',allItemsListTitle:'Delegates',SearchCategories:[{SearchCategory:0,Filter:{MaxResults:-1,CheckMembership:3,CheckMembershipDetails:{ResourceMailboxId:n.selecteditem.ResourceMailboxObjectId}}}]},n.formData.ResourceMailboxObjectId=n.selecteditem.ResourceMailboxObjectId,n.formData.ResourceMailboxAllowRecurringMeetings=n.selecteditem.ResourceMailboxCalendarConfiguration.ResourceMailboxAllowRecurringMeetings,n.formData.ResourceMailboxScheduleOnlyDuringWorkHours=n.selecteditem.ResourceMailboxCalendarConfiguration.ResourceMailboxScheduleOnlyDuringWorkHours,n.formData.ResourceMailboxEnforceSchedulingHorizon=n.selecteditem.ResourceMailboxCalendarConfiguration.ResourceMailboxEnforceSchedulingHorizon,n.formData.ResourceMailboxBookingWindowInDays=n.selecteditem.ResourceMailboxCalendarConfiguration.ResourceMailboxBookingWindowInDays,n.formData.ResourceMailboxMaximumDurationInHours=n.selecteditem.ResourceMailboxCalendarConfiguration.ResourceMailboxMaximumDurationInHours}this.$scope=n,this.$timeout=t,this.ResourceMailboxService=i,this.PanelService=r,this.PhotoService=u,n.contentLoaded=!1,n.$on('$includeContentLoaded',function(){n.contentLoaded=!0}),n.SaveResourceMailboxOptions=function(){n.showResourceMailboxOptionsform=!1,n.showResourceMailboxMembersForm=!1,n.saveinprogress=!0,n.savefinished=!1,n.saveResourceMailboxError=!1,n.ResourceDelegates=[],n.ResourceDelegateObjects=[],angular.forEach(n.Picker.selectedItems,function(t){n.ResourceDelegates.push(t.ObjectId),n.ResourceDelegateObjects.push(t)});var t={ResourceMailboxObjectId:n.selecteditem.ResourceMailboxObjectId,ResourceMailboxAllowRecurringMeetings:n.formData.ResourceMailboxAllowRecurringMeetings,ResourceMailboxScheduleOnlyDuringWorkHours:n.formData.ResourceMailboxScheduleOnlyDuringWorkHours,ResourceMailboxEnforceSchedulingHorizon:n.formData.ResourceMailboxEnforceSchedulingHorizon,ResourceMailboxBookingWindowInDays:n.formData.ResourceMailboxBookingWindowInDays,ResourceMailboxMaximumDurationInHours:n.formData.ResourceMailboxMaximumDurationInHours,ResourceMailboxResourceDelegates:n.ResourceDelegates,ResourceMailboxAutoProcessing:n.formData.ResourceMailboxAutoProcessing};n.formData=t,i.SetResourceMailboxCalendarProcessing(n.formData).then(function(t){t.data.Status===0?(n.showResourceMailboxOptionsform=!1,n.saveinprogress=!1,n.savefinished=!0,n.updateResourceMailboxOptions()):(n.showResourceMailboxOptionsform=!0,n.showResourceMailboxMembersForm=!0,n.saveinprogress=!1,n.saveResourceMailboxError=!0,n.saveResourceMailboxErrorMessage=t.data.Message)},function(t){n.showResourceMailboxOptionsform=!0,n.saveinprogress=!1,n.saveResourceMailboxError=!0,n.saveResourceMailboxErrorMessage=t.data.Message})},n.updateResourceMailboxOptions=function(){var i=n.getIndex(n.selecteditem,n.$root.ResourceMailboxesData);if(i!==-1){var t=n.$root.ResourceMailboxesData[i],u=[],f=[];angular.forEach(n.Picker.selectedItems,function(n){u.push(n.ObjectId),f.push(n)}),t.ResourceMailboxCalendarConfiguration.ResourceMailboxAllowRecurringMeetings=n.formData.ResourceMailboxAllowRecurringMeetings,t.ResourceMailboxCalendarConfiguration.ResourceMailboxScheduleOnlyDuringWorkHours=n.formData.ResourceMailboxScheduleOnlyDuringWorkHours,t.ResourceMailboxCalendarConfiguration.ResourceMailboxEnforceSchedulingHorizon=n.formData.ResourceMailboxEnforceSchedulingHorizon,t.ResourceMailboxCalendarConfiguration.ResourceMailboxBookingWindowInDays=n.formData.ResourceMailboxBookingWindowInDays,t.ResourceMailboxCalendarConfiguration.ResourceMailboxMaximumDurationInHours=n.formData.ResourceMailboxMaximumDurationInHours,t.ResourceMailboxCalendarConfiguration.ResourceMailboxAutoProcessing=n.formData.ResourceMailboxAutoProcessing,t.ResourceMailboxCalendarConfiguration.ResourceMailboxResourceDelegates=u,t.ResourceMailboxCalendarConfiguration.ResourceMailboxResourceDelegateObjects=f}t.ResourceMailboxMembershipRetrieved=!0,n.selecteditem=t,r.SetSelectedItem(n.selecteditem)},n.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.ResourceMailboxObjectId==t[i].ResourceMailboxObjectId)return i;return-1},n.Cancel=function(){n.$emit('closeFlyout')},n.SaveDisabled=function(){var t=!1;return n.formData.ResourceMailboxAutoProcessing||(n.Picker.selectedItems==null||n.Picker.selectedItems.length==0)&&(t=!0),t},n.IsValid=function(n){return!angular.isDefined(n)||n===null||n===""?!1:!0},n.GetResourceDelegatePhotos=function(){n.$root.features&&n.$root.features.ShowUserPhoto&&n.ResourceMailboxResourceDelegateObjects&&angular.forEach(n.ResourceMailboxResourceDelegateObjects,function(t,i){u.GetPhoto(t.EmailAddress,0).then(function(r){r&&t.EmailAddress==r.Identity&&n.IsValid(r.PhotoContent)&&(n.ResourceMailboxResourceDelegateObjects[i].PhotoContent=r.PhotoContent)})})},f()}return n.$inject=["$scope","$timeout","ResourceMailboxService","PanelService","PhotoService"],n}();n.app.controller("EditResourceMailboxOptionsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f){function o(){n.showResourceMailboxform=!0,n.saveinprogress=!1,n.savefinished=!1,n.saveResourceMailboxError=!1,n.hasActiveChange=!1,n.intervalTimeout=3e3,n.intervalCount=60,n.updateResourceMailboxListDone=!1,n.domainList=[],n.typeList=[],n.ResourceMailBoxTypeRoom='Room',n.ResourceMailboxTypeEquipment='Equipment',r.GetAddResourceMailboxDefaults().then(function(t){n.selectedDomain=t.data.DefaultDomain,angular.forEach(t.data.Types,function(t){t=="Room"?n.typeList.push({value:t,Text:n.ResourceMailBoxTypeRoom}):n.typeList.push({value:t,Text:n.ResourceMailboxTypeEquipment})});var i=n.typeList[0];angular.isDefined(n.$root.ResourceMailboxListConfig.resourceType)&&n.$root.ResourceMailboxListConfig.resourceType=="Equipment"&&(i=n.typeList[1]),n.selectedType=i,angular.forEach(t.data.Domains,function(t){n.domainList.push(t.Name)})},function(){}),n.UpdateResourceMailboxType=function(t){n.selectedType=t,n.hasActiveChange=!0},n.UpdateSelectedDomain=function(t){n.selectedDomain=t,n.hasActiveChange=!0},n.UpdateResourceMailboxInfo=function(){n.hasActiveChange=!0},n.SaveResourceMailbox=function(i){if(i.$valid){n.showResourceMailboxform=!1,n.saveinprogress=!0,n.savefinished=!1,n.saveResourceMailboxError=!1,n.formData.ResourceMailboxDomain=n.selectedDomain;var u={ResourceMailboxDisplayName:n.formData.ResourceMailboxDisplayName,ResourceMailboxAlias:n.formData.ResourceMailboxAlias,ResourceMailboxDomain:n.selectedDomain,ResourceMailboxPrimarySmtpAddress:n.formData.ResourceMailboxAlias+"@"+n.selectedDomain,ResourceMailboxResourceCapacity:n.formData.ResourceMailboxResourceCapacity,ResourceMailboxOffice:n.formData.ResourceMailboxOffice,ResourceMailboxPhone:n.formData.ResourceMailboxPhone,ResourceMailboxRecipientTypeDetails:n.selectedType.value};n.formData=u,r.NewResourceMailbox(n.formData).then(function(i){i.data.Status==0?(n.formData.ResourceMailboxObjectId=i.data.MailboxId,n.formData.ResourceMailboxPrimarySmtpAddress=n.formData.ResourceMailboxAlias+"@"+n.formData.ResourceMailboxDomain,r.AddMorePropertyToNewResourceMailbox(n.formData).then(function(t){t.data.Status==0?(r.GetResourceMailboxCalendarProcessing(n.formData.ResourceMailboxObjectId).then(function(t){t.data&&(n.formData.ResourceMailboxCalendarConfiguration=t.data),n.saveinprogress=!1,n.savefinished=!0}),n.updateResourceMailboxList()):(n.showResourceMailboxDetailsForm=!0,n.saveinprogress=!1,n.saveResourceMailboxError=!0,n.saveResourceMailboxErrorMessage=t.data.Message)},function(t){n.showResourceMailboxDetailsForm=!0,n.saveinprogress=!1,n.saveResourceMailboxError=!0,n.saveResourceMailboxErrorMessage=t.data.Message})):i.status==503?n.timeoutpromise=t(n.IsResourceMailboxCreated,n.intervalTimeout,n.intervalCount):(n.showResourceMailboxform=!0,n.saveinprogress=!1,n.saveResourceMailboxError=!0,n.saveResourceMailboxErrorMessage=i.data.Message)},function(i){i.status==503?n.timeoutpromise=t(n.IsResourceMailboxCreated,n.intervalTimeout,n.intervalCount):(n.showResourceMailboxform=!0,n.saveinprogress=!1,n.saveResourceMailboxError=!0,n.saveResourceMailboxErrorMessage=i.data.Message)})}else n.saveResourceMailboxError=!0,n.saveResourceMailboxErrorMessage='Please provide all required fields.'}}this.$scope=n,this.$interval=t,this.$timeout=i,this.ResourceMailboxService=r,this.PanelService=u,this.HelperService=f,n.contentLoaded=!1,n.$on('$includeContentLoaded',function(){n.contentLoaded=!0});var e=function(n){return n===null||n===""||n===" "||n===undefined?!1:!0};$(document).mousedown(function(t){$(t.target).attr("id")==="btnAddResourceMailboxClose"&&n.$emit('closeFlyout')}),n.GetWaitingMessage=function(){var t='Editing \x7b0\x7d Mailbox',i='Creating \x7b0\x7d mailbox. This may take a minute or so to create.';return n.isResourceMailboxEdit?n.selectedType.value=="Room"?t.Format(n.ResourceMailBoxTypeRoom):t.Format(n.ResourceMailboxTypeEquipment):n.selectedType.value=="Room"?i.Format(n.ResourceMailBoxTypeRoom):i.Format(n.ResourceMailboxTypeEquipment)},n.GetSuccessMessage=function(){var t='The \x7b0\x7d mailbox is ready to use.',i='\x7b0\x7d Mailbox was updated';return n.isResourceMailboxEdit?n.selectedType.value=="Room"?i.Format(n.ResourceMailBoxTypeRoom):i.Format(n.ResourceMailboxTypeEquipment):n.selectedType.value=="Room"?t.Format(n.ResourceMailBoxTypeRoom):t.Format(n.ResourceMailboxTypeEquipment)},n.updateResourceMailboxList=function(){var t={ResourceMailboxObjectId:n.formData.ResourceMailboxObjectId,ResourceMailboxDisplayName:n.formData.ResourceMailboxDisplayName,ResourceMailboxAlias:n.formData.ResourceMailboxAlias,ResourceMailboxDomain:n.formData.ResourceMailboxDomain,ResourceMailboxPrimarySmtpAddress:n.formData.ResourceMailboxPrimarySmtpAddress,ResourceMailboxResourceCapacity:n.formData.ResourceMailboxResourceCapacity,ResourceMailboxOffice:n.formData.ResourceMailboxOffice,ResourceMailboxPhone:n.formData.ResourceMailboxPhone,ResourceMailboxRecipientTypeDetails:n.formData.ResourceMailboxRecipientTypeDetails,ResourceMailboxResourceDelegates:[],ResourceMailboxMembershipRetrieved:!1};n.formData=t,n.$root.ResourceMailboxesData.unshift(n.formData),n.$root.ResourceMailboxListConfig.NoResults=!1,n.updateResourceMailboxListDone=!0,u.SetSelectedItem(n.formData)},n.lockAlias=!1,n.UpdateResourceMailboxAlias=function(){n.hasActiveChange=!0,n.lockAlias?console.log("Should not update: resource mailbox alias is locked"):n.formData.ResourceMailboxDisplayName&&(n.formData.ResourceMailboxAlias=n.formData.ResourceMailboxDisplayName.replace(/ /g,'').toLowerCase())},n.LockAlias=function(){n.lockAlias=!0},n.RemoveValidation=function(){n.saveResourceMailboxError=f.GetvalidaitonValue(n.formData.ResourceMailboxAlias)},n.Cancel=function(){n.$emit('closeFlyout')},n.IsResourceMailboxCreated=function(){n.intervalCount--,n.intervalCount<=0?(n.showResourceMailboxform=!0,n.saveinprogress=!1,n.saveResourceMailboxError=!0,n.saveResourceMailboxErrorMessage="Timeout"):r.CheckResourceMailboxWasCreated(n.formData.ResourceMailboxAlias+"@"+n.formData.ResourceMailboxDomain).then(function(i){e(i.data)&&(t.cancel(n.timeoutpromise),n.formData.ResourceMailboxObjectId=i.data,n.formData.ResourceMailboxPrimarySmtpAddress=n.formData.ResourceMailboxAlias+"@"+n.formData.ResourceMailboxDomain,r.AddMorePropertyToNewResourceMailbox(n.formData).then(function(t){t.data.Status==0?(n.saveinprogress=!1,n.savefinished=!0,n.updateResourceMailboxListDone||n.updateResourceMailboxList()):(n.showResourceMailboxDetailsForm=!0,n.saveinprogress=!1,n.saveResourceMailboxError=!0,n.saveResourceMailboxErrorMessage=t.data.Message)},function(t){n.showResourceMailboxDetailsForm=!0,n.saveinprogress=!1,n.saveResourceMailboxError=!0,n.saveResourceMailboxErrorMessage=t.data.Message}))})},n.$on("$destroy",function(){t.cancel(n.timeoutpromise)}),o()}return n.$inject=["$scope","$interval","$timeout","ResourceMailboxService","PanelService","HelperService"],n}();n.app.controller("AddResourceMailboxController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){function o(){function i(t){var i=!1,r=!1;angular.forEach(t.data.GroupTypes,function(t){t.Selected&&(n.groupType=t,n.formData.GroupTypeDisplayName=t.DisplayText),t.Value=="UnifiedGroup"&&(i=!0),t.Value=="DistributionList"&&(r=!0),n.groupTypeList.push(t)}),i||r?i?r||$('#groupType').attr('id','groupType_NonDistributionListGroup'):$('#groupType').attr('id','groupType_NonUnifiedGroup'):$('#groupType').attr('id','groupType_NonDistributionListAndNonUnifiedGroup'),angular.forEach(n.groupTypeList,function(t){n.$root.GroupListConfig&&n.$root.GroupListConfig.groupTypeFilter&&n.$root.GroupListConfig.groupTypeFilter==t.Value&&(n.groupType=t,n.formData.GroupTypeDisplayName=t.DisplayText)}),n.selectedDomain=t.data.DefaultDomain.Name,n.groupType.Value=="UnifiedGroup"&&(n.selectedDomain=t.data.O365GroupDefaultDomain),angular.forEach(t.data.Domains,function(t){n.domainList.push(t.Name)}),n.formData.PrimaryOwner=t.data.PrimaryOwnerEmailAddress,angular.forEach(t.data.PrivacyOptions,function(t){t.Selected&&(n.selectedPrivacy=t),n.privacyList.push(t)}),angular.forEach(t.data.AvailableCultures,function(t){t.Selected&&(n.selectedLanguage=t),n.languageList.push(t)})}n.showgroupform=!0,n.saveinprogress=!1,n.savefinished=!1,n.saveGroupError=!1,n.showPicker=!1,n.Picker={Type:0,allItemsListTitle:'Users',placeholderText:'Search'},n.domainList=[],n.languageList=[],n.privacyList=[],n.groupTypeList=[],n.selectedLanguage=null,n.selectedPrivacy=null,n.formData.AutoSubscribeNewMembers=!0,n.formData.AllowOutsideSenders=!0,r.GetAddGroupDefaultOptions()?i(r.GetAddGroupDefaultOptions()):r.GetAddGroupDefaults().then(function(n){r.SetAddGroupDefaultOptions(n),i(r.GetAddGroupDefaultOptions())},function(){}),n.UpdateGroupType=function(t){n.groupType=t,n.formData.GroupTypeDisplayName=t.DisplayText,n.Picker.selectedItem=undefined,n.saveGroupError=!1},n.UpdateSelectedPrivacy=function(t){n.selectedPrivacy=t},n.UpdateSelectedLanguage=function(t){n.selectedLanguage=t},n.UpdateSelectedDomain=function(t){n.selectedDomain=t},n.ClosePicker=function(){n.showPicker=!0,n.saveGroupError=!1},n.$watch("Picker.selectedItem",function(){n.Picker.selectedItem&&(n.showPicker=!1)}),n.showCustomValidationMessage=function(t){return n.saveGroupError=!1,t.$invalid?(n.saveGroupError=!0,n.saveGroupErrorMessage='Please provide all required fields.'):angular.isDefined(n.validGroupAlias)&&n.validGroupAlias==="invalid"?(n.saveGroupError=!0,n.saveGroupErrorMessage='The email you entered is not available.'):n.groupType.Value==='UnifiedGroup'&&angular.isUndefined(n.Picker.selectedItem)&&(n.saveGroupError=!0,n.saveGroupErrorMessage='Please select a owner.'),n.saveGroupError},n.SaveGroup=function(i){if(!n.showCustomValidationMessage(i)){n.formData.title='Adding Group',n.showgroupform=!1,n.saveinprogress=!0,n.savefinished=!1,n.saveGroupError=!1;switch(n.groupType.Value){case'UnifiedGroup':if(!t.features.UseMSGraphForO365Groups&&!n.Picker.selectedItem.Item.HasExchange){var u='The selected owner does not have email license.';e(u);return}n.formData.GroupType=0,n.formData.Domain=n.selectedDomain,n.formData.Privacy=n.selectedPrivacy.Value,t.features.UseMSGraphForO365Groups||(n.formData.Language=n.selectedLanguage.Value,n.formData.AllowOutsideSenders=!1,n.formData.PrimaryOwner=n.Picker.selectedItem.Item.UserPrincipalName);break;case'SharePointSecurityGroup':n.formData.GroupType=1,n.formData.Domain=null;break;case'DistributionList':n.formData.GroupType=2,n.formData.Domain=n.selectedDomain;break;case'SecurityEnabledDistributionGroup':n.formData.GroupType=3,n.formData.Domain=n.selectedDomain}r.SaveGroup(n.formData).then(function(t){n.formData.title='Group was added',n.saveinprogress=!1,n.savefinished=!0,n.formData.GroupId=t.data.GroupId,n.formData.GroupSmtp=n.formData.GroupAlias+"@"+n.formData.Domain,n.saveGroupCreateMessage=t.data.Message,n.editExchangeSettingsUrl=t.data.EditExchangeSettingsUrl,n.formData.refreshListArgs={Action:"reload",SelectedItem:n.selecteditem}},function(t){n.formData.title='Failed to add group',e(t.data)})}}}var f,e;this.$scope=n,this.$rootScope=t,this.$timeout=i,this.GroupService=r,this.$stateParams=u,n.contentLoaded=!1,f=n.$on('$includeContentLoaded',function(){n.contentLoaded=!0}),e=function(t){n.showgroupform=!0,n.saveinprogress=!1,n.saveGroupError=!0,n.saveGroupErrorMessage=t},n.updateGroupList=function(){var t={GroupId:n.formData.GroupId,GroupType:n.formData.GroupType,GroupTypeDisplayName:n.groupType.DisplayText,GroupName:n.formData.GroupName,GroupAlias:n.formData.GroupAlias,GroupSmtp:null,Domain:n.formData.Domain,GroupDescription:n.formData.GroupDescription,AutoSubscribeNewMembers:null,Privacy:null,AllowOutsideSenders:null,Members:[],PrimaryOwners:[],AdditionalDataRetrieved:!0,GroupMembershipRetrieved:!0};switch(n.groupType.Value){case'UnifiedGroup':t.GroupSmtp=n.formData.GroupSmtp,t.AutoSubscribeNewMembers=n.formData.AutoSubscribeNewMembers,t.AllowOutsideSenders=n.formData.AllowOutsideSenders,t.Privacy=n.formData.Privacy,t.PrimaryOwners.push(n.Picker.selectedItem),t.Members.push(n.Picker.selectedItem);break;case'DistributionList':case'SecurityEnabledDistributionGroup':t.GroupSmtp=n.formData.GroupSmtp,t.GroupAlias=n.formData.GroupAlias,t.AllowOutsideSenders=n.formData.AllowOutsideSenders}n.formData=t,n.$root.GroupsData.unshift(n.formData),n.$root.GroupListConfig.NoResults=!1},n.lockAlias=!1,n.UpdateGroupAlias=function(){n.lockAlias?console.log("Should not update: group alias is locked"):n.formData.GroupName&&(n.formData.GroupAlias=n.formData.GroupName.replace(/ /g,'').toLowerCase())},n.DisplayMembershipChainingContent=function(){return n.groupType.Value=="UnifiedGroup"&&!t.features.UseAADGraphForO365GroupsMembership},n.ValidateAlias=function(t){if(n.saveGroupError=!1,n.UpdateGroupAlias(),n.groupType.Value!="SharePointSecurityGroup"){if(t=="GroupName"&&n.lockAlias){console.log("Should not validate after changing GroupName: group alias is locked");return}if(n.formData.GroupName&&n.formData.GroupAlias)switch(n.groupType.Value){case'UnifiedGroup':n.ValidateAliasByGroupType(0);break;case'DistributionList':n.ValidateAliasByGroupType(2);break;case'SecurityEnabledDistributionGroup':n.ValidateAliasByGroupType(3)}}},n.LockAlias=function(){console.log('Lock alias'),n.lockAlias=!0},n.ValidateAliasByGroupType=function(t){var i=n.formData.GroupAlias;console.log("New alias. Need to validate: "+i),n.validGroupAlias="undefined",r.ValidateGroupAlias(i,t).then(function(t){t.data=="true"?(console.log(">>> Groups alias is available: "+i),n.validGroupAlias="valid"):(console.log(">>> Group alias already taken: "+i),n.validGroupAlias="invalid")},function(n){console.log("Error validating group alias: "+n)})},n.GetGroupDisplayName=function(n){return n},n.initCallbackPanel=function(t){n.panel=t},n.Close=function(){n.Cancel()},n.$on('$destroy',function(){f&&(f(),f=null)}),n.Cancel=function(){n.$emit('closeFlyout'),n.$destroy()},o()}return n.$inject=["$scope","$rootScope","$timeout","GroupService","$stateParams"],n}();n.AddGroupController=t,n.app.controller("AddGroupController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function r(){}this.$scope=n,this.$rootScope=t,this.GroupService=i,n.showgroupform=!0,n.saveinprogress=!1,n.savefinished=!1,n.deleteGroupError=!1,n.DeleteGroups=function(){n.showgroupform=!1,n.saveinprogress=!0,n.savefinished=!1,i.DeleteGroups(n.selecteditem).then(function(t){t.data[n.selecteditem.GroupId].Status==0?(n.saveinprogress=!1,n.savefinished=!0,n.$root.refreshList=!0,n.deleteGroupSuccessMessage=t.data[n.selecteditem.GroupId].Message?t.data[n.selecteditem.GroupId].Message:'Group deleted.',n.$emit('closePanel')):(n.showgroupform=!0,n.saveinprogress=!1,n.deleteGroupError=!0,n.deleteGroupStatusMessage=t.data[n.selecteditem.GroupId].Message?t.data[n.selecteditem.GroupId].Message:'Group can\x27t be deleted.')},function(t){n.showgroupform=!0,n.saveinprogress=!1,n.deleteGroupError=!0,n.deleteGroupStatusMessage=t.data})},n.Cancel=function(){n.$emit('closeFlyout')},n.Close=function(){n.formData.refreshListArgs={Action:"delete",SelectedItem:n.selecteditem},n.$emit('closeFlyout')},r()}return n.$inject=["$scope","$rootScope","GroupService"],n}();n.DeleteGroupController=t,n.app.controller("DeleteGroupController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){function f(){n.showgroupform=!0,n.saveinprogress=!1,n.savefinished=!1,n.isGroupEdit=!0,n.saveGroupError=!1,n.checkingAlias=null,n.domainList=[],n.languageList=[],n.privacyList=[],n.formData.GroupId=n.selecteditem.GroupId,n.formData.GroupName=n.selecteditem.GroupName,n.formData.GroupDescription=n.selecteditem.GroupDescription,n.formData.GroupType=n.selecteditem.GroupType.toString(),i.GetAddGroupDefaults().then(function(t){switch(n.formData.GroupType){case'0':n.groupType="O365Group",n.formData.GroupAlias=n.selecteditem.GroupAlias,n.formData.AutoSubscribeNewMembers=n.selecteditem.AutoSubscribeNewMembers,n.formData.AllowOutsideSenders=n.selecteditem.AllowOutsideSenders,n.formData.Privacy=n.selecteditem.Privacy,n.UpdatePrivacy(t.data.PrivacyOptions),angular.forEach(t.data.Domains,function(t){n.domainList.push(t.Name)}),n.selectedDomain=t.data.O365GroupDefaultDomain,angular.forEach(t.data.AvailableCultures,function(t){n.selecteditem.Language==t.Value&&(n.selectedLanguage=t),n.languageList.push(t)});break;case'1':n.groupType="SecurityGroup";break;case'2':case'3':n.groupType=n.formData.GroupType=='2'?"DistributionGroup":"MailEnabledSecurityGroup",n.formData.GroupAlias=n.selecteditem.GroupAlias,angular.forEach(t.data.Domains,function(t){n.domainList.push(t.Name)}),n.selectedDomain=t.data.DefaultDomain.Name,n.formData.AllowOutsideSenders=n.selecteditem.AllowOutsideSenders,n.formData.GroupDescription=n.selecteditem.GroupDescription}},function(){}),n.UpdatePrivacy=function(t){angular.forEach(t,function(t){n.selecteditem.Privacy==t.Value&&(n.selectedPrivacy=t),n.privacyList.push(t)})},n.UpdateSelectedLanguage=function(t){n.selectedLanguage=t},n.UpdateSelectedPrivacy=function(t){n.selectedPrivacy=t},n.UpdateSelectedDomain=function(t){n.selectedDomain=t},n.ValidateAlias=function(t){if(t!="GroupName"&&(n.saveGroupError=!1,n.formData.GroupName&&n.formData.GroupAlias))switch(n.groupType){case'DistributionGroup':n.ValidateAliasByGroupType(2);break;case'MailEnabledSecurityGroup':n.ValidateAliasByGroupType(3)}},n.LockAlias=function(){n.isGroupEdit&&(n.lockAlias=!0)},n.ValidateAliasByGroupType=function(t){var r=n.formData.GroupAlias;n.validGroupAlias="undefined",i.ValidateGroupAlias(r,t).then(function(t){n.validGroupAlias=t.data=="true"?"valid":"invalid"},function(){})},n.SaveGroup=function(){n.showgroupform=!1,n.saveinprogress=!0,n.savefinished=!1,n.saveGroupError=!1;switch(n.groupType){case'O365Group':n.formData.GroupType=0,n.formData.Domain=n.selectedDomain,n.formData.Privacy=n.selectedPrivacy.Value,n.formData.GroupSmtp=n.selecteditem.GroupSmtp;break;case'SecurityGroup':n.formData.GroupType=1;break;case'DistributionGroup':case'MailEnabledSecurityGroup':n.formData.GroupType=n.groupType=='DistributionGroup'?2:3,n.formData.Domain=n.selectedDomain,n.formData.GroupSmtp=n.selecteditem.GroupSmtp}i.UpdateGroup(n.formData).then(function(t){t.data.Status==0?(n.saveinprogress=!1,n.savefinished=!0,n.showCloseButton=!0,n.editExchangeSettingsUrl=n.selecteditem.EditExchangeSettingsUrl,n.updateGroupList()):(n.showgroupform=!0,n.saveinprogress=!1,n.saveGroupError=!0,n.saveGroupErrorMessage=t.data.Message)},function(t){n.showgroupform=!0,n.saveinprogress=!1,n.saveGroupError=!0,n.saveGroupErrorMessage=t.data})},n.updateGroupList=function(){if(n.groupType!='DistributionGroup'&&n.groupType!='MailEnabledSecurityGroup'){var i=n.getIndex(n.selecteditem,n.$root.GroupsData),t={};t=i!=-1?n.$root.GroupsData[i]:n.selecteditem,t.GroupName=n.formData.GroupName,n.selecteditem.GroupName=n.formData.GroupName,t.GroupDescription=n.formData.GroupDescription,n.selecteditem.GroupDescription=n.formData.GroupDescription;switch(n.groupType){case'O365Group':t.AutoSubscribeNewMembers=n.formData.AutoSubscribeNewMembers,t.AllowOutsideSenders=n.formData.AllowOutsideSenders,n.selecteditem.AutoSubscribeNewMembers=n.formData.AutoSubscribeNewMembers,n.selecteditem.AllowOutsideSenders=n.formData.AllowOutsideSenders;break;case'DistributionGroup':case'MailEnabledSecurityGroup':t.GroupAlias=n.formData.GroupAlias,n.selecteditem.GroupAlias=n.formData.GroupAlias,t.GroupSmtp=n.formData.GroupAlias+"@"+n.formData.Domain,n.selecteditem.GroupSmtp=n.formData.GroupAlias+"@"+n.formData.Domain,t.AllowOutsideSenders=n.formData.AllowOutsideSenders,n.selecteditem.AllowOutsideSenders=n.formData.AllowOutsideSenders}n.formData=t,n.selecteditem.doNotMakeAGetCall=!0,r.SetSelectedItem(n.selecteditem)}},n.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.GroupId==t[i].GroupId)return i;return-1},n.updateGroupListForO365GroupDetails=function(){var i=n.getIndex(n.selecteditem,n.$root.GroupsData),t;i!=-1&&(t=n.$root.GroupsData[i],t.AutoSubscribeNewMembers=n.selecteditem.AutoSubscribeNewMembers,t.AllowOutsideSenders=n.selecteditem.AllowOutsideSenders,t.Privacy=n.selecteditem.Privacy,t.AdditionalDataRetrieved=!0)},n.getIndex=function(n,t){if(t!=null)for(var i=0,r=t.length;i<r;i++)if(n.GroupId==t[i].GroupId)return i;return-1}}this.$scope=n,this.$timeout=t,this.GroupService=i,this.PanelService=r,n.contentLoaded=!1;var u=n.$on('$includeContentLoaded',function(){n.contentLoaded=!0});n.$on('$destroy',function(){u&&(u(),u=null)}),n.Close=function(){n.Cancel()},n.Cancel=function(){n.$emit('closeFlyout'),n.$destroy()},f()}return n.$inject=["$scope","$timeout","GroupService","PanelService"],n}();n.app.controller("EditGroupController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f,e,o){this.$scope=n,this.GroupService=t,this.PanelService=i,this.PhotoService=r,this.$filter=u,this.ProfileService=f,this.$rootScope=e,this.HelperService=o,n.init=function(t){var r,i;n.GroupMemberModel={},n.Members=[],n.isOwner=t,n.addingFirstOwner=!1,n.GroupMemberModel.showAddMembers=!1,n.GroupMemberModel.showRemoveMembers=!1,n.GroupMemberModel.showViewMembers=!0,n.GroupManagementStatus=n.selecteditem.GroupModel.GroupManagementStatus,n.Picker={Type:2,allItemsListTitle:'Group owners',inputLabel:'Search owners',placeholderText:'Search'},r={GroupId:n.selecteditem.GroupId,GroupDomain:n.selecteditem.Domain,GroupSmtp:n.selecteditem.GroupSmtp,GroupType:n.selecteditem.GroupType,IsOwner:n.isOwner,CheckOwners:n.isOwner},t?(i=[{SearchCategory:0,Filter:{Membership:2,CheckMembershipDetails:r}}],n.Picker.SearchCategories=i):(n.Picker.allItemsListTitle='Group members',n.Picker.inputLabel='Search members',i=[{SearchCategory:0,Filter:{Membership:1,CheckMembershipDetails:r}}],n.Picker.SearchCategories=i),n.showform=!0,n.saveinprogress=!1,n.savefinished=!1,n.saveMembersError=!1},n.Cancel=function(){n.$emit('closeFlyout')};var h=function(t){var r;t.data.Status==0||t.data.Status==4?(n.saveinprogress=!1,n.savefinished=!0,t.data.Status==0&&(n.isOwner?(o.IsValid(n.AddPicker)&&o.IsValid(n.AddPicker.selectedItems)&&(r=n.extendAddedMembers(n.selecteditem.PrimaryOwners.concat(n.AddPicker.selectedItems)),n.selecteditem.PrimaryOwners=r),o.IsValid(n.RemovePicker)&&o.IsValid(n.RemovePicker.selectedItems)&&n.deleteRemovedMembers(n.selecteditem.PrimaryOwners,n.RemovePicker.selectedItems)):(o.IsValid(n.AddPicker)&&o.IsValid(n.AddPicker.selectedItems)&&(r=n.extendAddedMembers(n.selecteditem.Members.concat(n.AddPicker.selectedItems)),n.selecteditem.Members=r),o.IsValid(n.RemovePicker)&&o.IsValid(n.RemovePicker.selectedItems)&&n.deleteRemovedMembers(n.selecteditem.Members,n.RemovePicker.selectedItems))),t.data.Status==4&&(n.warningErrorMessage=t.data.Message,n.failedMembers=[],angular.forEach(t.data.FailedMembers,function(t){n.failedMembers.push(t)})),n.selecteditem.doNotMakeAGetCall=!0,n.selecteditem.GroupManagementStatus=n.GroupManagementStatus,i.SetSelectedItem(n.selecteditem),n.Picker.RefreshList()):s(t.data.Message)},c=function(n){s(n.data)},s=function(t){n.showform=!0,n.saveinprogress=!1,n.saveMembersError=!0,n.saveMembersErrorMessage=t};n.OpenRemoveMembers=function(){n.RemovePicker={Type:1,action:1,existingItems:n.Picker.allItems,allItemsListTitle:n.Picker.allItemsListTitle,inputLabel:n.isOwner?'Search owners to remove':'Search members to remove',placeholderText:n.Picker.placeholderText,SearchCategories:n.Picker.SearchCategories},n.GroupMemberModel.showViewMembers=!1,n.GroupMemberModel.showAddMembers=!1,n.GroupMemberModel.showRemoveMembers=!0},n.OpenAddMembers=function(){n.AddPicker={Type:1,action:0,originalItems:n.Picker.allItems,allItemsListTitle:'All',inputLabel:n.isOwner?'Search to add owners':'Search to add members',placeholderText:n.Picker.placeholderText};var t=[],i={GroupId:n.selecteditem.GroupId,GroupDomain:n.selecteditem.Domain,GroupSmtp:n.selecteditem.GroupSmtp,GroupType:n.selecteditem.GroupType,IsOwner:n.isOwner,CheckOwners:n.isOwner};n.isOwner?n.selecteditem.GroupType==2||n.selecteditem.GroupType==3?t.push({SearchCategory:5,Filter:{CheckMembership:1,CheckMembershipDetails:i}}):n.selecteditem.GroupType==0&&t.push({SearchCategory:5,Filter:{CheckMembership:1,CheckMembershipDetails:i}}):n.selecteditem.GroupType==2||n.selecteditem.GroupType==3||n.selecteditem.GroupType==0?t.push({SearchCategory:5,Filter:{CheckMembership:1,CheckMembershipDetails:i}}):n.selecteditem.GroupType==1&&(t.push({SearchCategory:0,Filter:{CheckMembership:1,CheckMembershipDetails:i}}),t.push({SearchCategory:1,Filter:{GroupTypes:[2,3,1],CheckMembership:1,CheckMembershipDetails:i}})),n.AddPicker.SearchCategories=t,n.GroupMemberModel.showViewMembers=!1,n.GroupMemberModel.showRemoveMembers=!1,n.GroupMemberModel.showAddMembers=!0},n.CloseSummary=function(){n.GroupMemberModel.showRemoveMembers=!1,n.GroupMemberModel.showAddMembers=!1,n.savefinished=!1,n.GroupMemberModel.showViewMembers=!0,n.showform=!0,angular.element('#flyoutClose').focus()},n.CancelMembershipEdit=function(){n.GroupMemberModel.showAddMembers=!1,n.GroupMemberModel.showRemoveMembers=!1,n.GroupMemberModel.showViewMembers=!0,n.saveMembersError=!1},n.SaveDisabled=function(t){return t.selectedItems==null||t.selectedItems.length===0||n.isOwner&&n.RemovePicker&&n.RemovePicker.allItems.length===0},n.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.GroupId==t[i].GroupId)return i;return-1},n.extendAddedMembers=function(n){for(var t=n.concat(),r,i=0;i<t.length;++i)for(r=i+1;r<t.length;++r)t[i].ObjectId===t[r].ObjectId&&t.splice(r--,1);return t},n.deleteRemovedMembers=function(n,t){if(t)for(var i=n.length-1;i>=0;i-=1)angular.forEach(t,function(t){n[i].ObjectId===t.ObjectId&&n.splice(i,1)})},n.SaveGroup=function(i,r){var u,f;if(n.SaveDisabled(r)){n.saveMembersError=!0,n.saveMembersErrorMessage='Please select a user.';return}n.showform=!1,n.saveinprogress=!0,n.savefinished=!1,n.saveGroupError=!1,n.saveMembersError=!1,n.saveMembersErrorMessage="",n.warningErrorMessage="",u={ObjectId:n.selecteditem.GroupId,GroupType:n.selecteditem.GroupType,SmtpAddress:n.selecteditem.GroupSmtp,MembersToAdd:null,MembersToRemove:null},n.invalidMembers=[],u.GroupType==0&&angular.forEach(u.MembersToRemove,function(t){t.EmailAddress||n.invalidMembers.push(t)}),i?u.MembersToAdd=n.AddPicker.GetSelectedItems():u.MembersToRemove=n.RemovePicker.GetSelectedItems(),n.invalidMembers.length>0&&(f='One or more members can\x27t be added to this group since they do not have primary email address assigned to them.',s(f)),n.isOwner?t.UpdateGroupOwners(u).then(h,c):t.UpdateGroupMembers(u).then(h,c)}}return n.$inject=["$scope","GroupService","PanelService","PhotoService","$filter","ProfileService","$rootScope","HelperService"],n}();n.app.controller("EditGroupMembersController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f,e){this.$scope=n,this.GroupService=t,this.PanelService=i,this.PhotoService=r,this.$filter=u,this.ProfileService=f,this.$rootScope=e,n.init=function(i){n.Members=[],n.isOwner=i,n.addingFirstOwner=!1,n.isOwner?(n.selecteditem.PrimaryOwners===undefined||n.selecteditem.PrimaryOwners==null?t.GetGroupOwners(n.selecteditem.GroupType,n.selecteditem.GroupId,n.selecteditem.GroupSmtp,null,null).then(function(t){n.selecteditem.PrimaryOwners=t.data.Owners,angular.forEach(n.selecteditem.PrimaryOwners,function(t){n.Members.push(t)})}):angular.forEach(n.selecteditem.PrimaryOwners,function(t){n.Members.push(t)}),n.addingFirstOwner=n.Members.length==0):n.selecteditem.Members===undefined||n.selecteditem.Members==null?t.GetGroupMembers(n.selecteditem.GroupType,n.selecteditem.GroupId,n.selecteditem.GroupSmtp,null,null).then(function(t){t.data&&(n.selecteditem.Members=t.data.Members,angular.forEach(n.selecteditem.Members,function(t){n.Members.push(t)}))}):angular.forEach(n.selecteditem.Members,function(t){n.Members.push(t)}),n.Members=u('orderBy')(n.Members,'DisplayName'),n.GetMembersPhotos(),n.Picker={Type:1,existingItems:n.Members,allItemsListTitle:'Group owners',inputLabel:'Search to add or remove owners'};var f={GroupId:n.selecteditem.GroupId,GroupDomain:n.selecteditem.Domain,GroupSmtp:n.selecteditem.GroupSmtp,GroupType:n.selecteditem.GroupType,IsOwner:n.isOwner,CheckOwners:n.isOwner},r=[];i?n.selecteditem.GroupType==2||n.selecteditem.GroupType==3?r.push({SearchCategory:5,Filter:{MaxResults:10,CheckMembership:1,CheckMembershipDetails:f}}):n.selecteditem.GroupType==0&&r.push({SearchCategory:5,Filter:{MaxResults:10,CheckMembership:1,CheckMembershipDetails:f}}):(n.Picker.allItemsListTitle='Group members',n.Picker.inputLabel='Search to add or remove members',n.selecteditem.GroupType==2||n.selecteditem.GroupType==3||n.selecteditem.GroupType==0?r.push({SearchCategory:5,Filter:{MaxResults:10,CheckMembership:1,CheckMembershipDetails:f}}):n.selecteditem.GroupType==1&&(r.push({SearchCategory:0,Filter:{CheckMembership:1,CheckMembershipDetails:f}}),r.push({SearchCategory:1,Filter:{MaxResults:10,GroupTypes:[2,3,1],CheckMembership:1,CheckMembershipDetails:f}}))),n.Picker.SearchCategories=r,n.showform=!0,n.saveinprogress=!1,n.savefinished=!1,n.saveMembersError=!1},n.Cancel=function(){n.$emit('closeFlyout')};var s=function(t){t.data.Status==0||t.data.Status==4?(n.saveinprogress=!1,n.savefinished=!0,t.data.Status==0&&(n.isOwner?n.selecteditem.PrimaryOwners=n.Picker.selectedItems:n.selecteditem.Members=n.Picker.selectedItems),t.data.Status==4&&(n.warningErrorMessage=t.data.Message,n.failedMembers=[],angular.forEach(t.data.FailedMembers,function(t){n.failedMembers.push(t)})),n.selecteditem.doNotMakeAGetCall=!0,i.SetSelectedItem(n.selecteditem)):o(t.data.Message)},h=function(n){o(n.data)},o=function(t){n.showform=!0,n.saveinprogress=!1,n.saveMembersError=!0,n.saveMembersErrorMessage=t,n.Picker.selectedItems=n.Picker.existingItems,n.Picker.removedItems=[],n.Picker.addedItems=[]};n.SaveDisabled=function(){return n.Picker.addedItems==null||n.Picker.addedItems.length==0&&n.Picker.removedItems.length==0||n.isOwner&&n.Picker.selectedItems.length<=0},n.SaveGroup=function(){var i,r;n.showform=!1,n.saveinprogress=!0,n.savefinished=!1,n.saveGroupError=!1,n.saveMembersError=!1,n.saveMembersErrorMessage="",n.warningErrorMessage="",i={ObjectId:n.selecteditem.GroupId,GroupType:n.selecteditem.GroupType,SmtpAddress:n.selecteditem.GroupSmtp,MembersToAdd:n.Picker.addedItems,MembersToRemove:n.Picker.removedItems},n.invalidMembersToAdd=[],n.invalidMembersToRemove=[],i.GroupType!=1&&i.GroupType!=0&&angular.forEach(i.MembersToAdd,function(t){t.EmailAddress||n.invalidMembersToAdd.push(t)}),i.GroupType==0&&angular.forEach(i.MembersToRemove,function(t){t.EmailAddress||n.invalidMembersToRemove.push(t)}),n.invalidMembersToAdd.length>0?(r='One or more members can\x27t be added to this group since they do not have primary email address assigned to them.',o(r)):n.invalidMembersToRemove.length>0?(r='One or more members can\x27t be removed from this group since they do not have primay email address assigned to them.',o(r)):n.isOwner?t.UpdateGroupOwners(i).then(s,h):t.UpdateGroupMembers(i).then(s,h)},n.IsValid=function(n){return!angular.isDefined(n)||n==null||n==""?!1:!0},n.GetMembersPhotos=function(){n.$root.features&&n.$root.features.ShowUserPhoto&&n.Members&&angular.forEach(n.Members,function(t,i){var u,f;t.MemberType=="User"?(u=t.EmailAddress,f=0):t.MemberType=="Group"&&(u=t.EmailAddress,f=1),r.GetPhoto(u,f).then(function(t){t&&u==t.Identity&&n.IsValid(t.PhotoContent)&&(n.Members[i].PhotoContent=t.PhotoContent)})})},n.GetProfileImageColor=function(n){return f.GetProfileImageColor(n)},n.GetInitials=function(n){return f.GetUserInitials(n)}}return n.$inject=["$scope","GroupService","PanelService","PhotoService","$filter","ProfileService","$rootScope"],n}();n.app.controller("EditGroupMembersV1Controller",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t,i;(function(n){n[n.FullAccess=0]="FullAccess",n[n.SendAs=1]="SendAs",n[n.SendOnBehalf=2]="SendOnBehalf"})(t||(t={})),i=function(){function n(n,t,i,r){var u,f;this.$scope=n,this.UserManagementService=t,this.PanelService=i,this.PhotoService=r,n.init=function(){n.MailboxFullAccessMembers=[],n.MailboxSendAsMembers=[],n.MailboxSendOnBehalfMembers=[],n.selecteditem.MailboxFullAccessMembers===undefined||n.selecteditem.MailboxFullAccessMembers==null||angular.forEach(n.selecteditem.MailboxFullAccessMembers,function(t){n.MailboxFullAccessMembers.push(t)}),n.selecteditem.MailboxSendAsMembers===undefined||n.selecteditem.MailboxSendAsMembers==null||angular.forEach(n.selecteditem.MailboxSendAsMembers,function(t){n.MailboxSendAsMembers.push(t)}),n.selecteditem.MailboxSendOnBehalfMembers===undefined||n.selecteditem.MailboxSendOnBehalfMembers==null||angular.forEach(n.selecteditem.MailboxSendOnBehalfMembers,function(t){n.MailboxSendOnBehalfMembers.push(t)}),n.GetDelegateMemberPhotos(0),n.FullAccessPicker={clientId:"EditUserFullAccessPermission",Type:1,existingItems:n.MailboxFullAccessMembers,placeholderText:'Search by display name or email address',SearchCategories:[{SearchCategory:0,Filter:{MaxResults:-1,CheckMembership:4,CheckMembershipDetails:{MailboxId:n.selecteditem.ObjectId}}}]},n.GetDelegateMemberPhotos(1),n.SendAsPicker={clientId:"EditUserSendAsPermission",Type:1,existingItems:n.MailboxSendAsMembers,placeholderText:'Search by display name or email address',SearchCategories:[{SearchCategory:0,Filter:{MaxResults:-1,CheckMembership:4,CheckMembershipDetails:{MailboxId:n.selecteditem.ObjectId}}}]},n.GetDelegateMemberPhotos(2),n.SendOnBehalfPicker={clientId:"EditUserSendOnBehalfToPermission",Type:1,existingItems:n.MailboxSendOnBehalfMembers,placeholderText:'Search by display name or email address',SearchCategories:[{SearchCategory:0,Filter:{MaxResults:-1,CheckMembership:5,CheckMembershipDetails:{MailboxId:n.selecteditem.ObjectId}}}]},n.showform=!0,n.saveinprogress=!1,n.savefinished=!1,n.saveMembersError=!1},n.Cancel=function(){n.$emit('closeFlyout')},n.Close=function(){n.$emit('closeFlyout')},u=function(t){t.data.Status==0?(n.$emit('showWaitingIndicator',!1),n.savefinished=!0,n.showSummary=!0,n.updateMailboxMembership()):(n.$emit('showWaitingIndicator',!1),n.showform=!0,n.saveinprogress=!1,n.saveMembersError=!0,n.saveMembersErrorMessage=t.data.Code)},n.updateMailboxMembership=function(){var t=n.getIndex(n.selecteditem,n.$root.ActiveUserData.ListModel);t!=-1&&(n.$root.ActiveUserData.SelectedUserDetails.MailboxFullAccessMembers=n.FullAccessPicker.selectedItems,n.$root.ActiveUserData.SelectedUserDetails.MailboxSendAsMembers=n.SendAsPicker.selectedItems,n.$root.ActiveUserData.SelectedUserDetails.MailboxSendOnBehalfMembers=n.SendOnBehalfPicker.selectedItems),n.$root.ActiveUserData.SelectedUserDetails.MailboxMembershipRetrieved=!0,i.SetSelectedItem(n.$root.ActiveUserData.SelectedUserDetails)},n.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.ObjectId!=t[i].ObjectId)return i;return-1},f=function(t){n.$emit('showWaitingIndicator',!1),n.showform=!0,n.saveinprogress=!1,n.saveMembersError=!0,n.saveMembersErrorMessage=t.data.Code},n.SaveDisabled=function(){var t=n.FullAccessPicker.addedItems==null||n.FullAccessPicker.addedItems.length==0&&n.FullAccessPicker.removedItems.length==0,i=n.SendAsPicker.addedItems==null||n.SendAsPicker.addedItems.length==0&&n.SendAsPicker.removedItems.length==0,r=n.SendOnBehalfPicker.addedItems==null||n.SendOnBehalfPicker.addedItems.length==0&&n.SendOnBehalfPicker.removedItems.length==0;return t&&i&&r},n.SaveMailboxPermission=function(){n.$emit('showWaitingIndicator',!0),n.showform=!1,n.saveinprogress=!0,n.savefinished=!1,n.saveMailboxError=!1;var i={ObjectId:n.selecteditem.ObjectId,FullAccessMembersToAdd:n.FullAccessPicker.addedItems,FullAccessMembersToRemove:n.FullAccessPicker.removedItems,SendAsMembersToAdd:n.SendAsPicker.addedItems,SendAsMembersToRemove:n.SendAsPicker.removedItems,SendOnBehalfMembersToAdd:n.SendOnBehalfPicker.addedItems,SendOnBehalfMembersToRemove:n.SendOnBehalfPicker.removedItems};t.UpdateMailboxMembers(n.selecteditem.ObjectId,i).then(u,f)},n.IsValid=function(n){return!angular.isDefined(n)||n==null||n==""?!1:!0},n.GetDelegateMemberPhotos=function(t){if(n.$root.features&&n.$root.features.ShowUserPhoto)switch(t){case 0:n.GetMemberPhotos(n.MailboxFullAccessMembers);break;case 1:n.GetMemberPhotos(n.MailboxSendAsMembers);break;case 2:n.GetMemberPhotos(n.MailboxSendOnBehalfMembers)}},n.GetMemberPhotos=function(t){t&&angular.forEach(t,function(i,u){r.GetPhoto(i.PrimarySmtpAddress,0).then(function(r){r&&i.PrimarySmtpAddress==r.Identity&&n.IsValid(r.PhotoContent)&&(t[u].PhotoContent=r.PhotoContent)})})}}return n.$inject=["$scope","UserManagementService","PanelService","PhotoService"],n}(),n.app.controller("EditMailboxMembersController",i)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(t,i,r){function e(){t.MailboxMailForwardingConfig=n.prototype.GetForwardingConfig(),t.MailboxForwardingAddressResolved=null,t.formData.ObjectId=t.selecteditem.ObjectId,t.formData.MailboxForwardingAddressToDisplay=null,t.formData.MailboxForwardingAddress=t.selecteditem.MailboxForwardingAddress,t.formData.MailboxForwardingSmtpAddress=t.selecteditem.MailboxForwardingSmtpAddress,t.formData.MailboxDeliverToMailboxAndForward=t.selecteditem.MailboxDeliverToMailboxAndForward,t.formData.MailboxForwardingEnabled=t.selecteditem.MailboxForwardingEnabled,u(t.selecteditem.MailboxForwardingSmtpAddress)?(t.formData.MailboxForwardingAddressToDisplay=t.selecteditem.MailboxForwardingSmtpAddress,u(t.selecteditem.MailboxForwardingAddress)&&i.GetResolvedForwardAddress(t.selecteditem).then(function(n){u(n.data)?(t.MailboxForwardingAddressResolved=n.data,t.MailboxMailForwardingConfig.TwoEmailForwardingMessage='\x3cp\x3eThis mailbox has two types of email forwarding turned on\x3c\x2fp\x3e\x3cp\x3eTo continue, remove the forwarding address below.\x3c\x2fp\x3e\x3cp\x3eTo forward email to multiple addresses, go to \x3ca href\x3d\x22http\x3a\x2f\x2fgo.microsoft.com\x2ffwlink\x2fp\x2f\x3fLinkId\x3d784998\x22 target\x3d\x27_blank\x27\x3etransport rules\x3c\x2fa\x3e.\x3c\x2fp\x3e '):t.MailboxForwardingAddressResolved=null})):u(t.selecteditem.MailboxForwardingAddress)&&i.GetResolvedForwardAddress(t.selecteditem).then(function(n){u(n.data)?(t.formData.MailboxForwardingAddressToDisplay=n.data,t.MailboxMailForwardingConfig.convertEmailForwardingMessage='\x3cp\x3eThe email in this mailbox is already being forwarded. When you click Save, the forwarding format will change and the mailbox owner will be able to see and edit the forwarding settings.\x3c\x2fp\x3e\x3cp\x3eTo forward email without the mailbox owner\x27s knowledge, go to \x3ca href\x3d\x22http\x3a\x2f\x2fgo.microsoft.com\x2ffwlink\x2fp\x2f\x3fLinkId\x3d784998\x22 target\x3d\x27_blank\x27\x3etransport rules\x3c\x2fa\x3e.\x3c\x2fp\x3e '):t.MailboxForwardingAddressResolved=null}),t.RemoveConflictingFowardAddress=function(){t.MailboxForwardingAddressResolved=null,t.selecteditem.MailboxForwardingAddress=null,t.MailboxMailForwardingConfig.TwoEmailForwardingMessage=null},angular.isDefined(t.setSaveCancelButtonsPosition)&&t.setSaveCancelButtonsPosition(),t.SetDeliverToMailboxAndForwardOn=function(){t.formData.MailboxForwardingEnabled&&(t.formData.MailboxDeliverToMailboxAndForward=!0)},t.SaveMailbox=function(){t.MailboxMailForwardingConfig.showMailboxform=!1,t.MailboxMailForwardingConfig.saveinprogress=!0,t.MailboxMailForwardingConfig.savefinished=!1,t.MailboxMailForwardingConfig.saveMailboxError=!1,t.formData.ObjectId=t.selecteditem.ObjectId,t.formData.MailboxFowardingAddress=null,t.formData.MailboxForwardingEnabled?(t.formData.MailboxForwardingSmtpAddress=t.formData.MailboxForwardingAddressToDisplay,t.formData.MailboxDeliverToMailboxAndForward=t.formData.MailboxDeliverToMailboxAndForward):(t.formData.MailboxForwardingSmtpAddress=null,t.formData.MailboxDeliverToMailboxAndForward=!1),i.UpdateMailboxMailForwarding(t.selecteditem.ObjectId,t.formData).then(function(n){n.data.Status==0?(t.MailboxMailForwardingConfig.saveinprogress=!1,t.MailboxMailForwardingConfig.savefinished=!0,t.MailboxMailForwardingConfig.showCloseButton=!0,t.updateMailboxForwarding()):(t.MailboxMailForwardingConfig.showMailboxform=!0,t.MailboxMailForwardingConfig.saveinprogress=!1,t.MailboxMailForwardingConfig.saveMailboxError=!0,t.MailboxMailForwardingConfig.saveMailboxErrorMessage=n.data.Message)},function(n){t.MailboxMailForwardingConfig.showMailboxform=!0,t.MailboxMailForwardingConfig.saveinprogress=!1,t.MailboxMailForwardingConfig.saveMailboxError=!0,t.MailboxMailForwardingConfig.saveMailboxErrorMessage=n.data.Message})},t.updateMailboxForwarding=function(){var n=t.getIndex(t.selecteditem,t.$root.ActiveUserData.ListModel);n!=-1&&(t.$root.ActiveUserData.SelectedUserDetails.MailboxDeliverToMailboxAndForward=t.formData.MailboxDeliverToMailboxAndForward,t.$root.ActiveUserData.SelectedUserDetails.MailboxForwardingSmtpAddress=t.formData.MailboxForwardingSmtpAddress,t.$root.ActiveUserData.SelectedUserDetails.MailboxForwardingAddress=null,t.$root.ActiveUserData.SelectedUserDetails.MailboxForwardingEnabled=t.formData.MailboxForwardingEnabled),t.$root.ActiveUserData.SelectedUserDetails.MailboxInfoUpdated=!0,r.SetSelectedItem(t.$root.ActiveUserData.SelectedUserDetails)},t.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.ObjectId==t[i].ObjectId)return i;return-1}}var f,u;this.$scope=t,this.UserManagementService=i,this.PanelService=r,t.contentLoaded=!1,f=t.$on('$includeContentLoaded',function(){t.contentLoaded=!0}),t.$on('$destroy',function(){f&&(f(),f=null)}),t.Cancel=function(){t.$emit('closeFlyout'),t.$destroy()},t.SaveDisabled=function(){var n=!1;return t.formData.MailboxForwardingEnabled&&t.MailboxMailForwardingConfig.TwoEmailForwardingMessage!=null&&(n=!0),n},u=function(n){return!(n===null||n===""||n===" "||n===undefined)},e()}return n.prototype.GetForwardingConfig=function(){return{showMailboxform:!0,saveinprogress:!1,savefinished:!1,isMailboxEdit:!0,saveMailboxError:!1,saveMailboxErrorMessage:null,convertEmailForwardingMessage:null,TwoEmailForwardingMessage:null}},n.$inject=["$scope","UserManagementService","PanelService"],n}();n.app.controller("EditMailboxForwardingController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(t,i,r){function f(){t.MailboxConnectivityConfig=n.prototype.GetConnectivityConfig(),t.formData.MailboxObjectId=t.selecteditem.ObjectId,t.formData.MailboxEwsEnabled=t.selecteditem.MailboxConnectivity.MailboxEwsEnabled,t.formData.MailboxPopEnabled=t.selecteditem.MailboxConnectivity.MailboxPopEnabled,t.formData.MailboxOWAEnabled=t.selecteditem.MailboxConnectivity.MailboxOWAEnabled,t.formData.MailboxMAPIEnabled=t.selecteditem.MailboxConnectivity.MailboxMAPIEnabled,t.formData.MailboxImapEnabled=t.selecteditem.MailboxConnectivity.MailboxImapEnabled,t.formData.MailboxActiveSyncEnabled=t.selecteditem.MailboxConnectivity.MailboxActiveSyncEnabled,t.CountConnectivityEnabled=0}this.$scope=t,this.UserManagementService=i,this.PanelService=r,t.contentLoaded=!1;var u=t.$on('$includeContentLoaded',function(){t.contentLoaded=!0});t.SaveMailboxConnectivity=function(){t.MailboxConnectivityConfig.showMailboxform=!1,t.MailboxConnectivityConfig.saveinprogress=!0,t.MailboxConnectivityConfig.savefinished=!1,t.MailboxConnectivityConfig.saveMailboxError=!1;var n={MailboxObjectId:t.selecteditem.ObjectId,MailboxEwsEnabled:t.formData.MailboxEwsEnabled,MailboxPopEnabled:t.formData.MailboxPopEnabled,MailboxOWAEnabled:t.formData.MailboxOWAEnabled,MailboxMAPIEnabled:t.formData.MailboxMAPIEnabled,MailboxImapEnabled:t.formData.MailboxImapEnabled,MailboxActiveSyncEnabled:t.formData.MailboxActiveSyncEnabled};t.formData=n,i.SetMailboxConnectivity(t.formData.MailboxObjectId,t.formData).then(function(n){n.data.Status==0?(t.MailboxConnectivityConfig.saveinprogress=!1,t.MailboxConnectivityConfig.savefinished=!0,t.MailboxConnectivityConfig.showCloseButton=!0,t.updateMailboxConnectivity()):(t.MailboxConnectivityConfig.showMailboxform=!0,t.MailboxConnectivityConfig.saveinprogress=!1,t.MailboxConnectivityConfig.saveMailboxError=!0,t.MailboxConnectivityConfig.saveMailboxErrorMessage=n.data.Message)},function(n){t.MailboxConnectivityConfig.showMailboxform=!0,t.MailboxConnectivityConfig.saveinprogress=!1,t.MailboxConnectivityConfig.saveMailboxError=!0,t.MailboxConnectivityConfig.saveMailboxErrorMessage=n.data.Message})},t.updateMailboxConnectivity=function(){var n=t.getIndex(t.selecteditem,t.$root.ActiveUserData.ListModel);n!=-1&&(t.formData.MailboxEwsEnabled&&t.CountConnectivityEnabled++,t.formData.MailboxPopEnabled&&t.CountConnectivityEnabled++,t.formData.MailboxOWAEnabled&&t.CountConnectivityEnabled++,t.formData.MailboxMAPIEnabled&&t.CountConnectivityEnabled++,t.formData.MailboxImapEnabled&&t.CountConnectivityEnabled++,t.formData.MailboxActiveSyncEnabled&&t.CountConnectivityEnabled++,t.$root.ActiveUserData.MailboxConnectivity.MailboxEwsEnabled=t.formData.MailboxEwsEnabled,t.$root.ActiveUserData.MailboxConnectivity.MailboxPopEnabled=t.formData.MailboxPopEnabled,t.$root.ActiveUserData.MailboxConnectivity.MailboxOWAEnabled=t.formData.MailboxOWAEnabled,t.$root.ActiveUserData.MailboxConnectivity.MailboxMAPIEnabled=t.formData.MailboxMAPIEnabled,t.$root.ActiveUserData.MailboxConnectivity.MailboxImapEnabled=t.formData.MailboxImapEnabled,t.$root.ActiveUserData.MailboxConnectivity.MailboxActiveSyncEnabled=t.formData.MailboxActiveSyncEnabled,t.$root.ActiveUserData.MailboxConnectivity.CountConnectivityEnabled=t.CountConnectivityEnabled),t.$root.ActiveUserData.SelectedUserDetails.MailboxConnectivity=t.$root.ActiveUserData.MailboxConnectivity,t.$root.ActiveUserData.SelectedUserDetails.MailboxConnectivityRetrieved=!0,r.SetSelectedItem(t.$root.ActiveUserData.SelectedUserDetails)},t.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.ObjectId==t[i].ObjectId)return i;return-1},t.$on('$destroy',function(){u&&(u(),u=null)}),t.Cancel=function(){t.$emit('closeFlyout'),t.$destroy()},t.IsValid=function(n){return!angular.isDefined(n)||n==null||n==""?!1:!0},f()}return n.prototype.GetConnectivityConfig=function(){return{showMailboxform:!0,saveinprogress:!1,savefinished:!1,isMailboxEdit:!0,saveMailboxError:!1,saveMailboxErrorMessage:null}},n.$inject=["$scope","UserManagementService","PanelService"],n}();n.app.controller("EditMailboxConnectivityController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(t,i,r,u,f){function o(){t.MailboxAutoReplyConfigurationConfig=n.prototype.GetAutoReplyConfig(),t.MailboxAutoReplyEnabled=!1,t.formData.MailboxObjectId=t.selecteditem.ObjectId,t.formData.MailboxAutoReplyState=t.selecteditem.MailboxAutoReplyConfiguration.MailboxAutoReplyState,t.formData.MailboxExternalAudience=t.selecteditem.MailboxAutoReplyConfiguration.MailboxExternalAudience,t.formData.MailboxExternalMessage=t.selecteditem.MailboxAutoReplyConfiguration.MailboxExternalMessage,t.formData.MailboxInternalMessage=t.selecteditem.MailboxAutoReplyConfiguration.MailboxInternalMessage,t.MailboxExternalAudienceEnabled=t.selecteditem.MailboxAutoReplyConfiguration.MailboxExternalAudience=="None"?!1:!0,(t.selecteditem.MailboxAutoReplyConfiguration.MailboxAutoReplyState=="Enabled"||t.selecteditem.MailboxAutoReplyConfiguration.MailboxAutoReplyState=="Scheduled")&&(t.MailboxAutoReplyEnabled=!0),t.CheckMailboxAutoReplySaveCondition()}this.$scope=t,this.$timeout=i,this.UserManagementService=r,this.PanelService=u,this.HelperService=f,t.contentLoaded=!1;var e=t.$on('$includeContentLoaded',function(){t.contentLoaded=!0});t.SetExternalAudienceAll=function(){t.MailboxAutoReplyEnabled&&t.formData.MailboxExternalAudience=="None"&&(t.formData.MailboxExternalAudience="All"),t.CheckMailboxAutoReplySaveCondition()},t.CheckMailboxAutoReplySaveCondition=function(){t.MailboxAutoReplyConfigurationConfig.canSaveAutoReply=!0,(t.MailboxAutoReplyEnabled&&!f.IsValid(t.formData.MailboxInternalMessage)||t.MailboxAutoReplyEnabled&&t.MailboxExternalAudienceEnabled&&!f.IsValid(t.formData.MailboxExternalMessage))&&(t.MailboxAutoReplyConfigurationConfig.canSaveAutoReply=!1)},t.SaveMailboxAutoReplyConfiguration=function(){t.MailboxAutoReplyConfigurationConfig.showMailboxform=!1,t.MailboxAutoReplyConfigurationConfig.saveinprogress=!0,t.MailboxAutoReplyConfigurationConfig.savefinished=!1,t.MailboxAutoReplyConfigurationConfig.saveMailboxError=!1,t.formData.MailboxAutoReplyState=t.MailboxAutoReplyEnabled?"Enabled":"Disabled",t.MailboxExternalAudienceEnabled||(t.formData.MailboxExternalAudience="None");var n={MailboxObjectId:t.selecteditem.ObjectId,MailboxAutoReplyState:t.formData.MailboxAutoReplyState,MailboxExternalAudience:t.formData.MailboxExternalAudience,MailboxExternalMessage:t.formData.MailboxExternalMessage,MailboxInternalMessage:t.formData.MailboxInternalMessage};t.formData=n,r.SetMailboxAutoReplyConfiguration(t.formData.MailboxObjectId,t.formData).then(function(n){n.data.Status==0?(t.MailboxAutoReplyConfigurationConfig.saveinprogress=!1,t.MailboxAutoReplyConfigurationConfig.savefinished=!0,t.MailboxAutoReplyConfigurationConfig.showCloseButton=!0,t.updateMailboxAutoReplyConfiguration()):(t.MailboxAutoReplyConfigurationConfig.showMailboxform=!0,t.MailboxAutoReplyConfigurationConfig.saveinprogress=!1,t.MailboxAutoReplyConfigurationConfig.saveMailboxError=!0,t.MailboxAutoReplyConfigurationConfig.saveMailboxErrorMessage=n.data.Message)},function(n){t.MailboxAutoReplyConfigurationConfig.showMailboxform=!0,t.MailboxAutoReplyConfigurationConfig.saveinprogress=!1,t.MailboxAutoReplyConfigurationConfig.saveMailboxError=!0,t.MailboxAutoReplyConfigurationConfig.saveMailboxErrorMessage=n.data.Message})},t.updateMailboxAutoReplyConfiguration=function(){var n=t.getIndex(t.selecteditem,t.$root.ActiveUserData.ListModel);n!=-1&&(t.$root.ActiveUserData.MailboxAutoReplyConfiguration.MailboxAutoReplyState=t.formData.MailboxAutoReplyState,t.$root.ActiveUserData.MailboxAutoReplyConfiguration.MailboxExternalAudience=t.formData.MailboxExternalAudience,t.$root.ActiveUserData.MailboxAutoReplyConfiguration.MailboxExternalMessage=t.formData.MailboxExternalMessage,t.$root.ActiveUserData.MailboxAutoReplyConfiguration.MailboxInternalMessage=t.formData.MailboxInternalMessage),t.$root.ActiveUserData.SelectedUserDetails.MailboxAutoReplyConfiguration=t.$root.ActiveUserData.MailboxAutoReplyConfiguration,t.$root.ActiveUserData.SelectedUserDetails.MailboxAutoReplyConfigurationRetrieved=!0,u.SetSelectedItem(t.$root.ActiveUserData.SelectedUserDetails)},t.getIndex=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.ObjectId==t[i].ObjectId)return i;return-1},t.$on('$destroy',function(){e&&(e(),e=null)}),t.Cancel=function(){t.$emit('closeFlyout'),t.$destroy()},o()}return n.prototype.GetAutoReplyConfig=function(){return{showMailboxform:!0,saveinprogress:!1,savefinished:!1,canSaveAutoReply:!0,isMailboxEdit:!0,saveMailboxError:!1,saveMailboxErrorMessage:null}},n.$inject=["$scope","$timeout","UserManagementService","PanelService","HelperService"],n}();n.app.controller("EditMailboxAutoReplyConfigurationController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(i,r,u,f,e,o,s){function b(){i.MessageListConfig=t.prototype.GetMessageListConfig(),f.GetMessages().then(function(t){var e,r,f;if(t.data){w(t.data),i.MessageCentersModel={},i.MessageCentersModel.Messages=[],i.MessageCentersModel.IsRightToLeft=t.data.IsRightToLeft,i.showPreferences=t.data.ShowPreferencesLink,i.showNotSeeingLink=t.data.ShowNotSeeingLink,i.anyMessageOpened=!1;for(e in t.data.Messages)r=t.data.Messages[e],r.PublishedDate.startsWith("/Date")&&(r.PublishedDate=new Date(parseInt(r.PublishedDate.replace("/Date(","").replace(")/","")))),r.PublishedMomentShort=s.GetLocalizedDateTimeCustomFormat(r.PublishedDate,'MMM D'),r.PublishedMoment=s.GetLocalizedDateTime(r.PublishedDate,2),r.ExpirationDate.startsWith("/Date")&&(r.ExpirationDate=new Date(parseInt(r.ExpirationDate.replace("/Date(","").replace(")/","")))),r.ExpirationMoment=s.GetLocalizedDateTime(r.ExpirationDate,2),r.ActionRequiredByDate!=null&&(r.ActionRequiredByDate.startsWith("/Date")&&(r.ActionRequiredByDate=new Date(parseInt(r.ActionRequiredByDate.replace("/Date(","").replace(")/","")))),r.ActionRequiredByMomentShort=s.GetLocalizedDateTimeCustomFormat(r.ActionRequiredByDate,'MMM D'),r.ActionRequiredByMoment=s.GetLocalizedDateTime(r.ActionRequiredByDate,2)),r.StatusIcon={},r.ActionType==='Action'&&(r.StatusIcon.IconClass="ms-Icon-Basel ms-Icon-Basel--IncidentTriangle statusIncidentTriangle db-wdgt-icon"),r.Icon=n.MessageCenterIconsStyle[angular.lowercase(r.WorkLoad)],i.MessageCentersModel.Messages.push(r);i.MessageCentersModel.MessageFilters=[],i.MessageCentersModel.Categories=[];for(f in t.data.Categories)i.MessageCentersModel.MessageFilters.push(t.data.Categories[f]),i.MessageCentersModel.Categories.push(t.data.Categories[f]);i.MessageListConfig.messageFilter=i.MessageCentersModel.MessageFilters[0],i.MessageListConfig.messageFilter=i.MessageCentersModel.Categories[0],i.MessageListConfig.resultLoaded=!0,i.resultLoaded=!0,u.MessageCentersModel=i.MessageCentersModel,i.MessageCentersModel.Messages.length==0?(i.MessageListConfig.noResults=!0,i.MessageListConfig.serverListError=!1):(i.MessageListConfig.noResults=!1,i.MessageListConfig.serverListError=!1),y()}else i.MessageCentersModel={},i.MessageCentersModel.Messages=[],i.resultLoaded=!0,i.MessageListConfig.resultLoaded=!0,i.MessageListConfig.noResults=!1,i.MessageListConfig.serverListError=!0;i.$emit("autoscrolltotop")},function(){i.MessageCentersModel={},i.MessageCentersModel.Messages=[],i.MessageListConfig.resultLoaded=!0,i.MessageListConfig.noResults=!1,i.MessageListConfig.serverListError=!0,i.resultTranslated=!1,i.resultLoaded=!0,i.showPreferences=!1,i.showNotSeeingLink=!1,i.$emit("autoscrolltotop")})}var v,y,h,l;this.$scope=i,this.$http=r,this.$rootScope=u,this.MessageCenterService=f,this.PanelService=e,this.DateTimeService=s,v="/admin/api/messagecenter",y=function(){var n=o.search().id,t,r,u;n&&(i.MessageCentersModel.Messages.forEach(function(t){t.AnnouncementId==n&&(i.linkItem=t)}),t=o.search().MCLinkSource,O365.Instrument.ClientInstrument.getInstance().logClickAndData(t,n),i.linkItem&&(i.$apply(),$('#linkItemrow').trigger('click'))),r=o.search().showPref,r&&$('#showPrefDeeplink').trigger('click'),u=o.search().rating,u&&$('#showDigestFeedbacklink').trigger('click')},i.ToggleSortOption=function(n){i.translationInitiated=!1,i.resultTranslated=!1,i.MessageListConfig.sortField=n,i.MessageListConfig.sortDirection=i.MessageListConfig.sortDirection===1?0:1,f.RefreshMessageCenterMessages(i.MessageListConfig.messageFilter,i.MessageListConfig.sortField,i.MessageListConfig.sortDirection).success(h).error(c)},i.$on('resetSelection',function(){i.SelectedAllMessages(!1)}),i.$on('refreshMessageCenter',function(){i.selectedHeader.isChecked=!1,i.translationInitiated=!1,i.resultTranslated=!1,i.selectedLanguage=i.userPreferredLanguage,i.MessageListConfig.resultLoaded=!1,i.MessageCentersModel={},i.MessageCentersModel.Messages=[],f.RefreshMessageCenterMessages(i.MessageListConfig.messageFilter,i.MessageListConfig.sortField,i.MessageListConfig.sortDirection).success(h).error(c)}),i.ToggleFilterOption=function(){i.translationInitiated=!1,i.resultTranslated=!1,i.MessageListConfig.resultLoaded=!1,f.RefreshMessageCenterMessages(i.MessageListConfig.messageFilter,i.MessageListConfig.sortField,i.MessageListConfig.sortDirection).success(h).error(c)},h=function(t){var e,r,f;i.translationInitiated&&(i.resultTranslated=!0),i.MessageCentersModel={},i.MessageCentersModel.Messages=[],i.MessageCentersModel.IsRightToLeft=t.IsRightToLeft;for(e in t.Messages)r=t.Messages[e],r.PublishedDate.startsWith("/Date")&&(r.PublishedDate=new Date(parseInt(r.PublishedDate.replace("/Date(","").replace(")/","")))),r.PublishedMomentShort=s.GetLocalizedDateTimeCustomFormat(r.PublishedDate,'MMM D'),r.PublishedMoment=s.GetLocalizedDateTime(r.PublishedDate,2),r.ExpirationDate.startsWith("/Date")&&(r.ExpirationDate=new Date(parseInt(r.ExpirationDate.replace("/Date(","").replace(")/","")))),r.ExpirationMoment=s.GetLocalizedDateTime(r.ExpirationDate,2),r.ActionRequiredByDate!=null&&(r.ActionRequiredByDate.startsWith("/Date")&&(r.ActionRequiredByDate=new Date(parseInt(r.ActionRequiredByDate.replace("/Date(","").replace(")/","")))),r.ActionRequiredByMomentShort=s.GetLocalizedDateTimeCustomFormat(r.ActionRequiredByDate,'MMM D'),r.ActionRequiredByMoment=s.GetLocalizedDateTime(r.ActionRequiredByDate,2)),r.StatusIcon={},r.ActionType==='Action'&&(r.StatusIcon.IconClass="ms-Icon-Basel ms-Icon-Basel--IncidentTriangle statusIncidentTriangle db-wdgt-icon"),r.Icon=n.MessageCenterIconsStyle[angular.lowercase(r.WorkLoad)],i.MessageCentersModel.Messages.push(r);i.MessageCentersModel.MessageFilters=[],i.MessageCentersModel.Categories=[];for(f in t.Categories)i.MessageCentersModel.MessageFilters.push(t.Categories[f]),i.MessageCentersModel.Categories.push(t.Categories[f]);i.MessageListConfig.resultLoaded=!0,u.MessageCentersModel=i.MessageCentersModel,i.MessageCentersModel.Messages.length==0?(i.MessageListConfig.noResults=!0,i.MessageListConfig.serverListError=!1):(i.MessageListConfig.noResults=!1,i.MessageListConfig.serverListError=!1),i.$emit("autoscrolltotop")},i.ToggleHighlight=function(n){i.UnhighlightOthers(n),$("#"+n).addClass('mc-li-selected'),i.selectedIndex=n},i.MarkAsRead=function(n){var t;angular.isDefined(i.MessageCentersModel)&&angular.forEach(i.MessageCentersModel.Messages,function(i){i.AnnouncementId===n&&(t=i)}),!angular.isDefined(t)||t.IsRead||i.MessageListConfig.markUnreadActionStatus||(t.IsRead=!t.IsRead,i.MessageCentersModel.UnreadMessageCount--,i.MessageCentersModel.UnreadMessageCount==0&&(i.noUnreadMessages=!0),f.UpdateMessageReadStatus([t.AnnouncementId],!0).then(function(){i.LogUnreadActiveMesages()},function(){i.MessageListConfig.resultLoaded=!0,i.MessageListConfig.noResults=!1})),i.MessageListConfig.markUnreadActionStatus=!1},i.MarkAsUnRead=function(n){var t;angular.isDefined(i.MessageCentersModel)&&angular.forEach(i.MessageCentersModel.Messages,function(i){i.AnnouncementId===n&&(t=i)}),angular.isDefined(t)&&t.IsRead&&(t.IsRead=!t.IsRead,i.MessageCentersModel.UnreadMessageCount++,f.UpdateMessageReadStatus([t.AnnouncementId],!1).then(function(){i.LogUnreadActiveMesages()},function(){i.MessageListConfig.resultLoaded=!0,i.MessageListConfig.noResults=!1})),i.MessageListConfig.markUnreadActionStatus=!0},i.$on('markUnread',function(n,t){i.MarkAsUnRead(t)}),i.$on('ToggleHighlight',function(n,t){i.selectedIndex&&i.MarkAsRead(i.selectedIndex),i.ToggleHighlight(t)}),i.UnhighlightOthers=function(n){angular.isDefined(i.MessageCentersModel)&&i.MessageCentersModel.Messages.forEach(function(t){t.AnnouncementId!=n&&$("#"+t.AnnouncementId).removeClass('mc-li-selected')})},i.DismissAction=function(n){var e,t=-1,r;if(angular.isDefined(i.MessageCentersModel))for(r in i.MessageCentersModel.Messages)i.MessageCentersModel.Messages[r].AnnouncementId==n&&(t=r,e=i.MessageCentersModel.Messages[r]);t!=-1&&f.UpdateMessageDismissStatus([e.AnnouncementId],!0).then(function(){i.MessageCentersModel.Messages.splice(t,1),i.MessageCentersModel.UnreadMessageCount==0||e.IsRead||i.MessageCentersModel.UnreadMessageCount--,t=-1,i.LogUnreadActiveMesages(),u.$broadcast('DismissActionCompleted')},function(){i.MessageListConfig.resultLoaded=!0,i.MessageListConfig.noResults=!1})},i.RestoreAction=function(n){var u,t=-1,r;if(angular.isDefined(i.MessageCentersModel))for(r in i.MessageCentersModel.Messages)i.MessageCentersModel.Messages[r].AnnouncementId==n&&(t=r,u=i.MessageCentersModel.Messages[r]);t!=-1&&f.UpdateMessageDismissStatus([u.AnnouncementId],!1).then(function(){i.MessageCentersModel.Messages.splice(t,1),i.MessageCentersModel.UnreadMessageCount==0||u.IsRead||i.MessageCentersModel.UnreadMessageCount--,t=-1},function(){i.MessageListConfig.resultLoaded=!0,i.MessageListConfig.noResults=!1,i.MessageListConfig.serverListError=!0})},i.$on('DismissAction',function(n,t){i.DismissAction(t)}),i.$on('RestoreAction',function(n,t){i.RestoreAction(t)}),i.$on('panelclosed',function(){i.UnhighlightOthers(-1),i.MarkAsRead(i.selectedIndex)}),i.$on('markRead',function(n,t){i.MarkAsRead(t)}),i.selectedHeader={isChecked:!1},i.ToggleLangList=function(){$(".langlist").toggle()},i.translateLang=function(){i.resultTranslated=!1,i.MessageListConfig.resultLoaded=!1,i.noResults=!0,i.serverListError=!0,i.GetTranslatorResult()},i.TranslatetoPreferredLanguage=function(){i.selectedLanguage?i.translateLang():i.ToggleLangList()},i.LogUnreadActiveMesages=function(){var t,n="";angular.forEach(i.MessageCentersModel.Messages,function(t){t.IsRead||t.IsDismiss||(n+=t.AnnouncementId+"|")})},i.GetTranslatorResult=function(){i.language=i.selectedLanguage.code?i.selectedLanguage.code:"en",i.translationInitiated=!0,i.MessageCentersModel.ToLanguage=i.language;var n=angular.copy(i.MessageCentersModel);i.MessageCentersModel.Messages=[],f.GetTranslatorResult(v+"/GetTranslatorResult",n,i.language).then(h,c)},i.setLanguage=function(n){i.selectedLanguage=n,i.ToggleLangList(),i.translateLang()},i.SelectedMessages=[],i.SelectedAllMessages=function(n){if(n){$(".dataListField").prop('checked',!0),angular.forEach(i.MessageCentersModel.Messages,function(n){var t=i.SelectedMessages.indexOf(n);t===-1&&i.SelectedMessages.push(n),n.isChecked=!0});var t=a(i.SelectedMessages);i.panel.invoke(t)}else i.selectedHeader.isChecked=n,i.SelectedMessages=[],$(".dataListField").prop('checked',!1),angular.forEach(i.MessageCentersModel.Messages,function(n){n.isChecked=!1})},i.BulkMessageSelection=function(n){var r,u,t;n.isChecked?(i.SelectedMessages.push(n),r=!0,angular.forEach(i.MessageCentersModel.Messages,function(n){n.isChecked||(r=!1)}),r&&(i.selectedHeader.isChecked=!0),t=a(i.SelectedMessages),i.panel.invoke(t)):(u=i.SelectedMessages.indexOf(n),u!==-1&&i.SelectedMessages.splice(u,1),i.selectedHeader.isChecked=!1,i.SelectedMessages.length===0?i.$broadcast('closePanel'):(t=a(i.SelectedMessages),i.panel.invoke(t)))},i.getRowCss=function(n){return n.isChecked?{'background-color':'#DDEBF7'}:{'background-color':'#FFFFFF'}},i.initCallbackPanel=function(n){i.panel=n},l='Bulk actions',i.ShowMessageDetails=function(){i.anyMessageOpened||(p(),i.anyMessageOpened=!0),i.SelectedAllMessages(!1)};var p=function(){var n,t="";angular.forEach(i.MessageCentersModel.Messages,function(n){n.IsRead||n.IsDismiss||(t+=n.AnnouncementId+"|")}),n={"unread-active-message-ids":t},O365.Instrument.ClientInstrument.getInstance().logClientAction("MessageCenterUnreadActiveMessage",n)},a=function(n){i.anyMessageOpened||(p(),i.anyMessageOpened=!0);var t={};return t=n.length==1?{panelTemplateUrl:"../AdminPortal/MessageCenter/MessageSummary",panelType:"messageCenter",selecteditem:n[0],unselectonclose:!1,unhighlightonclose:!1}:i.MessageListConfig.messageFilter=="Dismissed messages"?{panelTemplateUrl:"../AdminPortal/MessageCenter/BulkDismissedMessageActions",panelType:"multimessage",selecteditem:n,panelHeaderTitle:l,unselectonclose:!0,unhighlightonclose:!0}:{panelTemplateUrl:"../AdminPortal/MessageCenter/BulkMessageActions",panelType:"multimessage",selecteditem:n,panelHeaderTitle:l,unselectonclose:!0,unhighlightonclose:!0}},c=function(){i.MessageCentersModel={},i.MessageCentersModel.Messages=[],i.MessageListConfig.serverListError=!0,i.MessageListConfig.noResults=!0,i.MessageListConfig.resultLoaded=!0},w=function(n){i.resultTranslated=!1,i.translationInitiated=!1,i.selectedLanguage=null,i.Languages=[];for(var t in n.BingTranslateLanguages)n.UserPreferredLanguage!=="en"&&t===n.UserPreferredLanguage&&(i.selectedLanguage={code:t,Name:n.BingTranslateLanguages[t]}),i.Languages.push({code:t,Name:n.BingTranslateLanguages[t]});i.userPreferredLanguage=i.selectedLanguage,n.UserPreferredLanguage!=="en"&&i.userPreferredLanguage==null&&(i.userPreferredLanguage="")};b()}return t.prototype.GetMessageListConfig=function(){return{messageFilter:{},noResults:!1,serverListError:!1,sortDirection:1,sortField:"PublishedDate",resultLoaded:!1,markUnreadActionStatus:!1}},t.$inject=["$scope","$http",'$rootScope',"MessageCenterService","PanelService",'$location',"DateTimeService"],t}();n.MessageCenterListController=t,n.app.controller("MessageCenterListController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f,e,o,s){function a(){n.feedbackShowForm=!0,n.feedbackEmailChecked=!1,n.feedbackShowDetails=!1,n.feedbackShowThanks=!1,$('input[name=changeRating]').attr('checked','false'),n.feedbackChangeRating=0,n.feedbackChangeChecked=!1,n.feedbackCommunicationChecked=!1,n.feedbackComment="",n.feedbackstatemaintain=!0,n.showme=!1}function w(){n.showDirectLink=!1,n.formData.headerTitle='',$("#AdminFeedbackDiv").hide(),n.$parent.$parent.selectedItem&&(n.message=n.$parent.$parent.selectedItem,v(),n.formData.headerTitle=n.message.DisplayTitle),$('#panel').length>0&&$('#panel').hasScroll()&&($('.mc-fix-flyout-h').css({width:"520px"}),$('.mc-fix-head').css({width:"520px"})),n.showme=!1,n.feedbackChangeRating=!1}function v(){var t,i;n.showDirectLink=!1,n.showAdditionalLink=!1;for(t in n.$root.MessageCentersModel.Messages)console.log('$scope.$root.MessageCentersModel.Messages',n.$root.MessageCentersModel.Messages[t]),n.$root.MessageCentersModel.Messages[t].AnnouncementId==n.message.AnnouncementId&&(n.selectedMessageIndex=t);n.message=n.$root.MessageCentersModel.Messages[n.selectedMessageIndex],console.log('$scope.selectedMessageIndex',n.selectedMessageIndex),l(),n.message&&n.message.ExternalLink&&n.message.ExternalLink.length>0&&(n.showAdditionalLink=!0),n.isPreviousEnabled=n.selectedMessageIndex==0?!1:!0,i=n.$root.MessageCentersModel.Messages.length-1,n.$root.MessageCentersModel.MessageSummaryOrigin===0&&(i=2),n.isNextEnabled=n.selectedMessageIndex==i?!1:!0}function l(){var t,e,i,o,s,h;for(n.message.Impacts=[],t=n.message.DisplayDescription;t.indexOf("[")!=-1;){var u=t.length,f=t.indexOf("["),r=t.indexOf("]");if(r>f)e=t.substring(f+1,r),t=t.substring(r,u),i=t.indexOf("["),i==-1&&(i=t.legth),o=t.substring(1,i),t=t.substring(i,u),s={question:e,answer:o.trim()},n.message.Impacts.push(s);else break}n.message.Impacts.length>0?(n.showAdminImpact=!0,n.MessageDescription="",h=n.message.DisplayDescription.indexOf("["),n.MessageDescription=n.message.DisplayDescription.substring(0,h).trim()):(n.showAdminImpact=!1,n.MessageDescription=n.message.DisplayDescription.trim())}var y,p,h,c;this.$scope=n,this.$timeout=t,this.$rootScope=i,this.$window=r,this.$filter=u,this.PanelService=f,this.UserManagementService=e,this.$compile=o,this.$document=s,n.selectedMessageIndex=0,n.maxIndex=n.$root.MessageCentersModel.Messages.length-1,n.message=n.$root.MessageCentersModel.Messages[0],l(),n.isPreviousEnabled=!0,n.isNextEnabled=!0,n.showAdminImpact=!1,n.feedbackUserEmail="",n.feedbackUserEmail=i.CurrentUserInfo.UserInfo.UserPrincipalName,n.feedbackShowForm=!0,n.feedbackChangeRating=0,n.feedbackChangeChecked=!1,n.feedbackCommunicationChecked=!1,n.feedbackRatingNotSelected=!1,n.feedbackComment="",n.feedbackEmailChecked=!1,n.feedbackShowDetails=!1,n.feedbackShowThanks=!1,n.showDirectLink=!1,n.showthanks=!1,y=function(){O365.Log.WriteLog(411958,O365.LogLevel.Error,O365.LogArea.Feedback,O365.LogParameter.Empty,"Message Center Feedback Submission Failed")},p=function(){O365.Log.WriteLog(414484,O365.LogLevel.Info,O365.LogArea.Feedback,O365.LogParameter.Empty,"Message Center Feedback Submission Succeded")},n.SubmitChangeFeedback=function(){var t,i,f,e,r,u;n.feedbackChangeRating==0?n.feedbackRatingNotSelected=!0:(t="",t+="title:"+n.message.DisplayTitle+";",t+="body:"+n.MessageDescription+";",t+="category:"+n.message.DisplayCategory+";",i="comm",n.feedbackChangeChecked&&(t+="change:true;",i="change"),n.feedbackCommunicationChecked&&(t+="communication:true;",i="comm"),n.feedbackComment.length>=400&&(n.feedbackComment=n.feedbackComment.substring(0,400)),f="Posting Feedback for Message: '"+n.message.AnnouncementId+"' with Rating: "+n.feedbackChangeRating,O365.Log.WriteLog(414485,O365.LogLevel.Info,O365.LogArea.Feedback,O365.LogParameter.Empty,f),r="",r=n.feedbackChangeRating==1?"dislike":"like",e={rating:r,about:i,"message-type":n.message.Category,message:n.message.AnnouncementId},u=null,n.feedbackEmailChecked&&(u=n.feedbackUserEmail),O365.Instrument.ClientInstrument.getInstance().logClientAction("O365ChangeFeedback:SubmitChangeFeedback",e),Feedback.SubmitToPortal("/feedback/PostFeedback","Office365","feedback","MessageCenter","ChangeFeedback",n.message.AnnouncementId,n.feedbackChangeRating,n.feedbackComment,u,t,null,Shared.GetSessionCookie('AjaxSessionKey'),function(){},p,y),n.feedbackShowForm=!1,n.feedbackShowThanks=!0,n.showme=!1)},n.GetDirectLink=function(){var u,t,h;n.showDirectLink=!0;var f='https://'+n.message.DomainPrefix+'/AdminPortal/home?switchtomodern=true#/MessageCenter?id='+n.message.AnnouncementId,r=angular.element('<span id="ngClipboardCopyId">'+f+'</span>'),e=s.find('body').eq(0);e.append(o(r)(i)),u=angular.element(document.getElementById('ngClipboardCopyId')),t=document.createRange(),t.selectNode(u[0]),window.getSelection().removeAllRanges(),window.getSelection().addRange(t),h=document.execCommand('copy'),window.getSelection().removeAllRanges(),r.remove()},n.feedbackstatemaintain=!0,n.ToggleFeedbackWidget=function(){n.feedbackstatemaintain&&n.showme==!1&&(n.showme=!n.showme)},n.ToggleFeedback=function(){n.feedbackShowDetails=n.feedbackChangeRating==1&&n.message.Category.toLowerCase().indexOf("plan")>=0?!0:!1},n.showAdditionalLink=!1,n.CloseActionLinks=function(){$(".userlistActions").hide();return},n.ToggleActionLinks=function(){if($(".mc-list-actns:visible").length>0){$(".mc-list-actns").hide();return}$('.mc-list-actns').show()},n.Previous=function(){a(),n.isNextEnabled=!0,n.showAdditionalLink=!1,n.showDirectLink=!1,n.selectedMessageIndex>0?(n.selectedMessageIndex=Number(n.selectedMessageIndex)-1,n.message=n.$root.MessageCentersModel.Messages[n.selectedMessageIndex],i.$broadcast('ToggleHighlight',n.message.AnnouncementId),n.selectedMessageIndex==0&&(n.isPreviousEnabled=!1),l()):n.isPreviousEnabled=!1,n.message.ExternalLink&&n.message.ExternalLink.length>0&&(n.showAdditionalLink=!0),n.formData.headerTitle=n.message.DisplayTitle},n.Next=function(t){var r=-1;r=n.$root.MessageCentersModel.MessageSummaryOrigin===0?2:n.maxIndex,a(),n.selectedMessageIndex!=-1&&(n.isPreviousEnabled=!0),n.showAdditionalLink=!1,n.showDirectLink=!1,n.selectedMessageIndex<n.maxIndex?(n.selectedMessageIndex=Number(n.selectedMessageIndex)+1,n.message=n.$root.MessageCentersModel.Messages[n.selectedMessageIndex],i.$broadcast('ToggleHighlight',n.message.AnnouncementId),t&&$("#"+n.message.AnnouncementId).removeClass('mc-li-selected'),n.selectedMessageIndex==r&&(n.isNextEnabled=!1),l()):n.isNextEnabled=!1,n.message.ExternalLink&&n.message.ExternalLink.length>0&&(n.showAdditionalLink=!0),n.formData.headerTitle=n.message.DisplayTitle},n.Share=function(){var i;n.CloseActionLinks();var t=n.message.DisplayTitle+'\n'+n.message.AnnouncementId+'\n',f='Published Date',e='Category',o='When do I need to take action by\x3f',s='Action required by',h='How does this impact me\x3f',c='Additional information',l='Disclaimer',a='You will need global admin group access to view Message center',v='Direct link',y='https://'+n.message.DomainPrefix+'/AdminPortal/home?switchtomodern=true#/MessageCenter?id=';if(t=t+'\n'+f+': '+u('date')(n.message.PublishedDate,"MMM dd"),t=t+'\n'+e+': '+n.message.DisplayCategory,n.message.ActionRequiredByDate&&n.message.ActionType==='Action'&&(t=t+'\n\n'+o+'\n'+s+': '+u('date')(n.message.ActionRequiredByDate,"MMM dd")),n.message.Impacts.length>0){t=t+'\n\n'+h+' \n\n';for(i in n.message.Impacts)t=t+n.message.Impacts[i].question+': '+n.message.Impacts[i].answer+'\n'}n.message.ExternalLink&&n.message.ExternalLink.length>0&&(t=t+'\n\n'+c+': '+n.message.ExternalLink),t=t+'\n\n'+v+': '+y+n.message.AnnouncementId,t=t+'\n('+l+'- '+a+')',r.location.href="mailto:?subject="+encodeURIComponent(n.message.DisplayTitle)+"&body="+encodeURIComponent(t)},n.MarkAsUnread=function(){n.CloseActionLinks(),i.$broadcast('markUnread',n.message.AnnouncementId)},n.DismissMessage=function(){n.CloseActionLinks(),i.$broadcast('DismissAction',n.message.AnnouncementId)},h=n.$on('DismissActionCompleted',function(){n.selectedMessageIndex>=0&&(n.selectedMessageIndex===n.maxIndex?n.Close():(n.selectedMessageIndex--,n.maxIndex=n.$root.MessageCentersModel.Messages.length-1,n.Next(!0)))}),n.Close=function(){$("#AdminFeedbackDiv").show(),n.message=undefined,n.$emit('closePanel')},n.$on('panelclosed',function(){$("#AdminFeedbackDiv").show(),n.message=undefined,c&&(c(),c=null),h&&(h(),h=null)}),w(),c=n.$on(f.GetBroadCastEventName(),function(t,r){n.message&&n.message.AnnouncementId!=r.AnnouncementId&&i.$broadcast('markRead',n.message.AnnouncementId),n.message=r,console.log('$scope.message',n.message),v(),n.$apply(function(){n.message=r,a(),v()}),n.formData.headerTitle=n.message.DisplayTitle})}return n.prototype.GetMessageSummaryConfig=function(){return{IsPreviousRequestPending:!1,IsDirSyncEnabled:!1,EndOfList:!1,NoResults:!1,detailsLoaded:!0,serverError:!1,searchDisabled:!1,searchInitiated:!1,searchBoxTracker:!1,UpnEqualsSmtp:!0,sortDirection:0,sortField:"DisplayName"}},n.$inject=["$scope",'$timeout','$rootScope','$window','$filter','PanelService',"UserManagementService","$compile","$document"],n}();n.MessageSummaryController=t,n.app.controller("MessageSummaryController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f,e,o){function c(){var n=u.search().rating,i,t;n&&(i=n[0],t=n.substring(1),t&&Feedback.SubmitToPortal("/feedback/PostFeedback","Office365","feedback","MessageCenter","MCDigestFeedback",t,i,"",null,null,null,Shared.GetSessionCookie('AjaxSessionKey'),function(){},h,s))}this.$scope=n,this.$timeout=t,this.$rootScope=i,this.$window=r,this.PanelService=f,this.$compile=e,this.$document=o,n.feedbackSubmitted=!1,n.feedbackError=!1;var s=function(){n.feedbackSubmitted=!1,n.feedbackError=!0,O365.Log.WriteLog(411958,O365.LogLevel.Error,O365.LogArea.Feedback,O365.LogParameter.Empty,"Message Center Feedback Submission Failed")},h=function(){n.feedbackSubmitted=!0,n.feedbackError=!1,O365.Log.WriteLog(414484,O365.LogLevel.Info,O365.LogArea.Feedback,O365.LogParameter.Empty,"Message Center Feedback Submission Succeded")};c()}return n.$inject=["$scope",'$timeout','$rootScope','$window','$location','PanelService',"$compile","$document"],n}();n.MessageDigestFeedbackController=t,n.app.controller("MessageDigestFeedbackController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n){this.$scope=n,n.$on('messageSummaryHeaderChanged',function(t,i){n.Title=i})}return n.$inject=["$scope"],n}();n.app.controller("MessageTitleCardController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{scope:{ngModel:'='},restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$validators.modelValidation=function(n){return n!=0}}}}n.app.directive("modelValidationDirective",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){var n=["$scope","HttpService","$cookieStore",function(n,t){n.options=['I\x27m not ready to complete setup right now. I will finish later.','I don\x27t understand how to proceed.','I\x27m getting an error that\x27s blocking my progress.','Other'],n.optionCodes=['1','2','3','4'],n.commentTexts=['What\x27s preventing you from finishing setup in this session\x3f','Describe in a few words what you\x27re trying to do and what you\x27re getting stuck on.','Please describe the error you\x27re experiencing.','Any other details\x3f','Please click the \x27Need help\x27 button on the bottom right of the browser window.'],n.formLabelTexts={title:'Let us know why you\x27re leaving setup\x3f',subtitle:'Help us improve your experience\x21',selectionDefaultText:'Please make a selection',additionalCommentsText:'Additional comments',feedbackContactText:'It\x27s okay for Microsoft to contact me.',emailAddressText:'Email address',submitText:'Send and exit'},n.optionSelected=-1,n.placeHolderText="",n.showAdditionalFields=!1,n.show=!1,n.postdata={},n.concierge=!1,n.selectionChanged=function(){n.showAdditionalFields=!0,n.optionSelected=n.postdata.selection,n.optionSelected>-1&&(n.placeHolderText=n.optionSelected==2&&n.concierge!=null&&n.concierge?n.commentTexts[4]:n.commentTexts[n.optionSelected])},n.displayEWizard=function(){n.$root.CurrentUserInfo.ShowExitFeedback?(n.postdata.emailAddress=n.$root.CurrentUserInfo.UserInfo.UserPrincipalName,t.Get("/admin/api/support/conciergetenant",{},!1).success(function(t){n.concierge=t}),t.Post("/admin/api/users/updateModalExitFeedbackLastShown",{},!1),n.$root.CurrentUserInfo.ShowExitFeedback=!1,n.show=!0):n.exitEWizard()},n.$on('EWizard:start',function(){n.displayEWizard()}),n.exitEWizard=function(){!n.show&&angular.isDefined(n.exitActionAfterNotShown)?n.exitActionAfterNotShown():(n.show=!1,angular.isDefined(n.exitAction)&&n.exitAction())},n.submitEWizard=function(){var u=null,i,r;n.postdata.contactCheckbox&&(u=n.postdata.emailAddress),i=n.postdata.selection,n.postdata.selection>n.options.length-1&&(i=n.options.length-1),r=null,window.location.hash&&(r=window.location.hash.charAt(0)=='#'?window.location.hash.substring(1):window.location.hash);var f=", Selection: ["+n.optionCodes[i]+"] "+n.options[i],e=", Step: "+n.data.step,o=", Substep: "+n.data.substep,s=f+e+o,h={rating:0,allowContact:n.postdata.contactCheckbox,selection:n.options[i],selectionCode:n.optionCodes[i],text:n.postdata.additionalComments,email:u,feature:n.data.wizard,step:n.data.step,substep:n.data.substep,page:r,additionalInfo:s,partner:"Office365",workload:"AdminPortal"};t.Post("/feedback/PostFeedback",h,null),n.exitEWizard()}}];return{restrict:'E',templateUrl:'/Admin/Views/ModalExitWizardFeedback/ModalExitWizardFeedback.html',scope:{data:"=",exitAction:"&",exitActionAfterNotShown:"&"},controller:n}}n.app.directive("modalExitWizardFeedback",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){var n=["$scope","HttpService","$cookieStore",function(n,t){n.options=['I can\x27t find the feature in the admin portal.','The feature I need does not work in the new admin portal.','I need more training to use the new admin portal.','I don\u2019t like the new admin portal.'],n.optionCodes=['1','2','3','4'],n.commentTexts=['Please tell us what feature you\x27re looking for.','Please describe the error you\x27re experiencing.','Describe in a few words what you\x27re trying to do and what you\x27re getting stuck on.','Please let us know how we can improve the new admin portal.'],n.formLabelTexts={title:'Let us know why you\x27re going back',subtitle:'Help us improve your experience\x21',selectionDefaultText:'Please make a selection',additionalCommentsText:'Additional comments',feedbackContactText:'It\x27s okay for Microsoft to contact me.',emailAddressText:'Email address',submitText:'Send and exit'},n.optionSelected=-1,n.placeHolderText="",n.showAdditionalFields=!1,n.show=!1,n.postdata={},n.selectionChanged=function(){n.showAdditionalFields=!0,n.optionSelected=n.postdata.selection,n.optionSelected>-1&&(n.placeHolderText=n.commentTexts[n.optionSelected])},n.displayOPWizard=function(){n.postdata.emailAddress=n.$root.CurrentUserInfo.UserInfo.UserPrincipalName,n.show=!0},n.$on('OPWizard:start',function(){n.displayOPWizard()}),n.exitOPWizard=function(){!n.show&&angular.isDefined(n.exitActionAfterNotShown)?n.exitActionAfterNotShown():(n.show=!1,angular.isDefined(n.exitAction)&&n.exitAction())},n.submitOPWizard=function(){var r=null,i;n.postdata.contactCheckbox&&(r=n.postdata.emailAddress),i=n.postdata.selection,n.postdata.selection>n.options.length-1&&(i=n.options.length-1);var u=", Selection: ["+n.optionCodes[i]+"] "+n.options[i],f=", Survey: "+n.data.survey,e=u+f,o={rating:0,allowContact:n.postdata.contactCheckbox,selection:n.options[i],selectionCode:n.optionCodes[i],text:n.postdata.additionalComments,email:r,survey:n.data.survey,additionalInfo:e,partner:"Office365",feedbackType:"feedback",workload:"AdminPortal",feature:"ModernAdminPortal",page:"SwitchBack"};t.Post("/feedback/PostFeedback",o,null),n.exitOPWizard()}}];return{restrict:'E',templateUrl:'/Admin/Views/ModalOldPortalFeedback/ModalOldPortalFeedback.html',scope:{data:"=",exitAction:"&",exitActionAfterNotShown:"&"},controller:n}}n.app.directive("modalOldPortalFeedback",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f,e){var o,h,c,s;this.$scope=n,this.ModernSearchService=t,this.o365FlyoutDirective=i,this.$state=r,this.SitesService=u,this.NavigationService=f,this.LogService=e,n.$root.IsDeletedUserPage=!1,n.showDefaultResults=!1,o=!1,n.modernSearchTerm="",h={addSite:null,supportPageLink:"/support/support.aspx",serviceRequestsPageLink:"/support/servicerequests.aspx",downloadAppsLink:"/OLS/MySoftware.aspx",publicWebsiteLink:"/PublicWebsite",mobileDeviceManagementLink:"/EAdmin/Device/IntuneInventory.aspx",yammerSetupLink:"http://Aka.ms/yammerdeploy",ProPlusDeploymentAdvisorLink:"http://aka.ms/proplusguidance",OneDriveForBusinessLink:"http://aka.ms/OD4Bguidance",SharePointOnlineDeploymentAdvisorLink:"http://aka.ms/spoguidance",GmailContactsCalendarAssistantLink:"http://aka.ms/gmailcontactscalendar",StagedLink:"http://aka.ms/stagedguidance",FinishedHybridEx2010Link:"http://aka.ms/hybrid2010guidance",FinishedHybridEx2013Link:"http://aka.ms/hybrid2013guidance",FinishedHybridEx2016Link:"http://aka.ms/hybrid2016guidance",AADConnectwithPasswordSyncLink:"http://aka.ms/aadconnectpwsync",GmailIMAPMigrationLink:"http://aka.ms/gmailimapguidance",ExchangeCutovermigrationLink:"http://aka.ms/cutoverguidance",IntunedeploymentadvisorLink:"http://aka.ms/intuneguidance",ExchangeOnlineProtectionLink:"http://aka.ms/eopguidance",MailSetupAdvisorLink:"http://aka.ms/office365setup",OtherIMAPMigrationLink:"http://aka.ms/imapguidance",AzureADLink:"http://aka.ms/aadpguidance",AzureRMSLink:"http://aka.ms/azurermsguidance",SkypeforBusinessdeploymentLink:"http://aka.ms/skypeguidance",YammerQuickStartLink:"https://aka.ms/yamquickstartguide",OfficeProPlusQuickStartLink:"https://aka.ms/OPPquickstartguide",SkypeforBusinessQuickStartLink:"https://aka.ms/SfBquickstartguide",SharePointOnlineQuickStartLink:"https://aka.ms/SPOquickstartguide",OneDriveForBusinessQuickStartLink:"https://aka.ms/ODfBquickstartguide",SmallBusinessOnboardingLink:"https://aka.ms/SmallBusinessQuickstartGuide"},f.getMenu().then(function(t){var i=t.AdminConsoles;angular.forEach(i,function(n){n.submenu&&angular.forEach(n.submenu,function(n){h[n.serviceId]=n.sref})}),n.$root.features&&n.$root.features.EditSite&&u.GetSitesListDefaults().then(function(n){h.addSite=n.data},function(n){this.LogService.LogError(418225,"Got an unexpected error getting site URL: "+n)})}),n.PerformSearch=function(i){return n.showDefaultResults=!1,n.modernSearchTerm=i,t.Search(i)},n.OnSelect=function(t,i,r){var u;n.$item=t,n.$model=i,n.$label=r,n.modernSearchTerm="",t.ResultType=='user'?(u=s('editUser',t),n.panel.invoke(u)):t.ResultType=='group'&&(u=s('editGroup',t),n.panel.invoke(u))},n.initCallbackFlyout=function(t){n.flyout=t},n.initCallbackPanel=function(t){n.panel=t},n.$on("panel",function(t,i){n.$broadcast('closePanel'),o=!0;var r=s(i.action,i.args);n.$root.enterKeyClickedOnListViewRow=!0,n.panel.invoke(r),n.showDefaultResults=!1}),n.$on("page",function(t,i){n.$broadcast('closePanel'),o=!0,r.go(i.action),n.showDefaultResults=!1}),n.$on("URL",function(t,i){o=!0;var r=c(i.action);window.open(r),n.showDefaultResults=!1}),n.$on("flyout",function(t,i){n.$broadcast('closePanel'),o=!0;var r=s(i.action,i.args);n.flyout.invoke(r,r.selecteditem),n.showDefaultResults=!1}),n.$on("helpPopup",function(t,i){o=!0,i&&i.args.HelpId&&Microsoft.Online.BOX.JS.Shared.ShowHelpPopup(i.args.HelpId,null),n.showDefaultResults=!1}),n.OnTextFocus=function(){O365.Log.WriteLog(416522,O365.LogLevel.Trace,O365.LogArea.ModernAdminPortal,O365.LogParameter.Empty,n.$root.CultureInfo);var t;t={language:n.$root.CultureInfo},O365.Instrument.ClientInstrument.getInstance().logClientAction("O365ModernSearch:SearchFieldClicked",t),(n.modernSearchTerm==null||n.modernSearchTerm=='')&&(n.showDefaultResults=!0)},n.OnTextBlur=function(){setTimeout(function(){n.$apply(function(){if(o==!0)o=!1;else{O365.Log.WriteLog(416800,O365.LogLevel.Trace,O365.LogArea.ModernAdminPortal,O365.LogParameter.Empty,n.modernSearchTerm,n.$root.CultureInfo);var t;t={searchTerm:n.modernSearchTerm,language:n.$root.CultureInfo},O365.Instrument.ClientInstrument.getInstance().logClientAction("O365ModernSearch:SearchAbandoned",t)}n.showDefaultResults=!1})},500)},n.searchButtonClick=function(){angular.element(document.querySelector('#modernSearchTextBoxId')).focus(),angular.element(document.querySelector('#modernSearchTextBoxId')).click()},c=function(n){var t=h[n];return t==null&&(t="/"),t},s=function(n,t){var i;switch(n){case"editUserPicker":i={panelTemplateUrl:"../AdminPortal/Users/EditUserPicker",panelHeaderTitle:'Edit a user',panelHeaderIcon:"ms-Icon-Basel ms-Icon-Basel--EditLegacy",showCloseButton:"false",selecteditem:{Type:"EditUser"}};break;case"editUser":i={panelTemplateUrl:"../AdminPortal/Users/UserItemDetailsTemplate",panelType:"user",selecteditem:t};break;case"deleteUser":i={panelTemplateUrl:"../AdminPortal/Users/EditUserPicker",panelHeaderTitle:'Delete user',panelHeaderIcon:"ms-Icon-Basel ms-Icon-Basel--DeleteLegacy",showCloseButton:"false",selecteditem:{Type:"DeleteUser"}};break;case"blockUser":i={panelTemplateUrl:"../AdminPortal/Users/EditUserPicker",panelHeaderTitle:'Sign-in status',panelHeaderIcon:"",showCloseButton:"false",selecteditem:{Type:"BlockUser"}};break;case"addGroup":i={flyoutTemplateUrl:"../AdminPortal/Groups/Add",flyoutType:"group",flyoutHeaderTitle:"",flyoutHeaderIcon:"",flyoutTitle:'Add a group',waitingIndicatorMessage:'Editing members',selecteditem:{}};break;case"editGroup":i={panelTemplateUrl:"../AdminPortal/Groups/GroupSummary",panelType:"group",selecteditem:t};break;case"editGroupMembers":i={flyoutTemplateUrl:"../AdminPortal/Groups/EditGroupMembers",flyoutType:"group",flyoutHeaderTitle:"",flyoutHeaderIcon:"",flyoutTitle:'Edit members',waitingIndicatorMessage:'Editing members',selecteditem:t};break;case"addUser":i={flyoutTemplateUrl:"../AdminPortal/Users/Add",flyoutType:"user",flyoutHeaderTitle:"",flyoutHeaderIcon:"",flyoutTitle:'Add a user',waitingIndicatorMessage:'Saving changes',selecteditem:{}};break;case"bulkAddUsers":i={flyoutTemplateUrl:"../AdminPortal/users/bulkadduser",flyoutHeaderTitle:'Import multiple users',flyoutHeaderIcon:"",waitingIndicatorMessage:'Import multiple users',selecteditem:{}};break;case"resetPassword":i={panelTemplateUrl:"../AdminPortal/Users/EditUserPicker",panelHeaderTitle:'Reset password',panelHeaderIcon:"ms-Icon-Basel ms-Icon-Basel--PermissionsLegacy",showCloseButton:"false",selecteditem:{Type:"ResetUser"}};break;case"resetUserPassword":i={flyoutTemplateUrl:"../AdminPortal/Users/userpasswordreset",flyoutType:"user",flyoutHeaderTitle:"",flyoutHeaderIcon:"",flyoutTitle:'Reset password',waitingIndicatorMessage:'Saving changes',selecteditem:t};break;case"addDomain":i={flyoutTemplateUrl:"../AdminPortal/DomainList/DomainAddWizard",flyoutType:"domainwizard",flyoutHeaderTitle:"",flyoutHeaderIcon:"",flyoutTitle:'',waitingIndicatorMessage:'Please wait',selecteditem:{}};break;case"addSharedMailbox":i={flyoutTemplateUrl:"../AdminPortal/SharedMailbox/Add",flyoutType:"sharedmailbox",flyoutHeaderTitle:"",flyoutHeaderIcon:"",flyoutTitle:'Adding Shared Mailbox',waitingIndicatorMessage:'Add a mailbox',selecteditem:{}};break;case"Mail":case"Calendar":case"RightsManagement":case"OfficeOnline":case"Cortana":case"Skype":case"Sway":case"Sites":case"Delve":case"Reports":case"MultiFactorAuth":case"CRM":case"ERP":case"SoftwareDownload":case"Store":case"IntegratedApps":case"Mobile":case"DirSync":i={flyoutTemplateUrl:"../AdminPortal/Settings/AppDetailsTemplate",flyoutHeaderTitle:t.DisplayName,flyoutHeaderIcon:t.Icon,flyoutHeaderIconUrl:t.IconUrl,waitingIndicatorMessage:'Please wait',selecteditem:t};break;case"CustomTilesSetting":i={panelTemplateUrl:"../AdminPortal/CompanyProfile/CustomTiles",panelType:"customTile",panelHeaderTitle:'Custom tiles',waitingIndicatorMessage:'Saving',selecteditem:{}};break;case"CustomTheme":i={flyoutTemplateUrl:"../AdminPortal/CompanyProfile/CustomTheme",flyoutType:"customTheme",flyoutHeaderTitle:'Custom theming',flyoutHeaderIcon:"",flyoutTitle:'Custom theming',waitingIndicatorMessage:'Saving',selecteditem:{}};break;case"CustomHelpdeskSetting":i={flyoutTemplateUrl:"../AdminPortal/CompanyProfile/CustomHelpdesk",flyoutType:"customhelpdesk",flyoutHeaderTitle:'Custom help desk',flyoutHeaderIcon:"",flyoutTitle:'Custom help desk',waitingIndicatorMessage:'Saving',selecteditem:{}};break;case"OfficeClientPolicy":i={flyoutTemplateUrl:"../AdminPortal/Settings/AppDetailsTemplate",flyoutType:"officepolicysettings",flyoutHeaderTitle:t.DisplayName,flyoutHeaderIcon:t.Icon,flyoutHeaderIconUrl:t.IconUrl,waitingIndicatorMessage:'Please wait',selecteditem:t};break;default:return}return i}}return n.$inject=["$scope","ModernSearchService","o365FlyoutDirective","$state","SitesService","NavigationService","LogService"],n}();n.app.controller("ModernSearchController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){function i(){n.feedbackEmailChecked=!1,n.feedbackUserEmail=t.CurrentUserInfo.UserInfo.UserPrincipalName,$('#panel').length>0&&$('#panel').hasScroll()&&($('.mc-fix-flyout-h').css({width:"520px"}),$('.mc-fix-head').css({width:"520px"}))}this.$scope=n,this.$rootScope=t,n.serviceCommsModel={},n.serviceCommsModel.Services=['Mail','Calendar','Skype for Business','SharePoint','Other'],n.servicecomms={service:'Mail'},i();var r=function(){O365.Log.WriteLog(414538,O365.LogLevel.Error,O365.LogArea.Feedback,O365.LogParameter.Empty,"Missed Opportunity Feedback Submission Failed")},u=function(){O365.Log.WriteLog(414539,O365.LogLevel.Info,O365.LogArea.Feedback,O365.LogParameter.Empty,"Missed Opportunity Feedback Submission Succeded"),n.$emit('closePanel')};n.Cancel=function(){n.$emit('closePanel')},n.SubmitServiceCommsFeedback=function(){var i="",t;i+="service:"+n.servicecomms.service+";",n.servicecomms.feedbackText.length>=800&&(n.servicecomms.feedbackText=n.servicecomms.feedbackText.substring(0,800)),t=null,n.feedbackEmailChecked&&(t=n.feedbackUserEmail),O365.Log.WriteLog(414540,O365.LogLevel.Info,O365.LogArea.Feedback,O365.LogParameter.Empty,"Posting Missed Opportunity Feedback"),Feedback.SubmitToPortal("/feedback/PostFeedback","Office365","feedback","MessageCenter","MissedOpportunity",n.servicecomms.service,0,n.servicecomms.feedbackText,t,i,null,Shared.GetSessionCookie('AjaxSessionKey'),function(){},u,r)}}return n.$inject=['$scope','$rootScope'],n}();n.app.controller("ServiceCommsFeedbackController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){this.$scope=n,this.DashboardService=t;var i=function(){n.ChecklistConfig={maxItems:3,remainingItems:0},n.AdminChecklistModel={},n.AdminChecklistModel.serverError=!1,n.AdminChecklistModel.isLoading=!0,t.GetAdminChecklistHelpTopics().then(function(t){n.AdminChecklistModel.AdminChecklistHelpTopics=[],angular.forEach(t.data.AdminChecklistHelpTopics,function(t){t.IsDismissed||n.AdminChecklistModel.AdminChecklistHelpTopics.push(t)}),n.ChecklistConfig.remainingItems=n.AdminChecklistModel.AdminChecklistHelpTopics.length-n.ChecklistConfig.maxItems,n.AdminChecklistModel.isLoading=!1},function(){n.AdminChecklistModel.serverError=!0,n.AdminChecklistModel.isLoading=!1})};n.MarkRead=function(i){angular.forEach(n.AdminChecklistModel.AdminChecklistHelpTopics,function(r){r.ProTipId==i.ProTipId&&t.SaveOffice365HelpTipsState(n.AdminChecklistModel).then(function(){r.IsRead=!0})})},n.DismissTopic=function(i){angular.forEach(n.AdminChecklistModel.AdminChecklistHelpTopics,function(r,u){r.ProTipId==i.ProTipId&&t.SaveOffice365HelpTipsState(n.AdminChecklistModel).then(function(){n.AdminChecklistModel.AdminChecklistHelpTopics.splice(u,1),n.ChecklistConfig.remainingItems>0&&n.ChecklistConfig.remainingItems--,r.IsDismissed=!0})})},i()}return n.$inject=["$scope","DashboardService"],n}();n.DashboardAdminChecklistWidgetController=t,n.app.controller("DashboardAdminChecklistWidgetController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){this.$scope=n,this.SettingsService=t,n.init=function(){},n.GetCortanaSettings=function(){i(),t.GetCortanaSettings().then(function(t){n.formData=t.data,n.$emit('showWaitingIndicator',!1),n.showForm=!0},function(){n.saveError=!0,n.saveErrorMessage='Unable to retrieve settings',n.$emit('showWaitingIndicator',!1),n.showForm=!0})},n.SaveCortanaSettings=function(){r(),t.UpdateCortanaSettings(n.formData).then(function(){u()},function(n){f(n)})},n.Cancel=function(){n.$emit('closeFlyout')};var i=function(){n.$emit('showWaitingIndicator',!0),n.showForm=!1,n.saveInProgress=!1,n.saveFinished=!1,n.saveError=!1,n.formData={}},r=function(){n.showForm=!1,n.saveInProgress=!0,n.saveFinished=!1,n.saveError=!1},u=function(){n.saveInProgress=!1,n.saveFinished=!0,n.showCloseButton=!0},f=function(t){n.showForm=!0,n.saveInProgress=!1,n.saveError=!0,n.saveErrorMessage=t.data.Message}}return n.$inject=["$scope","SettingsService"],n}();n.CortanaSettingsController=t,n.app.controller("CortanaSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){this.$scope=n,this.SettingsService=t,n.init=function(){},n.GetOfficeNotificationHubSettings=function(){i(),t.GetOfficeNotificationHubSettings().then(function(t){n.formData=t.data,n.$emit('showWaitingIndicator',!1),n.showForm=!0},function(){n.saveError=!0,n.saveErrorMessage='Unable to retrieve settings',n.$emit('showWaitingIndicator',!1),n.showForm=!0})},n.SaveOfficeNotificationHubSettings=function(){r(),t.UpdateOfficeNotificationHubSettings(n.formData).then(function(){u()},function(n){f(n)})},n.Cancel=function(){n.$emit('closeFlyout')};var i=function(){n.$emit('showWaitingIndicator',!0),n.showForm=!1,n.saveInProgress=!1,n.saveFinished=!1,n.saveError=!1,n.formData={}},r=function(){n.showForm=!1,n.saveInProgress=!0,n.saveFinished=!1,n.saveError=!1},u=function(){n.saveInProgress=!1,n.saveFinished=!0,n.showCloseButton=!0},f=function(t){n.showForm=!0,n.saveInProgress=!1,n.saveError=!0,n.saveErrorMessage=t.data.Message}}return n.$inject=["$scope","SettingsService"],n}();n.OfficeNotificationHubSettingsController=t,n.app.controller("OfficeNotificationHubSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){this.$scope=n,this.SettingsService=t,this.$location=i,n.init=function(){t.GetDirSyncSettings().then(function(t){n.DirSyncModel={},n.DirSyncModel.DirSyncManageUrl=t.data.ManageUrl,n.DirSyncModel.DirSyncWizardUrl=t.data.WizardUrl,n.DirSyncModel.DirSyncEnabled=t.data.DirSyncEnabled})},n.GoToManagement=function(){i.path(n.DirSyncModel.DirSyncManageUrl),n.Close()},n.Close=function(){n.$emit('closeFlyout')}}return n.$inject=["$scope","SettingsService","$location"],n}();n.DirSyncSettingsController=t,n.app.controller("DirSyncSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function r(){n.DataLocationOptInConfig={showForm:!1,saveInProgress:!1,saveFinished:!1,saveError:!1,loadingData:!0,alreadyOptedIn:!1},n.formData={},i.GetEligibleLocalLocation().then(function(t){n.formData=t.data,n.formData.AlreadyOptedIn?(n.DataLocationOptInConfig.saveFinished=!0,n.DataLocationOptInConfig.saveError=!1,n.DataLocationOptInConfig.showForm=!1,n.DataLocationOptInConfig.loadingData=!1,n.DataLocationOptInConfig.alreadyOptedIn=n.formData.AlreadyOptedIn):(n.DataLocationOptInConfig.showForm=!0,n.DataLocationOptInConfig.loadingData=!1)},function(){n.DataLocationOptInConfig.saveFinished=!0,n.DataLocationOptInConfig.saveError=!0,n.DataLocationOptInConfig.showForm=!1,n.DataLocationOptInConfig.loadingData=!1})}this.$scope=n,this.$rootScope=t,this.CompanyProfileService=i,r(),n.Cancel=function(){n.$emit('closeFlyout')},n.EnableSaveButton=function(){return n.formData.AlreadyOptedIn},n.SaveDataLocationOptInSettings=function(){n.DataLocationOptInConfig.saveInProgress=!0,n.DataLocationOptInConfig.saveFinished=!1,n.DataLocationOptInConfig.saveError=!1,n.DataLocationOptInConfig.showForm=!1,i.SaveLocalDataMoveSettings().then(function(){n.DataLocationOptInConfig.saveFinished=!0,n.DataLocationOptInConfig.saveError=!1,n.DataLocationOptInConfig.showForm=!1,n.DataLocationOptInConfig.loadingData=!1,n.DataLocationOptInConfig.alreadyOptedIn=!1,n.DataLocationOptInConfig.saveInProgress=!1,t.$broadcast('refreshDataResidencyOption')},function(){n.DataLocationOptInConfig.saveFinished=!0,n.DataLocationOptInConfig.saveError=!0,n.DataLocationOptInConfig.showForm=!1,n.DataLocationOptInConfig.loadingData=!1,n.DataLocationOptInConfig.alreadyOptedIn=!1,n.DataLocationOptInConfig.saveInProgress=!1})}}return n.$inject=["$scope",'$rootScope','CompanyProfileService'],n}();n.app.controller("DataLocationOptInSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){this.$scope=n,this.AppsService=t,n.DynamicsCrmInit=function(){n.dynamicsCrm={},n.dynamicsCrm.showContent=!1,n.dynamicsCrm.showErrors=!1,n.$emit('showWaitingIndicator',!0),t.GetSettingDetails("dynamicscrm").then(function(t){n.$emit('showWaitingIndicator',!1),n.dynamicsCrm.showContent=!0,n.dynamicsCrm.manageUrl=t.data.ManageUrl},function(){n.$emit('showWaitingIndicator',!1),n.dynamicsCrm.showErrors=!0,n.dynamicsCrm.error='Unable to retrieve settings'})},n.DynamicsErpInit=function(){n.dynamicsErp={},n.dynamicsErp.showContent=!1,n.dynamicsErp.showErrors=!1,n.$emit('showWaitingIndicator',!0),t.GetSettingDetails("dynamicserp").then(function(t){n.$emit('showWaitingIndicator',!1),n.dynamicsErp.showContent=!0,n.dynamicsErp.manageUrl=t.data.ManageUrl},function(){n.$emit('showWaitingIndicator',!1),n.dynamicsErp.showErrors=!0,n.dynamicsErp.error='Unable to retrieve settings'})},n.Close=function(){n.$emit('closeFlyout')}}return n.$inject=["$scope","AppsService"],n}();n.DynamicsSettingsController=t,n.app.controller("DynamicsSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u){this.$scope=t,this.$timeout=i,this.PrivateCatalogService=r,this.ManifestUploadService=u,this.isEnabled=this.ManifestUploadService.IsEnabled,this.showForm=!0,this.save=new n.PrivateCatalogStatusIndicator(this.$scope,this.$timeout,this.PrivateCatalogService)}return t.prototype.Submit=function(){var n=this;this.showForm=!1,this.save.SetInProgress(),this.PrivateCatalogService.ChangeAddInStatus(this.isEnabled?1:0,this.ManifestUploadService.ServicePrincipalObjectId).then(function(t){return n.save.SetFinished(t)},function(){return n.save.SetError()})},t.prototype.SaveAndClose=function(){this.save.errorMessages||(this.ManifestUploadService.IsEnabled=this.isEnabled,this.ManifestUploadService.IsNewEnableSet=!0)},t.$inject=['$scope','$timeout','PrivateCatalogService','ManifestUploadService'],t}();n.EditPrivateCatalogAddInStatusController=t,n.app.controller('EditPrivateCatalogAddInStatusController',t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u){this.$scope=t,this.$timeout=i,this.PrivateCatalogService=r,this.ManifestUploadService=u,this.showForm=!0,this.save=new n.PrivateCatalogStatusIndicator(this.$scope,this.$timeout,this.PrivateCatalogService),this.audiencePicker=n.AudiencePicker[this.ManifestUploadService.AudiencePicker],this.picker={Type:1,SearchTypes:[0,1],existingItems:this.ManifestUploadService.Members,addedItems:[],removedItems:[],selectedItems:[],placeholderText:'Search users or groups to add or remove.',inputLabel:'Search users or groups to add or remove.'}}return t.prototype.Submit=function(){this.ManifestUploadService.IsExistingAddIn?(this.showForm=!1,this.save.SetInProgress(),this.SaveAssignmentUpdates()):angular.element('#AddAssignmentSave').triggerHandler('click'),this.ManifestUploadService.AudiencePicker=n.AudiencePicker[this.audiencePicker],this.ManifestUploadService.AudiencePicker===0?this.ManifestUploadService.Members=[]:this.ManifestUploadService.AudiencePicker===1&&(this.ManifestUploadService.Members=this.picker.selectedItems)},t.prototype.ShouldDisableSubmit=function(){return this.ManifestUploadService.IsExistingAddIn&&n.AudiencePicker[this.audiencePicker]===1&&this.picker.addedItems.length===0&&this.picker.removedItems.length===0},t.prototype.SaveAssignmentUpdates=function(){var i=this,r=n.AudiencePicker[this.audiencePicker],u=r===1,f=t.GetMemberEmailAddresses(this.picker.addedItems),e=t.GetMemberEmailAddresses(this.picker.removedItems);this.PrivateCatalogService.UpdateAddInAssignments(this.ManifestUploadService.ServicePrincipalObjectId,u,f,e).then(function(n){return i.UpdateAddInAssignmentsSuccess(n)},function(){return i.save.SetError()})},t.prototype.UpdateAddInAssignmentsSuccess=function(n){var t,i;if(n&&n.FailedEmailAddresses&&n.FailedEmailAddresses.length>0&&(t=['The operation was successful but changing the assignment status failed for the following users\x3a'],t=t.concat(n.FailedEmailAddresses)),n&&n.NestedGroupAddresses&&n.NestedGroupAddresses.length>0&&(i=['The operation was successful but we detected the following groups contain nested groups. We cannot resolve assignment of Add-Ins to users in nested groups and only support those that are present in the top-level group.'],i=i.concat(n.NestedGroupAddresses)),t&&t.length>0||i&&i.length>0){this.save.SetWarning(t,i);return}this.save.SetFinished(n)},t.GetMemberEmailAddresses=function(n){var t=[];return angular.forEach(n,function(n){return t.push(n.EmailAddress)}),t},t.$inject=['$scope','$timeout','PrivateCatalogService','ManifestUploadService'],t}();n.EditPrivateCatalogUserGroupController=t,n.app.controller('EditPrivateCatalogUserGroupController',t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n){var t=this;this.$scope=n,this.$scope.$on('AddInMetadataUpdated',function(n,i,r){return t.AddInMetadataUpdated(i,r)})}return n.prototype.AddInMetadataUpdated=function(n,t){this.title=n,this.iconUrl=t},n.$inject=['$scope'],n}();n.ManifestPreviewCardController=t,n.app.controller('ManifestPreviewCardController',t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u,f,e,o,s){this.$scope=t,this.$rootScope=i,this.$timeout=r,this.LogService=u,this.ProfileService=f,this.PrivateCatalogService=e,this.PrivateCatalogDisplayService=o,this.ManifestUploadService=s,this.showForm=!1,this.showConsent=!1,this.showDeleteForm=!1,this.isStoreAddIn=!1,this.deleteIndicator=new n.PrivateCatalogStatusIndicator(this.$scope,this.$timeout,this.PrivateCatalogService),this.saveIndicator=new n.PrivateCatalogStatusIndicator(this.$scope,this.$timeout,this.PrivateCatalogService),this.getIndicator=new n.PrivateCatalogStatusIndicator(this.$scope,this.$timeout,this.PrivateCatalogService),this.isExistingAddIn=this.ManifestUploadService.IsExistingAddIn,this.isUpdating=this.ManifestUploadService.IsUpdating,!this.isExistingAddIn||this.isUpdating?this.GetManifestDetails(this.ManifestUploadService.IsEnabled?1:0):this.GetAddInDetails();var h=function(){this.ManifestUploadService.DeepLinkingCampaign=null}.bind(this);this.$scope.$on('closePanel',h),this.$scope.$on('closeFlyout',h),this.$scope.$on('$destroy',h)}return t.prototype.ShowDelete=function(){this.showForm=!1,this.showDeleteForm=!0},t.prototype.Delete=function(){var n=this;this.showForm=!1,this.showDeleteForm=!1,this.deleteIndicator.SetInProgress(),this.PrivateCatalogService.RemoveAddIn(this.addIn.ServicePrincipalObjectId).then(function(t){return n.DeleteSuccess(t)},function(){return n.deleteIndicator.SetError()})},t.prototype.DeleteSuccess=function(n){if(n.ResponseResult!==0){this.deleteIndicator.SetError(n);return}this.deleteIndicator.SetFinished(n),this.$scope.$emit('UpdateAddInList')},t.prototype.CancelDelete=function(){this.showForm=!0,this.showDeleteForm=!1},t.prototype.Update=function(){this.ManifestUploadService.IsExistingAddIn=!0,this.ManifestUploadService.IsUpdating=!0},t.prototype.CancelUpdate=function(){this.ManifestUploadService.IsUpdating=!1},t.prototype.SaveButtonEnabled=function(){return(!this.isExistingAddIn||this.isUpdating)&&!this.NeedsConsent()},t.prototype.ConsentButtonEnabled=function(){return(!this.isExistingAddIn||this.isUpdating)&&this.NeedsConsent()},t.prototype.UploadCancelButtonEnabled=function(){return!this.isExistingAddIn&&!this.isUpdating},t.prototype.UpdateButtonEnabled=function(){return this.isExistingAddIn&&!this.isUpdating&&!this.isStoreAddIn},t.prototype.UpdateCancelButtonEnabled=function(){return this.isUpdating},t.prototype.NeedsConsent=function(){return this.$rootScope.features.PrivateCatalogConsent&&!!this.addIn.AppId&&Array.isArray(this.addIn.Scopes)&&this.addIn.Scopes.length>0},t.prototype.ShowConsentPage=function(){this.showForm=!1,this.showConsent=!0},t.prototype.Save=function(){var n=this,t;this.showForm=!1,this.showConsent=!1,this.saveIndicator.SetInProgress('#loadingMessage'),this.isExistingAddIn?this.PrivateCatalogService.UpdateAddIn(this.ManifestUploadService.Contents,this.ManifestUploadService.Url,this.ManifestUploadService.ServicePrincipalObjectId).then(function(t){return n.SaveSuccess(t)},function(){return n.saveIndicator.SetError(null,'#CloseSaveForm')}):(t=[],this.ExtractEmailAddresses(this.ManifestUploadService.Members,t),this.PrivateCatalogService.UploadAddIn(this.addIn.StatusCode,this.ManifestUploadService.Contents,this.ManifestUploadService.Url,this.ManifestUploadService.AssetId,this.ManifestUploadService.ContentCulture,this.ManifestUploadService.DeepLinkingCampaign,t,this.ManifestUploadService.AudiencePicker===1).then(function(t){return n.UploadAddInSuccess(t)},function(){return n.saveIndicator.SetError(null,'#CloseSaveForm')}))},t.prototype.Cancel=function(){this.$scope.$emit('closeFlyout'),this.ClearDeepLinkingCampaign()},t.prototype.UploadAddInSuccess=function(n){this.$scope.$emit('UpdateAddInList');var t,i;if(n&&n.FailedEmailAddresses&&n.FailedEmailAddresses.length>0&&(t=['The operation was successful but changing the assignment status failed for the following users\x3a'],t=t.concat(n.FailedEmailAddresses)),n&&n.NestedGroupAddresses&&n.NestedGroupAddresses.length>0&&(i=['The operation was successful but we detected the following groups contain nested groups. We cannot resolve assignment of Add-Ins to users in nested groups and only support those that are present in the top-level group.'],i=i.concat(n.NestedGroupAddresses)),t&&t.length>0||i&&i.length>0){this.saveIndicator.SetWarning(t,i);return}this.saveIndicator.SetFinished(n),this.ClearDeepLinkingCampaign()},t.prototype.GetManifestDetails=function(n){var t=this;this.getIndicator.SetInProgress(),this.PrivateCatalogService.GetManifestDetails(this.ManifestUploadService.ServicePrincipalObjectId,this.ManifestUploadService.Contents,this.ManifestUploadService.Url,this.ManifestUploadService.AssetId,this.ManifestUploadService.ContentCulture,this.ManifestUploadService.DeepLinkingCampaign).then(function(i){return t.GetManifestDetailsSuccess(i,n)},function(){return t.getIndicator.SetError()})},t.prototype.GetManifestDetailsSuccess=function(n,t){if(n.ResponseResult!==0){this.getIndicator.SetError(n,'#CloseForm');return}n.AddInDetails.StatusCode=t;var i=this.PrivateCatalogDisplayService.GetCulturePrefix();this.addIn=this.PrivateCatalogDisplayService.CreateDisplayAddIn(i,n.AddInDetails),this.showForm=!0,this.showConsent=!1,this.getIndicator.SetFinished(),this.$rootScope.$broadcast('AddInMetadataUpdated',this.addIn.DisplayName,this.addIn.IconUrl)},t.prototype.GetAddInDetails=function(){var n=this;this.getIndicator.SetInProgress(),this.$rootScope.$broadcast('AddInMetadataUpdated',this.ManifestUploadService.SelectedItem.DisplayName,this.ManifestUploadService.SelectedItem.IconUrl),this.PrivateCatalogService.GetAddInDetails([this.ManifestUploadService.SelectedItem.ServicePrincipalObjectId]).then(function(t){return n.GetAddInDetailsSuccess(t)},function(){return n.getIndicator.SetError()})},t.prototype.GetAddInDetailsSuccess=function(n){var t,i;if(n.ResponseResult!==0){this.getIndicator.SetError(n);return}t=this.PrivateCatalogDisplayService.CreateDisplayAddIn(this.PrivateCatalogDisplayService.GetCulturePrefix(),n.AddInDetails[0]),this.ManifestUploadService.SelectedItem.Version=t.Version,this.ManifestUploadService.SelectedItem.HostApps=t.HostApps,this.ManifestUploadService.SelectedItem.ProviderName=t.ProviderName,this.ManifestUploadService.SelectedItem.Description=t.Description,this.ManifestUploadService.SelectedItem.Capabilities=t.Capabilities,this.ManifestUploadService.SelectedItem.AssignedUsers=t.AssignedUsers,this.ManifestUploadService.SelectedItem.AssignedGroups=t.AssignedGroups,this.ManifestUploadService.SelectedItem.LimitedAvailability=t.LimitedAvailability,this.ManifestUploadService.SelectedItem.AppId=t.AppId,this.ManifestUploadService.SelectedItem.Scopes=t.Scopes,this.ManifestUploadService.SelectedItem.StatusCode=this.ManifestUploadService.IsNewEnableSet?this.ManifestUploadService.IsEnabled?1:0:t.StatusCode,this.ManifestUploadService.SelectedItem.Status=this.PrivateCatalogDisplayService.GetStatus(this.ManifestUploadService.SelectedItem.StatusCode,n.AddInDetails[0].StoreStatusCode),this.addIn=this.ManifestUploadService.SelectedItem,this.ManifestUploadService.AudiencePicker=this.addIn.LimitedAvailability?1:0,this.ManifestUploadService.Members=[],this.ManifestUploadService.ServicePrincipalObjectId=this.addIn.ServicePrincipalObjectId,i=n.AddInDetails[0].StoreStatusCode,this.isStoreAddIn=i!==null&&i!==undefined&&i!==-1,this.ManifestUploadService.IsEnabled=this.addIn.StatusCode===1,this.isStoreAddIn&&(i===1||i===2)&&(this.ManifestUploadService.IsEnabled=!1),this.PopulateMembers(this.addIn.AssignedGroups,1),this.PopulateMembers(this.addIn.AssignedUsers,0),this.ManifestUploadService.IsNewEnableSet=!1,this.showForm=!0,this.getIndicator.SetFinished()},t.prototype.PopulateMembers=function(n,t){var i=this;n&&angular.forEach(n,function(n){return i.PopulateMember(n,t)})},t.prototype.PopulateMember=function(t,i){var u=t.indexOf(';'),r;if(u<=0){this.LogService.LogError(417967,t+' member object is incorrectly populated as it does not correctly contain the delimiter for email and display name.');return}r=new n.Member,r.EmailAddress=t.substring(0,u),r.DisplayName=t.substring(u+1,t.length),r.ProfileInitials=this.ProfileService.GetUserInitials(r.DisplayName),r.ProfileImageColor=this.ProfileService.GetProfileImageColor(r.DisplayName),r.MemberType=i,this.ManifestUploadService.Members.push(r)},t.prototype.ExtractEmailAddresses=function(n,t){var i=this;angular.forEach(n,function(n){return i.PopulateEmailAddressFromMember(n,t)})},t.prototype.PopulateEmailAddressFromMember=function(n,t){switch(n.MemberType){case 0:case 1:t.push(n.EmailAddress);break;default:this.LogService.LogError(417762,n.MemberType+' is neither user nor group')}},t.prototype.SaveSuccess=function(n){if(this.ManifestUploadService.DeepLinkingCampaign=null,n.ResponseResult!==0){this.saveIndicator.SetError(n,'#CloseForm');return}this.saveIndicator.SetFinished(null,'#CloseSaveForm'),this.$scope.$emit('UpdateAddInList')},t.prototype.ClearDeepLinkingCampaign=function(){this.ManifestUploadService.DeepLinkingCampaign&&(this.ManifestUploadService.DeepLinkingCampaign=null,window.location.href=window.location.pathname+window.location.hash)},t.$inject=['$scope','$rootScope','$timeout','LogService','ProfileService','PrivateCatalogService','PrivateCatalogDisplayService','ManifestUploadService'],t}();n.ManifestPreviewController=t,n.app.controller('ManifestPreviewController',t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){var i,r;this.$scope=n,this.SettingsService=t,i=function(){r(),t.GetMultiFactorAuthSettings().then(function(t){n.$emit('showWaitingIndicator',!1),n.multiFactorAuth.showContent=!0,n.multiFactorAuth.manageUrl=t.data.ManageUrl,n.multiFactorAuth.learnUrl=t.data.LearnUrl},function(){n.$emit('showWaitingIndicator',!1),n.multiFactorAuth.showErrors=!0,n.multiFactorAuth.error='Unable to retrieve settings'})},n.Close=function(){n.$emit('closeFlyout')},r=function(){n.multiFactorAuth={},n.multiFactorAuth.showContent=!1,n.multiFactorAuth.showErrors=!1,n.$emit('showWaitingIndicator',!0)},i()}return n.$inject=["$scope","SettingsService"],n}();n.MultiFactorAuthSettingsController=t,n.app.controller("MultiFactorAuthSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){var i,r;this.$scope=n,this.SettingsService=t,i=function(){r(),t.GetStaffHubSettings().then(function(t){n.$emit('showWaitingIndicator',!1),n.StaffHub.showContent=!0,n.StaffHub.manageUrl=t.data.ManageUrl},function(){n.$emit('showWaitingIndicator',!1),n.StaffHub.showErrors=!0,n.StaffHub.error='Unable to retrieve settings'})},n.Close=function(){n.$emit('closeFlyout')},r=function(){n.StaffHub={},n.StaffHub.showContent=!1,n.StaffHub.showErrors=!1,n.$emit('showWaitingIndicator',!0)},i()}return n.$inject=["$scope","SettingsService"],n}();n.StaffHubSettingsController=t,n.app.controller("StaffHubSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){this.$scope=n,this.SettingsService=t,n.init=function(){},n.GetOfficeOnlineSettings=function(){i(),t.GetOfficeOnlineSettings().then(function(t){n.formData=t.data,n.$emit('showWaitingIndicator',!1),n.showForm=!0},function(){n.saveError=!0,n.saveErrorMessage='Unable to retrieve settings',n.$emit('showWaitingIndicator',!1),n.showForm=!0})},n.SaveOfficeOnlineSettings=function(){r(),t.UpdateOfficeOnlineSettings(n.formData).then(function(){u()},function(n){f(n)})},n.Cancel=function(){n.$emit('closeFlyout')};var i=function(){n.$emit('showWaitingIndicator',!0),n.showForm=!1,n.saveInProgress=!1,n.saveFinished=!1,n.saveError=!1,n.formData={}},r=function(){n.showForm=!1,n.saveInProgress=!0,n.saveFinished=!1,n.saveError=!1},u=function(){n.saveInProgress=!1,n.saveFinished=!0,n.showCloseButton=!0},f=function(t){n.showForm=!0,n.saveInProgress=!1,n.saveError=!0,n.saveErrorMessage=t.data.Message}}return n.$inject=["$scope","SettingsService"],n}();n.OfficeOnlineSettingsController=t,n.app.controller("OfficeOnlineSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){this.$scope=n,this.SettingsService=t,n.init=function(){},n.GetSkypeSettings=function(){i(),t.GetSkypeSettings().then(function(t){n.formData=t.data,n.formData.BlockedDomains!=null&&n.formData.BlockedDomains.length>0?(n.formData.domainExceptionType="Blocked",n.formData.blockedDomainsList=n.formData.BlockedDomains.toString()):n.formData.AllowedDomains!=null&&n.formData.AllowedDomains.length>0?(n.formData.domainExceptionType="Allowed",n.formData.allowedDomainsList=n.formData.AllowedDomains.toString()):n.formData.domainExceptionType="AllAllowed",n.$emit('showWaitingIndicator',!1),n.showForm=!0},function(){n.saveError=!0,n.saveErrorMessage='Unable to retrieve settings',n.$emit('showWaitingIndicator',!1),n.showForm=!0})},n.SaveSkypeSettings=function(){r(),n.formData.AllDomainsAllowed=!0,n.formData.AllowedDomains=[],n.formData.BlockedDomains=[],n.formData.domainExceptionType=="Blocked"?n.formData.BlockedDomains=n.formData.blockedDomainsList.split(','):n.formData.domainExceptionType=="Allowed"&&(n.formData.AllowedDomains=n.formData.allowedDomainsList.split(','),n.formData.AllDomainsAllowed=!1),t.UpdateSkypeSettings(n.formData).then(function(){u()},function(n){f(n)})},n.Cancel=function(){n.$emit('closeFlyout')};var i=function(){n.$emit('showWaitingIndicator',!0),n.showForm=!1,n.saveInProgress=!1,n.saveFinished=!1,n.saveError=!1,n.formData={}},r=function(){n.showForm=!1,n.saveInProgress=!0,n.saveFinished=!1,n.saveError=!1},u=function(){n.saveInProgress=!1,n.saveFinished=!0,n.showCloseButton=!0},f=function(t){n.showForm=!0,n.saveInProgress=!1,n.saveError=!0,n.saveErrorMessage=t.data.Message}}return n.$inject=["$scope","SettingsService"],n}();n.SkypeSettingsController=t,n.app.controller("SkypeSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){this.$scope=n,this.SettingsService=t,n.init=function(){},n.GetGigJamSettings=function(){i(),t.GetGigJamSettings().then(function(t){n.formData.ServiceEnabled=t.data.ServiceEnabled,n.formData.ServiceEnabledOriginalValue=t.data.ServiceEnabled,n.$emit('showWaitingIndicator',!1),n.showForm=!0},function(){n.saveError=!0,n.saveErrorMessage='Unable to retrieve settings',n.$emit('showWaitingIndicator',!1),n.showForm=!0})},n.SaveGigJamSettings=function(){r(),t.UpdateGigJamSettings(n.formData).then(function(){u()},function(n){f(n)})},n.Cancel=function(){n.$emit('closeFlyout')};var i=function(){n.$emit('showWaitingIndicator',!0),n.showForm=!1,n.saveInProgress=!1,n.saveFinished=!1,n.saveError=!1,n.formData={}},r=function(){n.showForm=!1,n.saveInProgress=!0,n.saveFinished=!1,n.saveError=!1},u=function(){n.saveInProgress=!1,n.saveFinished=!0,n.showCloseButton=!0},f=function(t){n.showForm=!0,n.saveInProgress=!1,n.saveError=!0,n.saveErrorMessage=t.data.Message}}return n.$inject=["$scope","SettingsService"],n}();n.GigJamSettingsController=t,n.app.controller("GigJamSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){this.$scope=n,this.SettingsService=t,n.GetDocsComSettings=function(){i(),t.GetDocsComSettings().then(function(t){n.formData.ServiceEnabled=t.data.ServiceEnabled,n.formData.ServiceEnabledOriginalValue=t.data.ServiceEnabled,n.$emit('showWaitingIndicator',!1),n.docsComSettingsModel.showForm=!0},function(){n.docsComSettingsModel.saveError=!0,n.docsComSettingsModel.saveErrorMessage='Unable to retrieve settings',n.$emit('showWaitingIndicator',!1),n.docsComSettingsModel.showForm=!0})},n.SaveDocsComSettings=function(){r(),t.UpdateDocsComSettings(n.formData).then(function(){u()},function(n){f(n)})},n.Cancel=function(){n.$emit('closeFlyout')};var i=function(){n.$emit('showWaitingIndicator',!0),n.docsComSettingsModel={},n.docsComSettingsModel.showForm=!1,n.docsComSettingsModel.saveInProgress=!1,n.docsComSettingsModel.saveFinished=!1,n.docsComSettingsModel.saveError=!1,n.formData={}},r=function(){n.docsComSettingsModel.showForm=!1,n.docsComSettingsModel.saveInProgress=!0,n.docsComSettingsModel.saveFinished=!1,n.docsComSettingsModel.saveError=!1},u=function(){n.docsComSettingsModel.saveInProgress=!1,n.docsComSettingsModel.saveFinished=!0,n.docsComSettingsModel.showCloseButton=!0},f=function(t){n.docsComSettingsModel.showForm=!0,n.docsComSettingsModel.saveInProgress=!1,n.docsComSettingsModel.saveError=!0,n.docsComSettingsModel.saveErrorMessage=t.data.Message}}return n.$inject=["$scope","SettingsService"],n}();n.DocsComSettingsController=t,n.app.controller("DocsComSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){this.$scope=n,this.SettingsService=t,n.tabStates={isGeneralExpanded:!1,isTCExpanded:!1,isMeetupsExpanded:!1,isMessagingExpanded:!1,isTabsExpanded:!1,isBotsExpanded:!1},n.init=function(){},n.GetSkypeTeamSettings=function(){r(),t.GetSkypeTeamsSettings().then(function(t){n.formData=t.data,n.$emit('showWaitingIndicator',!1),n.showForm=!0,o()},function(){n.saveError=!0,n.saveErrorMessage='Unable to retrieve settings',n.$emit('showWaitingIndicator',!1),n.showForm=!0})},n.SaveSkypeTeamsSettings=function(){u(),t.UpdateSkypeTeamsSettings(n.formData).then(function(){f()},function(n){e(n)})},n.Cancel=function(){n.$emit('closeFlyout')};var r=function(){n.$emit('showWaitingIndicator',!0),n.showForm=!1,n.saveInProgress=!1,n.saveFinished=!1,n.saveError=!1,n.formData={},n.temporaryFormData={}},u=function(){n.showForm=!1,n.saveInProgress=!0,n.saveFinished=!1,n.saveError=!1},f=function(){n.saveInProgress=!1,n.saveFinished=!0,n.showCloseButton=!0},e=function(t){n.showForm=!0,n.saveInProgress=!1,n.saveError=!0,n.saveErrorMessage=t.data.Message},o=function(){s(),h()},s=function(){var t=[];n.formData&&n.formData.TenantCategorySettings&&n.formData.TenantCategorySettings.length>0&&(n.formData.TenantCategorySettings.forEach(function(n,r){var u=i(n.TenantSkuCategory);u&&u!=="unsupported"&&t.push({name:i(n.TenantSkuCategory),value:r})}),n.temporaryFormData.licenseOptions=t,n.temporaryFormData.licenseIndex=0),t.length===0&&(n.formData.IsSkypeTeamsLicensed=!1)},i=function(n){switch(n){case"BusinessEnterprise":return'Business \x26 Enterprise';case"EducationFaculty":return'Education - Faculty and Staff';case"EducationStudent":return'Education - Student';case"Kiosk":return'Deskless Worker \x28Kiosk\x29';default:return"unsupported"}},h=function(){var t=[];t.push({name:'Strict',value:"Strict"}),t.push({name:'Moderate',value:"Moderate"}),t.push({name:'Allow all content',value:"NoRestriction"}),n.temporaryFormData.contentRatingTypeOptions=t}}return n.$inject=["$scope","SettingsService"],n}();n.SkypeTeamsSettingsController=t,n.app.controller("SkypeTeamsSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){var i;this.$scope=n,this.SettingsService=t,i=function(){r(),t.GetSwaySettings().then(function(t){n.formData=t.data,n.$emit('showWaitingIndicator',!1),n.showForm=!0},function(){n.saveError=!0,n.saveErrorMessage='Unable to retrieve settings',n.$emit('showWaitingIndicator',!1),n.showForm=!0})},n.SaveSwaySettings=function(){u(),t.UpdateSwaySettings(n.formData).then(function(){f()},function(n){e(n)})},n.Cancel=function(){n.$emit('closeFlyout')};var r=function(){n.$emit('showWaitingIndicator',!0),n.showForm=!1,n.saveInProgress=!1,n.saveFinished=!1,n.saveError=!1,n.formData={}},u=function(){n.showForm=!1,n.saveInProgress=!0,n.saveFinished=!1,n.saveError=!1},f=function(){n.saveInProgress=!1,n.saveFinished=!0,n.showCloseButton=!0},e=function(t){n.showForm=!0,n.saveInProgress=!1,n.saveError=!0,n.saveErrorMessage=t.data.Message};i()}return n.$inject=["$scope","SettingsService"],n}();n.SwaySettingsController=t,n.app.controller("SwaySettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){function i(){n.showform=!0,n.inprogress=!1,n.finished=!1,n.isError=!1,n.formData={}}this.$scope=n,this.SettingsService=t,n.SendDelveRequestEmail=function(){n.showform=!1,n.inprogress=!0,n.finished=!1,n.isError=!1,t.SendDelveRequestEmail(n.formData).then(function(t){t.data?(n.showform=!1,n.inprogress=!1,n.finished=!0):(n.showform=!1,n.inprogress=!1,n.finished=!0,n.isError=!0)},function(){n.showform=!1,n.inprogress=!1,n.finished=!0,n.isError=!0})},n.Cancel=function(){n.$emit('closeFlyout')},i()}return n.$inject=["$scope","SettingsService"],n}();n.DelveSettingsController=t,n.app.controller("DelveSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function r(){n.showform=!1,n.isError=!1,n.inprogress=!1,n.finished=!1,n.formData={},t.features.ReportsUseUpdatedTenantConfig?i.GetReportsSettings().then(function(t){if(t.data&&t.data.Output&&t.data.Output.length>0){n.showform=!0;var i=JSON.parse(t.data.Output[0]);n.formData.PrivacyEnabled=i.PrivacyEnabled,n.formData.PowerBiEnabled=i.PowerBiEnabled}else n.isError=!0,n.errorMessage='Unable to retrieve settings'},function(){n.isError=!0,n.errorMessage='Unable to retrieve settings'}):i.GetReportsPrivacySettings().then(function(t){n.showform=!0,n.formData.PrivacyEnabled=t.data},function(){n.isError=!0,n.errorMessage='Unable to retrieve settings'})}this.$scope=n,this.SettingsService=i,n.OnSaveError=function(){n.isError=!0,n.showform=!1,n.inprogress=!1,n.finished=!0},n.UpdateReportsSettings=function(){n.showform=!1,n.inprogress=!0,n.finished=!1,n.isError=!1,t.features.ReportsUseUpdatedTenantConfig?i.UpdateReportsSettings(n.formData).then(function(t){t&&typeof t!='undefined'&&typeof t.data!='undefined'?(n.showform=!1,n.inprogress=!1,n.isError=!1,n.finished=!0):n.OnSaveError()},function(){n.OnSaveError()}):i.UpdateReportsPrivacySettings(n.formData.PrivacyEnabled).then(function(t){t&&typeof t!='undefined'&&typeof t.data!='undefined'?(n.showform=!1,n.inprogress=!1,n.isError=!1,n.finished=!0):n.OnSaveError()},function(){n.OnSaveError()})},n.Cancel=function(){n.$emit('closeFlyout')},r()}return n.$inject=["$scope","$rootScope","SettingsService"],n}();n.ReportsSettingsController=t,n.app.controller("ReportsSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){var e=this,f;this.$scope=n,this.$rootScope=t,this.$sce=i,this.$window=r,this.ManifestUploadService=u,this.iframeUrl='',f=r.location.hostname.replace('portal.','store.'),f=f.replace('portal-sdf.','store.'),this.iframeUrl=i.trustAsResourceUrl('https://'+f+'/gyro/clientstore?app=office365&client=office365&ad='+this.GetRegion()+'&rs='+this.$rootScope.CultureInfo+'&ui='+this.$rootScope.CultureInfo),this.AddInSelected=this.AddInSelected.bind(this),this.$window.addEventListener('message',this.AddInSelected,!1),this.RemoveMessageListener=this.RemoveMessageListener.bind(this),this.$scope.$on('closePanel',this.RemoveMessageListener),this.$scope.$on('closeFlyout',this.RemoveMessageListener),this.$scope.$on('$destroy',this.RemoveMessageListener),this.$scope.initCallbackFlyout=function(n){e.$scope.flyout=n}}return n.prototype.Cancel=function(){this.$scope.$emit('closeFlyout')},n.prototype.GetRegion=function(){var n=this.$rootScope.CultureInfo.split('-');return n[n.length-1]},n.prototype.AddInSelected=function(n){this.ManifestUploadService.AssetId=n.data.assetId,this.ManifestUploadService.ContentCulture=n.data.contentCulture,this.$scope.flyout.invoke({flyoutTemplateUrl:'../AdminPortal/Settings/ManifestPreview',flyoutType:'manifestPreview',flyoutHeaderTitle:'',flyoutHeaderIcon:'ms-Icon ms-Icon--apps ss-apps-icon',selecteditem:{},entry:'panel'}),this.$scope.$emit('closePanel'),this.RemoveMessageListener(null)},n.prototype.RemoveMessageListener=function(){this.$window.removeEventListener('message',this.AddInSelected,!1)},n.$inject=['$scope','$rootScope','$sce','$window','ManifestUploadService'],n}();n.ManifestStoreUploadController=t,n.app.controller('ManifestStoreUploadController',t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var i=function(){function n(n,i,r,u){var f=this;this.$scope=n,this.$rootScope=i,this.LogService=r,this.ManifestUploadService=u,this.uploadChoice=t[0],this.error=!1,this.$scope.$on('FileUpload',function(n,t,i){return f.FileUploaded(t,i)}),this.ShouldShowStore()||(this.uploadChoice=t[1])}return n.prototype.ShouldShowStore=function(){return this.$rootScope.features.PrivateCatalogStore&&!this.ManifestUploadService.IsUpdating},n.prototype.ShouldDisableSubmit=function(){switch(t[this.uploadChoice]){case 0:return!1;case 1:return this.error||!this.ManifestUploadService.Contents||this.ManifestUploadService.Contents.length===0;case 2:return!n.urlExpression.test(this.ManifestUploadService.Url);default:return this.LogService.LogError(417764,'Unrecognized upload choice: '+this.uploadChoice),!0}},n.prototype.Submit=function(){switch(t[this.uploadChoice]){case 0:this.ManifestUploadService.Contents='',this.ManifestUploadService.Url='';break;case 1:this.ManifestUploadService.Url='';break;case 2:this.ManifestUploadService.Contents='';break;default:this.LogService.LogError(417765,'Unrecognized upload choice: '+this.uploadChoice)}},n.prototype.Cancel=function(){this.$scope.$emit('closeFlyout')},n.prototype.CancelUpdate=function(){this.ManifestUploadService.IsUpdating=!1},n.prototype.FileUploaded=function(n,t){this.error=n,this.ManifestUploadService.Contents=t},n.$inject=['$scope','$rootScope','LogService','ManifestUploadService'],n.urlExpression=/^http(s)?:\/\/.+/i,n}(),t;n.ManifestUploadController=i,function(n){n[n.Store=0]="Store",n[n.File=1]="File",n[n.Url=2]="Url"}(t||(t={})),n.app.controller('ManifestUploadController',i)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){var i;this.$scope=n,this.AppsService=t,i=function(){r(),t.GetSettingDetails(n.formData.AppId).then(function(t){n.formData.Enabled=t.data,n.integratedAppsSettings.originalEnabledValue=n.formData.Enabled,n.$emit('showWaitingIndicator',!1),n.integratedAppsSettings.showForm=!0},function(){n.integratedAppsSettings.saveError=!0,n.integratedAppsSettings.saveErrorMessage='Unable to retrieve settings',n.$emit('showWaitingIndicator',!1),n.integratedAppsSettings.showForm=!0})},n.SaveIntegratedAppsSettings=function(){u(),t.UpdateSetting(n.formData).then(function(){f()},function(n){e(n)})},n.Cancel=function(){n.$emit('closeFlyout')},n.ShowIntegratedAppsHelp=function(){window.open("http://go.microsoft.com/fwlink/?LinkId=512425","O365Help","width=400,height=500,menubar=no,status=no,scrollbars=no,titlebar=no,toolbar=no,resizable=yes")};var r=function(){n.integratedAppsSettings={},n.integratedAppsSettings.showForm=!1,n.integratedAppsSettings.saveInProgress=!1,n.integratedAppsSettings.saveFinished=!1,n.integratedAppsSettings.saveError=!1,n.formData={},n.formData.AppId="integratedapps",n.$emit('showWaitingIndicator',!0)},u=function(){n.integratedAppsSettings.showForm=!1,n.integratedAppsSettings.saveInProgress=!0,n.integratedAppsSettings.saveFinished=!1,n.integratedAppsSettings.saveError=!1},f=function(){n.integratedAppsSettings.saveInProgress=!1,n.integratedAppsSettings.saveFinished=!0,n.integratedAppsSettings.showCloseButton=!0},e=function(t){n.integratedAppsSettings.showForm=!0,n.integratedAppsSettings.saveInProgress=!1,n.integratedAppsSettings.saveError=!0,n.integratedAppsSettings.saveErrorMessage=t.data.Message};i()}return n.$inject=["$scope","AppsService"],n}();n.IntegratedAppsSettingsController=t,n.app.controller("IntegratedAppsSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){var r;this.$scope=n,this.AppsService=t,r=function(){e(),n.Picker={Type:2,allItemsListTitle:'Users with permission',placeholderText:'Search users with permission'}},n.SavebusinessAppsSettings=function(){o()},n.Cancel=function(){n.$emit('closeFlyout')},n.Done=function(){n.businessAppsSettings.showPeoplePicker=!1},n.SaveDisabled=function(t){return t.selectedItems==null||t.selectedItems.length===0||n.isOwner&&n.RemovePicker&&n.RemovePicker.allItems.length===0},n.SaveUsers=function(r){n.businessAppsSettings.saveInProgress=!0;var e={},o=n.businessAppsData[n.businessAppsSettings.index].AppName;e=r?n.AddPicker.GetSelectedItems():n.RemovePicker.GetSelectedItems(),t.UpdateUserAppAccess(o,e,r).then(function(){n.businessAppsSettings.saveInProgress=!1,n.businessAppsSettings.showPeoplePicker=!1,n.businessAppsSettings.showForm=!1,n.businessAppsSettings.Message='The list of users that have access was updated.',u(),f(o)},function(t){n.businessAppsSettings.saveInProgress=!1,n.businessAppsSettings.showPeoplePicker=!1,n.businessAppsSettings.showForm=!1,i(t.data)})},n.CancelPicker=function(){n.businessAppsSettings.showViewMembers=!0,n.businessAppsSettings.showAddMembers=!1,n.businessAppsSettings.showRemoveMembers=!1},n.BackToPicker=function(){n.businessAppsSettings.saveInProgress=!1,n.businessAppsSettings.saveFinished=!1,n.businessAppsSettings.showForm=!0,n.goBackToInitialView||(n.businessAppsSettings.showPeoplePicker=!0),n.CancelPicker()},n.EnableSubmitButton=function(t){n.businessAppsData[t].showDetails=!n.businessAppsData[t].showDetails,n.businessAppsSettings.enableSubmitButton=!0},n.ToggleDetails=function(t){n.businessAppsData[t].showDetails=!n.businessAppsData[t].showDetails},n.OpenRemoveMembers=function(){n.AddPicker=null,n.RemovePicker={Type:1,action:1,existingItems:n.Picker.allItems,pageToken:n.Picker.pageToken,allItemsListTitle:'All users',placeholderText:'Search for users',SearchCategories:n.Picker.SearchCategories},n.businessAppsSettings.showViewMembers=!1,n.businessAppsSettings.showAddMembers=!1,n.businessAppsSettings.showRemoveMembers=!0},n.OpenAddMembers=function(){n.RemovePicker=null,n.AddPicker={Type:1,MemberType:0,SearchTypes:[0],originalItems:n.Picker.allItems,allItemsListTitle:'All users',placeholderText:'Search for users'},n.businessAppsSettings.showViewMembers=!1,n.businessAppsSettings.showRemoveMembers=!1,n.businessAppsSettings.showAddMembers=!0},n.ShowPeoplePicker=function(r){var u=[{SearchCategory:8,Filter:n.businessAppsData[r].AppName}];n.Picker.SearchCategories=u,n.goBackToInitialView=!1,t.UpdateSMBEntitledApps(n.businessAppsData).then(function(){n.businessAppsSettings.showViewMembers=!0,n.businessAppsSettings.index=r,n.businessAppsSettings.showPeoplePicker=!0,n.businessAppsSettings.enableSubmitButton=!1},function(n){i(n.data)})};var f=function(i){t.GetAppPermission(i).then(function(t){n.businessAppsData[n.businessAppsSettings.index].userList=t.data},function(){})},e=function(){n.businessAppsSettings={},n.businessAppsSettings.showForm=!1,n.businessAppsSettings.saveInProgress=!1,n.businessAppsSettings.saveFinished=!1,n.businessAppsSettings.saveError=!1,n.businessAppsSettings.showPeoplePicker=!1,n.businessAppsSettings.enableSubmitButton=!1,t.GetSMBEntitledApps().then(function(i){n.businessAppsData=i.data,angular.forEach(n.businessAppsData,function(n){n.showDetails=n.AppStatus.toLowerCase()=="on",n.userList={},n.loading=!1,n.AccessControlEnabled&&(n.loading=!0,t.GetAppPermission(n.AppName).then(function(t){n.userList=t.data,n.loading=!1},function(){n.errorRetrievingUsers=!0,n.loading=!1}))}),n.businessAppsSettings.showForm=!0},function(){n.businessAppsSettings.noEntitledApps=!1,n.businessAppsSettings.showForm=!0})},o=function(){n.businessAppsSettings.showForm=!1,n.businessAppsSettings.saveInProgress=!0,n.businessAppsSettings.saveFinished=!1,n.businessAppsSettings.saveError=!1,t.UpdateSMBEntitledApps(n.businessAppsData).then(function(){n.businessAppsSettings.Message='Successfully updated the app status.',u(),n.goBackToInitialView=!0},function(n){i(n.data)})},u=function(){n.businessAppsSettings.saveInProgress=!1,n.businessAppsSettings.saveFinished=!0,n.businessAppsSettings.showCloseButton=!0},i=function(t){n.businessAppsSettings.showForm=!0,n.businessAppsSettings.saveInProgress=!1,n.businessAppsSettings.saveError=!0,n.businessAppsSettings.saveErrorMessage=t.data.Message};r()}return n.$inject=["$scope","AppsService"],n}();n.BusinessAppsSettingsController=t,n.app.controller("BusinessAppsSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){var i;this.$scope=n,this.AppsService=t,i=function(){r(),t.GetSettingDetails(n.formData.AppId).then(function(t){n.formData.Enabled=t.data.BesEnabled,n.mobileSettings.originalEnabledValue=n.formData.Enabled,n.mobileSettings.besManageUrl=t.data.BesManageUrl,n.mobileSettings.besSupportUrl=t.data.BesSupportUrl,n.mobileSettings.besAcceptTermsUrl=t.data.BesAcceptTermsUrl,n.$emit('showWaitingIndicator',!1),n.mobileSettings.showForm=!0},function(){n.mobileSettings.saveError=!0,n.mobileSettings.saveErrorMessage='Unable to retrieve settings',n.$emit('showWaitingIndicator',!1),n.mobileSettings.showForm=!0})},n.SaveMobileSettings=function(){u(),t.UpdateSetting(n.formData).then(function(){f()},function(n){e(n)})},n.Cancel=function(){n.$emit('closeFlyout')};var r=function(){n.mobileSettings={},n.mobileSettings.showForm=!1,n.mobileSettings.saveInProgress=!1,n.mobileSettings.saveFinished=!1,n.mobileSettings.saveError=!1,n.formData={},n.formData.AppId="mobile",n.$emit('showWaitingIndicator',!0)},u=function(){n.mobileSettings.showForm=!1,n.mobileSettings.saveInProgress=!0,n.mobileSettings.saveFinished=!1,n.mobileSettings.saveError=!1},f=function(){n.mobileSettings.saveInProgress=!1,n.mobileSettings.saveFinished=!0,n.mobileSettings.showCloseButton=!0},e=function(t){n.mobileSettings.showForm=!0,n.mobileSettings.saveInProgress=!1,n.mobileSettings.saveError=!0,n.mobileSettings.saveErrorMessage=t.data.Message};i()}return n.$inject=["$scope","AppsService"],n}();n.MobileSettingsController=t,n.app.controller("MobileSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){var i;this.$scope=n,this.AppsService=t,i=function(){r(),t.GetSettingDetails(n.formData.AppId).then(function(t){n.formData.Enabled=t.data,n.storeSettings.originalEnabledValue=n.formData.Enabled,n.$emit('showWaitingIndicator',!1),n.storeSettings.showForm=!0},function(){n.storeSettings.saveError=!0,n.storeSettings.saveErrorMessage='Unable to retrieve settings',n.$emit('showWaitingIndicator',!1),n.storeSettings.showForm=!0})},n.SaveStoreSettings=function(){u(),t.UpdateSetting(n.formData).then(function(){f()},function(n){e(n)})},n.Cancel=function(){n.$emit('closeFlyout')};var r=function(){n.storeSettings={},n.storeSettings.showForm=!1,n.storeSettings.saveInProgress=!1,n.storeSettings.saveFinished=!1,n.storeSettings.saveError=!1,n.formData={},n.formData.AppId="store",n.$emit('showWaitingIndicator',!0)},u=function(){n.storeSettings.showForm=!1,n.storeSettings.saveInProgress=!0,n.storeSettings.saveFinished=!1,n.storeSettings.saveError=!1},f=function(){n.storeSettings.saveInProgress=!1,n.storeSettings.saveFinished=!0,n.storeSettings.showCloseButton=!0},e=function(t){n.storeSettings.showForm=!0,n.storeSettings.saveInProgress=!1,n.storeSettings.saveError=!0,n.storeSettings.saveErrorMessage=t.data.Message};i()}return n.$inject=["$scope","AppsService"],n}();n.StoreSettingsController=t,n.app.controller("StoreSettingsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){var r;this.$scope=n,this.$rootScope=t,this.CompanyProfileService=i,r=function(){e(),n.Picker={Type:2,placeholderText:'Search email address or name'},n.selecteditem.ReleaseTrack=="StagedRollout"?(n.Picker.SearchCategories=[{SearchCategory:0,Filter:{Membership:4}}],n.Picker.allItemsListTitle='First release users',n.FirstReleaseUsersModel.ViewTitle='View first release users',n.FirstReleaseUsersModel.RemoveTitle='Remove first release users',n.FirstReleaseUsersModel.AddTitle='Add first release users'):n.selecteditem.ReleaseTrack=="Compass"&&(n.Picker.SearchCategories=[{SearchCategory:0,Filter:{Membership:5}}],n.Picker.allItemsListTitle='Compass users',n.FirstReleaseUsersModel.ViewTitle='View compass users',n.FirstReleaseUsersModel.RemoveTitle='Remove compass users',n.FirstReleaseUsersModel.AddTitle='Add compass users'),n.selecteditem.GoToAdd===!0&&n.OpenAddMembers()},n.OpenRemoveMembers=function(){n.RemovePicker={Type:1,action:1,existingItems:n.Picker.allItems,allItemsListTitle:n.Picker.allItemsListTitle,placeholderText:n.Picker.placeholderText,SearchCategories:n.Picker.SearchCategories},n.FirstReleaseUsersModel.showViewMembers=!1,n.FirstReleaseUsersModel.showAddMembers=!1,n.FirstReleaseUsersModel.showRemoveMembers=!0},n.OpenAddMembers=function(){n.AddPicker={Type:1,action:0,allItemsListTitle:'All',inputLabel:'We recommend you select admins and people in your organization who identify themselves as power users.\u200b',placeholderText:n.Picker.placeholderText,SearchCategories:[{SearchCategory:0,Filter:{MaxResults:-1,CheckMembership:6,CheckMembershipDetails:{ReleaseTrack:n.selecteditem.ReleaseTrack}}}]},n.FirstReleaseUsersModel.showViewMembers=!1,n.FirstReleaseUsersModel.showRemoveMembers=!1,n.FirstReleaseUsersModel.showAddMembers=!0},n.CloseSummary=function(){n.showForm=!0,n.saveInProgress=!1,n.saveFinished=!1,n.saveError=!1,n.FirstReleaseUsersModel.showRemoveMembers=!1,n.FirstReleaseUsersModel.showAddMembers=!1,n.FirstReleaseUsersModel.showViewMembers=!0,n.Picker.RefreshList()},n.CancelMembershipEdit=function(){n.FirstReleaseUsersModel.showAddMembers=!1,n.FirstReleaseUsersModel.showRemoveMembers=!1,n.FirstReleaseUsersModel.showViewMembers=!0,n.saveError=!1},n.SaveDisabled=function(n){return n.selectedItems==null||n.selectedItems.length===0},n.SaveSelectedPeople=function(t){var e=n.selecteditem.ReleaseTrack,r={};o(),r.ReleaseTrack=e,t?r.AddUsers=n.AddPicker.GetSelectedItems():r.RemoveUsers=n.RemovePicker.GetSelectedItems(),e=='StagedRollout'?i.UpdateReleasePreferenceUsers(r).then(function(){u()},function(){f()}):e=="Compass"&&i.UpdateReleasePreferenceCompassUsers(r).then(function(){u()},function(){f()})},n.Cancel=function(){n.changesSaved&&t.$broadcast("refreshReleasePreferences"),n.$emit('closeFlyout')};var e=function(){n.showForm=!0,n.saveInProgress=!1,n.saveFinished=!1,n.saveError=!1,n.changesSaved=!1,n.FirstReleaseUsersModel={},n.FirstReleaseUsersModel.showAddMembers=!1,n.FirstReleaseUsersModel.showRemoveMembers=!1,n.FirstReleaseUsersModel.showViewMembers=n.selecteditem.GoToAdd?!1:!0},o=function(){n.showForm=!1,n.saveInProgress=!0,n.saveFinished=!1,n.saveError=!1},u=function(){n.saveInProgress=!1,n.saveFinished=!0,n.showCloseButton=!0,n.changesSaved=!0},f=function(){n.showForm=!0,n.saveInProgress=!1,n.saveError=!0,n.saveErrorMessage='Please try again later.'},s=function(n){return!(n===null||n===""||n===" "||n===undefined)};r()}return n.$inject=["$scope","$rootScope","CompanyProfileService"],n}();n.FirstReleaseUsersController=t,n.app.controller("FirstReleaseUsersController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u){function o(){t.isDataReady=!1,t.saveinprogress=!1,t.FailedGettingAdminRoles=!1,t.formData.SelectedHighLevelRoleGuid=n.GUIDForNoAdminAccess,t.formData.OtherAdminRoles=[],t.enableAlternateEmail=!0,t.isCurrentRoleLimitedAdmin=!1,t.emailNotAvailable="not available",t.formData.EmailAddress="",t.selectSecurityGroupOption={Name:"SelectaSecurityGroup",DisplayName:"Select a role",Description:"SelectaSecurityGroup",ObjectId:n.EmptyGUID,IsEnabled:!0},t.selectedSecurityRole=t.selectSecurityGroupOption,t.PartnerAgentSecurityGroups=[],t.PartnerAgentSecurityGroups.push(t.selectSecurityGroupOption),t.enableSecurityGroupOptions=!1,t.showSecurityGroupSelectionError=!1,t.selecteditem&&(t.IsSelfEditing=r.IsSelfUser(t.selecteditem.UserPrincipalName),t.formData.ObjectId=t.selecteditem.ObjectId,t.formData.UserId=t.formData.ObjectId,r.GetUserDetails(t.formData.UserId).then(function(n){t.formData.EmailAddress=n.data.AlternateEmailAddresses}),r.GetUserAdminRoles(t.selecteditem.ObjectId).then(f,e)),t.UserNewRoles=[],t.validEmail=!0}this.$scope=t,this.$rootScope=i,this.UserManagementService=r,this.PanelService=u;var f=function(i){t.adminRoles=i.data,angular.forEach(t.adminRoles.HighlevelRoles,function(i){i.IsEnabled&&(t.formData.SelectedHighLevelRoleGuid=i.ObjectId,t.userrole=i,i.ObjectId==n.GUIDForNoAdminAccess?(t.isCurrentRoleLimitedAdmin=!1,t.enableAlternateEmail=!1):i.ObjectId==n.EmptyGUID&&(t.isCurrentRoleLimitedAdmin=!0,t.enableAlternateEmail=!0))}),angular.forEach(t.adminRoles.UserSecurityGroups,function(n){t.PartnerAgentSecurityGroups.push(n),n.IsEnabled&&(t.selectedSecurityRole=n,t.enableSecurityGroupOptions=!0)}),t.isDataReady=!0},e=function(n){t.statusMessage=n.data.Message,t.showSummary=!0,t.isDataReady=!0},l=function(n){return n===null||n===""||n===undefined};o(),t.ClearAdminRole=function(){t.enableAlternateEmail=!0,angular.forEach(t.adminRoles.HighlevelRoles,function(n){n.IsEnabled=!1}),angular.forEach(t.adminRoles.OtherAdminRoles,function(n){n.IsEnabled=!1})},t.showCustomValidationMessage=function(){if(t.isCurrentRoleLimitedAdmin&&t.saveClicked){var n=!1;return angular.forEach(t.adminRoles.OtherAdminRoles,function(t){t.IsEnabled&&(n=!0)}),!n}return!1},t.GetCurrentAdminRole=function(i,r){t.ClearAdminRole(),t.userrole=i,t.saveClicked=!1,t.formData.SelectedHighLevelRoleGuid=i.ObjectId,t.adminRoles.HighlevelRoles[r].IsEnabled=!0,i.ObjectId==n.GUIDForNoAdminAccess?(t.isCurrentRoleLimitedAdmin=!1,t.enableAlternateEmail=!1):i.ObjectId==n.EmptyGUID?(t.isCurrentRoleLimitedAdmin=!0,t.enableAlternateEmail=!0):(t.isCurrentRoleLimitedAdmin=!1,t.enableAlternateEmail=!0)},t.Cancel=function(){t.$emit('closeFlyout')};var s=function(){t.$root.selectedViewType==n.RoleViewType&&(t.formData.refreshListArgs={})},h=function(){u.SetSelectedItem(t.formData)},c=function(){angular.isDefined(t.$root.BillingNotificationsAdmins)&&(t.formData.refreshListArgs=t.selecteditem.ObjectId)};t.Submit=function(i){(t.saveClicked=!0,t.showCustomValidationMessage())||i.$valid&&(t.$emit('showWaitingIndicator',!0),t.saveinprogress=!0,angular.forEach(t.adminRoles.HighlevelRoles,function(i){i.ObjectId===n.EmptyGUID&&angular.forEach(t.adminRoles.OtherAdminRoles,function(n){n.IsEnabled&&t.formData.OtherAdminRoles.push(n)})}),t.formData.SelectedPartnerAgentSecurityGroup=t.adminRoles.UserSecurityGroups!==null?t.selectedSecurityRole.ObjectId:n.EmptyGUID,r.UpdateUserRoles(t.selecteditem.ObjectId,t.formData).then(function(n){c(),t.$emit('showWaitingIndicator',!1),t.showSummary=!0,t.statusMessage=n.data.Message,h(),s()},function(n){t.$emit('showWaitingIndicator',!1),t.statusMessage=n.data.Message,t.showSummary=!0}))},t.ToggleSecurityGroupOptions=function(n){n?t.selectedSecurityRole===t.selectSecurityGroupOption&&(t.selectedSecurityRole=t.selectSecurityGroupOption,t.showSecurityGroupSelectionError=!0):(t.showSecurityGroupSelectionError=!1,t.selectedSecurityRole=t.selectSecurityGroupOption),t.enableSecurityGroupOptions=n},t.GetSelectedSecurityGroup=function(i){t.selectedSecurityRole=i,t.showSecurityGroupSelectionError=t.enableSecurityGroupOptions&&i.ObjectId==n.EmptyGUID?!0:!1}}return t.$inject=["$scope","$rootScope","UserManagementService","PanelService"],t}();n.EditUserRolesController=t,n.app.controller("EditUserRolesController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u,f){this.$scope=t,this.$rootScope=i,this.UserManagementService=r,this.HelperService=u,this.IntuneService=f;var o=function(n){var f=[],i=n?t.Picker.selectedItems:t.selecteditem;u.IsValid(i.length)?angular.forEach(i,function(n){u.IsValid(n.Devices)?n.Devices.length>0&&(t.showBulkDeleteDevicesWarning=!0):f.push(n.ObjectId)}):u.IsValid(i.Devices)||f.push(i.ObjectId),f.length>0&&r.GetIntuneDevices(f).then(function(n){u.IsValid(n.data)&&u.IsValid(n.data.length)&&n.data.length>0?angular.forEach(n.data,function(n){angular.forEach(i,function(i){u.IsValid(i.Devices)||(i.Devices=[]),i.ObjectId.indexOf(n.UserId)>-1&&(t.showBulkDeleteDevicesWarning=!0,i.Devices.push(n))})}):u.IsValid(n.data)&&(i.Devices=n.data)})},e=function(t){var i=new n.DeleteUserModel;return i.userId=t.ObjectId,i.hasIntuneDevices=u.IsValid(t.Devices)&&u.IsValid(t.Devices.length)&&t.Devices.length>0,i};t.init=function(){t.shouldShowPicker=!angular.isDefined(t.selecteditem)||angular.equals({},t.selecteditem),t.confirmMessage="",t.IsSelfEditing=!1,t.saveinprogress=!1,t.isServerError=!1,t.singleUserException=!1,t.multiUserException=!1,t.noException=!1,t.formData.DeleteUserDataModel=[],t.showChainingItems=!1,t.selectedOrPickedItem={},t.deletedUserResponse=[],t.showBulkDeleteDevicesWarning=!1,t.callGetIntuneDevices=!0,t.showIntuneUserDevicesMaxCount=4,t.showIntuneUsersMaxCount=20,u.IsValid(t.selecteditem)&&o(!1),t.confirmMessage=angular.isUndefined(t.selecteditem)||!angular.isUndefined(t.selecteditem.length)&&t.selecteditem.length>1?'Are you sure that you want to delete these users\x3f ':'Are you sure that you want to delete this user\x3f ',t.Picker={Type:1,showRemovedItems:!1,showAddedItems:!1,allItemsListTitle:'Users',inputLabel:'Type the person\x27s name or email address'}},t.init(),t.CheckSelfEditingUser=function(){var n=!1;return angular.isDefined(t.selecteditem)?angular.isDefined(t.selecteditem.length)?angular.forEach(t.selecteditem,function(t){var u=t.UserPrincipalName?t.UserPrincipalName:t.EmailAddress;n=n?!0:r.IsSelfUser(u)}):n=r.IsSelfUser(t.selecteditem.UserPrincipalName):t.Picker.addedItems!=null&&t.Picker.addedItems.length>0&&angular.forEach(t.Picker.addedItems,function(t){n=n?!0:r.IsSelfUser(t.Item.UserPrincipalName)}),n},t.Cancel=function(){t.$emit('closeFlyout'),ModalFeedbackV2.ShowModal("DeleteUser","admin")},t.$watch(function(){t.Picker.addedItems!=null&&t.Picker.addedItems.length==1?(t.showChainingItems=!0,t.selectedOrPickedItem=t.Picker.selectedItems[0].Item,t.deleteUserError=!1,!u.IsValid(t.Picker.selectedItems[0].Devices)&&t.callGetIntuneDevices&&(o(!0),t.callGetIntuneDevices=!1)):angular.isDefined(t.selecteditem)&&angular.isDefined(t.selecteditem.length)&&t.selecteditem.length==1?(t.showChainingItems=!0,t.selectedOrPickedItem=t.selecteditem,t.callGetIntuneDevices=!0,t.showBulkDeleteDevicesWarning=!1):angular.isDefined(t.selecteditem)&&t.selecteditem.ObjectId?(t.showChainingItems=!0,t.selectedOrPickedItem=t.selecteditem,t.callGetIntuneDevices=!0,t.showBulkDeleteDevicesWarning=!1):(t.showChainingItems=!1,t.callGetIntuneDevices=!0)}),t.ShouldDisableSave=function(){if(angular.isUndefined(t.selecteditem)||angular.equals({},t.selecteditem))return t.Picker.addedItems==null||t.Picker.addedItems.length==0&&t.Picker.removedItems.length==0},t.Submit=function(n){if(t.ShouldDisableSave()){t.deleteUserError=!0,t.deleteUserErrorMessage='Please select a user.';return}if(t.CheckSelfEditingUser()){t.deleteUserError=!0,t.deleteUserErrorMessage='you are not allowed make this opetation.';return}t.saveinprogress=!0,t.deleteUserError=!1,n.$valid&&(angular.isUndefined(t.selecteditem)||angular.equals({},t.selecteditem)?angular.forEach(t.Picker.selectedItems,function(n){t.formData.DeleteUserDataModel.push(e(n))}):angular.isUndefined(t.selecteditem.length)?t.formData.DeleteUserDataModel.push(e(t.selecteditem)):angular.forEach(t.selecteditem,function(n){t.formData.DeleteUserDataModel.push(e(n))}),r.DeleteUsers(t.formData.DeleteUserDataModel).then(function(n){t.$emit('showWaitingIndicator',!1),t.saveinprogress=!1,t.showSummary=!0,t.isServerError=!1,t.deletedUserResponse=n.data,t.formData.refreshListArgs={},t.noException=!0,t.$emit('closePanel'),angular.forEach(t.deletedUserResponse,function(n){n.Status!==0&&(t.formData.DeleteUserDataModel.length===1?t.singleUserException=!0:t.multiUserException=!0,t.noException=!1)})},function(n){t.$emit('showWaitingIndicator',!1),t.deletedUserResponse=n.data,t.saveinprogress=!1,t.isServerError=!0,t.showSummary=!0}),t.isServerError||f.RemoveUsersCompanyDataDevices(t.formData.DeleteUserDataModel))}}return t.$inject=["$scope","$rootScope","UserManagementService","HelperService","IntuneService"],t}();n.DeleteUserController=t,n.app.controller("DeleteUserController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){this.$scope=n,this.$rootScope=t,this.UserManagementService=i,this.AccessibilityService=r,n.init=function(){n.shouldShowPicker=!angular.isDefined(n.selecteditem)||angular.equals({},n.selecteditem),n.IsSelfEditing=!1,n.pickerSelectionError=!1,n.ResetUserPasswordModel={NotifyResetPassword:!1,ForceChangePassword:!1,UserId:[],Password:null,NotifyEmails:t.CurrentUserInfo.UserInfo.UserPrincipalName},n.selfgeneratedpassword="********",n.validEmail=!1,n.showEmailConfirmationMessage=!1,n.showSendEmailControl=!0,n.emailSendFailure=!1,i.GetUserChangePasswordLink().then(function(t){n.createChangePasswordUrl=t.data}),angular.isDefined(n.selecteditem)&&(angular.isDefined(n.selecteditem.length)?angular.forEach(n.selecteditem,function(t){n.IsSelfEditing=n.IsSelfEditing?!0:i.IsSelfUser(t.UserPrincipalName)}):n.IsSelfEditing=i.IsSelfUser(n.selecteditem.UserPrincipalName)),n.Picker={Type:1,showRemovedItems:!1,showAddedItems:!1,allItemsListTitle:'Users',inputLabel:'Type the person\x27s name or email address'},n.formData.sendPasswordEmailCheck=!0,n.formData.sendPasswordEmailAddress=t.CurrentUserInfo.UserInfo.UserPrincipalName,n.sendPasswordEmailModel={Recipients:n.formData.sendPasswordEmailAddress,Message:"",EmailTemplate:2,EmailContents:[]}},n.init(),n.CheckSelfEditingUser=function(){var t=!1;return angular.isDefined(n.selecteditem)?angular.isDefined(n.selecteditem.length)?angular.forEach(n.selecteditem,function(n){var u=n.UserPrincipalName?n.UserPrincipalName:n.EmailAddress;t=t?!0:i.IsSelfUser(u)}):t=i.IsSelfUser(n.selecteditem.UserPrincipalName):n.Picker.addedItems!=null&&n.Picker.addedItems.length>0?angular.forEach(n.Picker.addedItems,function(n){t=t?!0:i.IsSelfUser(n.Item.UserPrincipalName)}):(n.formData.NewPassword="",n.formData.isSelfgeneratePassword=!1,n.formData.passwordchoice=n.formData.autogenerateValue,n.resetUserPasswordForm&&(n.resetUserPasswordForm.$setUntouched(),n.resetUserPasswordForm.$setPristine())),t},n.$on('PickerItemAdded',function(){n.Picker&&n.Picker.selectedItems&&n.Picker.selectedItems.length>0&&(n.formData.ShowPasswordChoice=!0,n.$applyAsync())}),n.$on('PickerItemRemoved',function(){n.Picker&&n.Picker.selectedItems&&n.Picker.selectedItems.length===0&&(n.formData.ShowPasswordChoice=!1,n.$applyAsync())}),n.Cancel=function(){n.$emit('closeFlyout'),ModalFeedbackV2.ShowModal("ResetUserPassword","admin")},n.SaveDisabled=function(){return angular.isUndefined(n.selecteditem)||angular.equals({},n.selecteditem)?n.Picker.addedItems==null||n.Picker.addedItems.length==0&&n.Picker.removedItems.length==0:!1},n.OpenChangePasswordPage=function(){window.open(n.createChangePasswordUrl)},n.Submit=function(t){if(n.shouldShowPicker&&n.Picker.GetAllItems().length==0){n.pickerSelectionError=!0,n.statusErrorMessage='Please select a user.';return}t.$valid&&(n.saveinprogress=!0,t.newpassword&&(n.formData.isSelfgeneratePassword?n.ResetUserPasswordModel.Password=n.formData.NewPassword:(n.formData.NewPassword=null,n.ResetUserPasswordModel.Password=null)),t.requirePasswordChange&&(n.ResetUserPasswordModel.ForceChangePassword=n.formData.ForceChangePassword),t.emailAdmin&&(n.ResetUserPasswordModel.NotifyEmails=n.formData.SendPasswordEmailAddress),angular.isUndefined(n.selecteditem)||angular.equals({},n.selecteditem)?angular.forEach(n.Picker.GetAllItems(),function(t){n.ResetUserPasswordModel.UserId.push(t.ObjectId)}):angular.isUndefined(n.selecteditem.length)?n.ResetUserPasswordModel.UserId.push(n.selecteditem.ObjectId):angular.forEach(n.selecteditem,function(t){n.ResetUserPasswordModel.UserId.push(t.ObjectId)}),i.ResetUserPassword(n.ResetUserPasswordModel).then(function(t){n.$emit('showWaitingIndicator',!1),n.saveinprogress=!1,n.showSummary=!0,n.isServerError=!1,n.resetUserPasswordResponse=t.data;var i='Resetted the password successfully';r.AnnounceText(i),angular.forEach(n.resetUserPasswordResponse,function(t){var r={UserPrincipalName:t.AdditionalMessageInfo.EncryptedUPN,Password:t.AdditionalMessageInfo.EncryptedPassword};n.sendPasswordEmailModel.EmailContents.push(r),n.formData.isSelfgeneratePassword&&t.Status!==0&&(n.formData.isSelfgeneratePassword=!1)})},function(t){n.$emit('showWaitingIndicator',!1),n.resetUserPasswordResponse=t.data;var i='Error occurred while resetting the password';r.AnnounceText(i),n.saveinprogress=!1,n.isServerError=!0,n.showSummary=!0}))},n.ShowPassword=function(){n.selfgeneratedpassword=n.resetUserPasswordResponse[0].Message},n.HidePassword=function(){n.selfgeneratedpassword="********"},n.SendPasswordEmail=function(){n.sendPasswordEmailModel.Recipients=n.formData.sendPasswordEmailAddress,i.SendBulkUserPasswordEmail(n.sendPasswordEmailModel).then(function(t){t.data.Status!=0?(n.showEmailConfirmationMessage=!0,n.emailConfirmationMessage=t.data.Message,n.emailSendFailure=!0,n.showSendEmailControl=!0,n.formData.sendPasswordEmailCheck=!1):n.Cancel()},function(t){n.showEmailConfirmationMessage=!0,n.emailConfirmationMessage=t.data.Message,n.emailSendFailure=!0,n.showSendEmailControl=!0,n.formData.sendPasswordEmailCheck=!1})}}return n.$inject=["$scope","$rootScope","UserManagementService","AccessibilityService"],n}();n.ResetUserPasswordController=t,n.app.controller("ResetUserPasswordController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){this.$scope=n,this.UserManagementService=t,this.PanelService=i,this.HelperService=r,n.contentLoaded=!1,n.$on('$includeContentLoaded',function(){n.contentLoaded=!0}),n.init=function(){n.confirmMessage="",n.IsSelfEditing=!1,n.saveinprogress=!1,n.isServerError=!1,n.RecipientTypeDetails=n.selecteditem.RecipientTypeDetails,n.IsAdminUser=n.selecteditem.IsAdminUser,n.convertUserResponse=[],n.confirmMessage='Are you sure you want to convert this user mailbox into shared mailbox\x3f',n.WarningConvertForAdmin=n.IsAdminUser?'\x3cp\x3eThe mailbox you are trying to convert to shared mailbox belongs to an user that has an administrator role assigned. In order to proceed with conversion, you have to first remove Administrator role from the user because they will not be able to log into the admin portal after conversion.\x3c\x2fp\x3e':null},n.init(),n.CheckSelfEditingUser=function(){var i=!1;return angular.isDefined(n.selecteditem)&&(angular.isDefined(n.selecteditem.length)?angular.forEach(n.selecteditem,function(n){var u=n.UserPrincipalName?n.UserPrincipalName:n.EmailAddress;i=i?!0:t.IsSelfUser(u)}):i=t.IsSelfUser(n.selecteditem.UserPrincipalName)),i},n.Cancel=function(){n.$emit('closeFlyout')},n.Submit=function(i){n.saveinprogress=!0,i.$valid&&t.ConvertUser(n.selecteditem.ObjectId).then(function(t){t.data.Status==0?(n.$emit('showWaitingIndicator',!1),n.saveinprogress=!1,n.showSummary=!0,n.isServerError=!1,n.convertUserResponse=t.data,n.$emit('closePanel')):(n.$emit('showWaitingIndicator',!1),n.convertUserResponse=t.data,n.saveinprogress=!1,n.isServerError=!0,n.showSummary=!0)},function(t){n.$emit('showWaitingIndicator',!1),n.convertUserResponse=t.data,n.saveinprogress=!1,n.isServerError=!0,n.showSummary=!0})}}return n.$inject=["$scope","UserManagementService","PanelService","HelperService"],n}();n.ConvertUserController=t,n.app.controller("ConvertUserController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){this.$scope=n,this.UserManagementService=t,this.DateTimeService=i,n.Init=function(){n.saveinprogress=!1,n.showErrorMessage=!1,n.NoDeviceActivated=!1,n.selecteditem&&(n.formData.ObjectId=n.selecteditem.ObjectId,n.formData.TenantId="",n.formData.MachineKey="",n.formData.BrandName="",n.formData.UICapability="",n.userOfficeInstalls={},t.GetUserOfficeInstalls(n.formData.ObjectId).then(function(t){n.userOfficeInstalls=t.data,n.formData.UserName=n.selecteditem.DisplayName,n.formData.DownloagePageUrl=n.userOfficeInstalls.DownloagePageUrl,n.NoDeviceActivated=n.userOfficeInstalls.NoDeviceActivated,n.formData.TenantId=n.userOfficeInstalls.TenantId},function(t){n.userOfficeInstalls=t.data}))},n.Init(),n.DateFormat=function(n){return i.GetLocalizedDateTime(n,0)},n.IsSoftwareActivatedInMachines=function(n){return angular.isDefined(n)&&n.length>0},n.CloseInstallsPageAndPanel=function(){n.$emit('closeFlyout'),n.$emit('closePanel')},n.Cancel=function(){n.$emit('closeFlyout')};var r=function(){n.saveinprogress=!1,n.showErrorMessage=!1,n.Init()},u=function(t){n.saveinprogress=!1,n.showErrorMessage=!0,n.errorMessage=t.data.Message};n.Deactivate=function(i,f,e){e.$valid&&(n.saveinprogress=!0,n.formData.MachineKey=f.MachineKey,n.formData.BrandName=i.DownloadsData.Title,n.formData.UICapability=i.DownloadsData.UICapability,t.DeactivateOfficeInstall(n.formData).then(r,u))}}return n.$inject=["$scope","UserManagementService","DateTimeService"],n}();n.app.controller("ManageOfficeInstallsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f,e,o,s,h){function d(){var t=!1,r=i(JSON.stringify(n.csv.result[0]))({})[0].split(',');return r&&r.length>0?(t=r.length===n.bulkAddUserModel.expectedHeaderlength,t||s.LogError(419866,"Headers don't match.")):s.LogError(419865,"InvalidHeader: resultArray length 0 or is undefined."),t}function it(n){var t=n.length<79?!0:!1,u,i,r;return t?(u=/^(?!^[.])([-'a-zA-Z0-9_]+\.)*[-'a-zA-Z0-9_]+@(?!\.+)([-a-zA-Z0-9]+\.)+[a-zA-Z]{2,}$/,t=u.test(n),t?(i=n.search("@"),t=i!=-1?!0:!1,t?(r=n.substring(i+1),t=r.length>0,t?(t=l.indexOf(r.toLowerCase())!=-1?!0:!1,t||s.LogError(419871,"Domain entered is not in the list of tenant domains")):s.LogError(419870,"Invalid Domain length")):s.LogError(419869,"Username is not an email.")):s.LogError(419868,"Username has invalid characters.")):s.LogError(419867,"username length > 79"),t}function tt(){angular.forEach(n.csv.result,function(t,r){var o;if(r>0&&t[0].length>0){var s=/,(?![^\(]*\))(?![^"']*["'](?:[^"']*["'][^"']*["'])*[^"']*$)/g,f=i(JSON.stringify(n.csv.result))({})[r][0].split(s),e=[],u={};u.UserPrincipalName=f[0],n.bulkAddUserModel.isContentValid=n.bulkAddUserModel.isContentValid&&angular.isDefined(u.UserPrincipalName)&&u.UserPrincipalName!=""&&u.UserPrincipalName!=" ",angular.isDefined(u.UserPrincipalName)&&u.UserPrincipalName!=""&&u.UserPrincipalName!=" "?(o=it(u.UserPrincipalName),n.bulkAddUserModel.isContentValid=n.bulkAddUserModel.isContentValid&&o,o||(e.push('Invalid domain name used in user name. '),n.bulkAddUserModel.InvalidDomainName=!o)):e.push('The user name is invalid or empty'),u.FirstName=f[1],u.LastName=f[2],u.DisplayName=f[3],n.bulkAddUserModel.isContentValid=n.bulkAddUserModel.isContentValid&&angular.isDefined(u.DisplayName)&&u.DisplayName!=""&&u.DisplayName!=" ",u.DisplayName&&u.DisplayName!=""&&u.DisplayName!=" "||e.push('Invalid Display Name column'),u.JobTitle=f[4],u.Department=f[5],u.Office=f[6],u.OfficePhone=f[7],u.MobilePhone=f[8],u.FaxNumber=f[9],u.StreetAddress=f[10].replace(/\"/g,""),u.City=f[11],u.StateProvince=f[12],u.ZipOrPostalCode=f[13],u.CountryRegion=f[14],e.length>0&&a.push({'Row number':r,Errors:e}),n.bulkAddUserModel.isContentValid&&n.formData.Users.push(u)}})}function nt(){var t=n.csv.result.length>1;return t&&n.csv.result.length===2&&angular.forEach(n.csv.result,function(n,i){i>0&&(t=n[0].length>0)}),t}function g(t){angular.forEach(t.data.Products,function(t){t.eligibleSubscriptions=[],t.ShowDetails=!1,t.subscriptionCap=!1,t.subscriptionError=!1,t.ProductSkuId&&r.GetSubscriptions(t.ProductSkuId,1).then(function(i){var u,s;if(t.additionalQuantity=i.data.additionalQuantity,t.licenseOutOfSync=i.data.licenseOutOfSync,i.data.eligibleSubscriptions&&i.data.eligibleSubscriptions.length>0)u=[],angular.forEach(i.data.eligibleSubscriptions,function(n){n.apps=[],n.IsSubSelected=!1,t.eligibleSubscriptions.push(n),n.Id&&n.State.toLowerCase()==='active'&&u.push(n.Id)}),u&&r.GetSubscriptionPrice(u).then(function(t){n.subscriptionPriceResponse=t.data},function(){n.NoSubscriptionPrice=!0});else if(!t.IsSelected&&t.additionalQuantity>0)if(t.subscriptionError=!0,t.IsDisabledDueToError=!0,i.data.ineligibleSubscriptions&&i.data.ineligibleSubscriptions.length===1)t.subscriptionIsTrail=i.data.ineligibleSubscriptions[0].Offer.IsTrial,t.subscriptionIsPrepaid=i.data.ineligibleSubscriptions[0].Offer.IsPrepaid,t.ccOrSubscriptionError=!(i.data.ineligibleSubscriptions[0].Offer.IsTrial||i.data.ineligibleSubscriptions[0].Offer.IsPrepaid);else if(i.data.ineligibleSubscriptions&&i.data.ineligibleSubscriptions.length>1){var f=!1,e=!1,o=!1;angular.forEach(i.data.ineligibleSubscriptions,function(n){f||(f=!(n.Offer.IsTrial||n.Offer.IsPrepaid)),e||(e=n.Offer.IsTrial),o||(o=n.Offer.IsPrePaid)}),f?t.ccOrSubscriptionError=!0:o?t.subscriptionIsPrepaid=!0:e?t.subscriptionIsTrail=!0:t.ccOrSubscriptionError=!0}else t.ccOrSubscriptionError=!0;t.IsSelected&&(n.productSelected++,h.IsValid(t.PrerequisiteMessage)&&n.showSkypeMessageCount++),s=t.IsSelected,t.ServicePlans!=null&&angular.forEach(t.ServicePlans,function(n){n.IsSelected=n.IsSelected&&s}),i.data.eligibleSubscriptions&&i.data.eligibleSubscriptions.length==1&&(t.eligibleSubscriptions[0].IsSubSelected=!0)},function(n){typeof n.data!="object"&&n.data.toLowerCase()=='subscriptionsreachedmaximumquantity'?t.subscriptionCap=!0:typeof n.data!="object"&&n.data.toLowerCase()=='invalidpaymentinstrument'?t.invalidPaymentOption=!0:t.genericError=!0,t.IsSelected=!1,t.IsDisabledDueToError=!0})})}function ut(t){n.products=t.data.Products,n.getProductsCompleted=!0,n.products&&n.products.length!==0||(n.formData.CreateUserWithNoLicense=!0),n.ShowSkypeProvisioningMessage=t.data.ShowSkypeProvisioningMessage,n.SkypeAdminCenterUrl=t.data.SkypeAdminCenterUrl,g(t)}function k(){n.isProductAvailable=!1}function b(){r.GetTenantProducts().then(ut,k)}function w(){n.productSelected=0,angular.forEach(n.products,function(t){t.IsSelected?n.productSelected++:h.IsValid(t.PrerequisiteMessage)&&n.showSkypeMessageCount--})}function p(){r.GetBulkAddUserTemplateAndSampleUrl().then(function(t){n.bulkAddUserModel.sampleURL=t.data.Sample,n.bulkAddUserModel.TemplateURL=t.data.Template},function(){})}function y(){r.GetLocations().then(function(t){angular.forEach(t.data,function(t){var r={};r.DisplayName=t.DisplayName,r.CountryCode=t.CountryCode,n.locations.push(r),t.IsDefault==!0&&(n.formData.selectedLocation=r)})})}function v(t){n.bulkAddUserModel.successCSVContent=[],n.bulkAddUserModel.failureCSVContent=[],n.bulkAddUserModel.successCSVHeader=['Display name','User name','Password','Additional information'],n.bulkAddUserModel.failureCSVHeader=['Display name','User name','Error','Additional information'],n.bulkAddUserModel.successResult=[],n.bulkAddUserModel.failureResult=[],angular.forEach(t,function(t){var r;t.Status==0?(n.bulkAddUserModel.successResult.push(t),r={a:t.AdditionalMessageInfo.DisplayName,b:t.AdditionalMessageInfo.UserName,c:t.AdditionalMessageInfo.Password,d:t.AdditionalMessageInfo.LicenseFailed},n.bulkAddUserModel.successCSVContent.push(r)):(n.bulkAddUserModel.failureResult.push(t),r={a:t.AdditionalMessageInfo.DisplayName,b:t.AdditionalMessageInfo.UserName,c:t.Message,d:t.AdditionalMessageInfo.LicenseFailed},n.bulkAddUserModel.failureCSVContent.push(r))})}function rt(){r.GetAddUserPageDefaults().then(function(t){n.formData.recipients=t.data.SendPasswordEmailAddress,angular.forEach(t.data.Domains,function(n){l.push(n.Name.toLowerCase())})},function(){})}function ft(){n.csv={},n.csv.header=!1,n.csv.headerVisible=!0,n.csv.result={},n.csv.result.filename="",n.bulkAddUserModel={},n.formData.inBulkAddUserModel=!0,n.bulkAddUserModel.expectedHeaderlength=15,n.InitializationFileValidationResult(),n.showProductsInfo=!0,n.isProductAvailable=!0,n.bulkAddUserModel.disableWizard=!0,n.formData.CreateUserWithNoLicense=!1,n.productSelected=0,n.showSkypeMessageCount=0,n.getProductsCompleted=!1,n.noFileError=!1,n.locations=[],p(),rt(),y(),b(),n.formData.SignInStatusVal="allowed",n.formData.sendEmail=!0,n.bulkAddUserModel.singleUserCreatedText='1 user created',n.bulkAddUserModel.multipleUserCreatedText='\x7b\x7bbulkAddUserModel.successResult.length\x7d\x7d users created',n.bulkAddUserModel.singleUserFailedText='1 user could be not created',n.bulkAddUserModel.multipleUserFailedText='\x7b\x7bbulkAddUserModel.failureResult.length\x7d\x7d users could be not created',n.showCreateUserWithNoLicenseMessage=!0,n.bulkAddUserModel.saveInProgress=!1,n.bulkAddUserModel.SettingsTitle='Set user options',n.fileErrorValidation='Please select a file'}this.$scope=n,this.wizardHandler=t,this.$parse=i,this.UserManagementService=r,this.$interval=u,this.ProfileService=f,this.FileSaver=e,this.Blob=o,this.LogService=s,this.HelperService=h;var l=[],a=[],c={Recipients:"",Message:"",EmailContents:[],EmailTemplate:2};n.DownloadLogFile=function(){var n=JSON.stringify(a),t=new o([n],{type:'text/plain;charset=utf-8'});e.saveAs(t,'text.txt')},n.Cancel=function(){n.$emit('closeFlyout')},n.GetCurrentStep=function(){return t.wizard()?t.wizard().currentStepNumber():-1},n.IsValidFile=function(){return n.bulkAddUserModel.isValidHeader&&n.bulkAddUserModel.isContentValid&&!n.bulkAddUserModel.exceededNumberofUsers&&n.bulkAddUserModel.hasContent&&n.bulkAddUserModel.isValidFileExtension},n.SelectAFile=function(){if(!n.csv.result.filename){n.noFileError=!0,n.fileErrorValidation='Please select a file';return}n.noFileError=!1,n.bulkAddUserModel.isFileVerified||n.VerifyFile(),n.IsValidFile()&&t.wizard().next()},n.Back=function(){t.wizard().previous()},n.VerifyFile=function(){if(!n.csv.result.filename){n.noFileError=!0;return}n.noFileError=!1,n.InitializationFileValidationResult(),n.bulkAddUserModel.isValidFileExtension=n.csv.result.filename.substr(n.csv.result.filename.lastIndexOf(".")+1).toLowerCase()=="csv",n.bulkAddUserModel.isValidFileExtension&&(n.bulkAddUserModel.isValidHeader=d(),n.bulkAddUserModel.isValidHeader&&(n.bulkAddUserModel.hasContent=nt(),n.bulkAddUserModel.hasContent&&(n.bulkAddUserModel.exceededNumberofUsers=n.csv.result.length>251,n.bulkAddUserModel.exceededNumberofUsers||tt()))),n.bulkAddUserModel.isFileVerified=!0},n.InitializationFileValidationResult=function(){n.bulkAddUserModel.isFileVerified=!1,n.bulkAddUserModel.isValidHeader=!0,n.bulkAddUserModel.isContentValid=!0,n.bulkAddUserModel.ContentFailureInfo={},n.formData.Users=[],n.bulkAddUserModel.hasContent=!0,n.bulkAddUserModel.exceededNumberofUsers=!1,n.bulkAddUserModel.InvalidDomainName=!1,n.bulkAddUserModel.isValidFileExtension=!0},n.ToggleProductInfo=function(){n.showProductsInfo=!n.showProductsInfo},n.ToggleProductSelection=function(t){var r=!0;angular.forEach(t.ServicePlans,function(i){i.IsSelected&&(r=!1),r?(t.ShowDetails=!1,t.IsSelected=!1):(t.ShowDetails=!0,t.IsSelected=!0),w(),n.formData.CreateUserWithNoLicense=!1})},n.ToggleProductDetails=function(t){n.products[t].ShowDetails=!n.products[t].ShowDetails},n.DeSelectAllProductsServicesAndSubscription=function(){n.formData.CreateUserWithNoLicense&&(angular.forEach(n.products,function(t,i){t.IsSelected=!1,n.DeSelectAllSubscriptions(i),t.ServicePlans!=null&&angular.forEach(t.ServicePlans,function(n){n.IsSelected=!1})}),n.productSelected=0)},n.SetProductSelected=function(t,i){$("#"+t).is(":checked")?(n.productSelected++,n.products[i].IsSelected=!0,n.products[i].ShowDetails=!0,n.products[i].eligibleSubscriptions&&n.products[i].eligibleSubscriptions.length==1&&(n.products[i].eligibleSubscriptions[0].IsSubSelected=!0),n.products[i].ServicePlans!=null&&angular.forEach(n.products[i].ServicePlans,function(n){n.IsSelected=!0}),h.IsValid(n.products[i].PrerequisiteMessage)&&n.showSkypeMessageCount++,n.ShowSkypeNotification=n.products[i].HasSkypeNotificationMessage):(n.productSelected--,n.products[i].IsSelected=!1,n.products[i].ShowDetails=!1,n.DeSelectAllSubscriptions(i),h.IsValid(n.products[i].PrerequisiteMessage)&&n.showSkypeMessageCount--,n.products[i].ServicePlans!=null&&angular.forEach(n.products[i].ServicePlans,function(n){n.IsSelected=!1})),n.formData.CreateUserWithNoLicense=!1},n.IsAdditionalQuantityRequired=function(){var t=!1;return n.AddtionalLicenseRequired=0,n.SelectedSubscription='',angular.forEach(n.products,function(i){i.IsSelected&&angular.forEach(i.eligibleSubscriptions,function(r){r.IsSubSelected&&i.additionalQuantity>0&&(t=!0,n.AddtionalLicenseRequired+=i.additionalQuantity,n.SelectedSubscription+=i.ProductDisplayName+", ")})}),t},n.DeSelectAllSubscriptions=function(t){angular.forEach(n.products[t].eligibleSubscriptions,function(n){n.IsSubSelected=!1})},n.ToggleSubscriptionSelected=function(t,i){angular.forEach(t.eligibleSubscriptions,function(r,u){u!=i&&(t.eligibleSubscriptions[u].IsSubSelected=!1,t.eligibleSubscriptions[u].HasSkypeNotificationMessage&&(n.ShowSkypeNotification=!0))})},n.IsSubscriptionError=function(){var t=!1;return angular.forEach(n.products,function(n){n.IsSelected&&(t||(t=n.subscriptionError))}),t},n.IsAdditionalQuantityUpdated=function(){n.IntervalCount--,n.IntervalCount<=0?n.CreateUserHelper():r.IsAdditionalQuantityUpdated(n.ProductSkuids.substr(0,n.ProductSkuids.length-1)).then(function(t){angular.forEach(t.data,function(t){t.PurchasedQuantity>t.ConsumedQuantity&&(u.cancel(n.timeoutpromise),n.CreateUserHelper())})})},n.IsSubscriptionSelected=function(t){var i=!1;return angular.forEach(n.products[t].eligibleSubscriptions,function(n){i||(i=n.IsSubSelected)}),i},n.GetSelectedProduct=function(){var t='';return angular.forEach(n.products,function(n){n.IsSelected&&(t=n.ProductDisplayName)}),t},n.CreateUsers=function(){if(n.IsSubscriptionError()||n.productSelected<1&&!n.formData.CreateUserWithNoLicense){n.noFileError=!0,n.fileErrorValidation='Please assign a license';return}n.noFileError=!1,n.formData.Products=n.products,n.formData.SignInStatus=n.formData.SignInStatusVal=="allowed"?!0:!1,n.formData.UsageLocation=n.formData.selectedLocation.CountryCode,n.bulkAddUserModel.saveInProgress=!0,n.bulkAddUserModel.SettingsTitle="",r.BulkAddUsers(n.formData).then(function(i){n.bulkAddUserModel.response=i.data,v(n.bulkAddUserModel.response),n.bulkAddUserModel.disableWizard=!1,n.formData.refreshListArgs={},n.bulkAddUserModel.saveInProgress=!1,t.wizard().next()},function(i){n.bulkAddUserModel.createError=!0,n.bulkAddUserModel.response=i.data,n.bulkAddUserModel.saveInProgress=!1,n.bulkAddUserModel.disableWizard=!0,t.wizard().next()})},n.enterValidation=function(){return n.bulkAddUserModel.disableWizard},n.SendAndClose=function(){c.Recipients=n.formData.recipients,angular.forEach(n.bulkAddUserModel.response,function(n){var i={UserPrincipalName:n.AdditionalMessageInfo.EncryptedUPN,Password:n.AdditionalMessageInfo.EncryptedPassword};c.EmailContents.push(i)}),r.SendBulkUserPasswordEmail(c).then(function(t){t.data.Status!=0?(n.bulkAddUserModel.emailConfirmationMessage=t.data.Message,n.bulkAddUserModel.emailSendFailure=!0):n.Cancel()},function(t){n.bulkAddUserModel.emailConfirmationMessage=t.data.Meforminputssage,n.bulkAddUserModel.emailSendFailure=!0})},ft(),n.$watch("csv.result.filename",function(){n.InitializationFileValidationResult()})}return n.$inject=["$scope","wizardHandler","$parse","UserManagementService","$interval","ProfileService","FileSaver","Blob","LogService","HelperService"],n}();n.app.controller("BulkAddUserController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){var e,o,f;this.$scope=n,this.UserManagementService=t,this.PanelService=i,this.ProfileService=r,this.PhotoService=u,e=function(){n.GroupsModel={},n.GroupsModel.saveInProgress=!1,n.GroupsModel.isServerError=!1,n.GroupsModel.showSummary=!1,n.GroupsModel.Groups=[],n.GroupsModel.failedGroups=[],n.GroupsModel.succeededGroups=[],n.GroupsModel.showAddMembers=!1,n.GroupsModel.showRemoveMembers=!1,n.GroupsModel.showViewMembers=!0,n.Picker={Type:2,allItemsListTitle:'Group memberships',placeholderText:'Search'};var t=[{SearchCategory:1,Filter:{Membership:0,ObjectId:n.selecteditem.ObjectId}}];n.Picker.SearchCategories=t},n.GetProfileImageColor=function(n){return r.GetProfileImageColor(n)},n.downloadCSV=function(t){t.which===n.$root.KeyCodes.EnterKey&&angular.element(t.target).click()},n.GetInitials=function(n){return r.GetUserInitials(n)},n.GetGroupInitials=function(n){return r.GetGroupInitials(n)},n.CancelMembershipEdit=function(){n.GroupsModel.showAddMembers=!1,n.GroupsModel.showRemoveMembers=!1,n.GroupsModel.showViewMembers=!0},n.Cancel=function(){n.$emit('closeFlyout')},n.ShouldDisableSave=function(n){return n.selectedItems==null||n.selectedItems.length===0},n.OpenRemoveMembership=function(){n.AddPicker=null,n.RemovePicker={Type:1,action:1,existingItems:n.Picker.allItems,pageToken:n.Picker.pageToken,allItemsListTitle:n.Picker.allItemsListTitle,placeholderText:n.Picker.placeholderText,SearchCategories:n.Picker.SearchCategories},n.$root.CurrentUserInfo.IsGlobalAdmin||(n.RemovePicker.warningMessage='You can only remove members from groups you have access to.'),n.GroupsModel.showViewMembers=!1,n.GroupsModel.showAddMembers=!1,n.GroupsModel.showRemoveMembers=!0},n.OpenAddMembership=function(){n.RemovePicker=null,n.AddPicker={Type:1,MemberType:1,SearchTypes:[1],allItemsListTitle:'Groups',placeholderText:n.Picker.placeholderText,SearchCategories:[{SearchCategory:1,Filter:{GroupTypes:null,CheckMembership:0,CheckMembershipDetails:{GroupId:n.selecteditem.ObjectId}}}]},n.$root.CurrentUserInfo.IsGlobalAdmin||(n.AddPicker.warningMessage='You can only add members to groups you have access to.'),n.GroupsModel.showViewMembers=!1,n.GroupsModel.showRemoveMembers=!1,n.GroupsModel.showAddMembers=!0},n.CloseSummary=function(){n.GroupsModel.showRemoveMembers=!1,n.GroupsModel.showAddMembers=!1,n.GroupsModel.showSummary=!1,n.GroupsModel.showViewMembers=!0},o=function(){i.SetSelectedItem(n.formData),n.Picker.RefreshList()},f=function(t){n.GroupsModel.saveInProgress=!1,n.GroupsModel.showAddMembers=!1,n.GroupsModel.showRemoveMembers=!1,n.GroupsModel.showViewMembers=!1,n.GroupsModel.showSummary=!0,n.GroupsModel.successCSVContent=[],n.GroupsModel.failureCSVContent=[],n.GroupsModel.successCSVHeader=['Name','Alias','Type'],n.GroupsModel.failureCSVHeader=['Name','Alias','Type','Error'],angular.forEach(t.data.FailedGroups,function(t){n.GroupsModel.failedGroups.push(t.Group);var i={a:t.Group.GroupDisplayName,b:t.Group.GroupSmtp,c:t.Group.GroupTypeDisplayName,d:t.Message};n.GroupsModel.failureCSVContent.push(i)}),angular.forEach(t.data.SucceededGroups,function(t){n.GroupsModel.succeededGroups.push(t);var i={a:t.GroupDisplayName,b:t.GroupSmtp,c:t.GroupTypeDisplayName};n.GroupsModel.successCSVContent.push(i)}),o()},n.SaveUserGroups=function(i){n.GroupsModel.saveInProgress=!0,n.GroupsModel.isServerError=!1,n.GroupsModel.showSummary=!1,n.GroupsModel.errorMessage=null,n.GroupsModel.failedGroups=[],n.GroupsModel.succeededGroups=[],n.formData.ObjectId=n.selecteditem.ObjectId,n.formData.DisplayName=n.selecteditem.DisplayName,n.formData.EmailAddress=n.selecteditem.UserPrincipalName,n.formData.MemberType="User",n.formData.GroupsToAdd=[],n.formData.GroupsToRemove=[],i?n.formData.GroupsToAdd=n.AddPicker.GetSelectedItems():n.formData.GroupsToRemove=n.RemovePicker.GetSelectedItems(),t.UpdateUserGroups(n.selecteditem.ObjectId,n.formData).then(function(t){t.data.Status==1?(n.GroupsModel.isServerError=!0,n.GroupsModel.errorMessage='This user could not be added to one or more of the selected groups.',f(t)):(n.GroupsModel.isServerError=!1,f(t))},function(){n.GroupsModel.saveInProgress=!1,n.GroupsModel.isServerError=!0,n.GroupsModel.showAddMembers=!1,n.GroupsModel.showRemoveMembers=!1,n.GroupsModel.showViewMembers=!1,n.GroupsModel.showSummary=!0,n.GroupsModel.errorMessage='Group membership can\x27t be updated right now.'})},n.IsValid=function(n){return!angular.isDefined(n)||n==null||n==""?!1:!0},n.GetGroupPhotos=function(t){n.$root.features&&n.$root.features.ShowUserPhoto&&t&&t.forEach(function(t){u.GetPhoto(t.GroupSmtp,0).then(function(i){i&&t.GroupSmtp==i.Identity&&n.IsValid(i.PhotoContent)&&(t.PhotoContent=i.PhotoContent)})})},e()}return n.$inject=["$scope","UserManagementService","PanelService","ProfileService","PhotoService"],n}();n.app.controller("EditUserGroupController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){this.$rootScope=n,this.$scope=t,this.HelperService=i,t.CommonTasks={},t.CommonTasks.PartnerPortalLink=n.CurrentUserInfo.SyndicatedPartnerPortalUrl,t.InvokeAddUserFlyout=function(){if(!i.IsValid(t.CommonTasks.PartnerPortalLink)){var n;n={flyoutTemplateUrl:"../AdminPortal/Users/Add",flyoutType:"user",selecteditem:"{}"},t.flyout.invoke(n)}},t.initCallbackFlyout=function(n){t.flyout=n},t.initCallbackPanel=function(n){t.panel=n},t.InvokeDeleteUserFlyout=function(){if(!i.IsValid(t.CommonTasks.PartnerPortalLink)){var n,r='Delete user';n={panelTemplateUrl:"../AdminPortal/Users/EditUserPicker",panelHeaderIcon:"ms-Icon-Basel ms-Icon-Basel--DeleteLegacy",panelHeaderTitle:r,showCloseButton:"false",selecteditem:{Type:"DeleteUser"}},t.panel.invoke(n)}},t.InvokeEditUserFlyout=function(){if(!i.IsValid(t.CommonTasks.PartnerPortalLink)){var n,r='Edit a user';n={panelTemplateUrl:"../AdminPortal/Users/EditUserPicker",panelHeaderIcon:"ms-Icon-Basel ms-Icon-Basel--EditLegacy",panelHeaderTitle:r,showCloseButton:"false",selecteditem:{Type:"EditUser"}},t.panel.invoke(n)}},t.InvokeResetUserFlyout=function(){if(!i.IsValid(t.CommonTasks.PartnerPortalLink)){var n,r='Reset password';n={panelTemplateUrl:"../AdminPortal/Users/EditUserPicker",panelHeaderIcon:"ms-Icon-Basel ms-Icon-Basel--PermissionsLegacy",panelHeaderTitle:r,showCloseButton:"false",selecteditem:{Type:"ResetUser"}},t.panel.invoke(n)}}}return n.$inject=["$rootScope","$scope",'HelperService'],n}();n.DashboardCommonTasksWidgetController=t,n.app.controller("DashboardCommonTasksWidgetController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){this.$scope=n,this.$window=t,this.$location=i,n.ShareDownloadLink=function(){var n='Here\x27s the Office download link ',r='Download Office here\x3a ',u="\n\nNeed help? Read about it or watch a video: ",f='https://support.office.com/en-US/article/Video-Install-Office-on-your-PC-or-Mac-for-Office-365-for-business-b7071ece-237d-4f84-a67d-d8cf1d1f2e60',e=r+"https://"+i.host()+"/OLS/MySoftware.aspx"+u+f;t.location.href="mailto:?subject="+encodeURIComponent(n)+" &body="+encodeURIComponent(e)}}return n.$inject=["$scope","$window","$location"],n}();n.DownloadsWidgetController=t,n.app.controller("DownloadsWidgetController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){this.$scope=n,this.$window=t,this.$location=i,n.ShareWindowsDownloadLink=function(){var n='Upgrade to Windows 10',i='Upgrade to Windows 10 Pro here\x3a',r="\n\nThis link is intended for PCs with a Windows 10 license",u="\n\nNeed help? Read about it:",f='https://support.microsoft.com/products/windows?os=windows-10',e=i+"\n http://go.microsoft.com/fwlink/?LinkID=836951"+r+u+"\n"+f;t.location.href="mailto:?subject="+encodeURIComponent(n)+" &body="+encodeURIComponent(e)}}return n.$inject=["$scope","$window","$location"],n}();n.WindowsWidgetController=t,n.app.controller("WindowsWidgetController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){this.$rootScope=n,this.$scope=t,n.CurrentUserInfo.SyndicatedPartnerPortalUrl?(t.SupportLink=n.CurrentUserInfo.SyndicatedPartnerPortalUrl,t.ServiceRequestLink=n.CurrentUserInfo.SyndicatedPartnerPortalUrl):(t.SupportLink="/support/support.aspx",t.ServiceRequestLink="/support/servicerequests.aspx")}return n.$inject=["$rootScope","$scope"],n}();n.DashboardSupportWidgetController=t,n.app.controller("DashboardSupportWidgetController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r){var u,f;this.$scope=t,this.MessageCenterService=i,this.$rootScope=r,u={showMoreLinkText:'More',showLessLinkText:'Less',perferencesCount:7},f=function(){o(),t.NotificationChannels={SMSText:"SMS",SMSEnabled:!1,WeeklyEmailText:"WeeklyEmail",WeeklyEmailEnabled:!1,InstantEmailText:"InstantEmail",InstantEmailEnabled:!1,Recipient:{}},t.NotificationChannelEnum={None:0,SMS:1,WeeklyEmail:2,InstantEmail:3},t.Recipients={Upn:null,isUpn:!1,Alt:null,isAlt:!1,Preferred:null,isPref:!1},t.PreferencesText=u.showMoreLinkText,t.perferencesCount=u.perferencesCount,t.OpenFromDeeplink=t.$parent.$parent.selectedItem?!0:!1;var r="/admin/api/messagecenter/GetUserPreferences";i.GetUserPreferences(r).then(function(i){t.userPreferences=i.data,t.numberofServices=i.data.ServiceNotificationSettings?i.data.ServiceNotificationSettings.length:0,t.showMoreLessLink=t.numberofServices>u.perferencesCount?!0:!1,t.showDigestOption=t.OpenFromDeeplink||i.data.ShowDigestOption,t.showInstantOption=i.data.ShowInstantOption,t.Recipients.Upn=i.data.PrimaryEmailAddress,t.Recipients.Alt=i.data.AlternateEmailAddress,angular.forEach(t.userPreferences.NotificationChannels,function(n){n===t.NotificationChannelEnum.SMS?t.NotificationChannels.SMSEnabled=!0:n===t.NotificationChannelEnum.WeeklyEmail?t.NotificationChannels.WeeklyEmailEnabled=!0:n===t.NotificationChannelEnum.InstantEmail&&(t.NotificationChannels.InstantEmailEnabled=!0)}),angular.forEach(t.userPreferences.ServiceNotificationSettings,function(i,r){var u=i.m_Item1;u===null&&(u=i.Item1),t.userPreferences.ServiceNotificationSettings[r].Icon=n.MessageCenterIconsStyle[angular.lowercase(u.Id)]}),(t.NotificationChannels.WeeklyEmailEnabled||t.NotificationChannels.InstantEmailEnabled)&&(t.Recipients.isUpn=i.data.IsUpnSelected,t.Recipients.isAlt=i.data.IsAltEmailSelected,t.Recipients.Preferred=i.data.PreferredEmailAddress,t.Recipients.isPref=!!i.data.PreferredEmailAddress),t.userPreferences.NotificationChannels=[],t.userPreferences.IsUpnSelected=!1,t.userPreferences.IsAltEmailSelected=!1,t.userPreferences.PreferredEmailAddress=null,s()},function(){e()})},t.SetUserPreferences=function(){h(),t.NotificationChannels.SMSEnabled&&t.userPreferences.NotificationChannels.push(t.NotificationChannels.SMSText),t.NotificationChannels.WeeklyEmailEnabled&&t.userPreferences.NotificationChannels.push(t.NotificationChannels.WeeklyEmailText),t.NotificationChannels.InstantEmailEnabled&&t.userPreferences.NotificationChannels.push(t.NotificationChannels.InstantEmailText),(t.NotificationChannels.WeeklyEmailEnabled||t.NotificationChannels.InstantEmailEnabled)&&(t.userPreferences.IsUpnSelected=t.Recipients.isUpn,t.userPreferences.IsAltEmailSelected=t.Recipients.isAlt,t.Recipients.isPref&&(t.userPreferences.PreferredEmailAddress=t.Recipients.Preferred));var n="/admin/api/messagecenter/SetUserPreferences";i.SetUserPreferences(n,t.userPreferences).then(function(){c()},function(){e()})},t.toggleMoreLess=function(){t.PreferencesText==u.showMoreLinkText?(t.PreferencesText=u.showLessLinkText,t.perferencesCount=t.numberofServices):(t.PreferencesText=u.showMoreLinkText,t.perferencesCount=u.perferencesCount)},t.isRecipientDisabled=function(){var n=!0;return t.showDigestOption&&(n=n&&!t.NotificationChannels.WeeklyEmailEnabled),t.showInstantOption&&(n=n&&!t.NotificationChannels.InstantEmailEnabled),n},t.noneSelected=function(){var n=t.isRecipientDisabled();return n?!1:!(t.Recipients.isUpn||t.Recipients.isAlt||t.Recipients.isPref)},t.Cancel=function(){t.$emit('closePanel')},t.Close=function(){r.$broadcast('refreshMessageCenter'),t.$emit('closePanel')};var o=function(){t.showForm=!1,t.formError=!1,t.loadInProgress=!0,t.saveInProgress=!1,t.userPreferences={}},s=function(){t.showForm=!0,t.loadInProgress=!1},h=function(){t.showForm=!1,t.saveInProgress=!0},c=function(){t.saveInProgress=!1},e=function(){t.formError=!0};f()}return t.$inject=["$scope","MessageCenterService","$rootScope"],t}();n.MessageCenterPreferencesController=t,n.app.controller("MessageCenterPreferencesController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u){var f,e,o;this.$scope=n,this.UserManagementService=t,this.PanelService=i,this.ProfileService=r,this.GroupService=u,f=function(){n.UpdateGroupModel={},n.UpdateGroupModel.membersToRemove=[],n.UpdateGroupModel.membersToAdd=n.selecteditem,angular.forEach(n.UpdateGroupModel.membersToAdd,function(n){n.EmailAddress=n.UserPrincipalName}),n.UpdateGroupModel.saveInProgress=!1,n.UpdateGroupModel.isServerError=!1,n.UpdateGroupModel.showSummary=!1,n.Picker={Type:0,SearchTypes:[1],allItemsListTitle:'Group memberships',inputLabel:'Search group to add memberships',placeholderText:'Search'}},n.GetProfileImageColor=function(n){return r.GetProfileImageColor(n)},n.GetInitials=function(n){return r.GetUserInitials(n)},n.GetGroupInitials=function(n){return r.GetGroupInitials(n)},n.Cancel=function(){n.$emit('closeFlyout')},n.ShouldDisableSave=function(){return!angular.isDefined(n.Picker.selectedItem)},n.SaveGroupMembership=function(){var t={ObjectId:n.Picker.selectedItem.Item.GroupId,GroupType:n.Picker.selectedItem.Item.GroupType,SmtpAddress:n.Picker.selectedItem.Item.GroupSmtp,MembersToAdd:n.UpdateGroupModel.membersToAdd,MembersToRemove:n.UpdateGroupModel.membersToRemove};u.UpdateGroupMembers(t).then(e,o)},e=function(){n.UpdateGroupModel.saveInProgress=!1,n.UpdateGroupModel.isServerError=!1,n.UpdateGroupModel.showSummary=!0},o=function(){n.UpdateGroupModel.saveInProgress=!1,n.UpdateGroupModel.isServerError=!0,n.UpdateGroupModel.showSummary=!0},f()}return n.$inject=["$scope","UserManagementService","PanelService","ProfileService","GroupService"],n}();n.app.controller("BulkAddUserToGroupController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){this.$scope=n,this.UserManagementService=t;var i=function(){n.formData={UserObjectIds:[],UpdateModel:{Department:null,Office:null,OfficePhone:null,MobilePhone:null,FaxNumber:null,StreetAddress:null,City:null,StateProvince:null,ZipOrPostalCode:null,CountryRegion:null,DonotUpdateSignInStatus:!0}},n.CurrentConfig={DirSyncEnabled:!1,showZipCodeFirst:!1,saveinprogress:!1,saveCompleted:!1,serverError:!1,showSuccessMessage:!0},n.EditSummary={responseObject:[],changeSummary:[],updateCompleteUserCount:0,updateErrorUserCount:0},t.GetAddUserPageDefaults().then(function(t){n.CurrentConfig.showZipCodeFirst=t.data.ShowZipFirst}),angular.forEach(n.selecteditem,function(t){n.formData.UserObjectIds.push(t.ObjectId),t.IsDirSyncEnabled&&(n.CurrentConfig.DirSyncEnabled=!0)})};n.Cancel=function(){n.$emit('closeFlyout')},n.SaveContactInfo=function(){n.CurrentConfig.saveinprogress=!0,t.BulkUpdateContactInformation(n.formData).then(function(t){n.EditSummary.responseObject=t.data,n.AddressOptions1=[{itemText:'Department',itemValue:n.formData.UpdateModel.Department},{itemText:'Office',itemValue:n.formData.UpdateModel.Office},{itemText:'Office phone',itemValue:n.formData.UpdateModel.OfficePhone},{itemText:'Mobile phone',itemValue:n.formData.UpdateModel.MobilePhone},{itemText:'Fax number',itemValue:n.formData.UpdateModel.FaxNumber}],n.AddressOptions2=n.CurrentConfig.showZipCodeFirst?[{itemText:'ZIP or postal code',itemValue:n.formData.UpdateModel.ZipOrPostalCode},{itemText:'State or province',itemValue:n.formData.UpdateModel.StateProvince},{itemText:'City',itemValue:n.formData.UpdateModel.City},{itemText:'Street address',itemValue:n.formData.UpdateModel.StreetAddress}]:[{itemText:'Street address',itemValue:n.formData.UpdateModel.StreetAddress},{itemText:'City',itemValue:n.formData.UpdateModel.City},{itemText:'State or province',itemValue:n.formData.UpdateModel.StateProvince},{itemText:'ZIP or postal code',itemValue:n.formData.UpdateModel.ZipOrPostalCode}],n.AddressOptions3=[{itemText:'Country or region',itemValue:n.formData.UpdateModel.CountryRegion}],n.EditSummary.changeSummary=[],angular.forEach(n.AddressOptions1,function(t){n.EditSummary.changeSummary.push(t)}),angular.forEach(n.AddressOptions2,function(t){n.EditSummary.changeSummary.push(t)}),angular.forEach(n.AddressOptions3,function(t){n.EditSummary.changeSummary.push(t)}),angular.forEach(n.EditSummary.responseObject,function(t){t.Status===1?(n.CurrentConfig.showErrorSummary=!0,n.EditSummary.updateErrorUserCount+=1):t.Status===0&&(n.EditSummary.updateCompleteUserCount+=1)}),n.CurrentConfig.saveCompleted=!0,n.CurrentConfig.saveinprogress=!1},function(){n.CurrentConfig.serverError=!0,n.CurrentConfig.saveCompleted=!0,n.CurrentConfig.saveinprogress=!1})},n.ShouldDisableSave=function(){var t=!1;return t=n.formData.UpdateModel.Department!=null&&n.formData.UpdateModel.Department!=""||n.formData.UpdateModel.Office!=null&&n.formData.UpdateModel.Office!=""||n.formData.UpdateModel.OfficePhone!=null&&n.formData.UpdateModel.OfficePhone!=""||n.formData.UpdateModel.MobilePhone!=null&&n.formData.UpdateModel.MobilePhone!=""||n.formData.UpdateModel.FaxNumber!=null&&n.formData.UpdateModel.FaxNumber!=""||n.formData.UpdateModel.StreetAddress!=null&&n.formData.UpdateModel.StreetAddress!=""||n.formData.UpdateModel.City!=null&&n.formData.UpdateModel.City!=""||n.formData.UpdateModel.StateProvince!=null&&n.formData.UpdateModel.StateProvince!=""||n.formData.UpdateModel.ZipOrPostalCode!=null&&n.formData.UpdateModel.ZipOrPostalCode!=""||n.formData.UpdateModel.CountryRegion!=null&&n.formData.UpdateModel.CountryRegion!=""?!1:!0},i()}return n.$inject=["$scope","UserManagementService"],n}();n.app.controller("BulkEditContactInformationController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i){function f(){t.formData={UserIds:[],SelectedHighLevelRoleGuid:n.GUIDForNoAdminAccess,OtherAdminRoles:[]},t.CurrentConfig={isDataReady:!1,saveInProgress:!1,isCurrentRoleLimitedAdmin:!1,serverError:!1,saveCompleted:!1},t.EditSummary={responseObject:[],updateCompleteUserCount:0,updateErrorUserCount:0},angular.forEach(t.selecteditem,function(n){t.formData.UserIds.push(n.ObjectId)}),t.selecteditem&&t.selecteditem.length>1&&i.GetAdminRoles().then(r,u)}this.$scope=t,this.UserManagementService=i;var r=function(i){t.adminRoles=i.data,angular.forEach(t.adminRoles.HighlevelRoles,function(i){i.ObjectId==n.GUIDForNoAdminAccess&&(t.formData.SelectedHighLevelRoleGuid=i.ObjectId,t.userrole=i)}),t.CurrentConfig.isDataReady=!0},u=function(n){t.statusMessage=n.data.Message,t.showSummary=!0,t.CurrentConfig.isDataReady=!0};f(),t.ClearAdminRole=function(){angular.forEach(t.adminRoles.HighlevelRoles,function(n){n.IsEnabled=!1}),angular.forEach(t.adminRoles.OtherAdminRoles,function(n){n.IsEnabled=!1})},t.GetCurrentAdminRole=function(i,r){t.ClearAdminRole(),t.userrole=i,t.formData.SelectedHighLevelRoleGuid=i.ObjectId,t.adminRoles.HighlevelRoles[r].IsEnabled=!0,t.saveClicked=!1,t.CurrentConfig.isCurrentRoleLimitedAdmin=i.ObjectId==n.GUIDForNoAdminAccess?!1:i.ObjectId==n.EmptyGUID?!0:!1},t.showCustomValidationMessage=function(){if(t.CurrentConfig.isCurrentRoleLimitedAdmin&&t.saveClicked){var n=!1;return angular.forEach(t.adminRoles.OtherAdminRoles,function(t){t.IsEnabled&&(n=!0)}),!n}return!1},t.Cancel=function(){t.$emit('closeFlyout')},t.Submit=function(r){(t.saveClicked=!0,t.showCustomValidationMessage())||r.$valid&&(t.$emit('showWaitingIndicator',!0),t.CurrentConfig.saveinprogress=!0,t.CurrentConfig.isDataReady=!1,angular.forEach(t.adminRoles.HighlevelRoles,function(i){i.ObjectId===n.EmptyGUID&&angular.forEach(t.adminRoles.OtherAdminRoles,function(n){n.IsEnabled&&t.formData.OtherAdminRoles.push(n)})}),i.UpdateBulkUserRoles(t.formData).then(function(n){t.EditSummary.responseObject=n.data,angular.forEach(t.EditSummary.responseObject,function(n){n.Status===1?(t.CurrentConfig.showErrorSummary=!0,t.EditSummary.updateErrorUserCount+=1):n.Status===0&&(t.EditSummary.updateCompleteUserCount+=1)}),t.CurrentConfig.saveCompleted=!0,t.CurrentConfig.saveinprogress=!1,t.$emit('showWaitingIndicator',!1)},function(){t.$emit('showWaitingIndicator',!1),t.CurrentConfig.serverError=!0,t.CurrentConfig.saveCompleted=!0,t.CurrentConfig.saveInProgress=!1}))}}return t.$inject=["$scope","UserManagementService"],t}();n.app.controller("BulkEditUserRolesController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){function i(){n.formData={UserObjectIds:[],UpdateModel:{Department:null,Office:null,OfficePhone:null,MobilePhone:null,FaxNumber:null,StreetAddress:null,City:null,StateProvince:null,ZipOrPostalCode:null,CountryRegion:null,SignInStatus:null}},n.CurrentConfig={saveinprogress:!1,saveCompleted:!1,showErrorSummary:!1,hasErrorInSaving:!1,showCloseButton:!1},n.EditSummary={responseObject:[],changeSummary:[],updateCompleteUserCount:0,updateErrorUserCount:0}}this.$scope=n,this.UserManagementService=t;var r=function(){n.CurrentConfig.showErrorSummary==!1&&(n.$root.refreshList=!0)};n.Submit=function(){angular.forEach(n.selecteditem,function(t){n.formData.UserObjectIds.push(t.ObjectId)}),t.BulkUpdateSignInStatus(n.formData).then(function(t){n.EditSummary.responseObject=t.data,angular.forEach(n.EditSummary.responseObject,function(t){t.Status===1?(n.CurrentConfig.showErrorSummary=!0,n.EditSummary.updateErrorUserCount+=1):t.Status===0&&(n.EditSummary.updateCompleteUserCount+=1)}),r(),n.CurrentConfig.saveinprogress=!0,n.CurrentConfig.saveCompleted=!0,n.CurrentConfig.showCloseButton=!0},function(){n.CurrentConfig.hasErrorInSaving=!0,n.CurrentConfig.saveCompleted=!1,n.CurrentConfig.saveinprogress=!0,n.CurrentConfig.showCloseButton=!0})},n.Cancel=function(){n.$emit('closePanel'),n.$emit('closeFlyout')},i()}return n.$inject=["$scope","UserManagementService"],n}();n.app.controller("BulkEditSigninStatusController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function r(){n.oneDriveModel={upn:n.selectedItem.UserPrincipalName,userDisplayName:n.selectedItem.DisplayName,usageInfo:{StorageQuota:0,StorageUsed:0},sharing:{ExternalSharingEnabled:!0,SharingCapability:null},signOut:{signOutStateMessage:"",signOutInitiated:!1,error:null},UserOneDriveUrl:"",oneDriveUrlRetreived:!1,error:null,showGetErrors:!1},n.ShowWaitingMessage=!0,n.ShowNotProvisionedMessage=!1,n.saveInProgress=!1,n.saveFinished=!1,n.saveError=!1,u()}function u(){t.GetUserOneDriveSiteSettings(n.oneDriveModel.upn).then(function(t){t.data.Status===0?(n.oneDriveModel.usageInfo.StorageQuota=t.data.StorageQuotaLimit,n.oneDriveModel.usageInfo.StorageUsed=t.data.StoragePercentageUse,n.oneDriveModel.sharing.ExternalSharingEnabledForUser=t.data.SharingCapabilities>0,n.oneDriveModel.sharing.SharingCapability=t.data.SharingCapabilities,n.oneDriveModel.sharing.SharingCapabilityOnParentSite=t.data.SharingCapabilitiesForTenant,n.oneDriveModel.sharing.ExternalSharingEnabledForTenant=t.data.SharingCapabilitiesForTenant>0,n.ShowWaitingMessage=!1,n.oneDriveModel.UserOneDriveUrl=t.data.UserPersonalSiteUrl,n.ShowNotProvisionedMessage=n.oneDriveModel.UserOneDriveUrl==null||n.oneDriveModel.UserOneDriveUrl==""?!0:!1):(n.ShowWaitingMessage=!1,n.oneDriveModel.error=t.data.ExceptionMessage,n.oneDriveModel.showGetErrors=!0)},function(){n.oneDriveModel.error='Error trying to get OneDrive  settings',n.oneDriveModel.showGetErrors=!0,n.ShowNotProvisionedMessage=!1,n.ShowWaitingMessage=!1})}this.$scope=n,this.UserManagementService=t,this.PanelService=i,n.Cancel=function(){n.$emit('closeFlyout')},n.Close=function(){n.$emit('closeFlyout')},n.SignOutUserSessions=function(){t.SignOutUserO365Sessions(n.selectedItem.UserPrincipalName).then(function(t){n.oneDriveModel.signOut.signOutStateMessage=t.data,n.oneDriveModel.signOut.signOutInitiated=!0},function(t){n.oneDriveModel.signOut.signOutInitiated=!0,n.oneDriveModel.signOut.error=t,n.oneDriveModel.signOut.signOutStateMessage='We could not sign out this user. Please try again later.'})},n.AccessOneDrive=function(){t.AccessUserOneDrive(n.selectedItem.UserPrincipalName).then(function(t){n.oneDriveModel.UserOneDriveUrl=t.data,n.oneDriveModel.oneDriveUrlRetreived=!0},function(){n.oneDriveModel.oneDriveUrlRetreived=!1})},r()}return n.$inject=["$scope","UserManagementService","PanelService"],n}();n.OneDriveForBusinessController=t,n.app.controller("OneDriveForBusinessController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function r(){u(),n.SharingCapabilityOriginal=n.selecteditem.sharing.SharingCapability,n.upn=n.selecteditem.upn,n.isNewSettingLessRestrictive=!1}this.$scope=n,this.UserManagementService=t,this.PanelService=i,n.SaveOneDriveExternalSharingSettings=function(){n.showForm=!1,n.saveInProgress=!0,n.isNewSettingLessRestrictive=!1,n.selecteditem.sharing.SharingCapability>n.selecteditem.sharing.SharingCapabilityOnParentSite?(n.saveInProgress=!1,n.isNewSettingLessRestrictive=!0,n.selecteditem.sharing.SharingCapability=n.SharingCapabilityOriginal):t.SetUserOneDriveSharingCapability(n.upn,n.selecteditem.sharing.SharingCapability).then(function(){n.saveInProgress=!1,n.saveFinished=!0,n.saveError=!1,n.SharingCapabilityOriginal=n.selecteditem.sharing.SharingCapability},function(){n.saveInProgress=!1,n.selecteditem.sharing.SharingCapability=n.SharingCapabilityOriginal,n.selecteditem.sharing.ExternalSharingEnabled=n.selecteditem.sharing.SharingCapability>0,n.saveFinished=!0,n.saveError=!0})},n.ToggleExternalSharing=function(){n.selecteditem.sharing.ExternalSharingEnabled||(n.selecteditem.sharing.SharingCapability=0)},n.CloseSharing=function(){n.$emit('closeFlyout')},n.CancelSharing=function(){n.$emit('closeFlyout')};var u=function(){n.showForm=!0,n.showConfirm=!1,n.saveInProgress=!1,n.saveFinished=!1,n.saveError=!1};r()}return n.$inject=["$scope","UserManagementService","PanelService"],n}();n.OneDriveSharingSettingController=t,n.app.controller("OneDriveSharingSettingController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f){function s(t){if(typeof t.data.ExceptionMessage!='undefined'&&t.data.ExceptionMessage.constructor===Array){var i=t.data.ExceptionMessage.split(";");n.bulkAddUserModel.failureResult=[],n.bulkAddUserModel.successCount=n.formData.AddUsers.length-i.length,angular.forEach(i,function(t){n.bulkAddUserModel.failureResult.push(t)})}else n.bulkAddUserModel.showError=!0}function h(){n.saveInProgress=!0,n.formData.ReleaseTrack=n.selecteditem,n.bulkAddUserModel.showError=!1,n.formData.ReleaseTrack=='StagedRollout'?f.UpdateReleasePreferenceUsers(n.formData).then(function(){n.bulkAddUserModel.successCount=n.formData.AddUsers.length,o()},function(n){s(n),o()}):n.formData.ReleaseTrack=='Compass'&&f.UpdateReleasePreferenceCompassUsers(n.formData).then(function(){n.bulkAddUserModel.successCount=n.formData.AddUsers.length,o()},function(n){s(n),o()})}function o(){n.saveInProgress=!1,t.wizard().next()}function c(n){var r=n.search("@"),t=r!=-1?!0:!1,i;return t&&(i=n.substring(r+1),t=i.length>0&&i.search(".")!=-1),t}function l(){angular.forEach(n.csv.result,function(t,i){var f=[],r={},u,o;r.UserPrincipalName=t[0].trim(),r.UserPrincipalName&&(u=c(r.UserPrincipalName),n.bulkAddUserModel.isContentValid=n.bulkAddUserModel.isContentValid&&u,u||(f.push('Invalid email address. A user name, \x40, and . must be included. For example someone\x40contoso.com.'),n.bulkAddUserModel.InvalidUPNFormat=!u),f.length>0?e.push({'Row number':i+1,Errors:f}):(o={},o.UserPrincipalName=r.UserPrincipalName,n.formData.AddUsers.push(o)))})}function a(){n.csv={},n.csv.header=!1,n.csv.headerVisible=!0,n.csv.result={},n.csv.result.filename="",n.bulkAddUserModel={},n.noFileError=!1,n.InitializationFileValidationResult(),n.saveInProgress=!1,n.fileErrorValidation='Please select a file'}this.$scope=n,this.wizardHandler=t,this.$parse=i,this.FileSaver=r,this.Blob=u,this.CompanyProfileService=f;var e=[];n.GetCurrentStep=function(){return t.wizard()?t.wizard().currentStepNumber():-1},n.DownloadLogFile=function(){var n=JSON.stringify(e),t=new u([n],{type:'text/plain;charset=utf-8'});r.saveAs(t,'log.txt')},n.DownloadSampleFile=function(){var n='chris@contoso.com\r\nbeth@contoso.com\r\ndaniel@contoso.com',t=new u([n],{type:'text/plain;charset=utf-8'});r.saveAs(t,'Bulk_Add_Sample.csv')},n.Back=function(){t.wizard().previous()},n.Cancel=function(){n.$emit('closeFlyout')},n.CloseAndRefresh=function(){n.formData.refreshListArgs="bulkaddreleasetrack",n.$emit('closeFlyout')},n.SelectAFile=function(){if(!n.csv.result.filename){n.noFileError=!0;return}n.noFileError=!1,n.bulkAddUserModel.isFileVerified||n.VerifyFile(),n.IsValidFile()&&h()},n.IsValidFile=function(){return n.bulkAddUserModel.isContentValid&&!n.bulkAddUserModel.exceededNumberofUsers&&n.bulkAddUserModel.hasContent},n.VerifyFile=function(){var t;if(!n.csv.result.filename){n.noFileError=!0;return}n.noFileError=!1,n.InitializationFileValidationResult(),n.bulkAddUserModel.hasContent=n.csv.result.length>0,n.bulkAddUserModel.hasContent&&(n.bulkAddUserModel.exceededNumberofUsers=n.csv.result.length>200,n.bulkAddUserModel.exceededNumberofUsers?(t='It looks like your CSV file has more than 200 users. Please ensure you have no more than 200 users. Save your changes, then verify your file again',e.push({Errors:t})):l()),!n.bulkAddUserModel.exceededNumberofUsers&&n.bulkAddUserModel.isContentValid&&n.formData.AddUsers.length==0&&(t='It looks like your CSV file has no entry. Please add the required user details. Save your changes, then verify your file again',e.push({Errors:t}),n.bulkAddUserModel.hasContent=!1),n.bulkAddUserModel.isContentValid||(n.formData.AddUsers=[]),n.bulkAddUserModel.isFileVerified=!0},n.InitializationFileValidationResult=function(){n.bulkAddUserModel.isFileVerified=!1,n.bulkAddUserModel.isContentValid=!0,n.bulkAddUserModel.hasContent=!0,n.bulkAddUserModel.exceededNumberofUsers=!1,n.bulkAddUserModel.InvalidUPNFormat=!1,n.formData.AddUsers=[],e=[]},a(),n.$watch("csv.result.filename",function(){n.InitializationFileValidationResult()})}return n.$inject=["$scope","wizardHandler","$parse","FileSaver","Blob","CompanyProfileService"],n}();n.app.controller("BulkAddReleaseTrackController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){function i(){n.dummyDomain='Select a domain',n.formData={UserObjectIds:[],DomainName:null},n.domainslist=[n.dummyDomain],n.DefaultDomain=n.dummyDomain,n.CurrentConfig={showNotification:!1,hasActiveChange:!1,pageinprogress:!0,saveComplete:!1,isLocationEmpty:!1,hasErrorInSaving:!1,showCloseButton:!1,showErrorSummary:!1},n.EditSummary={responseObject:[],updateCompleteUserCount:0,updateErrorUserCount:0},r()}function r(){t.GetUserDomains().success(function(t){for(var r,i=0;i<t.length;i++)r=t[i],n.domainslist.push(r.Name.toLocaleLowerCase());n.CurrentConfig.pageinprogress=!1})}this.$scope=n,this.UserManagementService=t;var u=function(){n.CurrentConfig.hasErrorInSaving||(n.$root.refreshList=!0)};n.Submit=function(){angular.isUndefined(n.DefaultDomain)?n.CurrentConfig.isLocationEmpty=!0:(n.CurrentConfig.pageinprogress=!0,n.CurrentConfig.saveActionStarted=!0,n.CurrentConfig.showCloseButton=!0,angular.forEach(n.selecteditem,function(t){n.formData.UserObjectIds.push(t.ObjectId)}),n.formData.DomainName=n.DefaultDomain,t.UpdateUserDomain(n.formData).then(function(t){n.EditSummary.responseObject=t.data,angular.forEach(n.EditSummary.responseObject,function(t){t.Status===1?(n.CurrentConfig.showErrorSummary=!0,n.EditSummary.updateErrorUserCount+=1):t.Status===0&&(n.EditSummary.updateCompleteUserCount+=1)}),u(),n.CurrentConfig.pageinprogress=!1,n.CurrentConfig.showCloseButton=!0,n.CurrentConfig.showNotification=!1,n.CurrentConfig.saveComplete=!0},function(){n.CurrentConfig.hasErrorInSaving=!0,n.CurrentConfig.pageinprogress=!1,n.CurrentConfig.showCloseButton=!0,n.CurrentConfig.showNotification=!1,n.CurrentConfig.saveComplete=!0}))},n.ShowWarnigNotification=function(){n.DefaultDomain!=n.dummyDomain?(n.CurrentConfig.hasActiveChange=!0,n.CurrentConfig.showNotification=!0):(n.CurrentConfig.hasActiveChange=!1,n.CurrentConfig.showNotification=!1)},n.Cancel=function(){n.$emit('closeFlyout')},i()}return n.$inject=["$scope","UserManagementService"],n}();n.app.controller("EditDomainsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;n.DeepLinkDictionary={adduser:{flyoutTemplateUrl:"../AdminPortal/Users/Add",flyoutType:"user",waitingIndicatorMessage:'Adding user',selecteditem:{}},resetpassword:{panelTemplateUrl:"../AdminPortal/Users/EditUserPicker",panelHeaderTitle:'Reset password',panelHeaderIcon:"ms-Icon-Basel ms-Icon-Basel--PermissionsLegacy",showCloseButton:"false",selecteditem:{Type:"ResetUser"}},edituser:{panelTemplateUrl:"../AdminPortal/Users/EditUserPicker",panelHeaderTitle:'Edit a user',panelHeaderIcon:"ms-Icon-Basel ms-Icon-Basel--EditLegacy",showCloseButton:"false",selecteditem:{Type:"EditUser"}},deleteuser:{panelTemplateUrl:"../AdminPortal/Users/EditUserPicker",panelHeaderTitle:'Delete user',panelHeaderIcon:"ms-Icon-Basel ms-Icon-Basel--DeleteLegacy",showCloseButton:"false",selecteditem:{Type:"DeleteUser"}},blockuser:{panelTemplateUrl:"../AdminPortal/Users/EditUserPicker",panelHeaderTitle:'Sign-in status',panelHeaderIcon:"",showCloseButton:"false",selecteditem:{Type:"BlockUser"}},bulkadduser:{flyoutTemplateUrl:"../AdminPortal/users/bulkadduser",flyoutHeaderTitle:'Import multiple users',flyoutHeaderIcon:"",waitingIndicatorMessage:'Import multiple users',selecteditem:{}},addgroup:{flyoutTemplateUrl:"../AdminPortal/Groups/Add",flyoutType:"group",flyoutHeaderTitle:"",flyoutHeaderIcon:"",flyoutTitle:'Add a group',waitingIndicatorMessage:'Editing members',selecteditem:{}},addsharedmailbox:{flyoutTemplateUrl:"../AdminPortal/SharedMailbox/Add",flyoutType:"sharedmailbox",flyoutHeaderTitle:"",flyoutHeaderIcon:"",flyoutTitle:'Adding Shared Mailbox',waitingIndicatorMessage:'Add a mailbox',selecteditem:{}},adddomain:{flyoutTemplateUrl:"../AdminPortal/DomainList/DomainAddWizard",flyoutType:"domainwizard",flyoutHeaderTitle:"",flyoutHeaderIcon:"",flyoutTitle:'',waitingIndicatorMessage:'Please wait',selecteditem:{}},editapppermissions:{flyoutTemplateUrl:"/AdminPortal/Settings/BusinessApps",flyoutType:"",flyoutHeaderTitle:'Business apps',flyoutHeaderIcon:"ms-Icon ms-Icon--office ss-cldr-icon",flyoutTitle:'',waitingIndicatorMessage:'Please wait',selecteditem:{}}}})(Admin||(Admin={}));//-----------------------------------------------------------------------
// <copyright file="WipeDeviceWizardController.ts" company="Microsoft">
//     Copyright (c) Microsoft. All rights reserved.
// </copyright>
//-----------------------------------------------------------------------
/// <reference path="../../ext/angular/1.3.15/angular.d.ts" />
/// <reference path="../../AdminBaseControls.ts" />
/// <reference path="../../services/IntuneService.ts"/>
/// <reference path="../../services/IntuneHelperService.ts"/>
/// <reference path="../../ext/angular-wizard/angular-wizard.ts" />
var Admin;
(function (Admin) {
    'use strict';
    /**
     * The controller for the Wipe Device Wizard
     */
    var WipeDeviceWizardController = (function () {
        function WipeDeviceWizardController($scope, $q, wizardHandler, intuneService, IntuneHelperService) {
            $scope.searchTerm = { Value: "" };
            $scope.selectedDevices = [];
            $scope.formData.refreshListArgs = {};
            $scope.operationModel = { serverError: false, errors: [], showSpinner: false, complete: false };
            $scope.deviceModel = { serverError: false, error: [], showSpinner: true };
            $scope.OpenedFromDeviceList = function () {
                if ($scope.selecteditem.Data && $scope.selecteditem.Data.length > 0) {
                    if ($scope.GetCurrentStep() === 1) {
                        wizardHandler.wizard().next();
                    }
                    $scope.selectedDevices = $scope.selecteditem.Data;
                    return true;
                }
                return false;
            };
            $scope.WizardDataLoaded = false;
            $scope.GetCurrentStep = function () {
                if (wizardHandler.wizard()) {
                    return wizardHandler.wizard().currentStepNumber();
                }
                else {
                    return -1;
                }
            };
            $scope.IsFactoryReset = function () {
                return $scope.selecteditem.Type === "FactoryReset";
            };
            var initDeviceList = function () {
                intuneService.GetAllDevices().then(function (result) {
                    result.data.forEach(function (device) {
                        device.isChecked = false;
                    });
                    $scope.allDevices = result.data;
                    // Factory reset can only be done on windows 10 devices
                    if ($scope.IsFactoryReset()) {
                        $scope.allDevices = $scope.allDevices.filter(function (device) { return device.OperatingSystem === "Windows"; });
                    }
                    $scope.devices = $scope.allDevices;
                    $scope.deviceCount = $scope.devices.length;
                    $scope.WizardDataLoaded = true;
                    $scope.deviceModel.showSpinner = false;
                }, function (error) {
                    $scope.deviceModel.showSpinner = false;
                    $scope.deviceModel.serverError = true;
                    $scope.deviceModel.error = error.data;
                });
            };
            $scope.UpdateSelectedDevices = function (device) {
                if (device.isChecked) {
                    $scope.selectedDevices.push(device);
                }
                else {
                    var index = $scope.selectedDevices.findIndex(function (element) {
                        return element.id === device.id;
                    });
                    if (index !== -1) {
                        $scope.selectedDevices.splice(index, 1);
                    }
                }
            };
            $scope.getRowCss = function (device) {
                if (device && device.isChecked) {
                    return { 'background-color': '#DDEBF7' };
                }
            };
            $scope.Cancel = function () {
                $scope.$emit('closeFlyout');
            };
            $scope.SearchList = function (searchTerm) {
                $scope.devices = [];
                $scope.selectedDevices = [];
                $(".dataListField").prop('checked', false);
                if (searchTerm !== "") {
                    $scope.allDevices.forEach(function (device) {
                        if ((device.DisplayName.indexOf(searchTerm) !== -1) || (device.UserDisplayName.indexOf(searchTerm) !== -1) || (device.OperatingSystem.indexOf(searchTerm) !== -1) || (device.OsVersion.indexOf(searchTerm) !== -1)) {
                            $scope.devices.push(device);
                        }
                    });
                    $scope.deviceCount = $scope.devices.length;
                }
                else {
                    $scope.devices = $scope.allDevices;
                    $scope.deviceCount = $scope.devices.length;
                }
            };
            $scope.SelectDevices = function () {
                wizardHandler.wizard().next();
            };
            $scope.ResetDevices = function () {
                var promises = [];
                switch ($scope.selecteditem.Type) {
                    case "RemoveCompanyData":
                        $scope.selectedDevices.forEach(function (device, index, array) {
                            promises.push(intuneService.RemoveCompanyDataDevice(device.UserId, device.Id));
                        });
                        break;
                    case "FactoryReset":
                        $scope.selectedDevices.forEach(function (device, index, array) {
                            promises.push(intuneService.FactoryResetDevice(device.Id));
                        });
                        break;
                    default:
                }
                if ($scope.selectedDevices && $scope.selectedDevices.length > 0) {
                    $scope.operationModel.showSpinner = true;
                    IntuneHelperService.WaitForAllPromises($q, promises).promise.then(function () {
                        $scope.operationModel.showSpinner = false;
                        $scope.operationModel.complete = true;
                        $scope.operationModel.serverError = false;
                        return null;
                    }).catch(function () {
                        var headerFormat = $scope.selecteditem.Type === "RemoveCompanyData" ? 'Failed to remove company data from device \x7b0\x7d' : 'Failed to factory reset device \x7b0\x7d';
                        $scope.operationModel.showSpinner = false;
                        $scope.operationModel.serverError = true;
                        $scope.operationModel.complete = true;
                        promises.forEach(function (promise, index, array) {
                            if (promise.$$state.status === 2) {
                                $scope.operationModel.errors.push({
                                    header: headerFormat.Format($scope.selectedDevices[index].DisplayName),
                                    error: promise.$$state.value.data,
                                    device: $scope.selectedDevices[index]
                                });
                            }
                        });
                        return null;
                    });
                }
            };
            initDeviceList();
        }
        WipeDeviceWizardController.$inject = ["$scope", "$q", "wizardHandler", "IntuneService", "IntuneHelperService"];
        return WipeDeviceWizardController;
    })();
    Admin.app.controller("WipeDeviceWizardController", WipeDeviceWizardController);
})(Admin || (Admin = {}));
;var Admin;(function(n){'use strict';;var i,t;(function(n){n[n.Unknown=0]="Unknown",n[n.Wipe=1]="Wipe",n[n.Reset=2]="Reset"})(i||(i={})),t=function(){function n(n,t,i,r){var o='Bulk Actions',f=function(i){var r={};return r=i.length==1?{panelTemplateUrl:"../AdminPortal/Intune/DeviceSummary",panelHeaderTitle:i[0].DisplayName,panelHeaderIcon:t.currentCultureInfo?"ms-Icon ms-Icon--desktop g-icon-txt-rtl ss-icon-size":"ms-Icon ms-Icon--desktop g-icon-txt ss-icon-size",unselectonclose:!1,unhighlightonclose:!1,selecteditem:n.selectedDevices[0]}:{panelTemplateUrl:"../AdminPortal/Intune/bulkdeviceactions",panelHeaderTitle:o,unselectonclose:!0,unhighlightonclose:!0,panelCustomClass:"panelflyout-xsmall"}},s=function(){var i=n.selecteditem;return i.Data=n.selectedDevices,n.selectedAction===2?(i.Type="FactoryReset",{flyoutTemplateUrl:"../AdminPortal/Intune/WipeDeviceWizard",flyoutTitle:'Factory reset',flyoutHeaderIcon:t.currentCultureInfo?"ms-Icon ms-Icon--desktop g-icon-txt-rtl ss-icon-size":"ms-Icon ms-Icon--desktop g-icon-txt ss-icon-size",selecteditem:i,flyoutType:"user"}):n.selectedAction===1?(i.Type="RemoveCompanyData",{flyoutTemplateUrl:"../AdminPortal/Intune/WipeDeviceWizard",flyoutTitle:'Remove company data',flyoutHeaderIcon:t.currentCultureInfo?"ms-Icon ms-Icon--desktop g-icon-txt-rtl ss-icon-size":"ms-Icon ms-Icon--desktop g-icon-txt ss-icon-size",selecteditem:i,flyoutType:"user"}):null},e=function(t,u){u!=null?(t!=null&&u.forEach(function(n,i,r){r[i].UserDisplayName=t.DisplayName,r[i].UserId=t.ObjectId,r[i].UserPrincipalName=t.UserPrincipalName}),n.selectedDevices=[],n.allDevices=u,n.devices=n.allDevices,n.deviceCount=n.devices.length,n.WizardDataLoaded=!0,n.IntuneModel.showSpinner=!1):i.GetAllDevices().then(function(t){n.selectedDevices=[],t.data.length>0?(t.data.forEach(function(n){n.isChecked=!1}),n.allDevices=t.data,n.devices=n.allDevices,n.deviceCount=n.devices.length,n.WizardDataLoaded=!0):n.IntuneModel.noResults=!0,n.IntuneModel.showSpinner=!1},function(t){n.IntuneModel.serverError=!0,n.IntuneModel.showSpinner=!1,n.IntuneModel.error=t.data,r.LogError(423423,"Intune_DeviceController: ListDevices error: {0}".Format(t.data))})},u='closePanel';n.selectedAction=0,n.searchTerm={Value:""},n.selectedDevices=[],n.selectedHeader={isChecked:!1},n.WizardDataLoaded=!1,n.IntuneModel={},n.IntuneModel.serverError=!1,n.IntuneModel.noResults=!1,n.IntuneModel.showSpinner=!0,n.IntuneModel.error=null,n.initCallbackPanel=function(t){n.panel=t},n.initCallbackFlyout=function(t){n.flyout=t},n.UpdateSelectedDevices=function(t){var r,i;t.isChecked?(n.selectedDevices.push(t),n.panel!=null&&(n.$broadcast(u),i=f(n.selectedDevices),n.panel.invoke(i))):(r=n.selectedDevices.findIndex(function(n){return n.Id===t.Id}),r!==-1&&n.selectedDevices.splice(r,1),n.panel!=null&&(n.selectedDevices.length===1&&(n.$broadcast(u),i=f(n.selectedDevices),n.panel.invoke(i)),n.selectedDevices.length===0&&n.$broadcast(u)),n.selectedHeader.isChecked=!1)},n.getRowCss=function(n){if(n&&n.isChecked)return{'background-color':'#DDEBF7'}},n.SearchList=function(t){if(n.devices=[],n.selectedDevices=[],$(".dataListField").prop('checked',!1),t!==""){var i=t.toLowerCase();n.devices=n.allDevices.filter(function(n){return n.DisplayName.toLowerCase().indexOf(i)!==-1||n.UserDisplayName.toLowerCase().indexOf(i)!==-1||n.OperatingSystem.toLowerCase().indexOf(i)!==-1||n.OsVersion.toLowerCase().indexOf(i)!==-1})}else n.devices=n.allDevices;n.deviceCount=n.devices.length},n.SelectAllDevices=function(t){if(t){if(n.allDevices!=null&&n.allDevices.length>0&&n.allDevices.forEach(function(t){n.selectedDevices.indexOf(t)==-1&&n.selectedDevices.push(t)}),n.panel!=null){var i=f(n.selectedDevices);n.panel.invoke(i)}}else n.selectedDevices=[];n.selectedHeader.isChecked=t,$(".dataListField").prop('checked',t),angular.forEach(n.allDevices,function(n){n.isChecked=t}),angular.forEach(n.devices,function(n){n.isChecked=t})},n.ShouldDisable=function(){return n.selectedDevices.length<1},n.ToggleActionLinks=function(){if($(".userlistActions:visible").length>0){$(".userlistActions").hide();return}$('.userlistActions').show()},n.$on('RefreshList',function(){for(var i=0;i<n.devices.length;i++)n.devices[i].isChecked&&(n.devices.splice(i,1),i--);n.$broadcast(u),e(null)}),n.SelectedDevicesContainsNonWindows=function(){return n.selectedDevices.some(function(n){return n.OperatingSystem!="Windows"})},n.SelectDeviceOperation=function(){n.selectedDevices.length>0&&n.flyout.invoke(s())},n.CancelDeviceOperation=function(){n.$emit('closeFlyout')},n.selecteditem!=null?e(n.selecteditem,n.selecteditem.Devices):e()}return n.$inject=["$scope","$rootScope","IntuneService","LogService"],n}(),n.DeviceListController=t,n.app.controller("DeviceListController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n){n.selectedDevices=n.$parent.$parent.$parent.selectedDevices,n.SelectedDevicesContainsNonWindows=function(){return n.selectedDevices.some(function(n){return n.OperatingSystem!="Windows"})}}return n.$inject=["$scope","IntuneService"],n}();n.DevicePanelsController=t,n.app.controller("DevicePanelsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(){}return Object.defineProperty(n,"EVENTS",{get:function(){return{FILTER_CHANGED:"shd-FilterChanged"}},enumerable:!0,configurable:!0}),n}(),i,r;n.ServiceHealthConstants=t,function(n){n[n.All=0]="All",n[n.Incidents=1]="Incidents",n[n.Advisories=2]="Advisories"}(n.MessageFilter||(n.MessageFilter={})),i=n.MessageFilter,function(n){n[n.Advisory=0]="Advisory",n[n.Incident=1]="Incident"}(n.MessageClassification||(n.MessageClassification={})),r=n.MessageClassification,n.app.constant("ServiceHealthConstants",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(n,t){var i=function(i,r,u){i.$watch(u.content,function(){r.html(t(u.content)(i)),n(r.contents())(i)},!0)};return{restrict:'E',link:i}}n.app.directive("dynamicHtml",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{restrict:'A',scope:{item:'='},link:function(n,t){if(t[0].tagName==='A'&&angular.isDefined(n.item)){var r=n.item,u='';angular.isDefined(r.HelpTopicId)&&r.HelpTopicId!==null&&r.HelpTopicId!==''?u=r.HelpLinkUrl:angular.isDefined(r.PopoutURL)&&r.PopoutURL!==null&&r.PopoutURL!==''&&(t[0].target="_blank",u=r.PopoutURL),t[0].href=u}}}}n.app.directive("dynamicHrefDirective",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(n,t){return{restrict:'A',require:"ngModel",link:function(i,r,u,f){var e=function(){var t=r.val().replace(/[^0-9]/g,'');r.val(n('textNumberFilter')(t,!1))};f.$parsers.push(function(n){return n.replace(/[^0-9]/g,'').slice(0,10)}),f.$render=function(){r.val(n('textNumberFilter')(f.$viewValue,!1))},r.bind('change',e),r.bind('keydown',function(n){var i=n.keyCode;i==91||15<i&&i<19||37<=i&&i<=40||t.defer(e)}),r.bind('paste cut',function(){t.defer(e)})}}}n.app.directive("textNumberDirective",['$filter','$browser',t])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(n){var t=function(n){return n.querySelector("input").getAttribute("name")},i=function(n){return n.querySelector("input").getAttribute("validation-message")},r=function(n,t,i,r,u,f){var e=u+'_Validation',o="<div id='"+e+"' class='form-hide-validation'><div>"+f+"</div></div>",s=i(o)(r);t.append(s)},u=function(n,t){return function(){if(t&&n[t])return n[t].$touched&&n[t].$error.required}},f=function(n,t){var i=t.fclass;return function(t){t?(n.find("#validation").removeClass("form-hide-validation").addClass("font-medium f-disp-inblk"),i&&n.find("#validation").addClass(i)):(n.find("#validation").removeClass("f-disp-inblk").addClass("form-hide-validation"),i&&n.find("#validation").removeClass(i))}},e=function(n){return function(e,o,s,h){var c=t(o[0]),l=i(o[0]);r(h,o,n,e,c,l),e.$watch(u(h,c),f(o,s))}};return{restrict:'A',scope:{},require:"^form",link:e(n)}}n.app.directive("forminputdirective",['$compile',t])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t,i;(function(n){n[n.Right=0]="Right",n[n.Bottom=1]="Bottom"})(t||(t={})),i=function(){function n(n,t){var i=this;this.$timeout=n,this.$rootScope=t,this.restrict="A",this.scope={tooltipsIsCustomPosition:"=?",tooltipsIsInFlyout:"=?",tooltipsPosition:"@"},this.link=function(n,t,r){function s(t,i){var o=t[0].id,h=o+"_Tooltip_",f=i.id.replace(h,''),s="tooltip_"+f,a="<span class= \""+c(e)+" f-inblck\" id=\""+s+"\">"+i.value+"</span>",r=$("#"+f);r.attr("aria-describedby",s),r.prop("tagName")&&r.prop("tagName").toLowerCase()==="span"&&(r.addClass("f-tooltip-text-hint"),r.attr("role","tooltip"),r.attr("tabindex",0)),t.after(a);r.on('focusin',function(){var i=$("#tooltip_"+f),s=0,h,c,a;if(n.tooltipsIsInFlyout){var v=document.getElementById(f),y=u.$rootScope.currentCultureInfo?$(".flyoutContent-rtl")[0]:$(".flyoutContent")[0],p=y.getBoundingClientRect(),w=v.getBoundingClientRect(),b=w.top-p.top,h=u.$rootScope.currentCultureInfo?angular.element(".flyout-header-rtl:first"):angular.element(".flyout-header:first");s=b+h.outerHeight(!0)+$(".flyout-ng-Title:first").outerHeight(!0)}else s=t.find("#"+f).position().top;r.attr('type')&&r.attr('type').toLowerCase()=="checkbox"&&(s=s-11),o=="DomainAddForm"?(h=u.$rootScope.currentCultureInfo?angular.element(".flyout-header-rtl:first"):angular.element(".flyout-header:first"),s=s-h.outerHeight(!0),i.addClass("f-tooltip-max-width-350")):o=="CustomDnsRecord"&&i.addClass("f-tooltip-max-width-350"),n.tooltipsIsCustomPosition||(l(e)?(c=s+r.outerHeight()+12,a=.5*(r.outerWidth()-i.outerWidth()),i.css("top",c),i.css("left",r.position().left),i.css({transform:"translateX("+a+"px)"})):i.css("top",s)),i.show()});r.on('focusout',function(n){var t=$("#tooltip_"+f);if(document.activeElement.attributes.getNamedItem("id")&&document.activeElement.attributes.getNamedItem("id").nodeValue=="tooltip_"+f||n.relatedTarget&&n.relatedTarget.parentNode.attributes.getNamedItem("id")&&n.relatedTarget.parentNode.attributes.getNamedItem("id").nodeValue=="tooltip_"+f){t.show();t.on('focusout',function(){t.hide()})}else t.hide()})}function h(n){if(!n||n==="")return 0;var t;switch(n.toLowerCase()){case"bottom":t=1;break;case"right":default:t=0}return t}function c(n){return n===1?"f-tooltip-bottom":u.$rootScope.currentCultureInfo?"f-tooltip-rtl":"f-tooltip"}function l(n){return n===1}n.tooltipsIsInFlyout=angular.isDefined(r.tooltipsIsInFlyout)?n.$parent.$eval(r.tooltipsIsInFlyout):!0;var e=h(n.tooltipsPosition),o=t[0].id+"_Tooltip_",u=i,f;$('[id^="'+o+'"]').each(function(n,i){f=u.$timeout(function(){s(t,i)},1e3)}),n.$on("$destroy",function(){f&&u.$timeout.cancel(f)})}}return n.factory=function(){var t=function(t,i){return new n(t,i)};return t.$inject=["$timeout","$rootScope"],t},n}(),n.app.directive("tooltips",i.factory())})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{scope:{pwdstrength:'='},require:'?ngModel',link:function(n,t,i,r){if(r){var u=function(t){if(n.pwdstrength){if(t&&t.length<=16){var i=/^(?=.*[0-9])(?=.*[A-Z])(?=.*[a-z])[a-zA-Z0-9\x21-\x2f\x3a-\x40\x5b-\x60\x7b-\x7e]{8,16}$/,u=/^(?=.*[0-9])(?=.*[A-Z])(?=.*[\x21-\x2f\x3a-\x40\x5b-\x60\x7b-\x7e])[a-zA-Z0-9\x21-\x2f\x3a-\x40\x5b-\x60\x7b-\x7e]{8,16}$/,f=/^(?=.*[0-9])(?=.*[a-z])(?=.*[\x21-\x2f\x3a-\x40\x5b-\x60\x7b-\x7e])[a-zA-Z0-9\x21-\x2f\x3a-\x40\x5b-\x60\x7b-\x7e]{8,16}$/,e=/^(?=.*[a-z])(?=.*[A-Z])(?=.*[\x21-\x2f\x3a-\x40\x5b-\x60\x7b-\x7e])[a-zA-Z0-9\x21-\x2f\x3a-\x40\x5b-\x60\x7b-\x7e]{8,16}$/,o=i.test(t)||u.test(t)||f.test(t)||e.test(t);r.$setValidity('pwdstrength',o)}else r.$setValidity('pwdstrength',!1);return t}return r.$setValidity('pwdstrength',!0),t};r.$formatters.push(u),r.$parsers.unshift(u),n.$watch('pwdstrength',function(){u(r.$viewValue)})}}}}function i(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$validators.validateemail=function(n){if(n){if(n.trim().length>0){var t=/^([a-zA-Z0-9\'_-]\\.?)*[a-zA-Z0-9\'_.-]+$/;return t.test(n)}return!0}return!0}}}}n.app.directive("pwdstrength",['$parse',t]),n.app.directive("validateemail",i)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{scope:{required:'='},restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$validators.fiveEmailAddressesValidation=function(n){if(i.required)var r=/^\s*[a-zA-Z0-9]['a-zA-Z0-9._-]*@(?!\.+)[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}(\s*;\s*([a-zA-Z0-9]['a-zA-Z0-9._-]*@(?!\.+)[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})){0,4}\s*;?\s*$/,t=r.test(n);else t=!0;return t}}}}n.app.directive("fiveEmailAddressesValidation",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{scope:{required:'='},restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$validators.emailAddressValidation=function(n){if(i.required)var r=/^(?!^[.])([-'a-zA-Z0-9_]+\.)*[-'a-zA-Z0-9_\+]+@(?!\.+)([-a-zA-Z0-9]+\.)+[a-zA-Z]{2,}$/,t=r.test(n);else t=!0;return t}}}}n.app.directive("emailAddressValidation",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{scope:{required:'='},restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$validators.phoneNumberValidation=function(n){if(i.required)var r=/^[0-9]{3}[-\s\.]{0,1}[0-9]{3}[-\s\.]{0,1}[0-9]{4}$/,t=r.test(n);else t=!0;return t}}}}n.app.directive("phoneNumberValidation",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{scope:{required:'='},restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$validators.zipCodeValidation=function(n){if(i.required)var r=/^(\d{5}(-\d{4})?|[A-Z]\d[A-Z] *\d[A-Z]\d)$/,t=r.test(n);else t=!0;return t}}}}n.app.directive("zipCodeValidation",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$validators.userNameValidation=function(n){var t=/^([a-zA-Z0-9'_-]\?)*[a-zA-Z0-9'_.-]+$/;return t.test(n)}}}}n.app.directive("userNameValidation",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$validators.groupAliasValidation=function(n){var t=/^(?!.*\.{2})(?!^\.)(?!.*[-_.]$)[a-zA-Z0-9-_.]+$/;return t.test(n)}}}}n.app.directive("groupAliasValidation",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$validators.ewsGroupAliasValidation=function(n){var t=/^[A-Za-z0-9-_]+$/;return t.test(n)}}}}n.app.directive("ewsGroupAliasValidation",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{scope:{minvalue:'=',maxvalue:'='},require:"ngModel",link:function(n,t,i,r){r.$validators.inputRangeValidation=function(t){return!isNaN(t)&&angular.isNumber(+t)&&t>=n.minvalue&&t<=n.maxvalue}}}}n.app.directive("inputRangeValidation",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{require:"ngModel",link:function(n,t,i,r){function u(n){var t=n.replace(/[^0-9]/g,'');return t!==n&&(r.$setViewValue(t),r.$render()),t}r.$parsers.push(u)}}}n.app.directive("integer",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(n,t,i){function b(n,t){n.bind("keydown keypress",function(i){var r=n.parents("#headerbarContainer").find('[controltype="child"]'),u=r.index(n);i.which==t.$root.KeyCodes.DownArrowKey?($(r[u+1]).attr("tabindex",0).focus(),i.preventDefault()):i.which==t.$root.KeyCodes.UpArrowKey&&($(r[u-1]).attr("tabindex",0).focus(),i.preventDefault())})}function w(n,t,i){n.bind("keydown keypress",function(r){if(r.which===t.$root.KeyCodes.TabKey&&i.controltype=="file"&&angular.element("#flyout").length){var u=$('#flyout').find('a, button, :input, [tabindex]').filter(":visible").filter(":enabled").filter(":not([tabindex=-1])"),f=u.index(n);r.shiftKey?angular.element(u[f-1]).focus():angular.element(u[f+1]).focus(),r.preventDefault()}})}function p(n,t,i){n.bind("keydown keypress",function(r){r.which===t.$root.KeyCodes.EnterKey&&i.controltype=="widgettask"&&(n.click(),r.preventDefault())})}function y(n,t){n.bind("keydown keypress",function(i){var r,u;r=n.hasClass('cp-content')?n.find('[controltype="widgettask"]'):n.parents('.cp-content').find('[controltype="widgettask"]'),u=r.index(n),i.which===t.$root.KeyCodes.DownArrowKey?($(r[u+1]).attr("tabindex",-1).focus(),i.preventDefault(),i.stopPropagation()):i.which===t.$root.KeyCodes.UpArrowKey&&($(r[u-1]).attr("tabindex",-1).focus(),i.preventDefault(),i.stopPropagation())})}function v(n,t,i,r){var u=angular.element("#searchResultsInfo").find('[controltype="searchresult"]'),f,e;(u||u.length!=0)&&(f=u.index(n),r.which==t.$root.KeyCodes.DownArrowKey?($(u[f+1]).attr("tabindex",-1).focus(),r.preventDefault()):r.which==t.$root.KeyCodes.UpArrowKey?($(u[f-1]).attr("tabindex",-1).focus(),r.preventDefault()):r.which==t.$root.KeyCodes.EnterKey&&i.controltype==="searchresult"?(n.find('.srch-cursor-ptr').trigger('click'),r.preventDefault()):r.which!=t.$root.KeyCodes.TabKey||i.controltype!="header"||r.shiftKey||(e=k(t),angular.element("#"+e).find(".widgetHeader").focus(),r.preventDefault()))}function a(n,t,i){n.bind("keydown keypress",function(r){var u=n.parents("#gridRowsContainer").find('[controltype=widgettask]'),f;u.length!=0&&(f=u.index(n),r.which===t.$root.KeyCodes.DownArrowKey&&i.controltype=="widgettask"?($(u[0]).attr("tabindex",-1),$(u[f+1]).attr("tabindex",-1).focus(),r.preventDefault()):r.which===t.$root.KeyCodes.UpArrowKey&&i.controltype=="widgettask"?($(u[0]).attr("tabindex",-1),$(u[f-1]).attr("tabindex",-1).focus(),r.preventDefault()):r.which===t.$root.KeyCodes.SpaceBar&&i.controltype=="widgettask"?(t.$root.focusOnPanel=!1,n.find("input[type='checkbox']").click(),r.preventDefault()):r.which===t.$root.KeyCodes.EnterKey&&i.controltype=="widgettask"?(n.find(".listViewRowInfo").click(),r.preventDefault()):r.which===t.$root.KeyCodes.TabKey&&i.controltype=="header"&&n.is(":focus")&&!r.shiftKey?($(u[0]).attr("tabindex",-1).focus(),r.preventDefault()):r.which===t.$root.KeyCodes.TabKey&&i.controltype=="widgettask"&&n.is(":focus")&&!r.shiftKey?$(u[0]).attr("tabindex",0):r.which===t.$root.KeyCodes.HomeKey&&($(u[0]).attr("tabindex",-1).focus(),r.preventDefault()))})}function c(i,r,u){u.controltype==="header"&&(i.parent('div').attr('isvideowidget')?$(i).attr("aria-describedby","VideoWidgetInstructions"):i.parent('div').attr('ismessagecenterwidget')?$(i).attr("aria-describedby","MessageCenterWidgetInstructions"):$(i).attr("aria-describedby","WidgetInstructions")),i.bind("keydown keypress",function(o){var v=i.parents('.dashboard-widget2,.dashboard-widget').find('[controltype="widgettask"]'),c=v.index(i),l,d,b,tt,it,w,p,y,k,a,ut,g,nt,rt;if(o.which===r.$root.KeyCodes.DownArrowKey)$(v[c+1]).attr("tabindex",-1).focus(),o.preventDefault();else if(o.which===r.$root.KeyCodes.UpArrowKey)$(v[c-1]).attr("tabindex",-1).focus(),o.preventDefault();else if(o.which===r.$root.KeyCodes.EnterKey)l=i.attr('ui-sref'),d=i.attr('ismessagecenter'),l?(b=l.substring(l.lastIndexOf("(")+1,l.lastIndexOf(")")),b?(tt=l.substring(0,l.lastIndexOf("(")),n.go(tt,b)):n.go(l)):i.find('a').attr('href')||i.attr('href')?(it=i.find('a').attr('href')||i.attr('href'),w=i.find('a').attr('target')||i.attr('target'),w===undefined&&(w="_self"),t.open(it,w),o.preventDefault()):typeof d!=typeof undefined&&d!==!1?(i.find('div').first().click(),o.preventDefault()):(i.click(),o.preventDefault());else if(o.which===r.$root.KeyCodes.LeftKey&&u.controltype=="widgettask"&&u.isvideocontrol)$(".carousel-control.left").click(),p=i.parent('ul').attr('slideslength'),y=parseInt(i.parent('ul').attr('slideindex')),c=y==0?(p-1)*u.rowlimit:(y-1)*u.rowlimit,o.preventDefault(),$(v[c]).attr("tabindex",-1).focus();else if(o.which===r.$root.KeyCodes.RightKey&&u.controltype=="widgettask"&&u.isvideocontrol)$(".carousel-control.right").click(),p=i.parent('ul').attr('slideslength'),y=parseInt(i.parent('ul').attr('slideindex')),c=y==p-1?0:(y+1)*u.rowlimit,o.preventDefault(),$(v[c]).attr("tabindex",-1).focus();else if(o.which===r.$root.KeyCodes.DeleteKey&&u.ismessagecenter)k=i.find("div.mc-dismiss-div a").first(),k&&(k.trigger('click'),$(v[c+1]).attr("tabindex",-1).focus()),o.preventDefault();else if(o.which===r.$root.KeyCodes.TabKey){if(a=i.parent().attr('id'),a=u.controltype=="header"?i.parent().attr('id'):i.parents('.gridster-item').attr('id'),ut=r.$root.CurrentUserInfo.CustomizationModel.SelectedWidgets,o.shiftKey)u.iscustomaddwidget?(nt=h(r),angular.element("#"+nt).find(".widgetHeader").focus()):e(r,a)?angular.element("#modernSearchTextBoxId").focus():(rt=f(r,a),angular.element("#"+rt).find(".widgetHeader").focus());else{if(a==undefined)return;g=s(r,a),g=="lastwidget"?angular.element("#CustomizeDashboardWidget").focus():angular.element("#"+g).find(".widgetHeader").focus()}o.preventDefault()}})}function k(n){for(var f=n.$root.Dashboard.cols,t=0,u=0,i=undefined;typeof i=="undefined";)t>f&&(u++,t=0),i=r(u,t,n),t++;return console.log('first widget name',i),i}function h(n){var t=n.$root.Dashboard.cols,e=n.$root.CurrentUserInfo.CustomizationModel.SelectedWidgets,f=u(n),i;for(t--,f--,i=undefined;typeof i=="undefined";)t--,t<0&&(f--,t=n.$root.Dashboard.cols),i=r(f,t,n);return i}function s(n,t){for(var s=n.$root[t],e=s.row,i=s.col,h=n.$root.Dashboard.cols,l=u(n),f=undefined,c;typeof f=="undefined";)i++,i>h&&(e++,i=0),f=r(e,i,n),c=o(h,l,e,i),c&&(f="lastwidget");return f}function u(n){for(var i=n.$root.CurrentUserInfo.CustomizationModel.SelectedWidgets,r=0,t=0;t!=i.length;++t)n.$root[i[t]].row>r&&(r=n.$root[i[t]].row);return r}function o(n,t,i,r){return n===r+1&&t===i+1}function e(n,t){var i=n.$root[t],r=i.col,u=i.row;return r===0&&u===0}function f(n,t){for(var f=n.$root[t],e=f.row,i=f.col,u=undefined;typeof u=="undefined";)i--,i<0&&(e--,i=n.$root.Dashboard.cols),u=r(e,i,n);return u}function r(n,t,i){var r=undefined,u=i.$root.CurrentUserInfo.CustomizationModel.SelectedWidgets;return angular.forEach(u,function(u){if(angular.isUndefined(r)){var e=i.$root[u];if(e.col==t&&e.row==n)return r=u}}),r}function l(n,t,r){n.bind("keydown keypress",function(u){var f=n.parents("#pickerSelection").find('[controltype=pickeritem]'),e=n.parents("#pickerSelection").find('[controltype=pickeritemselected]'),l=n.parents("#pickerSelection").find('[controltype=pickerheaderselected]'),a=n.parents("#pickerSelection").find('[controltype=pickerheader]'),o=f.index(n),s=e.index(n),h,c;u.which===t.$root.KeyCodes.DownArrowKey?(r.controltype=="pickeritem"?$(f[o+1]).attr("tabindex",-1).focus():r.controltype=="pickeritemselected"?$(e[s+1]).attr("tabindex",-1).focus():r.controltype=="pickerheader"?$(f[0]).attr("tabindex",-1).focus():r.controltype=="pickerheaderselected"&&$(e[0]).attr("tabindex",-1).focus(),u.preventDefault()):u.which===t.$root.KeyCodes.UpArrowKey?(r.controltype=="pickeritem"?$(f[o-1]).attr("tabindex",-1).focus():r.controltype=="pickeritemselected"&&$(e[s-1]).attr("tabindex",-1).focus(),u.preventDefault()):u.which===t.$root.KeyCodes.SpaceBar||u.which===t.$root.KeyCodes.EnterKey?n.find('.ms-Icon-Basel--CancelLegacy').length>0&&r.controltype=="pickeritem"?(n.find('.ms-Icon-Basel--CancelLegacy').click(),o==f.length-1?$(f[o-1]).attr("tabindex",-1).focus():$(f[o+1]).attr("tabindex",-1).focus(),f.length==1&&$(l[0]).focus(),u.preventDefault()):r.controltype=="pickeritem"?(n.find(":checkbox").length>0?(h=n.find(":checkbox"),c=h.prop('checked')?'Removed':'Selected',h.attr('aria-checked',!h.prop('checked')),i.AnnounceText(c),n.click()):n.click(),u.preventDefault()):r.controltype=="pickerheaderselected"?(n.click(),u.preventDefault()):r.controltype=="pickeritemselected"&&(n.find("#clearSelection").click(),s==e.length-1?$(e[s-1]).attr("tabindex",-1).focus():$(e[s+1]).attr("tabindex",-1).focus(),e.length==1&&$(a[0]).focus(),u.preventDefault()):u.which===t.$root.KeyCodes.HomeKey&&(r.controltype=="pickeritem"?($(f[0]).attr("tabindex",-1).focus(),u.preventDefault()):r.controltype=="pickeritemselected"&&($(e[0]).attr("tabindex",-1).focus(),u.preventDefault()))})}function d(n,t){n.bind("keydown keypress",function(i){i.which===t.$root.KeyCodes.EnterKey&&(n.find('[name=changeRating]').click(),i.preventDefault())})}return{restrict:"A",link:function(n,t,i){var r=i.page;r=='dashboard'?c(t,n,i):r=='grid'?a(t,n,i):r=='modernsearch'?t.bind("keydown keypress",function(r){(r.which===n.$root.KeyCodes.DownArrowKey||r.which===n.$root.KeyCodes.UpArrowKey||r.which===n.$root.KeyCodes.EnterKey||r.which===n.$root.KeyCodes.TabKey)&&v(t,n,i,r)}):r=='picker'?l(t,n,i):r=='companyprofile'?y(t,n,i):r=='messagecenterlist'?d(t,n,i):r=="domain"?p(t,n,i):r=="common"?w(t,n,i):r=="dropdown"&&b(t,n,i)}}}n.app.directive("keyUpAndDownWidget",['$state','$window','AccessibilityService',t])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(n){return{restrict:"A",link:function(t,i){n(function(){i[0].focus()},400)}}}n.app.directive("setfocus",["$timeout",t])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){var n="../AdminPortal/SetupWizard/SetupBannerTemplate",t=['$scope','$location','$modal',function(t,i,r){var u=function(){t.templateUrl&&(n=t.templateUrl)};t.openSetupVideo=function(){var n=r.open({animation:!1,controller:'VideoPlayerController',resolve:{uuid:function(){return t.videoLink}},templateUrl:'setupVideoModalContent.html',backdrop:'static'})},t.GetSetupWizardBannerStepIconCssClass=function(n){return n==t.currentIndex?"inprogress":n<t.currentIndex?"done ms-Icon-Basel ms-Icon-Basel--CompletedSolid":"notstarted"},t.GotoUsers=function(){i.path("/users")},u()}];return{restrict:'E',templateUrl:n,scope:{typeClass:'=',currentIndex:'=',stepSet:'=',simpleMode:'=',processing:'=',showError:'=',showVideo:'=',showIndicator:'=',completedRate:'@',videoLink:'@',bannerText:'@',buttonText:'@',templateUrl:'@',buttonAction:'&',helpAction:'&',showClose:'=',closeAction:'&',loadingComplete:'='},controller:t}}n.app.directive("setupBanner",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{restrict:'E',templateUrl:'/Admin/Views/SetupWizard/_InstallSoftware.html',scope:{icon:'@',pictures:'=',title:'@',intro:'@',buttonText:'@',buttonAction:'&'}}}n.app.directive("setupwizardInstallsoftware",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){var n=['$scope','SetupWizardService',function(n,t){n.$watch("hasBackAction",function(i){i!==undefined&&(i||(n.backAction=function(){t.Previous()}))}),n.$watch("hasNextAction",function(i){i!==undefined&&(i||(n.nextAction=function(){t.Next()}))}),n.$watch("hasExitAction",function(i){i!==undefined&&(i||(n.exitAction=function(){t.Exit()}))})}];return{restrict:'E',templateUrl:'/Admin/Views/SetupWizard/_FootActionTemplate.html',scope:{backText:"@",exitText:"@",backAction:"&",nextAction:"&",exitAction:"&",processingIndicator:"=",disableNextIndicator:"=",nextDisplayModel:"="},controller:n,link:function(n,t,i){n.hasBackAction=angular.isDefined(i.backAction),n.hasNextAction=angular.isDefined(i.nextAction),n.hasExitAction=angular.isDefined(i.exitAction)}}}n.app.directive("setupWizardFootAction",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(n){var t=['$scope',function(t){t.toggled=function(i,r){var f,e,u,o,s;r&&(n.AnnounceText(t.boxText),t.bottomTip&&(f=angular.element(i.target),f.attr('name')==="lbbtext"||f.attr('name')==="lbbicon"?(u=f.parent().parent(),e=t.$root.currentCultureInfo?u.siblings(".lightBulbBubbleBox-rtl"):u.siblings(".lightBulbBubbleBox")):(u=f.parent(),e=t.$root.currentCultureInfo?u.siblings(".lightBulbBubbleBox-rtl"):u.siblings(".lightBulbBubbleBox")),o=u.offset().top-$("#O365_NavHeader").height()-e.height()+$("#ShellBodyAndFooterContainer").scrollTop(),s=o.toString()+"px",e.css("top",s)))}}];return{restrict:'E',templateUrl:'/Admin/Views/SetupWizard/_LightBulbBubbleTemplate.html',scope:{text:"@",boxText:"@",bottomTip:"="},controller:t}}n.app.directive("lightBulbBubble",["AccessibilityService",t])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){function i(n){var t=0,i=0;return n.forEach(function(n){n.MessagesByClassification&&(n.MessagesByClassification.Incidents&&(t+=n.MessagesByClassification.Incidents.length),n.MessagesByClassification.Advisories&&(i+=n.MessagesByClassification.Advisories.length))}),{incident:t,advisory:i}}this.ServiceHealthDataService=t,n.isLoading=!0,n.hasError=!1,t.GetActiveServicesStatus().then(function(t){var r,u;n.isLoading=!1,t||(n.hasError=!0),n.summaryText=t.data.StatusText,r=i(t.data.ServiceStatus),r.incident>0&&(u=r.incident>1?'incidents':'incident',n.incidentText=r.incident+" "+u),r.advisory>0&&(u=r.advisory>1?'advisories':'advisory',n.advisoryText=r.advisory+" "+u)},function(){n.isLoading=!1,n.hasError=!0})}return n.$inject=["$scope","ServiceHealthDataService"],n}(),i=function(){function n(){this.restrict="E",this.replace=!0,this.templateUrl="servicehealthwidget.html",this.scope={},this.controller=t}return n.factory=function(){return function(){return new n}},n}();n.app.directive("servicehealthwidget",i.factory())})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t,i;(function(n){n[n.Unknown=0]="Unknown",n[n.Healthy=1]="Healthy",n[n.Advisory=2]="Advisory",n[n.Incident=3]="Incident"})(t||(t={})),i=function(){function n(){this.restrict="E",this.replace=!0,this.template='<div class="{{iconClass.color}}" ng-class="{\'status-icon\':iconClass.icon!==\'Warning\',\'warning-status-icon\':iconClass.icon===\'Warning\'}"><i class="ms-Icon-Basel ms-Icon-Basel--{{iconClass.icon}}" aria-hidden="true"></i></div>',this.scope={count:'='},this.link=function(n){function r(n){var t={color:"",icon:""};switch(n){case 1:t.color="success-green",t.icon="CheckMark bold";break;case 2:t.color="primary-blue",t.icon="Info2";break;case 3:t.color="error-red",t.icon="Warning"}return t}function u(n,t){var i=0;return i=n&&n>0?3:t&&t>0?2:1}n.$watch("count",function(t,i){(t!==undefined||t!==i)&&(n.status=u(n.count.incident,n.count.advisory),n.iconClass=r(n.status))})}}return n.factory=function(){return function(){return new n}},n}(),n.app.directive("shdStatusIcon",i.factory())})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t){this.constants=t,this.restrict="E",this.replace=!0,this.template='<div class="summary"><span id="incident" ng-show="incident.show" ng-class="{\'link\':filter===0}">{{incident.count}} {{incident.unit}}</span><span class="pipe" ng-if="showPipe"> | </span><span id="advisory" ng-show="advisory.show" ng-class="{\'link\':filter===0}">{{advisory.count}} {{advisory.unit}}</span><span ng-if="showAllGood" class="all-good">Service is healthy</span></div>',this.scope={count:"=",filter:"="},this.link=function(t,i){function o(){t.incident=s(t.count.incident,1),t.advisory=s(t.count.advisory,0),t.showPipe=t.count.incident>0&&t.count.advisory>0&&t.filter===0,t.showAllGood=!t.count.incident&&!t.count.advisory&&t.filter===0,t.filter===0?(f.attr("tabindex","0"),u.attr("tabindex","0")):(f.removeAttr("tabindex"),u.removeAttr("tabindex"))}function s(n,i){var r={count:n,unit:"",show:!1};switch(i){case 1:r.show=n===0?t.filter===1:t.filter!==2,r.unit=n>1?'incidents':'incident';break;case 0:r.show=n===0?t.filter===2:t.filter!==1,r.unit=n>1?'advisories':'advisory';break;default:throw"ServiceHealth status summary - unexpected incident classification";}return r}function e(n){var i=n;return function(){if(t.filter===0){var n={filter:i};t.$root.$broadcast(h,n),t.$apply()}}}var h=n.ServiceHealthConstants.EVENTS.FILTER_CHANGED,f=i.find("#incident"),u;f.on("click",e(1));f.bind("keydown keypress",function(n){var t=n.which||n.keyCode;t===13&&(e(1)(),n.preventDefault())}),u=i.find("#advisory");u.on("click",e(2));u.bind("keydown keypress",function(n){var t=n.which||n.keyCode;t===13&&(e(2)(),n.preventDefault())}),t.$watch("filter",function(n,t){(n!==undefined||n!==t)&&o()}),t.$watch("count",function(n,t){(n!==undefined||n!==t)&&o()})}}return t.factory=function(){var n=function(n){return new t(n)};return n.$inject=["ServiceHealthConstants"],n},t}();n.app.directive("shdStatusSummary",t.factory())})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n){n.serviceTabExpanded=!1,n.classificationCount={incident:n.messages.Incidents.length||0,advisory:n.messages.Advisories.length||0}}return n.$inject=["$scope"],n}(),i=function(){function n(n){var i=this;this.LogService=n,this.restrict="E",this.replace=!0,this.templateUrl="SHDServiceMessages.html",this.scope={serviceName:'=',messages:"=",filter:"="},this.controller=t,this.link=function(n,t){function f(){n.filter!==0&&(n.serviceTabExpanded=!n.serviceTabExpanded,n.$digest())}function e(n){t.find("#"+n+" .show-more .link").focus()}n.onFlyoutClosed=e,n.$watch("filter",function(t,r){if((t!==undefined||t!==r)&&typeof t=="number"){n.serviceTabExpanded=!1;switch(t){case 0:n.displayedMessages=[];break;case 1:n.displayedMessages=n.messages.Incidents;break;case 2:n.displayedMessages=n.messages.Advisories;default:i.LogService.LogError(421504,'Unknown MessageFilter: '+t)}}});var u=t.find(".service-tab");u.on("click",function(){f()});u.bind("keydown keypress",function(n){var t=n.which||n.keyCode;t===13&&(f(),n.preventDefault())})}}return n.factory=function(){var t=function(t){return new n(t)};return t.$inject=["LogService"],t},n}();n.app.directive("shdServiceMessages",i.factory())})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){function i(){n.feedbackData={omsTenantId:n.tenantId,email:n.email,eventWorkload:n.eventWorkload,eventId:n.eventId,eventStatus:n.eventStatus,starRating:null,incorrectFields:{title:!1,impactedUserCount:!1,userImpact:!1,startTime:!1,classification:!1},contactMe:!1}}function f(t,i){n.feedbackSubmitted||(n.feedbackData.starRating=t+1,u(t)),i&&l()}function e(){n.showFeedbackForm||n.feedbackSubmitted||r()}function o(){Feedback.SubmitToPortal("/feedback/PostFeedback","Office365","feedback","ServiceHealthDashboard","EventContentFeedback",n.currentPage,n.feedbackData.starRating,null,n.feedbackData.contactMe?n.feedbackData.email:"",null,y(n.feedbackData),Shared.GetSessionCookie('AjaxSessionKey'),function(){},c,h)}function s(){n.feedbackSubmitted||(i(),r(),n.showErrorMessage=!1),a()}function h(){n.showErrorMessage=!0,n.$digest(),t.LogError(423359,'Submit feedback failed. '+p())}function c(){n.feedbackSubmitted=!0,n.showThankYouMessage=!0,n.$digest()}function r(){u(-1),n.starTooltip=""}function u(t){n.feedbackStars.forEach(function(i,r){i.on=r<=t,t===r&&(n.starTooltip=i.tooltip)})}function l(){n.showFeedbackForm=!0}function a(){n.showFeedbackForm=!1,n.setFocusToStar&&n.setFocusToStar()}function v(){for(var i=5,r=['Terrible','Poor','Fair','Good','Great'],t=[],n=0;n<i;n++)t.push({on:!1,tooltip:r[n]});return t}function y(n){var t={},i;t.omsTenantId=n.omsTenantId,t.eventWorkload=n.eventWorkload,t.eventId=n.eventId,t.eventStatus=n.eventStatus;for(i in n.incorrectFields)t["err_"+i]=n.incorrectFields[i];return t}function p(){var i={},t;for(t in n.feedbackData)t!=="email"&&(i[t]=n.feedbackData[t]);return JSON.stringify(i)}n.advisoryId=0,n.incidentId=1,n.emailRegex=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,n.feedbackSubmitted=!1,n.showErrorMessage=!1,n.showThankYouMessage=!1,n.feedbackStars=v(),n.showFeedbackForm=!1,n.feedbackInit=i,n.onStarClicked=f,n.onStarMouseLeaved=e,n.onFeedbackFormCancel=s,n.onFeedbackFormSubmit=o,i()}return n.$inject=["$scope","LogService"],n}(),i=function(){function n(n){this.LogService=n,this.restrict="E",this.replace=!0,this.templateUrl="SHDPostFeedback.html",this.scope={tenantId:'@',email:"@",eventWorkload:"@",eventId:"@",eventStatus:"@",eventClassification:"=",eventAffectedusercount:"=",currentPage:"@"},this.controller=t,this.link=function(n,t){function r(){t.find(".ms-Icon.ms-Icon--star").first().focus()}n.setFocusToStar=r}}return n.factory=function(){var t=function(t){return new n(t)};return t.$inject=["LogService"],t},n}();n.app.directive("shdPostFeedback",i.factory())})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(t,i,r,u,f,e){var h=800,s=['$scope','$timeout','$rootScope','$window','HelperService',function(t,i,u,f,e){function h(){i(function(){var t=n.pagePreviousElements.panel;t&&angular.element(t.element).focus(),$(":focus").length==0&&u.$broadcast('focusOnMainPageElements')},400)}function s(){r.SetUnselectUnhighlightOnclose(undefined,undefined),u.$broadcast('panelclosed'),r.ResetSelectedItemCount(),$('#panel').remove(),document.getElementById("ShellBodyAndFooterContainer").style.overflow="auto"}function o(n){i(function(){var t=$('#panel').outerHeight(),n;$('#bottomCover').outerHeight(0),$.each($("#panel > div"),function(n,i){t-=$(i).outerHeight(!0)}),$('#bottomCover').outerHeight(t-15),n=document.getElementById("panel"),n&&(n.style.overflowY="auto")},n)}function c(){function u(n,t,i){return i>=n.top&&i<=n.bottom&&t>=n.left&&t<=n.right}function f(){var n=$('<div />'),t,i,r;return $('body').append(n),n.width(50).height(50).css({overflow:'scroll',visibility:'hidden',position:'absolute'}),t=$('<div />').height(1),n.append(t),i=t.width(),r=n.width(),n.remove(),r-i}function e(t){var h=t.pageX,c=t.pageY,r=$(t.target),o=null,s=null,f=null,e=null,l=!1,a=!1;return typeof r.hasScroll!="undefined"&&r.hasScroll!=null&&(o=r.hasScroll(),s=r.hasScroll("x")),o!=null&&o&&(e=new i,e.top=r.offset().top,e.right=r.offset().left+r.width(),e.bottom=e.top+r.height(),e.left=e.right-n,a=u(e,h,c)),s!=null&&s&&(f=new i,f.bottom=r.offset().top+r.height(),f.left=r.offset().left,f.top=f.bottom-n,f.right=f.left+r.width(),l=u(f,h,c)),l||a}var i=function(){this.top=0,this.left=0,this.bottom=0,this.right=0},n;$.fn.hasScroll=function(n){var i=this.css("overflow"),t,r,u,f;return t=typeof n=="undefined"||n=="y"?this.css("overflow-y"):this.css("overflow-x"),r=this.get(0).scrollHeight>this.innerHeight(),u=i=="auto"||i=="visible"||t=="auto"||t=="visible",f=i=="scroll"||t=="scroll",r&&u||f},n=f(),$(document).mousedown(function(n){$(n.target).parents(".listViewRowInfo").length>0||$(n.target).parents(".panel").length>0||$(n.target).parents(".flyoutCover").length>0||n.target.nodeName.toUpperCase()==="HTML"||e(n)||$(n.target).hasClass("flyoutCover")||$(n.target).hasClass("panelflyout")||$(n.target).parents(".o365cs-notifications-notificationPopupArea").length>0||$(n.target).parents(".pnl-no-dimiss").length>0?$(n.target).parents(".pnl-no-dimiss").length>0||$(n.target).hasClass("pnl-no-dimiss")?$(n.target).hasClass("panelflyout")||$(n.target).parents(".panelflyout").length>0||$(n.target).parents(".o365cs-notifications-notificationPopupArea").length>=0||t.panelClose(n,!0):$(n.target).parents(".o365cs-notifications-notificationPopupArea").length>0||($(n.target).parents(".flyoutCover").length<=0&&$(n.target)[0].id!=="ShellBodyAndFooterContainer"?t.panelClose(n,!0):$(n.target).hasClass("pnl-dismiss")&&t.panelClose(n,!0)):r.GetSelectedItemCount()>0&&t.panelClose(n,!0)})}t.selectedItem=undefined,t.formData={},t.contentLoaded=!1,t.$root.refreshList=!1,t.currentCultureInfo=t.$root.currentCultureInfo,t.panelClose=function(n,i){angular.isDefined(n)&&$(n.target).hasClass("pnl-dismiss")?s():angular.isDefined(n)&&($(n.target).parents(".flyoutCover").length>0||$(n.target).is('#flyoutCover')||$(n.target).parents("#O365_NavHeader").length>0)?document.getElementById("ShellBodyAndFooterContainer").style.overflow="auto":((angular.isDefined(r.GetUnhighlightOnclose())&&r.GetUnhighlightOnclose()||i)&&(angular.isDefined(n)&&($(n.target).attr("id")==="actionButton"||$(n.target).parent().attr("id")==="actionButton")||$(".gridRow").css("background-color","transparent")),(t.selectedItem&&t.selectedItem.length===0&&angular.isDefined(r.GetUnSelectOnclose())&&r.GetUnSelectOnclose()||i)&&(angular.isDefined(n)&&($(n.target).attr("id")==="actionButton"||$(n.target).parent().attr("id")==="actionButton")||u.$broadcast('resetSelection')),s()),h()},t.$on('closePanel',function(n){t.panelClose(n,!0)}),angular.element(f).bind('resize',function(){o(500)}),t.$on(r.GetPanelReadyEventName(),function(n,i){var u=document.getElementById("panel"),f;u&&(u.style.overflowY="hidden"),t.contentLoaded=!0,f=e.IsValid(i)&&!isNaN(i)?i:500,o(i),document.getElementById("ShellBodyAndFooterContainer").style.overflow=angular.isDefined(r.GetPanelType())&&r.GetPanelType()==='multiuser'?"auto":"hidden"}),t.$on('$includeContentLoaded',function(){t.contentLoaded=!0,t.timeoutpromise=i(function(){t.$apply()}),o(1e3),document.getElementById("ShellBodyAndFooterContainer").style.overflow=angular.isDefined(r.GetPanelType())&&r.GetPanelType()==='multiuser'?"auto":"hidden"}),t.$on('PickerItemUpdated',function(){o(500)}),t.$on('closeFlyout',function(){document.getElementById("ShellBodyAndFooterContainer").style.overflow=angular.isDefined(r.GetPanelType())&&r.GetPanelType()==='multiuser'?"auto":angular.isDefined(r.GetPanelType())?"hidden":"auto",o(0)}),t.$on("$destroy",function(){i.cancel(t.timeoutpromise)}),t.$on('$includeContentLoaded',function(){t.$applyAsync(function(){t.contentLoaded=!0})}),c()}];return{restrict:'A',scope:{panelOnInit:"&"},controller:s,link:function(n,f,o){function l(t,i){t&&(i?r.SetSelectedItem(o.selecteditem):r.SetSelectedItem(n.$eval(o.selecteditem))),n.selectedItem=r.GetSelectedItem();var f=o.panelType,e=undefined;f=="user"?(e=n.selectedItem.ObjectId,n.formData.DisplayName=n.selectedItem.DisplayName,n.formData.InitialsColor=n.selectedItem.InitialsColor,n.formData.Initials=n.selectedItem.Initials,n.formData.UserPrincipalName=n.selectedItem.UserPrincipalName,n.formData.PhotoContent=n.selectedItem.PhotoContent,n.formData.JobTitle=n.selectedItem.JobTitle,n.formData.Department=n.selectedItem.Department):f=="group"?(e=n.selectedItem.GroupId,n.formData.GroupName=n.selectedItem.GroupName,n.formData.InitialsColor=n.selectedItem.InitialsColor,n.formData.GroupType=n.selectedItem.GroupType,n.formData.GroupTypeDisplayName=n.selectedItem.GroupTypeDisplayName,n.formData.GroupSmtp=n.selectedItem.GroupSmtp,n.formData.PhotoContent=n.selectedItem.PhotoContent):f=="sharedmailbox"?(e=n.selectedItem.SharedMailboxId,n.formData.SharedMailboxDisplayName=n.selectedItem.SharedMailboxDisplayName,n.formData.InitialsColor=n.selectedItem.InitialsColor,n.formData.Initials=n.selectedItem.Initials,n.formData.SharedMailboxSmtp=n.selectedItem.SharedMailboxSmtp,n.formData.PhotoContent=n.selectedItem.PhotoContent):f=="contact"?(e=n.selectedItem.ContactId,n.formData.ContactDisplayName=n.selectedItem.ContactDisplayName,n.formData.InitialsColor=n.selectedItem.InitialsColor,n.formData.Initials=n.selectedItem.Initials,n.formData.ContactExternalEmailAddress=n.selectedItem.ContactExternalEmailAddress,n.formData.PhotoContent=n.selectedItem.PhotoContent):f=="resourcemailbox"?(e=n.selectedItem.ResourceMailboxObjectId,n.formData.ResourceMailboxDisplayName=n.selectedItem.ResourceMailboxDisplayName,n.formData.ResourceMailboxPrimarySmtpAddress=n.selectedItem.ResourceMailboxPrimarySmtpAddress,n.formData.ResourceMailboxRecipientTypeDetails=n.selectedItem.ResourceMailboxRecipientTypeDetails,n.formData.InitialsColor=n.selectedItem.InitialsColor,n.formData.Initials=n.selectedItem.Initials,n.formData.PhotoContent=n.selectedItem.PhotoContent):f=="partner"?(e=n.selectedItem.Identity,n.formData.PartnerName=n.selectedItem.DisplayName):f=="site"?(e=n.selectedItem.ObjectId,n.formData.DisplayName=n.selectedItem.DisplayName,n.formData.UserPrincipalName=n.selectedItem.Url,n.formData.InitialsColor=n.selectedItem.InitialsColor,n.formData.Initials=n.selectedItem.Initials):f=="dirsyncerror"?(n.formData.DisplayName=n.selectedItem.PropertyNameLocalized,n.formData.UserPrincipalName=n.selectedItem.PropertyValue,n.formData.InitialsColor=n.selectedItem.InitialsColor,n.formData.Initials="DE"):f=="bulkactionuser"?(n.formData.DisplayName=n.selectedItem.DisplayName,n.formData.InitialsColor=n.selectedItem.InitialsColor,n.formData.Initials=n.selectedItem.Initials,n.formData.UserPrincipalName=n.selectedItem.UserPrincipalName):f=="bulkactiongroup"?(n.formData.GroupName=n.selectedItem.GroupName,n.formData.InitialsColor=n.selectedItem.InitialsColor,n.formData.GroupTypeDisplayName=n.selectedItem.GroupTypeDisplayName,n.formData.GroupSmtp=n.selectedItem.GroupSmtp):f=="bulkactionresourcemailbox"?(n.formData.ResourceMailboxDisplayName=n.selectedItem.ResourceMailboxDisplayName,n.formData.ResourceMailboxPrimarySmtpAddress=n.selectedItem.ResourceMailboxPrimarySmtpAddress,n.formData.ResourceMailboxRecipientTypeDetails=n.selectedItem.ResourceMailboxRecipientTypeDetails,n.formData.InitialsColor=n.selectedItem.InitialsColor,n.formData.Initials=n.selectedItem.Initials):f=="bulkactionsharedmailbox"?(n.formData.SharedMailboxDisplayName=n.selectedItem.SharedMailboxDisplayName,n.formData.InitialsColor=n.selectedItem.InitialsColor,n.formData.Initials=n.selectedItem.Initials,n.formData.SharedMailboxSmtp=n.selectedItem.SharedMailboxSmtp,n.formData.PhotoContent=n.selectedItem.PhotoContent):f=="bulkactioncontact"?(n.formData.ContactDisplayName=n.selectedItem.ContactDisplayName,n.formData.InitialsColor=n.selectedItem.InitialsColor,n.formData.Initials=n.selectedItem.Initials,n.formData.ContactExternalEmailAddress=n.selectedItem.ContactExternalEmailAddress):f==="setupProducts"&&(n.formData.ProductSkuId=n.selectedItem.ProductSkuId,n.formData.ProductDisplayName=n.selectedItem.ProductDisplayName,n.formData.TotalUnits=n.selectedItem.TotalUnits,n.formData.AvailableUnits=n.selectedItem.AvailableUnits,n.formData.HasUnlimitedSeats=n.selectedItem.HasUnlimitedSeats,n.formData.Tiles=n.selectedItem.Tiles,n.formData.Status=n.selectedItem.Status),u.$broadcast('highlightselectedrow',e)}function a(n){i(function(){var n=$('#panel').outerHeight();$('#bottomCover').outerHeight(0),$.each($("#panel > div"),function(t,i){n-=$(i).outerHeight(!0)}),$('#bottomCover').outerHeight(n-15)},n)}function v(){var t=n.currentCultureInfo?'.flyoutClose-rtl':'.flyoutClose',i=n.$watch(function(){return angular.element(t).length>0},function(r){r>0&&n.$root.focusOnPanel&&(angular.element(t).focus(),i(),n.$root.focusOnPanel=!1)})}function h(u){var g,b,c;u!=null&&(o=u);var et=o.panelTemplateUrl,rt=o.panelTitle,w=o.panelHeaderTitle,st=o.panelHeaderIcon,f=o.panelType,gt=o.waitingIndicatorMessage,dt="/AdminPortal/Home/FlyoutFooter",a=o.customClass,y=o.showCloseButton,l=o.panelCustomClass;n.unselectonclose=o.unselectonclose,(angular.isUndefined(a)||a=="")&&(a=''),(angular.isUndefined(l)||l=="")&&(l=''),(angular.isUndefined(y)||y=="")&&(y=!0),n.multiPersonCardEntry='panel',n.headerTitle=w;var e="",s="<div ng-include=\"'{profileCardTemplate}'\"></div>",p="/AdminPortal/Users/PersonCard",ut="/AdminPortal/Groups/GroupCard",it="/AdminPortal/SharedMailbox/SharedMailboxCard",ft="/AdminPortal/Contact/ContactCard",nt="/AdminPortal/ResourceMailbox/ResourceMailboxCard",lt="/AdminPortal/EmailMigration/ImapCard",kt="/AdminPortal/EmailMigration/ExchangeMigrationCard",ni="/AdminPortal/Users/EditUserPicker",wt="/AdminPortal/Users/MultiUserPersonCard",pt="/AdminPortal/MessageCenter/MultiMessageCard",yt="/AdminPortal/Groups/MultiGroupPersonCard",vt="/AdminPortal/SharedResource/MultiSharedMailboxPersonCard",at="/AdminPortal/ResourceMailbox/MultiResourceMailboxPersonCard",bt="/AdminPortal/Contact/MultiContactPersonCard",ct='Refresh',h="<button data-hint='PanelRefresh' data-value='"+f+"' ng-class=\"{'flyoutClose-rtl f-color-white':currentCultureInfo,  'flyoutClose f-color-white':!currentCultureInfo}\" class='ms-Icon-Basel ms-Icon-Basel--refreshLegacy f-mrgn-right-60px' ng-click='panelRefresh()' aria-label='"+ct+"'></button> ";f=="user"?e=s.replace("{profileCardTemplate}",p):f=="group"?e=s.replace("{profileCardTemplate}",ut):f=="sharedmailbox"?e=s.replace("{profileCardTemplate}",it):f=="contact"?e=s.replace("{profileCardTemplate}",ft):f=="resourcemailbox"?e=s.replace("{profileCardTemplate}",nt):f=="domain"?(c="1000px",e="<domain-card size= \"lg\" domain=\"selectedItem\"> </domain-card>"):f=="messageCenter"?(g="../AdminPortal/messagecenter/messagecentertitlecard",e=s.replace("{profileCardTemplate}",g)):f=="imapConfig"?(e=s.replace("{profileCardTemplate}",lt),h=""):f=="ExchangeMigrationConfig"?(e=s.replace("{profileCardTemplate}",kt),h=""):f=="partner"?(b="/AdminPortal/Partners/PartnerCard",e=s.replace("{profileCardTemplate}",b)):f=="site"?e=s.replace("{profileCardTemplate}",p):f=="dirsyncerror"?(e=s.replace("{profileCardTemplate}",p),h=""):f=="multiuser"?(c="300px",e=s.replace("{profileCardTemplate}",wt),h=""):f=="multimessage"?(c="300px",e=s.replace("{profileCardTemplate}",pt),h=""):f=="multigroup"?(c="300px",e=s.replace("{profileCardTemplate}",yt),h=""):f=="multicontact"?(c="300px",e=s.replace("{profileCardTemplate}",bt),h=""):f=="multisharedmailbox"?(c="300px",e=s.replace("{profileCardTemplate}",vt),h=""):f=="multiresourcemailbox"?(c="300px",e=s.replace("{profileCardTemplate}",at),h=""):f=="bulkactionuser"?e=s.replace("{profileCardTemplate}",p):f=="bulkactiongroup"?e=s.replace("{profileCardTemplate}",ut):f=="bulkactionresourcemailbox"?(e=s.replace("{profileCardTemplate}",nt),h=""):f=="bulkactionsharedmailbox"?e=s.replace("{profileCardTemplate}",it):f=="bulkactioncontact"?e=s.replace("{profileCardTemplate}",ft):(e="<div class=\"flyout-head-title flyout-head_trim flyOutHeader\"  title=\""+w+"\"><i class=\""+st+"\ mc-pdrt-10px\" aria-hidden=\"true\"></i>"+w+"</div>",h="");var ht='Please wait',k='Close',v="<div id ='panel' role='form' ng-class=\"{'panelflyout-rtl panel "+l+" pnl-no-dimiss':currentCultureInfo,  'panelflyout panel "+l+" pnl-no-dimiss':!currentCultureInfo}\"> \
                                            <div ng-class=\"{'flyout-header-rtl "+a+"':currentCultureInfo,  'flyout-header "+a+"':!currentCultureInfo}\">\
                                                {RefreshCard} \
                                                <button data-hint='PanelClose' data-value='"+f+"' ng-class=\"{'flyoutClose-rtl f-color-white':currentCultureInfo,  'flyoutClose f-color-white':!currentCultureInfo}\" class='ms-Icon-Basel ms-Icon-Basel--CancelLegacy f-mrgn-right-20px' ng-click='panelClose(e, true)' aria-label='"+k+"'></button> \
                                                 {profileCard} \
                                             <div ng-if='"+rt+"' class='flyout-ng-Title' id='PanelTitle'> \
                                                 <label class='flyOutLabel' style='font-weight:normal' id = 'PanelTitleLabel'>"+rt+"</label > \
                                             </div > </div>\
                                             <div id='panelContent' ng-include=\"'"+et+"'\" ng-class=\"{'panelContent-rtl':currentCultureInfo,  'panelContent':!currentCultureInfo}\"></div> \
                                            <div ng-if='!contentLoaded' class='contentLoaded'><img src='/images/spinner_24x24_metro.gif' />\
                                            <span class='waitingMessage'>"+ht+"</span> \
                                            </div> \
                                             <div ng-if=\""+y+"\" > \
                                              <button ng-if='contentLoaded' ng-class=\"{'panelbtn-rtl':currentCultureInfo,  'panelbtn':!currentCultureInfo}\" class='font-medium f-prm-btn' id='btnPanelClose' ng-click='panelClose(e, true)' data-hint='"+f+"Summary' data-value='Close'>"+k+"</button> \
                                            </div><div id='bottomCover' class='f-mrgn-top-60px'></div></div>";v=v.replace("{profileCard}",e),v=v.replace("{RefreshCard}",h);var ot=t(v)(n),d=document.getElementById("ShellBodyAndFooterContainer"),ti=$("#ShellBodyAndFooterContainer").scrollTop(),tt=$("#ShellBodyAndFooterContainer").scrollLeft();d.appendChild(ot[0]),d.style.overflow="hidden",n.$watch(function(){return $("#ShellBodyAndFooterContainer").scrollTop()},function(n){$("#panel").css({top:n})}),n.$root.currentCultureInfo?$("#panel").css({left:0-tt}):$("#panel").css({right:0-tt}),c&&$("#panel").css({width:c}),r.SetPanelType(f),i(function(){n.$apply()})}function c(n){var t='';t=n=="user"?'User details panel opened':n=="group"?'Group details panel opened':n=="sharedmailbox"?'Shared mailbox details panel opened':n=="contact"?'Contact details panel opened':n=="resourcemailbox"?'Resource mailbox details panel opened':n=="domain"?'Domain details panel opened':n=="messageCenter"?'Message center details panel opened':n=="imapConfig"?'Details Panel Opened':n=="ExchangeMigrationConfig"?'Details Panel Opened':n=="partner"?'Partner details panel opened':n=="site"?'Site details panel opened':n=="dirsyncerror"?'Details Panel Opened':n=="multiuser"?'Multi user details panel opened':n=="multimessage"?'Multi message details panel opened':n=="multigroup"?'Multi group details panel opened':n=="multicontact"?'Multi contact details panel opened':n=="multisharedmailbox"?'Multi shared mailbox details panel opened':n=="multiresourcemailbox"?'Multi resource mailbox details panel opened':n=="bulkactionuser"?'Bulk user action details panel opened':n=="bulkactiongroup"?'Bulk group action details panel opened':n=="bulkactionresourcemailbox"?'Bulk resource mailbox action details panel opened':n=="bulkactioncontact"?'Bulk contact action details panel opened':n=="bulkactionsharedmailbox"?'Shared mailbox details panel opened':undefined,t&&e.AnnounceText(t)}function s(t,i){var e=!0,u,f;angular.isDefined(t)&&t!=null?(u=t.panelType,angular.isDefined(r.GetPanelType())&&!r.IsPanelTypeSame(u)&&(n.panelType=u,n.panelClose(event,!1)),r.SetUnselectUnhighlightOnclose(t.unselectonclose,t.unhighlightonclose)):angular.isDefined(o.panelType)&&angular.isDefined(r.GetPanelType())&&!r.IsPanelTypeSame(o.panelType)&&n.panelClose(event,!0),r.GetSelectedItemCount()===0?(h(t),t&&angular.isDefined(t.isInvokedFromGlobalSearch)||r.IncrementSelectedItemCount()):(f=500,n.$parent.Picker&&n.$parent.Picker.isFromPanelPicker&&(e=!1,$('#panel').remove(),h(t),f=3500),r.IncrementSelectedItemCount(),a(f)),v(),l(e,i)}n.invoke=function(n){s(n,!0)},$('#panel a, button, :input, [tabindex]').bind('keydown keypress',function(t){if(t.keyCode===n.$root.KeyCodes.TabKey&&$("#panel").length){var i=$('#panel').find('a, button, :input, [tabindex]').filter(":visible"),r=i.index(t.target);r!=i.length-1||t.shiftKey?r==0&&t.shiftKey&&(angular.element(i[i.length-1]).focus(),t.preventDefault()):(angular.element(i[0]).focus(),t.preventDefault())}}),n.panelRefresh=function(){var t,i;n.selectedItem=r.GetSelectedItem(),t=o.panelType,t=="user"||t=="bulkactionuser"?u.$broadcast('UpdateUserPanelDetails',n.selectedItem):t=="group"||t=="bulkactiongroup"?u.$broadcast('UpdateGroupPanelDetails',n.selectedItem):t=="sharedmailbox"||t=="bulkactionsharedmailbox"?u.$broadcast('UpdateMailboxPanelDetails',n.selectedItem):t=="resourcemailbox"?u.$broadcast('UpdateResourceMailboxPanelDetails',n.selectedItem):t=="site"?u.$broadcast('UpdateSitePanelDetails',n.selectedItem):t=="contact"||t=="bulkactioncontact"?u.$broadcast('UpdateSitePanelDetails',n.selectedItem):(n.selectedItem=r.GetSelectedItem(),i=undefined,r.DecrementSelectedItemCount(),i=n.selectedItem.ObjectId,n.panelClose(event,!0),s(o,!1))};f.on("click",function(){c(o.panelType),$(this).attr('panel-on-init')||(n.$root.focusOnPanel=!0,s(null,!1))});f.bind("keydown keypress",function(t){t.which!==n.$root.EnterKeyCode||$(this).attr('panel-on-init')||(c(o.panelType),n.$root.focusOnPanel=!0,s(null,!1))}),n.panelOnInit({interface:{invoke:n.invoke}})}}}n.app.directive("o365PanelDirective",['$compile','$timeout','PanelService','$rootScope','$window',"AccessibilityService","HelperService",t])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(t,i,r,u){var s=800,o=['$scope','$rootScope','$timeout','PanelService',function(t,i,u){function e(){u(function(){var n=t.currentCultureInfo?'.flyoutClose-rtl':'.flyoutClose';angular.element(n).focus()},400)}function o(){var n=document.getElementById("panel");n&&($('.g-ctn-top').addClass('f-mrgn-left-0px'),u(function(){$('.g-ctn-top').removeClass('f-mrgn-left-0px')}))}function s(){var t=n.pagePreviousElements.panel;t?(angular.element(t.element).focus(),$(":focus").length===0&&i.$broadcast('focusOnMainPageElements')):i.$broadcast('focusOnMainPageElements')}t.showIndicator=!1,t.contentLoaded=!1,t.$root.refreshList=!1,t.formData={},t.childPerformCloseAction=!1,t.currentCultureInfo=t.$root.currentCultureInfo,t.flyoutClose=function(){if(s(),o(),t.childPerformCloseAction){t.childPerformCloseAction=!1,t.$broadcast('O365Flyout:close');return}t.$root.refreshList==!0&&t.$root.RefreshList!=null&&t.$root.RefreshList(),t.formData.refreshListArgs&&i.$broadcast('RefreshList',t.formData.refreshListArgs),$('#flyoutCover').remove(),t.entry!="panel"&&(document.getElementById("ShellBodyAndFooterContainer").style.overflow="auto",$(".gridRow").css("background-color","transparent"),i.$broadcast('resetSelection')),angular.element(r).unbind("resize.flyoutCover"),t.flyoutOnClose&&t.flyoutOnClose()},t.$on('closeFlyout',function(){t.flyoutClose()}),t.$on('showWaitingIndicator',function(n,i){t.$applyAsync(function(){t.showIndicator=i})}),t.$on('$includeContentLoaded',function(){document.getElementById("ShellBodyAndFooterContainer").style.overflow="hidden",t.$applyAsync(function(){t.contentLoaded=!0,e()})})}];return{restrict:'A',scope:{selecteditem:'=?',data:'=?',objectid:'=?',entry:'@',flyoutOnInit:"&",flyoutOnClose:"&"},controller:o,link:function(n,i,f){function e(t,i){!n.IsValid(n.formData.PhotoContent)&&n.$root.features&&n.$root.features.ShowPersonPhoto&&u.GetPhoto(t,i).then(function(t){t&&(t.UserType==0&&t.Identity==n.formData.UserPrincipalName||t.UserType==1&&t.Identity==n.formData.GroupSmtp||t.UserType==3&&t.Identity==n.formData.SharedMailboxSmtp||t.UserType==2&&t.Identity==n.formData.ResourceMailboxPrimarySmtpAddress||t.UserType==4&&t.Identity==n.formData.ContactExternalEmailAddress)&&n.IsValid(t.PhotoContent)&&(n.formData.PhotoContent=t.PhotoContent)})}function o(i,u){var b,o,l,c;i!=null&&(f=i,u||n.selecteditem||!i.selecteditem||(n.selecteditem=i.selecteditem),i.data&&(n.data=i.data),i.objectid&&(n.objectid=i.objectid)),u&&(n.selecteditem=u),b=f.flyoutTemplateUrl,o=f.flyoutType,n.headerTitle=f.flyoutHeaderTitle;var k=f.flyoutHeaderIcon,d=f.flyoutHeaderIconUrl,g=f.flyoutHeaderImage;n.headerTitle=='Office Client Policy Settings'&&(o="officepolicysettings"),n.selecteditem!=null&&(o=="group"&&(n.objectid=n.selecteditem.GroupId),o=="user"&&(n.objectid=n.selecteditem.ObjectId),o=="officepolicysettings"&&(n.objectid=n.selecteditem.Id)),l='',k?l='<i class="'+k+' f-color-white" ng-class="::$root.currentCultureInfo ? \'f-pad-left-8px\' : \'f-pad-right-8px\'" aria-hidden="true"></i>':d?l='<img class="addin-icon" ng-class="::$root.currentCultureInfo ? \'addin-icon-rtl\' : \'addin-icon-ltr\'" aria-hidden="true" src="'+d+'" alt="" />':g&&(l='<img class="f-fo-img" ng-src="'+g+'">');var s="",h="<div ng-class=\"{'flyout-header-rtl':currentCultureInfo,  'flyout-header':!currentCultureInfo}\"><div ng-include=\"'{profileCardTemplate}'\"></div></div>",v='<div ng-if="contentLoaded" ng-class="{\'flyout-header-rtl\':currentCultureInfo, \'flyout-header\':!currentCultureInfo}"><div class="flyout-head-title flyout-head_trim pc-header">'+l+'{{headerTitle}}  </div></div>',p="/AdminPortal/Users/PersonCard",nt="/AdminPortal/Groups/GroupCard",pt="/AdminPortal/SharedMailbox/SharedMailboxCard",yt="/AdminPortal/ResourceMailbox/ResourceMailboxCard",vt="/AdminPortal/Contact/ContactCard",at="/AdminPortal/Users/MultiUserPersonCard",bt="/AdminPortal/EmailMigration/ImapCard",lt="/AdminPortal/EmailMigration/ExchangeMigrationCard",ct="/AdminPortal/EmailMigration/ExchangeHybridDownloadCard",ht="/AdminPortal/Partners/PartnerCard",st="/AdminPortal/Settings/ManifestPreviewCard",wt="/AdminPortal/MessageCenter/MultiMessageActionCard",ot="/AdminPortal/Users/InviteUserCard";n.formData={},n.formData.HideChangePhotoLink=!0,o=="user"?(n.formData.DisplayName=n.selecteditem.DisplayName,n.formData.InitialsColor=n.selecteditem.InitialsColor,n.formData.Initials=n.selecteditem.Initials,n.formData.UserPrincipalName=n.selecteditem.UserPrincipalName,s=h.replace("{profileCardTemplate}",p),n.formData.PhotoContent=n.selecteditem.PhotoContent,n.formData.PhotoUserType=0,n.formData.JobTitle=n.selecteditem.JobTitle,n.formData.Department=n.selecteditem.Department,e(n.formData.UserPrincipalName,n.formData.PhotoUserType)):o=="group"?(n.formData.GroupName=n.selecteditem.GroupName,n.formData.InitialsColor=n.selecteditem.InitialsColor,n.formData.GroupTypeDisplayName=n.selecteditem.GroupTypeDisplayName,s=h.replace("{profileCardTemplate}",nt),n.formData.GroupSmtp=n.selecteditem.GroupSmtp,n.formData.PhotoContent=n.selecteditem.PhotoContent,n.formData.PhotoUserType=1,e(n.formData.GroupSmtp,n.formData.PhotoUserType)):o=="sharedmailbox"?(n.formData.SharedMailboxDisplayName=n.selecteditem.SharedMailboxDisplayName,n.formData.InitialsColor=n.selecteditem.InitialsColor,n.formData.SharedMailboxSmtp=n.selecteditem.SharedMailboxSmtp,s=h.replace("{profileCardTemplate}",pt),n.formData.PhotoContent=n.selecteditem.PhotoContent,n.formData.PhotoUserType=3,e(n.formData.SharedMailboxSmtp,n.formData.PhotoUserType)):o=="contact"?(n.formData.ContactDisplayName=n.selecteditem.ContactDisplayName,n.formData.InitialsColor=n.selecteditem.InitialsColor,n.formData.ContactExternalEmailAddress=n.selecteditem.ContactExternalEmailAddress,s=h.replace("{profileCardTemplate}",vt),n.formData.PhotoContent=n.selecteditem.PhotoContent,n.formData.PhotoUserType=4,e(n.formData.ContactExternalEmailAddress,n.formData.PhotoUserType)):o=="resourcemailbox"?(n.formData.ResourceMailboxDisplayName=n.selecteditem.ResourceMailboxDisplayName,n.formData.ResourceMailboxPrimarySmtpAddress=n.selecteditem.ResourceMailboxPrimarySmtpAddress,n.formData.ResourceMailboxRecipientTypeDetails=n.selecteditem.ResourceMailboxRecipientTypeDetails,n.formData.InitialsColor=n.selecteditem.InitialsColor,s=h.replace("{profileCardTemplate}",yt),n.formData.PhotoContent=n.selecteditem.PhotoContent,n.formData.PhotoUserType=2,e(n.formData.ResourceMailboxPrimarySmtpAddress,n.formData.PhotoUserType)):o=="officepolicysettings"?(s=v,c="540px"):o=="domain"?(c="1000px",s="<div ng-class=\"{'flyout-header-rtl':currentCultureInfo,  'flyout-header':!currentCultureInfo}\"><domain-card size= \"lg\" domain=\"selecteditem\"> </domain-card></div>",n.source=f.source):o==="domainDnsHealth"?(c="1200px",s="<div ng-class=\"{'flyout-header-rtl':currentCultureInfo,  'flyout-header':!currentCultureInfo}\"><domain-card size= \"lg\" domain=\"selecteditem\"> </domain-card></div>"):o=="domainwizard"?(c="70%",s=""):o=="multiuser"?s=h.replace("{profileCardTemplate}",at):o=="multimessage"?s=h.replace("{profileCardTemplate}",wt):o=="imapConfig"?s=h.replace("{profileCardTemplate}",bt):o=="ExchangeMigrationConfig"?s=h.replace("{profileCardTemplate}",lt):o=="exchangehybridconfig"?s=h.replace("{profileCardTemplate}",ct):o=="partner"?(n.formData.PartnerName=n.selecteditem.DisplayName,s=h.replace("{profileCardTemplate}",ht)):o=="site"?(n.formData.DisplayName=n.selecteditem.DisplayName,n.formData.InitialsColor=n.selecteditem.InitialsColor,n.formData.Initials=n.selecteditem.Initials,n.formData.UserPrincipalName=n.selecteditem.Url,s=h.replace("{profileCardTemplate}",p)):o==='manifestPreview'?s=h.replace('{profileCardTemplate}',st):o==="findus"?(c='1200px',s=v):o=="inviteuser"?(n.formData.Title='Invite a user',s=h.replace("{profileCardTemplate}",ot)):o=="Intune_Edit_Policy"?c="1000px":s=v,n.formData.title=f.flyoutTitle;var et=f.waitingIndicatorMessage,ft="/AdminPortal/Home/FlyoutFooter",ut='Please wait',rt='Close',a="<div id ='flyoutCover' class='flyoutCover'>\
                                        <div id ='flyout' role='form' class='' ng-class=\"{'flyout-rtl ms-u-slideRightIn40':currentCultureInfo,  'flyout ms-u-slideLeftIn40':!currentCultureInfo}\"> \
                                        <button data-hint='FlyoutClose' id='flyoutClose' setfocus data-value='"+o+"' ng-class=\"{'flyoutClose-rtl  f-color-white':currentCultureInfo,  'flyoutClose  f-color-white':!currentCultureInfo}\" class='ms-Icon-Basel ms-Icon-Basel--CancelLegacy f-mrgn-right-20px' ng-click='flyoutClose()' aria-label='"+rt+"'></button> \
                                             {profileCard}\
                                             <div class='flyout-ng-Title' id='FlyoutTitle' ng-if='formData.title'> \
                                                 <label class='flyOutLabel font-large flyout-title' id = 'FlyoutTitleLabel' ng-bind='formData.title'></label > \
                                             </div > \
                                             <div ng-include=\"'"+b+"'\" ng-class=\"{'flyoutContent-rtl':currentCultureInfo,  'flyoutContent':!currentCultureInfo}\"></div> \
                                             <div ng-if='showIndicator==true' class='waitingIndicator'><img src='/images/spinner_24x24_metro.gif' /> \
                                                <span class='waitingMessage'>"+et+"</span> \
                                            </div> \
                                            <div ng-if='!contentLoaded' class='contentLoaded'><img src='/images/spinner_24x24_metro.gif' />\
                                            <span class='waitingMessage' announcement>"+ut+"</span> \
                                            </div> \
                                        </div>\
                                       <div ng-include=\"'"+ft+"'\" class='flyoutfooter f-mrgn-top-60px'></div> \
                                    </div > ",it=angular.element('#flyoutCover');angular.forEach(it,function(n){return angular.element(n).remove()}),a=a.replace("{profileCard}",s);var tt=t(a)(n),y=document.getElementById("ShellBodyAndFooterContainer"),kt=$("#ShellBodyAndFooterContainer").scrollTop(),w=$("#ShellBodyAndFooterContainer").scrollLeft();y.appendChild(tt[0]),y.style.overflow="hidden",n.$watch(function(){return $("#ShellBodyAndFooterContainer").scrollTop()},function(n){$("#flyoutCover").css({top:n})}),n.$root.currentCultureInfo?$("#flyout").css({left:0-w}):$("#flyout").css({right:0-w}),c&&$("#flyout").css({width:c}),angular.element(r).bind("resize.flyoutCover",function(){document.getElementById('ShellBodyAndFooterContainer').style.overflow==="auto"&&(document.getElementById('ShellBodyAndFooterContainer').style.overflow="hidden")}),n.$applyAsync()}n.invoke=function(n,t){o(n,t)},$('#flyout a, button, :input, [tabindex]').bind('keydown keypress',function(t){if(t.keyCode===n.$root.KeyCodes.TabKey&&$("#flyout").length){var i=$('#flyout').find('a, button, :input, [tabindex]').filter(":visible"),r=i.index(t.target);r!=i.length-1||t.shiftKey?r==0&&t.shiftKey&&(angular.element(i[i.length-1]).focus(),t.preventDefault()):(angular.element(i[0]).focus(),t.preventDefault())}}),n.IsValid=function(n){return!angular.isDefined(n)||n==null||n==""?!1:!0};i.on('click.o365FlyoutDirective',function(){$(this).attr('flyout-on-init')||o(null,null)});i.bind("keydown keypress",function(t){t.which!==n.$root.EnterKeyCode||$(this).attr('flyout-on-init')||o(null,null)}),n.flyoutOnInit({interface:{invoke:n.invoke}})},IDirectivePrePost:null}}n.app.directive("o365FlyoutDirective",['$compile','$timeout','$window',"PhotoService","PanelService",t])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(n,t){var r=800,u=['$scope','$rootScope','$timeout',function(n,i,u){function f(){u(function(){var u=angular.element("#flyout"),r;u.css({overflow:'hidden'}),$(".f-actn-btns").first().css({'margin-top':'0'});var f=angular.element("#flyout > div"),n=t.innerHeight-($(".navPageTitleContainer ").height()+$(".o365cs-nav-header16").height()),i=0;$.each($(f),function(n,t){i+=$(t).outerHeight(!0)}),i>=n?(r=$(".flyout-header").outerHeight(!0)+$(".f-actn-btns").outerHeight(!0),i-=r,n-=r,i>=400&&n>=400?$(".flyout-picker-pg").first().css({height:'400px'}):$(".flyout-picker-pg").first().css({height:n})):$(".flyout-picker-pg").first().removeAttr("style"),document.getElementById('ShellBodyAndFooterContainer').style.overflow==="auto"&&(document.getElementById('ShellBodyAndFooterContainer').style.overflow="hidden")},r)}n.$on('updateActionButtonPosition',function(){n.setSaveCancelButtonsPosition()}),n.setSaveCancelButtonsPosition=function(){f()},angular.element(t).bind("resize",function(){n.setSaveCancelButtonsPosition()})}];return{restrict:"A",controller:u,link:function(n){n.setSaveCancelButtonsPosition()}}}n.app.directive("alwaysShowSaveCancel",["$timeout",'$window',t])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(t,i){var u=['$scope','hotkeys',function(r,u){function f(){if(angular.element("#flyout").length==0)switch(t.keyFocus){case 1:angular.element("#O365_MainLink_NavMenu").focus();break;case 2:angular.element(r.menuitem).focus();break;case 3:e(t.$state.$current.name);break;case 4:c();break;case 5:o();break;case 6:s();break;case 7:h();break;default:t.keyFocus=1,f()}}function c(){angular.element("#gridRowsContainer").length>0?$(angular.element("#gridRowsContainer").find('[controltype=widgettask]')[0]).attr("tabindex",-1).focus():o()}function o(){angular.element("#panel").length>0?(angular.element(".flyout-command-bar").children().find('.g-btn:enabled, .g-dlt-btn:enabled').first().focus(),t.keyFocus=5):s()}function s(){angular.element("#cw-min-state").length>0?(angular.element("#cw-min-state").focus(),t.keyFocus=6):h()}function h(){angular.element("#feedbackHeader").length>0?angular.element("#feedbackHeader").focus():angular.element(r.menuitem).focus(),t.keyFocus=7}function e(t){var i,r;t===n.routes.home?(i=angular.element(document).find('.widgetHeader'),i.length>0&&angular.element(i[0]).focus()):(r=angular.element("#viewportContainer").find("a, button, :input, [tabindex]"),r.length>0&&angular.element(r[0]).focus())}t.keyFocus=0,r.menuitem=n.menuNavigation,r.isShiftKey,r.actualFocus,u.add({combo:'ctrl+f6',description:'Key Board Accessibiltiy',callback:function(){t.keyFocus++,r.actualFocus=t.keyFocus,r.isShiftKey=!1,f()}}),u.add({combo:'shift+ctrl+f6',description:'Key Board Accessibiltiy',callback:function(){t.keyFocus=r.actualFocus,r.actualFocus--,r.isShiftKey=!0,f()}}),r.focusPreviousElements=function(t){var i=n.pagePreviousElements[t],r;i&&(r=i.element.attr('id'),r?angular.element("#"+r).focus():i.element.attr('class')&&angular.element("."+i.element.attr('class')[0]).focus()),$(":focus").length==0&&e(t)},r.focusOnFlyoutChanges=function(t){var i=n.pagePreviousElements[t];i&&i.element.focus(),$(":focus").length==0&&e(t)},r.$on('focusOnMainPageElements',function(){r.focusOnFlyoutChanges(t.$state.$current.name)}),r.$watch(function(){return t.$state.$current.name},function(n,t){n!==t&&i(function(){r.focusPreviousElements(n)},400)})}];return{restrict:"A",controller:u}}t.$inject=["$rootScope","$timeout","hotkeys"],n.app.directive("o365HotKeys",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){function t(n,t,i,r){var u=n.find('[controltype="validclick"]');u.click(function(){r.$invalid&&angular.forEach(r.$error,function(n){angular.forEach(n,function(n){n.$setTouched()})}),t.$apply()})}return{restrict:"A",require:"^form",link:function(n,i,r,u){t(i,n,r,u)}}}t.$inject=["$rootScope"],n.app.directive("validationDirective",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(n,t){return{restrict:'A',link:function(i,r,u){i.$watch(function(){return r.is(":visible")},function(i){var e,o;i&&(e=u.timeout,e=e?e:0,o=u.message,o=o?o:r.text(),n(function(){t.AnnounceText(o)},e))})}}}n.app.directive("announcement",["$timeout","AccessibilityService",t])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function u(n,i,r,u,f){var e=['$scope','$rootScope','ProfileService',function(f,e){function v(){f.showPickerInput=!0,f.expandSelectedItems=!1,f.sortDirection=1,f.sortField="DisplayName",(f.picker.SearchTypes==null||typeof f.picker.SearchTypes===undefined||f.picker.SearchTypes.length===0)&&(f.picker.SearchTypes=[0]),f.picker.allItems=[],f.picker.selectedItems=[],f.picker.pageToken=null,f.picker.currentPageToken=null,f.picker.existingItems?f.picker.UpdateList():h(null),f.picker.originalItems&&(f.originalItemsList=[],angular.forEach(f.picker.originalItems,function(n){n.ObjectId&&f.originalItemsList.push(n.ObjectId)})),f.picker.clientId=f.picker.clientId?f.picker.clientId:"pickerInput",f.picker.placeholderText=f.picker.placeholderText?f.picker.placeholderText:"",f.picker.inputLabel=f.picker.inputLabel?f.picker.inputLabel:"",f.picker.allItemsListTitle=f.picker.allItemsListTitle?f.picker.allItemsListTitle:'All',f.picker.warningMessage=f.picker.warningMessage?f.picker.warningMessage:null;var n='Adding';f.picker.Type===1&&f.picker.action===1&&(n='Removing'),f.picker.selectedItemsListTitle=f.picker.selectedItemsListTitle?f.picker.selectedItemsListTitle:n,f.picker.searchResultsListTitle=f.picker.searchResultsListTitle?f.picker.searchResultsListTitle:'Results',f.picker.showSelectedItems=angular.isUndefined(f.picker.showSelectedItems)?!0:f.picker.showSelectedItems,f.picker.action=angular.isUndefined(f.picker.action)?0:f.picker.action,f.pickerListInstructions='Use up and down arrows to navigate items.',f.picker.Type===0?f.pickerListInstructions='Use up and down arrows to navigate items.Press Enter or Spacebar to select an item.':f.picker.Type===1&&f.picker.action===0?f.pickerListInstructions='Use up and down arrows to navigate items.Press Enter or Spacebar to select or unselect items.':f.picker.Type===1&&f.picker.action===1&&(f.pickerListInstructions='Use up and down arrows to navigate items.Press Enter or Spacebar to remove the item.'),f.$root.isFromPanelPicker=f.picker.isFromPanelPicker}var a='\x7b0\x7d items returned',c=function(n){var t=n.AlreadyMember?n.AlreadyMember:!1;return s(n,f.picker.selectedItems)!==-1&&(t=!0,f.picker.action===1&&(t=!1)),t},l=function(i){var r,u,e;r=new t,r.Enabled=!0;switch(i.Type){case 1:r.DisplayName=i.GroupDisplayName,r.SecondaryInfo=i.GroupSmtp?i.GroupSmtp:"",r.ObjectId=i.GroupId?i.GroupId:i.GroupSmtp,r.ProfileInitials=i.ProfileInitials?i.ProfileInitials:n.GetContactInitials(r.DisplayName),r.EmailAddress=i.GroupSmtp,r.MemberType=i.Type,r.Enabled=o(i.CanBeManagedByAdmin)?i.CanBeManagedByAdmin:!0,e=i.GroupSmtp,u=1;break;case 2:r.DisplayName=i.ContactDisplayName,r.SecondaryInfo=i.ContactExternalEmailAddress,r.ObjectId=i.ContactId,r.ProfileInitials=i.ProfileInitials?i.ProfileInitials:n.GetContactInitials(r.DisplayName),r.EmailAddress=i.ContactExternalEmailAddress,r.MemberType=i.Type,e=i.ContactExternalEmailAddress,u=4;break;case 4:i.AlreadyMember=!0;case 0:r.DisplayName=i.DisplayName,r.SecondaryInfo=i.UserPrincipalName,r.ObjectId=i.ObjectId,r.ProfileInitials=i.ProfileInitials?i.ProfileInitials:n.GetUserInitials(r.DisplayName),r.EmailAddress=i.EmailAddress?i.EmailAddress:i.UserPrincipalName,r.MemberType=i.Type,e=i.UserPrincipalName,u=0;break;case 7:r.DisplayName=i.DisplayName,r.SecondaryInfo=i.UserPrincipalName,r.ObjectId=i.ObjectId,r.ProfileInitials=i.ProfileInitials?i.ProfileInitials:n.GetUserInitials(r.DisplayName),r.MemberType=i.Type;break;default:r.DisplayName=i.DisplayName,r.SecondaryInfo=i.EmailAddress,r.ObjectId=i.ObjectId,r.ProfileInitials=i.ProfileInitials?i.ProfileInitials:n.GetUserInitials(r.DisplayName),r.EmailAddress=i.EmailAddress,r.MemberType=i.MemberType?i.MemberType:0,e=i.EmailAddress,u=0}return f.picker.action===1?(r.IsOriginal=!0,r.AlreadyMember=!0,r.AlreadyMember=c(r)):(f.originalItemsList&&f.originalItemsList.length>0&&-1!==f.originalItemsList.indexOf(r.ObjectId)&&(i.AlreadyMember=!0),r.IsOriginal=i.AlreadyMember?i.AlreadyMember:!1,r.AlreadyMember=i.AlreadyMember,r.AlreadyMember=c(r)),r.ProfileImageColor=i.ProfileImageColor?i.ProfileImageColor:n.GetProfileImageColor(r.DisplayName),r.Item=i,y(e,u,r),r.Normalized=!0,r},o=function(n){return!angular.isDefined(n)||n==null||n==""?!1:!0},y=function(n,t,i){f.$root.features&&f.$root.features.ShowUserPhoto&&o(n)&&u.GetPhoto(n,t).then(function(t){t&&n==t.Identity&&o(t.PhotoContent)&&(i.PhotoContent=t.PhotoContent)})},s=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.ObjectId==t[i].ObjectId||!o(t[i].ObjectId)&&n.EmailAddress===t[i].EmailAddress)return i;return-1},p=function(n){var t=[];return angular.forEach(n,function(n){switch(n){case 0:t.push({SearchCategory:0,Filter:null});break;case 1:t.push({SearchCategory:1,Filter:null});break;case 2:t.push({SearchCategory:2,Filter:null});break;case 7:t.push({SearchCategory:7,Filter:null});break;default:this.LogService.LogError(418960,n+' is not a supported type to search.')}}),t},h=function(n){var t=f.picker;return o(n)&&(t=f.searchResults),t.loadingMembers=!0,t.noResults=!1,!f.picker.SearchCategories&&f.picker.SearchTypes&&(f.picker.SearchCategories=p(f.picker.SearchTypes)),r.PickerSearch(n,f.picker.SearchCategories,t.pageToken).then(function(r){if(n==f.searchValue)return angular.forEach(r.results,function(n){var r=l(n);o(r)&&(r.AlreadyMember&&f.picker.action===1||f.picker.action!=1)&&t.allItems.push(r)}),t.pageToken=r.pageToken,i.AnnounceText(a.replace("{0}",t.allItems.length)),t.loadingMembers=!1,e.$broadcast('PickerItemUpdated'),t.allItems.length===0&&(t.noResults=!0),t.allItems})},w=function(){e.$broadcast('updateActionButtonPosition')};f.LoadMore=function(){var i,n,t;f.$root.features.PickerInfiniteScrollEnabled&&(i=f.searchValue,n=f.picker,o(i)&&(n=f.searchResults),t=n.pageToken,t&&t!==n.currentPageToken&&!n.loadingMembers&&(h(i),n.currentPageToken=t))},f.ClearSearch=function(){f.searchValue=null,f.searchInitiated=!1,f.searchResults={allItems:[],loadingMembers:!1,pageToken:null,currentPageToken:null},f.memberSelected="",$("#"+f.picker.clientId).focus()},f.picker.RefreshList=function(){f.ClearSearch(),f.picker.allItems=[],f.picker.pageToken=null,f.picker.currentPageToken=null,h(null)},f.Search=function(n){if(f.searchValue=n,f.searchResults={allItems:[],loadingMembers:!1,pageToken:null,currentPageToken:null},n.length===0){f.searchInitiated=!1;return}return f.searchInitiated=!0,h(n)},f.picker.GetAllItems=function(){var n=[];return angular.forEach(f.picker.allItems,function(t){n.push(t.Item)}),n},f.picker.GetSelectedItems=function(){var n=[];return angular.forEach(f.picker.selectedItems,function(t){n.push(t.Item)}),n},f.picker.UpdateList=function(){angular.forEach(f.picker.existingItems,function(n){angular.isUndefined(f.picker.MemberType)||(n.Type=f.picker.MemberType);var i=n.Normalized?n:l(n);i.IsOriginal=!0,i.AlreadyMember=!0,f.picker.allItems.push(i)}),e.$broadcast('PickerItemUpdated')},f.ToggleSelectedMembers=function(){f.expandSelectedItems=!f.expandSelectedItems},f.SelectMember=function(n){f.onSelect(n)},f.onSelect=function(n){if(f.picker.Type==0){var u='User selected successfully ';i.AnnounceTextWithTimeout(u,500),f.picker.selectedItem=n,f.showPickerInput=!1,f.ClearSearch()}else if(f.picker.Type==1){if(n.IsOriginal&&f.picker.action===0)return;f.picker.action===1?f.RemoveMember(n):f.AddMember(n)}},f.AddMember=function(n){var t,i,r;f.picker.selectedItems==null&&(f.picker.selectedItems=[]),t=s(n,f.picker.selectedItems),t!=-1?(f.picker.selectedItems.splice(t,1),n.AlreadyMember=!1):(f.picker.selectedItems.unshift(n),n.AlreadyMember=!0),i=s(n,f.picker.allItems),i!=-1&&(f.picker.allItems[i].AlreadyMember=n.AlreadyMember),f.searchResults&&f.searchResults.allItems&&(r=s(n,f.searchResults.allItems),r!=-1&&(f.searchResults.allItems[r].AlreadyMember=n.AlreadyMember))},f.RemoveMember=function(n){var t,i,r;f.picker.selectedItems==null&&(f.picker.selectedItems=[]),t=s(n,f.picker.selectedItems),t!=-1?(f.picker.selectedItems.splice(t,1),n.AlreadyMember=!0,f.searchResults&&f.searchResults.allItems&&f.searchResults.allItems.unshift(n),f.picker.allItems.unshift(n)):(n.AlreadyMember=!1,f.picker.selectedItems.unshift(n),f.searchResults&&f.searchResults.allItems&&(i=s(n,f.searchResults.allItems),i!=-1&&f.searchResults.allItems.splice(i,1)),r=s(n,f.picker.allItems),r!=-1&&f.picker.allItems.splice(r,1))},f.ChangeMember=function(){f.memberSelected=null,f.picker.selectedItem=null,f.showPickerInput=!0},f.$watch("loadingMembers",function(){f.$parent&&angular.isDefined(f.$parent.setSaveCancelButtonsPosition)&&f.$parent.setSaveCancelButtonsPosition()}),v()}];return{restrict:'A',scope:{picker:'='},controller:e,templateUrl:'../AdminPortal/Shared/O365Picker',link:function(n){f(function(){var t=n.currentCultureInfo?'.flyoutClose-rtl':'.flyoutClose';angular.element(t).focus()},400)}}}var t=function(){function n(){}return n}(),i,r;(function(n){n[n.SingleSelect=0]="SingleSelect",n[n.MultiSelect=1]="MultiSelect",n[n.View=2]="View"})(n.PickerSelectType||(n.PickerSelectType={})),i=n.PickerSelectType,function(n){n[n.Add=0]="Add",n[n.Remove=1]="Remove"}(n.PickerMultiSelectAction||(n.PickerMultiSelectAction={})),r=n.PickerMultiSelectAction,n.app.directive("o365Picker",['ProfileService','AccessibilityService','ModernSearchService','PhotoService','$timeout',u])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function r(n,i,r,u,f){var e=['$scope','$rootScope','$http','ProfileService','GroupService',function(i,f){function v(){i.showPickerInput=!0,i.expandRemovedItems=!1,i.expandAddedItem=!1,i.sortDirection=1,i.sortField="DisplayName",i.picker.addedItems=[],i.picker.removedItems=[],i.picker.selectedItems=[],i.picker.existingItems?i.picker.UpdateList():i.picker.existingItems=[],i.picker.clientId=i.picker.clientId?i.picker.clientId:"pickerInput",i.picker.placeholderText=i.picker.placeholderText?i.picker.placeholderText:"",i.picker.inputLabel=i.picker.inputLabel?i.picker.inputLabel:"",i.picker.showRemovedItems=angular.isUndefined(i.picker.showRemovedItems)?!0:i.picker.showRemovedItems,i.picker.showAddedItems=angular.isUndefined(i.picker.showAddedItems)?!0:i.picker.showAddedItems,(i.picker.SearchTypes==null||typeof i.picker.SearchTypes===undefined||i.picker.SearchTypes.length===0)&&(i.picker.SearchTypes=[0]),i.$root.onSelectActionText=i.picker.Type===1?"ShowAction":'Add',i.$root.isFromPanelPicker=i.picker.isFromPanelPicker}var y=function(n){var t=n.AlreadyMember?n.AlreadyMember:!1;return s(n,i.picker.addedItems)!==-1?t=!0:s(n,i.picker.removedItems)!==-1?t=!1:s(n,i.picker.selectedItems)!==-1&&(t=!0),t},c=function(r){var u,f,e;u=new t;switch(r.Type){case 1:u.DisplayName=r.GroupDisplayName,u.SecondaryInfo=r.GroupSmtp?r.GroupSmtp:"",u.ObjectId=r.GroupId?r.GroupId:r.GroupSmtp,u.ProfileInitials=r.ProfileInitials?r.ProfileInitials:n.GetContactInitials(u.DisplayName),u.EmailAddress=r.GroupSmtp,u.MemberType=r.Type,e=r.GroupSmtp,f=1;break;case 2:u.DisplayName=r.ContactDisplayName,u.SecondaryInfo=r.ContactExternalEmailAddress,u.ObjectId=r.ContactId,u.ProfileInitials=r.ProfileInitials?r.ProfileInitials:n.GetContactInitials(u.DisplayName),u.EmailAddress=r.ContactExternalEmailAddress,u.MemberType=r.Type,e=r.ContactExternalEmailAddress,f=4;break;case 4:r.AlreadyMember=!0;case 0:u.DisplayName=r.DisplayName,u.SecondaryInfo=r.UserPrincipalName,u.ObjectId=r.ObjectId,u.ProfileInitials=r.ProfileInitials?r.ProfileInitials:n.GetUserInitials(u.DisplayName),u.EmailAddress=r.EmailAddress?r.EmailAddress:r.UserPrincipalName,u.MemberType=r.Type,u.IsUnlicensed=r.UserStatus?r.UserStatus=="Unlicensed":!1,e=r.UserPrincipalName,f=0;break;case 7:u.DisplayName=r.DisplayName,u.SecondaryInfo=r.UserPrincipalName,u.ObjectId=r.ObjectId,u.ProfileInitials=r.ProfileInitials?r.ProfileInitials:n.GetUserInitials(u.DisplayName),u.MemberType=r.Type;break;default:u.DisplayName=r.DisplayName,u.SecondaryInfo=r.EmailAddress,u.ObjectId=r.ObjectId,u.ProfileInitials=r.ProfileInitials?r.ProfileInitials:n.GetUserInitials(u.DisplayName),u.EmailAddress=r.EmailAddress,u.MemberType=r.MemberType?r.MemberType:0,e=r.EmailAddress,f=0}return i.picker.RemoveItemsOnly?(u.IsOriginal,u.AlreadyMember=!0):(u.IsOriginal=r.AlreadyMember?r.AlreadyMember:!1,u.AlreadyMember=r.AlreadyMember,u.AlreadyMember=y(u)),u.ProfileImageColor=r.ProfileImageColor?r.ProfileImageColor:n.GetProfileImageColor(u.DisplayName),u.Item=r,p(e,f,u),u},h=function(n){return!angular.isDefined(n)||n==null||n==""?!1:!0},p=function(n,t,r){i.$root.features&&i.$root.features.ShowUserPhoto&&h(n)&&u.GetPhoto(n,t).then(function(t){t&&n==t.Identity&&h(t.PhotoContent)&&(r.PhotoContent=t.PhotoContent)})},s=function(n,t){for(var i=0,r=t.length;i<r;i++)if(n.ObjectId&&n.ObjectId===t[i].ObjectId||!h(t[i].ObjectId)&&n.EmailAddress===t[i].EmailAddress)return i;return-1},w=function(n){var t=[];return angular.forEach(n,function(n){switch(n){case 0:t.push({SearchCategory:0,Filter:null});break;case 1:t.push({SearchCategory:1,Filter:null});break;case 2:t.push({SearchCategory:2,Filter:null});break;case 7:t.push({SearchCategory:7,Filter:null});break;default:this.LogService.LogError(418960,n+' is not a supported type to search.')}}),t},l=function(n,t){return r.SearchCategories(n,t).then(function(n){var t=[];return angular.forEach(n,function(n){var r=c(n);h(r)&&t.push(r)}),f.$broadcast('PickerItemUpdated'),t})},a=function(){i.$parent&&angular.isDefined(i.$parent.setSaveCancelButtonsPosition)&&i.$parent.setSaveCancelButtonsPosition()};i.picker.GetAllItems=function(){var n=[];return angular.forEach(i.picker.selectedItems,function(t){n.push(t.Item)}),n},i.picker.GetAddedItems=function(){var n=[];return angular.forEach(i.picker.addedItems,function(t){n.push(t.Item)}),n},i.picker.GetRemovedItems=function(){var n=[];return angular.forEach(i.picker.removedItems,function(t){n.push(t.Item)}),n},i.picker.UpdateList=function(){angular.forEach(i.picker.existingItems,function(n){angular.isUndefined(i.picker.MemberType)||(n.Type=i.picker.MemberType);var r=c(n);r.IsOriginal=!0,r.AlreadyMember=!0,i.picker.selectedItems.push(r)}),f.$broadcast('PickerItemUpdated')},i.ToggleRemovedMembers=function(){i.expandRemovedItems=!i.expandRemovedItems},i.ToggleAddedMembers=function(){i.expandAddedItem=!i.expandAddedItem},i.onSelect=function(n){i.picker.Type==0?(i.picker.selectedItem=n,i.showPickerInput=!1):i.picker.Type==1&&(i.memberSelected=null,n.AlreadyMember?i.RemoveMember(n):i.AddMember(n)),a()},i.SelectMember=function(n){n.AlreadyMember?i.RemoveMember(n):i.AddMember(n)},i.AddMember=function(n){i.picker.selectedItems==null&&(i.picker.selectedItems=[]),n.AlreadyMember=!0;var t=s(n,i.picker.removedItems);t!=-1&&i.picker.removedItems.splice(t,1),s(n,i.picker.addedItems)==-1&&n.IsOriginal==!1&&i.picker.addedItems.push(n),s(n,i.picker.selectedItems)==-1&&i.picker.selectedItems.unshift(n),f.$broadcast('PickerItemAdded')},i.ChangeMember=function(){i.memberSelected=null,i.picker.selectedItem=null,i.showPickerInput=!0},i.RemoveMember=function(n){var t=s(n,i.picker.selectedItems);t!==-1&&i.picker.selectedItems.splice(t,1),t=s(n,i.picker.addedItems),t!==-1?i.picker.addedItems.splice(t,1):(n.AlreadyMember=!1,i.picker.removedItems.push(n)),f.$broadcast('PickerItemRemoved'),a()},i.$watch("loadingMembers",function(){i.$parent&&angular.isDefined(i.$parent.setSaveCancelButtonsPosition)&&i.$parent.setSaveCancelButtonsPosition()}),i.Search=function(n){return i.picker.SearchCategories?l(n,i.picker.SearchCategories):i.picker.SearchTypes?(i.picker.SearchCategories=w(i.picker.SearchTypes),l(n,i.picker.SearchCategories)):void 0},v()}];return{restrict:'A',scope:{picker:'='},controller:e,templateUrl:'../AdminPortal/Users/Picker',link:function(n){f(function(){var t=n.currentCultureInfo?'.flyoutClose-rtl':'.flyoutClose';angular.element(t).focus()},400)}}}var t=function(){function n(){}return n}(),i;n.PickerItem=t,function(n){n[n.SingleSelect=0]="SingleSelect",n[n.MultiSelect=1]="MultiSelect"}(n.PickerType||(n.PickerType={})),i=n.PickerType,n.app.directive("o365PickerDirective",['ProfileService','SitesService','ModernSearchService','PhotoService','$timeout',r])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){var t=['$scope',"HelperService",function(n,t){function i(){n.searchDisabled=!1,n.searchInitiated=!1,n.searchBoxTracker=!1,n.searchTerm.Value=""}n.SearchOnClick=function(){var i=n.searchTerm.Value;(t.IsValid(i)||n.searchInitiated)&&(n.searchInitiated=!0,n.search()(i),n.$emit("autoscrolltotop"))},n.SearchKeydown=function(t){if(t.keyCode===13)n.SearchOnClick();else return!1},n.clearLabel=function(){$("#listSearch").addClass("is-active"),n.searchInitiated=!1},n.searchBoxClose=function(){n.searchBoxTracker=!0,n.searchBoxBlur(),n.SearchOnClick(),n.searchInitiated=!1,$("#searchTerm").focus()},n.searchBoxBlur=function(){n.searchBoxTracker===!0&&(n.searchTerm.Value=""),$("#listSearch").removeClass("is-active"),n.searchBoxTracker=!1},i()}];return{restrict:'EA',scope:{searchTerm:'=',search:'&'},controller:t,templateUrl:'../AdminPortal/Users/Search'}}n.app.directive("o365SearchDirective",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;n.app.directive('onFileChange',function(){return{restrict:'A',scope:{onFileChange:'&'},link:function(n,t){t.change(function(t){n.$apply(function(){n.onFileChange({event:t})})})},IDirectivePrePost:null}})})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(n,t,i,r){var u=['$scope','$parse',"UserManagementService","HelperService",function(n,t){n.functionCallback=function(i){if(n.contextMenu.length-1>=i){var r=n.contextMenu[i].TitleAction;t(r)(n)}}}];return{restrict:'AE',scope:{contextName:'@'},controller:u,link:function(u,f,e){function c(t,i,u){var f=u.replace("{%data-hint%}",t.DataHint),o,d,c,e,a,v,k;return f=f.replace("{%data-value%}",t.DataValue),f=f.replace("{%data-id%}",t.DataValue),t.TitleType==='button'?f=f.replace("{%button-action%}","functionCallback("+i+")"):(o='',o=t.TitleType==='href'?s.replace("{%link-action%}",t.TitleAction):h.replace("{%link-action%}",t.TitleAction),f=f.replace("{%lnk-template%}",o)),d="",t.TitleIcon=='ms-Icon-Basel ms-Icon-Basel--chevronRight'&&n.currentCultureInfo&&(t.TitleIcon='ms-Icon-Basel ms-Icon-Basel--chevronLeft'),c=w.replace("{%icon-class%}",t.TitleIcon),t.TitleIconRigthAlign?(c=b.replace("{%icon-class%}",t.TitleIcon),f=f.replace("{%left-icon-placeholder%}",d),f=f.replace("{%right-icon-placeholder%}",c)):(f=f.replace("{%left-icon-placeholder%}",c),f=f.replace("{%right-icon-placeholder%}",d)),f=f.replace("{%aria-text%}",t.TitleAriaText),f=f.replace("{%menu-title%}",t.TitleText),e=l.replace("{%ACTION_ELEMENT_TEMPLATE%}",f),e=e.replace("{%ngshowVal%}",t.ShowHideCondition),a=y.replace("{%body-para%}",t.BodyText),r.IsValid(t.BodyTextLink)&&(v='',v=t.BodyTextLinkType==='href'?s.replace("{%link-action%}",t.BodyTextLink):h.replace("{%link-action%}",t.BodyTextLink),k=p.replace("{%lnk-template%}",v),k=k.replace("{%body-link-text%}",t.BodyLinkText),a=a.replace("{%body-link-text%}",k)),e=e.replace("{%BODYCONTENT_TEMPLATE%}",a)}function k(){var r="",f,e;angular.forEach(u.contextMenu,function(n,t){n.TitleType==='button'?r=r+c(n,t,a):(n.TitleType==='href'||n.TitleType==='uisref')&&(r=r+c(n,t,v))}),o=o.replace("{%ngshowVal%}",u.showContextualMenu),o=o.replace("{%CONTEXT_CARDS%}",r),f=t(o)(u),e=document.getElementById("contextHelpdivId"),e.appendChild(f[0]),u.$applyAsync()}i.GetContextMenuHelp(u.contextName).then(function(n){u.showContextualMenu=!1,u.contextMenu=n.data.ContextHelpTopics,u.showContextualMenu=u.contextMenu.length>0,k(f,e)},function(){u.contextMenu={}});var o="<div class=\"f11-mrgn-top-32px\">\
                                    <hr class=\"listHeaderSeparator\" ng-show=\"{%ngshowVal%}\" />\
                                    <div class=\"f-pad-top-20px f-pdg-left-20 f-pad-right-20px f-txtalgn-center\" >\
                                        {%CONTEXT_CARDS%}\
                                    </div>\
                                </div>",l="<div class=\"cntx-card\" ng-show=\"{%ngshowVal%}\">\
                                            {%ACTION_ELEMENT_TEMPLATE%}\
                                            <div class=\"f-pad-top-12px f-pad-btm-20px\" >\
                                                {%BODYCONTENT_TEMPLATE%}\
                                            </div>\
                                        </div>",a="  <div>\
                                            <button data-hint=\"{%data-hint%}\"\
                                                    data-value=\"{%data-value%}\"\
                                                    id=\"{%data-id%}\"\
                                                    class=\"font-large-semilight cntx-help-btn\"\
                                                    type = \"button\"\
                                                    ng-click=\"{%button-action%}\"\
                                                    aria-label=\"{%aria-text%}\"\
                                                    aria-hidden=\"false\" >\
                                                {%left-icon-placeholder%} <span style=\"text-align: center\">{%menu-title%}</span> {%right-icon-placeholder%}\
                                            </button>\
                                        </div>",v="<div style=\"min-height: 40px\">\
                                            <a data-hint=\"{%data-hint%}\" data-value=\"{%data-value%}\" id=\"{%data-id%}\"\ class=\"font-large-semilight\" style = \"display: block; padding-top: 8px; white-space:nowrap;\" {%lnk-template%} aria-label=\"{%aria-text%}\" aria-hidden=\"false\" >\
                                                {%left-icon-placeholder%} {%menu-title%} {%right-icon-placeholder%}\
                                            </a>\
                                        </div>",y="<p> {%body-para%} </p>",p="<a {%lnk-template%}>{%body-link-text%}</a>",s="href = \"{%link-action%}\"",h="ui-sref = \"{%link-action%}\"",w="<i class=\"{%icon-class%} {{$root.currentCultureInfo ? 'g-icon-txt-rtl' : 'g-icon-txt'}}\" > </i>",b="<i class=\"{%icon-class%} {{$root.currentCultureInfo ? 'g-icon-txt' : 'g-icon-txt-rtl'}}\" > </i>"}}}n.app.directive("o365ContextualHelpDirective",['$rootScope','$compile','UserManagementService','HelperService',t])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{restrict:'A',scope:{titleText:'@',imgAriaLabel:'@',bodyText:'@'},templateUrl:'../AdminPortal/Shared/EmptyListView'}}n.app.directive("emptyListViewDirective",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{restrict:'A',scope:{photoUpload:'=',onPhotoChanged:'&'},link:function(n,t){t.bind("change",function(t){var r=t.target,i=new FileReader;i.onload=function(t){n.$apply(function(){var i=t.target;n.photoUpload=i.result,n.onPhotoChanged()})},i.readAsDataURL(r.files[0])})}}}n.app.directive("photoUpload",[t])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{restrict:"A",link:function(n,t,i){t.on("click",function(){var u,f,r,t,e,o;return n.clickAction=i.clickAction,n.clickArgs=i.clickArgs,n.clickActionType=i.clickActionType,u={action:n.clickAction,args:''},n.clickArgs!=null&&n.clickArgs!=''&&(u.args=JSON.parse(n.clickArgs)),f=n.$parent.query==null?"":n.$parent.query,r=u.args.ResultType,r||(r=n.clickAction=="openHelp"?'help':'tasks'),t=[r,n.clickAction,u.args.ResultPos,f.length],e=f,r!='user'&&r!='groups'?t.push(f):(t.push(""),e=""),t.push(n.$root.CultureInfo),O365.Log.WriteLog(416799,O365.LogLevel.Trace,O365.LogArea.ModernAdminPortal,O365.LogParameter.Empty,t[0],t[1],t[2],t[3],t[4],t[5]),o={resultType:r,clickAction:n.clickAction,resultPosition:u.args.ResultPos,searchTermLength:f.length,searchTerm:e,language:n.$root.CultureInfo},O365.Instrument.ClientInstrument.getInstance().logClientAction("O365ModernSearch:ResultClicked",o),n.$root.$broadcast(n.clickActionType,u),angular.element("#adminDashboardContainer").trigger('click'),!1})}}}n.app.directive("clickBroadcastDirective",[t])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{restrict:"A",require:['ngModel'],link:function(n,t){t.on("click",function(){var n=t.controller('ngModel'),i=n.$modelValue;i&&i!=''&&(n.$setViewValue(""),n.$setViewValue(i))})}}}n.app.directive("typeaheadOnClickDirective",[t])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){var n=['$scope','HttpService',function(n,t){function i(){t.Get(n.webapiurl,[],!0).then(function(t){var r,i;n.ServiceStatusModel={},n.ServiceStatusModel.Workloads=[],n.ServiceStatusModel.IsAllUp=t.data.IsAllUp,n.ServiceStatusModel.GoodIconClass="ms-Icon-Basel ms-Icon-Basel--CompletedSolid statusCompletedSolid-icn",n.ServiceStatusModel.GoodIconAlt='service is healthy',n.ServiceStatusModel.IsRightToLeft=t.data.IsRightToLeft;for(r in t.data.Workloads)i=t.data.Workloads[r],i.StatusIcon={},i.CurrentDay.StatusLevel===0?(i.StatusIcon.IconClass="ms-Icon-Basel ms-Icon-Basel--StatusErrorFull statusErrorFull-icn",i.StatusIcon.Alt='service is interrupted',n.ServiceStatusModel.Workloads.push(i)):i.CurrentDay.StatusLevel===1&&(i.StatusIcon.IconClass="ms-Icon-Basel ms-Icon-Basel--IncidentTriangle statusIncidentTriangle-icn",i.StatusIcon.Alt='service is degraded',n.ServiceStatusModel.Workloads.push(i))},function(){console.log("Error in getting service status")}),t.Get(n.dirsyncapiurl,[],!0).then(function(t){n.DirSyncManagementModel={},n.DirSyncManagementModel.IsDirSyncEnabled=t.data.IsDirSyncEnabled,n.DirSyncManagementModel.EnableDirSyncManagementNewPortal=t.data.EnableDirSyncManagementNewPortal,n.DirSyncManagementModel.IsSyncNormal=t.data.IsSyncNormal,n.DirSyncManagementModel.IsPasswordSyncNormal=t.data.IsPasswordSyncNormal,t.data.IsSyncNormal&&t.data.IsPasswordSyncNormal?(n.DirSyncManagementModel.IconClass="ms-Icon-Basel ms-Icon-Basel--CompletedSolid statusCompletedSolid db-wdgt-icon",n.DirSyncManagementModel.IconAlt='service is healthy'):(n.DirSyncManagementModel.IconClass="ms-Icon-Basel ms-Icon-Basel--IncidentTriangle statusIncidentTriangle db-wdgt-icon",n.DirSyncManagementModel.IconAlt='service is degraded')},function(){console.log("Error in getting dirsync status")})}i()}],t='servicestatuswidget.html';return{restrict:'E',scope:{webapiurl:'@',dirsyncapiurl:'@'},controller:n,templateUrl:t}}n.app.directive("o365admindashboardservicestatuswidget",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){var i=['$scope','HttpService',function(n,t){function i(){t.Get(n.webapiurl,[],!0).then(function(t){n.BillingModel={},n.BillingModel.Subscriptions=t.data.Subscriptions,n.BillingModel.Title=t.data.Title,n.BillingModel.TotalAmountDue=t.data.TotalAmountDue,n.BillingModel.PastDue=t.data.PastDue,n.BillingModel.SubTitle=t.data.SubTitle,n.BillingModel.HasPastDue=t.data.HasPastDue,n.BillingModel.HasDueDate=t.data.HasDueDate,n.BillingModel.HasAmountDue=t.data.HasAmountDue,n.BillingModel.TrialSubscriptionID=t.data.TrialSubscriptionID,n.BillingModel.HasExpiringCC=t.data.HasExpiringCC,n.BillingModel.ExpiringText=t.data.ExpiringText,n.BillingModel.ExpiringCCSubID=t.data.ExpiringCCSubID,n.BillingModel.DueDate=t.data.DueDate,n.BillingModel.CCExpired=t.data.CCExpired,n.BillingModel.IsPendingDomainVerification=t.data.IsPendingDomainVerification})}i(),n.EditPaymentInstr=function(){UpdateLocalPane('EditPaymentMethod',!0,n.BillingModel.ExpiringCCSubID,'&showsp=1',0,0,n.UpdateCCExpiry)},n.UpdateCCExpiry=function(){n.BillingModel.CCExpired=!1,n.BillingModel.HasExpiringCC=!1,n.$apply()}}],r='billingwidget.html';return{restrict:'E',scope:{webapiurl:'@'},controller:i,templateUrl:r}}t.$inject=["$rootScope","$window"],n.app.directive("o365admindashboardbillingwidget",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(n,t){return{restrict:'A',link:function(n,i,r){r.$observe('disableAnimation',function(n){t.enabled(!n,i)})}}}t.$inject=["$rootScope","$animate"],n.app.directive("disableAnimation",t)})(Admin||(Admin={}));var CFRV3Modern;(function(){'use strict';;function t(n,t){return{restrict:'A',link:function(i,r){var f=t(r.attr('dynamic-ng-controller'))(i);r.removeAttr('dynamic-ng-controller'),r.attr('ng-controller',f),n(r)(i)},IDirectivePrePost:''}}t.$inject=["$compile","$parse"],Admin.app.directive("dynamicNgController",t)})(CFRV3Modern||(CFRV3Modern={}));var CFRV3Modern;(function(){'use strict';;function t(){return{restrict:'E',replace:!0,scope:{options:'='},IDirectivePrePost:'',template:'<div kendo-chart k-options="options" k-rebind="options"></div>'}}Admin.app.directive("chart",t)})(CFRV3Modern||(CFRV3Modern={}));var Admin;(function(n){'use strict';;var t=function(){function n(t,i){var r=this;this.$rootScope=t,this.LogService=i,this.restrict='E',this.template='<span><input type="file" accept="{{::accept}}" class="hide" /><input name="filepath" type="text" class="f-txtfld-file" ng-class="::$root.currentCultureInfo ? \'f-txtfld-file-rtl\' : \'f-txtfld-file-ltr\'" ng-value="filename" readonly ng-disabled="disabled" /><button type="button" class="font-medium pc-browse-btn f-prm-btn" ng-disabled="disabled">Browse</button><div class="f-hght-32px"><img ng-if="loading" src="/images/spinner_24x24_metro.gif" alt="" /><span ng-if="loading" class="waitingMessage">Uploading manifest file...</span></div></span>',this.scope={accept:'@',disabled:'='},this.link=function(t,i){var f=i.children('span').first(),u=f.children('input[type=file]').first(),e=f.children('button').first();u.on('change.FileUploadDirective',function(){return r.MonitorFileInputChanges(t,u)});e.on('click.FileUploadDirective',function(){return n.MonitorButtonClicks(u)});t.$on('$destroy',function(){return n.HandleDestroy(u,e)})}}return n.Instance=function(){var t=function(t,i){return new n(t,i)};return t.$inject=['$rootScope','LogService'],t},n.HandleDestroy=function(n,t){n.off('change.FileUploadDirective'),t.off('click.FileUploadDirective')},n.prototype.MonitorFileInputChanges=function(n,t){this.FileNameChanged(n,t.prop('files'))},n.MonitorButtonClicks=function(n){n.val(''),n.click()},n.prototype.FileNameChanged=function(n,t){var u=this,r,i;n.filename=t[0].name,r=t[0],n.loading=!0,i=new FileReader,i.onload=function(){return u.FileReaderLoad(n,i)},i.readAsDataURL(r)},n.prototype.FileReaderLoad=function(n,t){var i=this;n.$applyAsync(function(){return i.FileReaderLoadAsync(n,t)})},n.prototype.FileReaderLoadAsync=function(n,t){var i=t.error!==null,r='';i?this.LogService.LogError(417778,'File upload error occurred: '+t.error):r=t.result.split(',')[1],n.loading=!1,this.$rootScope.$broadcast('FileUpload',i,r)},n}();n.FileUploadDirective=t,n.app.directive('fileUpload',t.Instance())})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{restrict:'A',require:'ngModel',link:function(n,t,i,r){i.type==='text'&&(t.unbind('input').unbind('keypress'),t.bind('blur',function(){n.$apply(function(){r.$setViewValue(t.val())})}))}}}n.app.directive("modelChangeOnBlurDirective",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(t,i){var r=this;this.$window=t,this.LogService=i,this.restrict='A',this.link=function(t,i){n.elementClasses.forEach(function(n){return t.$watch(function(){return angular.element(n).outerHeight(!0)},function(){return r.Resize(i,n)})})}}return n.Instance=function(){var t=function(t,i){return new n(t,i)};return t.$inject=['$window','LogService'],t},n.prototype.Resize=function(t){var r=this.GetHeight(n.elementClasses[0]);r-=this.GetHeight(n.elementClasses[1]),r-=this.GetHeight(n.elementClasses[2]),r<500&&(r=500),t.css('height',r+'px')},n.prototype.GetHeight=function(n){var t=angular.element(n);return t.length!==1&&this.LogService.LogError(422028,'Element '+n+' exists '+t.length+' times.'),t.outerHeight(!0)},n.elementClasses=['.flyout','.flyout-header','.f-actn-btns'],n}();n.PrivateCatalogFrameHeightDirective=t,n.app.directive('privateCatalogFrameHeight',t.Instance())})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t){this.$rootScope=n,this.LogService=t,this.restrict='E',this.template='<div ng-if="indicator.inProgress" class="waitingMessage-div f-mrgn-top-20px"><img class="f-disp-inline" src="/images/spinner_24x24_metro.gif" alt="" /><span class="font-medium f-msg f-disp-inline" tabindex="tabindex" role="status">{{::waiting}}</span></div><div ng-if="indicator.finished" class="f-mrgn-top-20px"><div ng-if="indicator.warningMessages && indicator.warningMessages.length &gt; 0" class="f-wrn-msg-bdr"><div class="f-wdh-45px"><i class="ms-Icon ms-Icon--alert f-alert"></i></div><div class="f-msg-div"><p class="font-medium f-msg" ng-bind-html="indicator.warningMessages[0]" tabindex="tabindex" role="alert"></p><ul ng-if="indicator.warningMessages.length &gt; 1"><li class="font-medium f-msg" ng-repeat="warningMessage in indicator.warningMessages" ng-if="$index &gt; 0" ng-bind-html="warningMessage" tabindex="tabindex" role="alert"></li></ul></div></div><div ng-if="indicator.additionalWarningMessages && indicator.additionalWarningMessages.length &gt; 0" class="f-wrn-msg-bdr"><div class="f-wdh-45px"><i class="ms-Icon ms-Icon--alert f-alert"></i></div><div class="f-msg-div"><p class="font-medium f-msg" ng-bind-html="indicator.additionalWarningMessages[0]" tabindex="tabindex" role="alert"></p><ul ng-if="indicator.additionalWarningMessages.length &gt; 1"><li class="font-medium f-msg" ng-repeat="additionalWarningmessage in indicator.additionalWarningMessages" ng-if="$index &gt; 0" ng-bind-html="additionalWarningmessage" tabindex="tabindex" role="alert"></li></ul></div></div><div ng-if="indicator.errorMessages && indicator.errorMessages.length &gt; 0" class="f-err-msg-bdr"><div class="f-wdh-45px"><i class="ms-Icon ms-Icon--xCircle f-xcrcl"></i></div><div class="f-msg-div"><p class="font-medium f-msg" ng-bind-html="indicator.errorMessages[0]" tabindex="tabindex" role="alert"></p><ul ng-if="indicator.errorMessages.length &gt; 1"><li class="font-medium f-msg" ng-repeat="errorMessage in indicator.errorMessages" ng-if="$index &gt; 0" ng-bind-html="errorMessage" tabindex="tabindex" role="alert"></li></ul></div></div><div class="f-cnfm-msg" ng-if="(!indicator.errorMessages || indicator.errorMessages.length === 0) && (!indicator.warningMessages || indicator.warningMessages.length === 0) && (!indicator.additionalWarningMessages || indicator.additionalWarningmessages.length === 0)"><span class="font-medium" tabindex="tabindex" role="status">{{::success}}</span></div></div>',this.scope={indicator:'=',success:'@',tabindex:'=',waiting:'@'},this.link=function(){}}return n.Instance=function(){var t=function(t,i){return new n(t,i)};return t.$inject=['$rootScope','LogService'],t},n}();n.PrivateCatalogStatusDirective=t,n.app.directive('privateCatalogStatus',t.Instance())})(Admin||(Admin={}));var CFRV3Modern;(function(){'use strict';;function t(){return{restrict:'E',replace:!0,scope:{widget:'='},IDirectivePrePost:'',templateUrl:'../Admin/Views/Partials/Reports/ReportDashboardKpiTemplate.html'}}Admin.app.directive("rdKpiWidget",t)})(CFRV3Modern||(CFRV3Modern={}));var CFRV3Modern;(function(){'use strict';;function t(){return{restrict:'E',IDirectivePrePost:'',templateUrl:'/Admin/Views/Partials/Reports/DashboardWidgetTemplate.html'}}Admin.app.directive("dashboardWidget",t)})(CFRV3Modern||(CFRV3Modern={}));var CFRV3Modern;(function(){'use strict';;function t(){return{restrict:'E',IDirectivePrePost:'',templateUrl:'/Admin/Views/Partials/Reports/ReportDetailsTemplate.html'}}Admin.app.directive("reportDetails",t)})(CFRV3Modern||(CFRV3Modern={}));var CFRV3Modern;(function(){'use strict';;function t(){return{restrict:'E',IDirectivePrePost:'',templateUrl:'/Admin/Views/Partials/Reports/ReportDetailsGridTemplate.html'}}Admin.app.directive("reportdetailsgrid",t)})(CFRV3Modern||(CFRV3Modern={}));var CFRV3Modern;(function(){'use strict';;function t(n){return{restrict:'E',IDirectivePrePost:'',scope:{selectedFilter:'=filter',filterList:'=filterlist'},templateUrl:'/Admin/Views/Partials/Reports/ReportFilterSelectorTemplate.html',link:function(t,i){t.filterListVisible=!1,t.ToggleFilterList=function(){t.filterListVisible=!t.filterListVisible},t.UpdateFilter=function(n){t.selectedFilter.filter=n,t.$emit(Admin.ReportEventNames.FilterChangeBroadcastEventNeeded,n),t.filterListVisible=!1},n.bind('mouseup',function(n){i.find(n.target).length>0||(t.filterListVisible=!1,t.$apply())})}}}t.$inject=["$document"],Admin.app.directive("reportfilterselector",t)})(CFRV3Modern||(CFRV3Modern={}));var CFRV3Modern;(function(){'use strict';;function t(n,t){return{restrict:'E',IDirectivePrePost:'',scope:{selectedReport:'=selectedreport',reportList:'=reportlist'},templateUrl:'/Admin/Views/Partials/Reports/ReportSelectorTemplate.html',link:function(i,r){i.reportListVisible=!1,t.GetReportCategoryDetails().then(function(n){n&&n.length>0&&(i.reportList=n)},function(){Admin.ReportsUtils.LogError("Failed to retrieve report category list details from ReportService")});var f=[];i.reportListFilters=function(){return f=[],i.reportList},i.filterWorkload=function(n){if(n.workload!=undefined)var t=f.indexOf(n.workload)==-1;return f&&f.push(n.workload),t},i.ToggleReportList=function(){i.reportListVisible=!i.reportListVisible},i.selectNewReport=function(n){i.selectedReport.report=n,i.ToggleReportList(),i.$emit(Admin.ReportEventNames.ReportIdChanged,n)},n.bind('mouseup',function(n){r.find(n.target).length>0||(i.reportListVisible=!1,i.$apply())})}}}t.$inject=["$document","ReportService","$rootScope","$state"],Admin.app.directive("reportselector",t)})(CFRV3Modern||(CFRV3Modern={}));var Admin;(function(n){'use strict';;function t(){var t=['$scope','$http','$rootScope','MessageCenterService','DateTimeService',function(t,i,r,u,f){function e(){u.GetMessages().then(function(i){var o,u;if(i.data){t.MessageCentersModel={},t.MessageCentersModel.MessageSummaryOrigin=0,t.MessageCentersModel.Messages=[],t.MessageCentersModel.IsRightToLeft=i.data.IsRightToLeft;var s=t.maxitems,h=0,e=0,c="";for(o in i.data.Messages)u=i.data.Messages[o],u.StatusIcon={},u.noIconClass='',u.ActionType.toLowerCase()==='action'?u.StatusIcon.IconClass="ms-Icon-Basel ms-Icon-Basel--IncidentTriangle statusIncidentTriangle db-wdgt-icon":u.noIconClass='db-wdgt-noicon',t.MessageCentersModel.Messages.push(u),u.IsRead&&(e+=1),u.Icon=n.MessageCenterIconsStyle[angular.lowercase(u.WorkLoad)],u.PublishedDate.startsWith("/Date")&&(u.PublishedDate=new Date(parseInt(u.PublishedDate.replace("/Date(","").replace(")/","")))),u.PublishedMomentShort=f.GetLocalizedDateTimeCustomFormat(u.PublishedDate,'MMM D'),u.PublishedMoment=f.GetLocalizedDateTime(u.PublishedDate,2),u.ExpirationDate.startsWith("/Date")&&(u.ExpirationDate=new Date(parseInt(u.ExpirationDate.replace("/Date(","").replace(")/","")))),u.ExpirationMoment=f.GetLocalizedDateTime(u.ExpirationDate,2),u.ActionRequiredByDate!=null&&(u.ActionRequiredByDate.startsWith("/Date")&&(u.ActionRequiredByDate=new Date(parseInt(u.ActionRequiredByDate.replace("/Date(","").replace(")/","")))),u.ActionRequiredByMomentShort=f.GetLocalizedDateTimeCustomFormat(u.ActionRequiredByDate,'MMM D'),u.ActionRequiredByMoment=f.GetLocalizedDateTime(u.ActionRequiredByDate,2));t.MessageCentersModel.UnreadMessageCount=i.data.UnreadMessageCount-e,t.MessageCentersModel.OtherMessages=t.MessageCentersModel.Messages.length,r.MessageCentersModel=t.MessageCentersModel,t.MessageCentersModel.Messages.length>0?(t.noResult=!1,t.serverError=!1,t.noUrgentResult=!1,t.noUnreadMessages=!1,t.resultLoaded=!0):t.MessageCentersModel.Messages.length==0?(t.noUrgentResult=!0,t.noResult=!1,t.serverError=!1,t.noUnreadMessages=!1):(t.noUrgentResult=!1,t.noResult=!0,t.serverError=!1,t.noUnreadMessages=!1),t.MessageCentersModel.UnreadMessageCount==0&&(t.noResult=!1,t.serverError=!1,t.noUrgentResult=!1,t.noUnreadMessages=!0)}else t.noUrgentResult=!1,t.noResult=!1,t.serverError=!0,t.noUnreadMessages=!1,t.resultLoaded=!1;t.LogUnreadActiveMesages()},function(){t.noUrgentResult=!1,t.noResult=!1,t.serverError=!0,t.noUnreadMessages=!1,t.resultLoaded=!1})}t.noResult=!1,t.serverError=!1,t.markUnreadActionStatus=!1,t.noUnreadMessages=!1,t.resultLoaded=!1,t.ToggleHighlight=function(n){$("#"+n).addClass('mc-li-selected'),t.UnhighlightOthers(n),t.selectedAnnouncementId=n},t.MarkAsRead=function(n){var i;angular.isDefined(t.MessageCentersModel)&&t.MessageCentersModel.Messages.forEach(function(t){t.AnnouncementId==n&&(i=t)}),!i||i.IsRead||t.markUnreadActionStatus||u.UpdateMessageReadStatus([i.AnnouncementId],!0).then(function(){i.IsRead=!i.IsRead,t.MessageCentersModel.UnreadMessageCount--,t.MessageCentersModel.UnreadMessageCount==0&&(t.noUnreadMessages=!0),t.LogUnreadActiveMesages()},function(){t.noUrgentResult=!1,t.noResult=!1,t.serverError=!0,t.noUnreadMessages=!1,t.resultLoaded=!1}),t.markUnreadActionStatus=!1},t.MarkAsUnRead=function(n){var i;angular.isDefined(t.MessageCentersModel)&&angular.forEach(t.MessageCentersModel.Messages,function(t){t.AnnouncementId==n&&(i=t)}),i.IsRead&&u.UpdateMessageReadStatus([i.AnnouncementId],!1).then(function(){i.IsRead=!i.IsRead,t.MessageCentersModel.UnreadMessageCount++,t.noUnreadMessages=!1,t.LogUnreadActiveMesages()},function(){t.noUrgentResult=!1,t.noResult=!1,t.serverError=!0,t.noUnreadMessages=!1,t.resultLoaded=!1}),t.markUnreadActionStatus=!0},t.$on('markUnread',function(n,i){t.MarkAsUnRead(i)}),t.$on('markRead',function(n,i){t.MarkAsRead(i)}),t.$on('ToggleHighlight',function(n,i){t.selectedAnnouncementId&&t.MarkAsRead(t.selectedAnnouncementId),t.ToggleHighlight(i)}),t.$on('panelclosed',function(){t.UnhighlightOthers(-1),t.MarkAsRead(t.selectedAnnouncementId)}),t.UnhighlightOthers=function(n){angular.isDefined(t.MessageCentersModel)&&t.MessageCentersModel.Messages.forEach(function(t){t.AnnouncementId!=n&&$("#"+t.AnnouncementId).removeClass('mc-li-selected')})},t.DismissAction=function(n){var r,f=-1,i;if(angular.isDefined(t.MessageCentersModel))for(i in t.MessageCentersModel.Messages)t.MessageCentersModel.Messages[i].AnnouncementId==n&&(f=i,r=t.MessageCentersModel.Messages[i]);f!=-1&&u.UpdateMessageDismissStatus([r.AnnouncementId],!0).then(function(){t.MessageCentersModel.Messages.splice(f,1),t.MessageCentersModel.Messages.length==0&&(t.noUrgentResult=!0,t.noUnreadMessages=!0),t.MessageCentersModel.UnreadMessageCount==0||r.IsRead?t.MessageCentersModel.UnreadMessageCount==0&&(t.noUnreadMessages=!0):t.MessageCentersModel.UnreadMessageCount--,t.$broadcast('DismissActionCompleted'),t.message=undefined,t.$broadcast('closePanel'),t.LogUnreadActiveMesages()},function(){t.noUrgentResult=!1,t.noResult=!1,t.serverError=!0,t.noUnreadMessages=!1,t.resultLoaded=!1})},t.$on('DismissAction',function(n,i){t.DismissAction(i)}),t.LogUnreadActiveMesages=function(){var n,i="";angular.forEach(t.MessageCentersModel.Messages,function(n){n.IsRead||n.IsDismiss||(i+=n.AnnouncementId+"|")}),n={"unread-active-message-ids":i},O365.Instrument.ClientInstrument.getInstance().logClientAction("MessageCenterUnreadActiveMessage",n)},e()}],i='messagecenterwidget.html';return{restrict:'E',scope:{webapiurl:'@',maxitems:'@'},controller:t,templateUrl:i}}n.app.directive("o365admindashboardmessagecenterwidget",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(n){function t(t,i,r){n.GetDomainDns(t.domain.Name,t.domain.DomainType,r).then(function(n){t.domainDns.data=n.data,t.domainDns.DataLoaded=!0,i||u(t)},function(){t.domainDns.ServerError=!0,t.domainDns.DataLoaded=!1})}function r(n){return function(){return n.domain.Name}}function u(n){n.showDnsSection={},n.ShowDns=!1,n.domainDns.data.forEach(function(t){t.IsAddable&&t.DnsRecords&&t.DnsRecords.length>0?(n.showDnsSection[t.ServiceName]=!0,n.ShowDns=!0):n.domain.DomainType=="Partial"&&(n.showDnsSection[t.ServiceName]=!0,n.ShowDns=!0)})}function i(n){n.ShowSuccessMessage={value:!1},n.errorMessage={},n.errorMessage.GeneralError=null,n.domainDns={},n.partialDomain=n.domain.DomainType==='Partial',t(n,!1,!1)}var f=['$scope',"DomainService","$rootScope",function(n,r){function f(t){for(var i in t)n.errorMessage[i]=t[i][0]}n.$on('updatednsrecords',function(i,r){r.action=='save'?(n.ShowSuccessMessage.value=!0,n.IsSaveMessage=!0):r.action=='delete'&&(n.ShowSuccessMessage.value=!0,n.IsSaveMessage=!1),n.domainDns.DataLoaded=!1,t(n,!0,!0)}),n.ToggleDnsDisplay=function(t){n.showDnsSection[t]=!n.showDnsSection[t]},n.RemoveRecord=function(t,i){n.errorMessage={},r.RemoveCustomDnsRecord(t,i).then(function(){var r={domainName:t,action:"delete"};n.$emit('updatednsrecords',r)},function(n){f(n.data.ModelState)})},i(n)}],e='../AdminPortal/DomainList/DomainDnsList';return{restrict:'E',scope:{domain:'='},controller:f,templateUrl:e,link:function(n){n.$watch(r(n),function(t,r){t!=r&&i(n)})}}}n.app.directive("domaindnslist",["DomainService",t])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(n){function f(n){return function(){return n.domain.Name}}function t(t,i){n.GetResellerDomainData(t.domain.Name,t.domain.DomainRegistrar,i).then(function(n){t.resellerData.Data=n.data,t.resellerData.DataLoaded=!0,t.resellerData.ServerError=!1},function(){t.resellerData.ServerError=!0,t.resellerData.DataLoaded=!1})}function i(n){n.DataDetail=!0,t(n,!1)}var r=['$scope',function(r){r.resellerData={},i(r),r.ShowSuccessMessageForEmailSent={value:!1},r.ShowErrorMessageForEmailSent={value:!1},r.ShowSuccessMessageForContactUpdate={value:!1},r.ShowTransfer=!1,r.ShowTransferSection=!1,r.ShowTransferRequestWaitMessage=!1,r.ShowSuccessMessageForRequestSent={value:!1},r.ShowErrorMessageForRequestSent={value:!1},r.ShowSuccessMessageForTransferCode={value:!1},r.ShowSuccessMessageForTransferCancelSubscription={value:!1},r.ShowErrorMessageForTransferCancelSubscription={value:!1},r.ResetMessageBars=function(){r.ShowSuccessMessageForEmailSent.value=!1,r.ShowErrorMessageForEmailSent.value=!1,r.ShowSuccessMessageForContactUpdate.value=!1,r.ShowSuccessMessageForRequestSent.value=!1,r.ShowErrorMessageForRequestSent.value=!1,r.ShowSuccessMessageForTransferCode.value=!1,r.ShowSuccessMessageForTransferCancelSubscription.value=!1,r.ShowErrorMessageForTransferCancelSubscription.value=!1},r.$on('updatecontacts',function(t,i){r.ResetMessageBars(),r.ShowSuccessMessageForContactUpdate.value=!0,r.resellerData.Data.Contacts.forEach(function(t){i.type&t.Type&&n.CopyResellerContactData(t.Contact,i.formData)})}),r.ResendVerificationEmail=function(){r.ResetMessageBars(),n.ResendVerificationEmail(r.domain.Name,r.domain.DomainRegistrar).then(function(){var t='A verification email message was sent to \x7b0\x7d. Check your inbox and junk folder.',i=0;r.SuccessMessageForEmailSent=t.replace("{0}",r.resellerData.Data.Contacts[i].EmailAddress),r.ShowSuccessMessageForEmailSent.value=!0},function(){r.ShowErrorMessageForEmailSent.value=!0})},r.$on('showtransfersection',function(){r.ShowTransferSection=!r.ShowTransferSection,r.ShowTransfer=!r.ShowTransfer}),r.EnableTransferDomain=function(){r.ResetMessageBars(),r.ShowSuccessMessageForRequestSent.value=!0,n.EnableTransferDomain(r.resellerData.Data.DomainName,r.resellerData.Data).then(function(){if(t(r,!0),r.resellerData.DataLoaded){var i='Your authorization code is \x7b0\x7d. Provide this code to the new registrar to transfer in the domain.';r.SuccessMessageForTransferCode=i.replace("{0}",r.resellerData.Data.AuthCode),r.ShowSuccessMessageForTransferCode.value=!0}},function(){r.ShowErrorMessageForRequestSent.value=!0})},r.CompleteTransferDomain=function(){r.ResetMessageBars(),n.CompleteTransferDomain(r.resellerData.Data.DomainName,r.resellerData.Data).then(function(){r.ShowSuccessMessageForTransferCancelSubscription.value=!0,r.$emit('updatedomaindata')},function(){r.ShowErrorMessageForTransferCancelSubscription.value=!0})},r.CompleteTransferDomainDone=function(){r.$emit('closePanel'),r.$destroy()}}],u='../AdminPortal/DomainList/DomainResellerData';return{restrict:'E',scope:{domain:'='},controller:r,templateUrl:u,link:function(n){n.$watch(f(n),function(t,r){t!=r&&i(n)})}}}n.app.directive("domainresellerdata",["DomainService",t])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(n){var t=function(n){return n.querySelector("input").getAttribute("name")},i=function(n){return angular.element(n.querySelector("input"))},r=function(n){return angular.element(n.querySelector(".help-block"))},u=function(n){return function(u,f,e,o){var c=o.$name,l=t(f[0]),a=i(f[0]),v,s,y,k,p,w,h,b,d;f.attr("class","form-group"),v=c+"."+l,f.attr("ng-class","{'has-error': "+v+".$invalid \&\& "+v+".$touched}"),f.removeAttr("domainforminputdirective"),s="",y=e.requiredMessage,y&&(s=s+"<span ng-message=\"required\">"+y+"</span>",k=a.attr("required"),typeof k=="undefined"&&a.attr("required","")),p=e.emailMessage,p&&(s=s+"<span ng-message=\"email\">"+p+"</span>"),w=e.patternMessage,w&&(s=s+"<span ng-message=\"pattern\">"+w+"</span>"),h=e.postValidation,h&&(s=s+"<span ng-message=\"postsubmit\">{{"+h+"}}</span>",a.attr("postvalidation",h)),b=r(f[0]),b&&(d="<div ng-messages=\""+c+"."+l+".$error\" ng-show=\""+c+"."+l+".$touched\">"+s+"</div>",b.append(angular.element(d))),n(f)(u)}};return{restrict:"A",require:"^form",link:u(n)}}function i(){var n=function(n){return function(t){t?n.$setValidity("postsubmit",!1):n.$setValidity("postsubmit",!0)}},t=function(n){return function(){return n.postvalidation}},i=function(n){return function(){n.postvalidation=""}},r=function(n){return function(){return n.$viewValue}},u=function(){return function(u,f,e,o){u.$watch(t(u),n(o)),u.$watch(r(o),i(u))}};return{restrict:"A",require:"ngModel",scope:{postvalidation:"="},link:u()}}n.app.directive("domainforminputdirective",['$compile',t]),n.app.directive("postvalidation",i)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){var n=['$scope','PanelService',function(n,t){n.getImageColor=function(n){var t=["#FFB900","#D83B01","#E81123","#B4009E","#5C2D91","#0078D7","#008272","#107C10"],i,r;return n==null||n===""?"#FF0000":(i=n.split('').map(function(n){return n.charCodeAt(0)}).reduce(function(n,t){return t+n}),r=i%t.length,t[r])},n.size=="lg"&&n.$on(t.GetBroadCastEventName(),function(t,i){n.domain=i})}];return{restrict:'E',templateUrl:'../AdminPortal/DomainList/DomainCard',scope:{domain:'=',size:'@'},controller:n}}n.app.directive("domainCard",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){var n=function(n){return function(t){var u=!1;return t&&t.ExpectedRecord&&t.ExpectedRecord.Type&&t.ExpectedRecord.Type.toLowerCase()===n.toLowerCase()&&(u=!0),u}},t=['$scope','$filter',function(t,i){t.ShowTable=!0,t.RecordList={},t.showhelp===undefined&&(t.showhelp=!0),t.$watch(function(){return t.healthresultlist},function(){t.RecordList={},angular.forEach(t.dnstype,function(r){t.RecordList[r]=i('filter')(t.healthresultlist,n(r))})}),t.IsRecordSetHealthy=function(n){var t=!0;return angular.forEach(n,function(n){t&&n&&n.ReasonUnhealthy!==null&&(t=!1)}),t},t.IsValidTxtCnameRecord=function(n,t){return!n.HostName||!t.HostName||!r(n.HostName,t.HostName)?!1:!n.Value||!t.Value||!r(n.Value,t.Value)?!1:!0},t.IsValidMxRecord=function(n,t){return!n.HostName||!t.HostName||!r(n.HostName,t.HostName)?!1:!n.Value||!t.Value||!r(n.Value,t.Value)?!1:!0},t.IsValidSrvRecord=function(n,t){return!n.Service||!t.Service||!r(n.Service,t.Service)?!1:!n.Protocol||!t.Protocol||!r(n.Protocol,t.Protocol)?!1:!n.Port||!t.Port||!r(n.Port,t.Port)?!1:!n.HostName||!t.HostName||!r(n.HostName,t.HostName)?!1:!n.Value||!t.Value||!r(n.Value,t.Value)?!1:!0},t.IsValidNsRecord=function(n,t){return!n.Value||!t.Value||!r(n.Value,t.Value)?!1:!0};var r=function(n,t){return n.trim().toLowerCase()===t.trim().toLowerCase()};t.Copy=function(n){var r=document.getElementById('table_'+n),t=document.createRange(),i=window.getSelection();i.removeAllRanges();try{t.selectNodeContents(r),i.addRange(t)}catch(u){t.selectNode(r),i.addRange(t)}document.execCommand("Copy"),i.removeAllRanges()},t.ToggleAtucalRecords=function(n,t){var i=$("."+n+"_"+t);i&&i.toggle()}}];return{restrict:'A',templateUrl:'../AdminPortal/DomainList/DomainDnsListTable',scope:{healthresultlist:'=',dnstype:'=',hideactual:'=',registrar:'=',hidewarning:'=',showhelp:'@'},controller:t}}n.app.directive("dnsHealthTableDirective",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){var n=function(n){return function(t){var u=!1;return t&&t.ExpectedRecord&&t.ExpectedRecord.Type&&t.ExpectedRecord.Type.toLowerCase()===n.toLowerCase()&&(u=!0),u}},t=['$scope','$filter',function(t,i){t.ShowTable=!0,t.RecordList={},t.showhelp===undefined&&(t.showhelp=!0),t.$watch(function(){return t.healthresultlist},function(){t.RecordList={},angular.forEach(t.dnstype,function(r){t.RecordList[r]=i('filter')(t.healthresultlist,n(r))})}),t.IsRecordSetHealthy=function(n){var t=!0;return angular.forEach(n,function(n){t&&n&&n.ReasonUnhealthy!==null&&(t=!1)}),t},t.IsValidTxtCnameRecord=function(n,t){return!n.HostName||!t.HostName||!r(n.HostName,t.HostName)?!1:!n.Value||!t.Value||!r(n.Value,t.Value)?!1:!0},t.IsValidMxRecord=function(n,t){return!n.HostName||!t.HostName||!r(n.HostName,t.HostName)?!1:!n.Value||!t.Value||!r(n.Value,t.Value)?!1:!0},t.IsValidSrvRecord=function(n,t){return!n.Service||!t.Service||!r(n.Service,t.Service)?!1:!n.Protocol||!t.Protocol||!r(n.Protocol,t.Protocol)?!1:!n.Port||!t.Port||!r(n.Port,t.Port)?!1:!n.HostName||!t.HostName||!r(n.HostName,t.HostName)?!1:!n.Value||!t.Value||!r(n.Value,t.Value)?!1:!0},t.IsValidNsRecord=function(n,t){return!n.Value||!t.Value||!r(n.Value,t.Value)?!1:!0};var r=function(n,t){return n.trim().toLowerCase()===t.trim().toLowerCase()};t.Copy=function(n){var r=document.getElementById('table_'+n),t=document.createRange(),i=window.getSelection();i.removeAllRanges();try{t.selectNodeContents(r),i.addRange(t)}catch(u){t.selectNode(r),i.addRange(t)}document.execCommand("Copy"),i.removeAllRanges()},t.ToggleAtucalRecords=function(n,t){var i=$("."+n+"_"+t);i&&i.toggle()}}];return{restrict:'A',templateUrl:'../AdminPortal/DomainList/DomainDnsRecordTable',scope:{healthresultlist:'=',dnstype:'=',hideactual:'=',registrar:'=',hidewarning:'=',showhelp:'@'},controller:t}}n.app.directive("dnsRecordTableDirective",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){var n=['$scope',function(n){n.cancelBar=function(){n.condition.value=!1}}];return{restrict:'E',templateUrl:"/Admin/Views/Partials/Domains/SuccessBar.html",scope:{message:'@',condition:'=',barclass:'@',msgclass:'@'},controller:n}}n.app.directive("successBar",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){var n=['$scope',function(n){n.cancelBar=function(){n.condition.value=!1}}];return{restrict:'E',templateUrl:"/Admin/Views/Partials/Domains/FailureBar.html",scope:{message:'@',condition:'=',barclass:'@',msgclass:'@'},controller:n}}n.app.directive("failureBar",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){var n=['$scope',function(n){n.cancelBar=function(){n.condition.value=!1}}];return{restrict:'E',templateUrl:"/Admin/Views/Partials/Domains/ErrorBar.html",scope:{message:'@',condition:'=',barclass:'@',msgclass:'@'},controller:n}}n.app.directive('errorBar',t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){var n=['$scope',function(n){n.myargs=n.params.split(','),n.getMessage=function(t){for(var r=n.formatstring,u,i=0;i<n.myargs.length;i++)u=new RegExp("\\{"+i+"\\}","gi"),r=r.replace(u,t[n.myargs[i]]);return r}}];return{restrict:'E',templateUrl:"../AdminPortal/DomainList/RemoveLineItem",scope:{list:'=',title:'@',formatstring:'@',params:'@'},controller:n}}n.app.directive("removeLineItem",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function u(){return{restrict:'A',link:function(n,i,u){var s=u.copyTooltip,c=u.copyTooltipAfter,e=u.filterClass,l=u.hoverClass,o=u.tooltipOnTarget,h=u.iconStyleClass,f;l?$(i).addClass(l):$(i).addClass("copy-enabled-cell"),e||(e="copyData"),h||(h="text-primary"),r(i,s,o,h),f=o?$(i):$(i).find(".copy-icon");f.on("click",function(){t(i,o,e,c)});f.on("mouseenter",function(){f.data("kendoTooltip").options.content=s,f.data("kendoTooltip").refresh()});i.on('$destroy',function(){f.off("click",function(){t(i,o,e,c)}),f.off("mouseenter",function(){f.data("kendoTooltip").options.content=s,f.data("kendoTooltip").refresh()})})}}}var i="<span class='copy-icon'><i class='ms-Icon-Basel ms-Icon-Basel--CopyLink'></i></span>",r=function(n,t,r,u){$(n).prepend(i),$(n).find(".copy-icon").addClass(u),r?$(n).kendoTooltip({content:t}):$(n).find(".copy-icon").kendoTooltip({content:t})},t=function(n,t,i,r){var u=$(n).find("."+i)[0],f,e,o;if(u||(u=$(document).find("#"+i)[0]),u){f=document.createRange(),e=window.getSelection(),e.removeAllRanges();try{f.selectNodeContents(u),e.addRange(f)}catch(s){f.selectNode(u),e.addRange(f)}document.execCommand("Copy"),e.removeAllRanges(),o=t?$(n):$(n).find(".copy-icon"),o.data("kendoTooltip").options.content=r,o.data("kendoTooltip").refresh()}};n.app.directive("copytext",u)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{restrict:'E',templateUrl:"/Admin/Views/Partials/Domains/TruncatedText.html",scope:{text:'@',maxlength:'@'}}}n.app.directive('truncatedtext',t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(n,t,i){var r=['$scope',function(t){var u={},r="",f;t.suggestionItems=[],t.ShowSuggestionContainer=!1,t.NeedValidation=!0,t.processing=!1;var e=function(n){var r=[];angular.forEach(n,function(n){r.push({Id:n.BPCategoryId,Value:n.CategoryName,Show:!0})}),t.suggestionItems=r,t.ShowSuggestionContainer=r.length>0,t.ShowSuggestionContainer&&($(".suggestion-container").scrollTop(0),$(".suggestion-item").removeClass("selected")),f&&(i.cancel(f),f=null),t.processing=!1},s=function(o){t.NeedValidation=!0;var s;if(s=u[o],s){r===o?t.ShowSuggestionContainer=!0:(r=o,e(s));return}f=i(function(){t.processing=!0},200),n.GetCategoryInfo(o).then(function(n){var t=n.data;r=o,u[o]=t.Data,e(t.Data)})},o=function(n){var t=n.height()*(n.prevAll(".suggestion-item:not(.ng-hide)").length-2);t<0&&(t=0),$(".suggestion-container").scrollTop(t)};t.GetSuggestionFromDict=function(n){if(n===void 0&&(n=!1),t.inputType==="businesscategory"){var i=angular.copy(t.displayValue);if(i||(i=""),!n&&t.minChars&&t.minChars>i.length){t.ShowSuggestionContainer=!1;return}s(i.toLowerCase())}},t.SelectSuggetionItem=function(n){t.displayValue=n.Value,t.ValidInputValue()},t.ValidInputValue=function(){t.NeedValidation&&(t.ShowSuggestionContainer=!1,t.InputValidated=!1,t.displayValue&&t.displayValue.length)&&(u[r]?angular.forEach(u[r],function(n){t.InputValidated||t.displayValue.toLowerCase()===n.CategoryName.toLowerCase()&&(t.displayValue=n.CategoryName,t.selectedValue={Id:n.BPCategoryId,Value:n.CategoryName},t.InputValidated=!0,t.NeedValidation=!1)}):t.InputValidated||n.GetCategoryInfo(t.displayValue).then(function(n){var i=n.data;r=t.displayValue,u[t.displayValue]=i.Data,t.ValidInputValue()}))},t.KeyPressAction=function(n){var r,i,u;n.keyCode===9?t.ValidInputValue():n.keyCode===13?(i=$(".suggestion-item.selected:not(.ng-hide)").first(),i.length&&(t.displayValue=i.text().trim()),t.ValidInputValue()):n.keyCode===27?t.ValidInputValue():n.keyCode===38?(i=$(".suggestion-item.selected:not(.ng-hide)").first(),i.length?(r=i.prevAll(".suggestion-item:not(.ng-hide)").first(),r&&r.length&&(i.removeClass("selected"),r.addClass("selected"),o(r))):$(".suggestion-item").removeClass("selected"),n.preventDefault()):n.keyCode===40&&(i=$(".suggestion-item.selected:not(.ng-hide)").first(),i.length?(u=i.nextAll(".suggestion-item:not(.ng-hide)").first(),u&&u.length&&(i.removeClass("selected"),u.addClass("selected"),o(u))):($(".suggestion-item").removeClass("selected"),$(".suggestion-container").children(":not(.ng-hide)").first().addClass("selected")),n.preventDefault())}}];return{restrict:'E',templateUrl:'/Admin/Views/Partials/FindUs/FindUsSmartInput.html',scope:{selectedValue:'=',inputType:'@',inputName:'@',displayValue:'=',InputValidated:'=validateResult',ValidInputValue:'=validateHandler',validationMessage:"@",postValidationMessage:'=',minChars:"@",placeholderText:'@'},link:function(n,i){var r=function(t){var r=i.find(t.target).length>0;r||n.$apply("ValidInputValue()")};t.on("click",r);i.on('$destroy',function(){t.off("click",r)})},controller:r}}n.app.directive("findUsSmartInput",["FindUsService","$document","$timeout",t])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return{restrict:'E',templateUrl:'/Admin/Views/Partials/FindUs/FindUsProgressBar.html',scope:{currentValue:'=',barSize:'@',foreGround:'@',backGround:'@'},link:function(n,t){n.$watch('currentValue',function(n){var u=t.find('#foreGroundBar'),f=t.find('#backGroundBar'),r,i;u&&f&&(r=$(f).width(),i=r*n/100,i>r?i=r:i<0&&(i=1),$(u).width(i))})}}}n.app.directive("findUsProgressBar",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(n,t,i){var r="/Admin/Views/Partials/DefaultO365InputValidationTemplate.html",u=function(n,t,i,u){n.messageTemplateUrl||(n.messageTemplateUrl=r),t(n.messageTemplateUrl).then(function(t){var r=i(t)(n);u.append(r)})},f=function(n,t){return function(){return t&&n[t]&&n[t].$touched?n[t].$error:undefined}},e=function(n,t){return function(i){var r=!1;n.find(".o365InputValidationMessage").removeClass("f-disp-inblk").addClass("form-hide-validation"),i&&(i.required?(n.find(".validation-required-message").removeClass("form-hide-validation").addClass("font-medium f-disp-inblk"),r=!0):i.pattern&&(n.find(".validation-pattern-message").removeClass("form-hide-validation").addClass("font-medium f-disp-inblk"),r=!0)),!r&&t.validationCustomMessage&&n.find(".validation-custom-message").removeClass("form-hide-validation").addClass("font-medium f-disp-inblk")}},o=function(n,t){return function(r){n.find(".o365InputValidationMessage").removeClass("f-disp-inblk").addClass("form-hide-validation"),t.validationPostMessage=r,i(function(){r&&n.find(".validation-post-message").removeClass("form-hide-validation").addClass("font-medium f-disp-inblk")},0)}},s=function(n,t){return function(r){n.find(".o365InputValidationMessage").removeClass("f-disp-inblk").addClass("form-hide-validation"),t.validationCustomMessage=r,i(function(){r&&n.find(".validation-custom-message").removeClass("form-hide-validation").addClass("font-medium f-disp-inblk")},0)}},h=function(n,t){var i="input";return t.targetElementType&&(i=t.targetElementType),n.querySelector(i).getAttribute("name")},c=function(n,t){return function(i,r,c,l){var a=h(r[0],i);u(i,n,t,r),i.$watch(f(l,a),e(r,i),!0),i.$watch("validationPostMessage",o(r,i),!0),i.$watch("validationCustomMessage",s(r,i),!0)}};return{restrict:'A',scope:{targetElementType:"@",messageTemplateUrl:'@',validationRequiredMessage:"@",validationPatternMessage:"@",validationPostMessage:'=',validationCustomMessage:'=',allowRequiredHtml:'=',allowPatternHtml:'=',allowPostHtml:'=',allowCustomHtml:'='},require:"^form",link:c(n,t)}}n.app.directive("o365forminputdirective",['$templateRequest','$compile','$timeout',t])})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){var n=['$scope',function(n){n.cancelBar=function(){n.message.value=""}}];return{restrict:'E',templateUrl:"../AdminPortal/Shared/InformationBar",scope:{message:'=',barstyle:'&',msgclass:'@'},controller:n}}n.app.directive("informationBar",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){function n(n){var r=new Date(n.error.UtcTimestamp);n.header!=null&&n.header!==""?(n.error.Header=n.header,n.error.ShowHeader=!0):(n.error.Header=null,n.error.ShowHeader=!1),n.error.Message='Error\x3a \x7b0\x7d'.Format(n.error.Message),n.error.TrackingId='Tracking Id\x3a \x7b0\x7d'.Format(n.error.TrackingId),n.error.Timestamp='Timestamp\x3a \x7b0\x7d'.Format(r.toUTCString())}return{scope:{error:'=error',header:'=header'},templateUrl:'../AdminPortal/Intune/ErrorBlock',link:n,IDirectivePrePost:null}}n.app.directive("intuneErrorBlock",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(i,r,u,f,e,o,s,h,c,l,a,v,y,p){function lt(){var n,t;i.ActiveUserListConfig.NoResults?(n='No results found',y.AnnounceText(n)):t=i.$watch(function(){return angular.element("#gridRowsContainer").find(".listViewRow").length},function(n){if(n){var r=angular.element("#gridRowsContainer").find(".listViewRow").first();r.length&&(r.attr('tabindex',-1).focus(),t())}})}function ot(){var n,f,u;i.selectedViewType=undefined,i.ActiveUserListConfig=t.prototype.GetActiveUserListConfig(),i.ActiveUserData=e.GetActiveUserData(),e.GetUserChangePasswordLink().then(function(n){i.createChangePasswordUrl=n.data}),i.ActiveUserData.ListModel=[],i.ActiveUserListConfig.ItemsCountOnInit=0,document.getElementById("ShellBodyAndFooterContainer").style.overflow="hidden",i.IsDeletedUserPage?e.GetDefaultDeletedUserList(i.ActiveUserListConfig.sortDirection,i.ActiveUserListConfig.sortField).success(b).error(w):i.IsGuestUserPage?(i.ActiveUserListConfig.IsGuestUserView=!0,e.GetGuestUsersList().then(b,w)):(angular.isDefined(a.filtername)&&a.filtername!==''&&(i.ActiveUserListConfig.StateParams.FilterName=a.filtername,i.ActiveUserListConfig.StateParams.ObjectId=a.objid),angular.isDefined(i.ActiveUserListConfig.StateParams.ObjectId)&&e.GetUserListForSKU(i.ActiveUserListConfig.sortDirection,i.ActiveUserListConfig.sortField,i.ActiveUserListConfig.LicensedUserFilterViewId,i.ActiveUserListConfig.StateParams.ObjectId,-1,null).then(b,w),angular.isDefined(a.action)&&a.action!==''?(e.GetDefaultUserList(i.ActiveUserListConfig.sortDirection,i.ActiveUserListConfig.sortField).success(b).error(w),n=l.GetDeepLinkAttributes(a.action),n==undefined||n==null||p(function(){i.OpenFlyoutOrPanel(n)},500)):e.GetDefaultUserList(i.ActiveUserListConfig.sortDirection,i.ActiveUserListConfig.sortField).success(b).error(w)),e.GetUserViews().then(ht,w),$('#userViewsDropdown').change(function(){i.filterDropdownChanged=!0,i.RefreshList()}),f=document.getElementById('ShellBodyAndFooterContainer'),angular.element(f).bind('scroll',it),u=r.$on('$stateChangeStart',function(n,t,i,r){if(r.name==='users'||r.name==='deletedusers'){var e=document.getElementById('ShellBodyAndFooterContainer');angular.element(e).unbind('scroll',it)}k&&(k(),k=null),nt&&(nt(),nt=null),d&&(d(),d=null),u&&(u(),u=null)}),$(document).mouseup(function(n){var t=$(".userlistActions"),i=$(".userlistActions li"),r=$(".userlistActions li a"),u=$(".userlistActions li a i"),f=$("#actionButton"),e=$("#actionButton span"),o=$("#actionButton span i");return f.is(n.target)||e.is(n.target)||o.is(n.target)?!1:t.is(n.target)||i.is(n.target)||r.is(n.target)||u.is(n.target)?void 0:($(".userlistActions").hide(),$('#actionButton').attr('aria-expanded','false'),n.stopPropagation(),!1)}),i.multiFactorAuth={},h.GetMultiFactorAuthSettings().then(function(n){i.$emit('showWaitingIndicator',!1),i.multiFactorAuth.manageUrl=n.data.ManageUrl,i.multiFactorAuth.learnUrl=n.data.LearnUrl},function(){i.$emit('showWaitingIndicator',!1),i.multiFactorAuth.showErrors=!0,i.multiFactorAuth.error='Unable to retrieve settings'}),i.CurrentUser||(i.CurrentUser=r.CurrentUserInfo)}var k,ut,g,nt,d;this.$scope=i,this.$rootScope=r,this.$http=u,this.$document=f,this.UserManagementService=e,this.ProfileService=o,this.PanelService=s,this.SettingsService=h,this.PhotoService=c,this.HelperService=l,this.$stateParams=a,this.DateTimeService=v,this.AccessibilityService=y,this.$timeout=p,i.SyndicatedPartnerUrl=r.CurrentUserInfo.SyndicatedPartnerPortalUrl,i.initCallbackFlyout=function(n){i.flyout=n},i.InvokeAddUserFlyout=function(){if(i.SyndicatedPartnerUrl)parent.open(i.SyndicatedPartnerUrl,"_blank");else{var n,t='Adding user';n={flyoutTemplateUrl:"../AdminPortal/Users/add",flyoutType:"user",selecteditem:{},waitingIndicatorMessage:t},i.flyout.invoke(n)}},i.ToggleHighlight=function(n){$(".gridRow").css("background-color","transparent"),$("#user_list_"+n).css("background-color","#DDEBF7"),i.SelectedAllUsers(!1)},k=i.$on('highlightselectedrow',function(n,t){angular.isDefined(t)&&i.ToggleHighlight(t)}),i.GetBackgroundColor=function(n){return o.GetProfileImageColor(n)},i.getRowCss=function(n){if(n.isChecked)return{'background-color':'#DDEBF7'}},i.updateUpnColumnCss=function(){i.ActiveUserListConfig.UpnColumnCss=i.ActiveUserListConfig.IsDirSyncEnabled||i.ActiveUserListConfig.ShowUserStatus?'adjustedUpnColumn':'defaultUpnColumn'},i.updateDisplaynameColumnCss=function(){i.ActiveUserListConfig.DisplayNameColumnCss=i.ActiveUserListConfig.IsDirSyncEnabled||i.ActiveUserListConfig.ShowUserStatus?'adjustedDisplayNameColumn':'defaultDisplayNameColumn'},i.updateCustomizableColumnCss=function(){i.ActiveUserListConfig.IsDirSyncEnabled&&i.ActiveUserListConfig.ShowUserStatus?(i.ActiveUserListConfig.UserStatusColumnCss='adjustedUserStatusColumn',i.ActiveUserListConfig.SyncTypeColumnCss='adjustedSyncTypeColumn'):(i.ActiveUserListConfig.UserStatusColumnCss='defaultCustomizableColumn',i.ActiveUserListConfig.SyncTypeColumnCss='defaultCustomizableColumn')},i.EditRoles=function(n){return window.flyoutRoot=i.$root,O365.AdminBaseControls.startEditRolesFlyout(n),!1},i.EditProfile=function(n){return O365.AdminBaseControls.startEditUserFlyout(n),!1},i.ResetPassword=function(n){return O365.AdminBaseControls.startResetPasswordFlyout(n),!1},i.DeleteUser=function(n){return window.flyoutRoot=i.$root,O365.AdminBaseControls.startDeleteUserFlyout(n),!1},i.DeleteSelectedUsers=function(){return window.flyoutRoot=i.$root,O365.AdminBaseControls.startDeleteUserFlyout(i.ActiveUserData.SelectedUsers),!1},i.ResetPasswordSelectedUsers=function(){return O365.AdminBaseControls.startResetPasswordFlyout(i.ActiveUserData.SelectedUsers),!1},i.ManageOfficeInstalls=function(n){return O365.AdminBaseControls.startOfficeInstallsFlyout(n),!1},i.ClosePanel=function(){r.$broadcast('closePanel')},i.IsSelfUser=function(n){return n===i.$root.CurrentUserInfo.ObjectId},i.OpenChangePasswordPage=function(){window.open(i.createChangePasswordUrl)},i.RefreshList=function(){var n,t,u,r;if(i.ActiveUserListConfig.StateParams.ObjectId=undefined,i.ActiveUserListConfig.StateParams.FilterName=undefined,i.ActiveUserListConfig.showContextualHelp=!1,i.ActiveUserListConfig.ItemsCountOnInit>i.ActiveUserListConfig.ShowContextualHelpItemCount&&(i.ActiveUserListConfig.ItemsCountOnInit=undefined),i.ActiveUserListConfig.DeletedUsersEmptyListViewTitle='Nothing here yet.',i.ActiveUserListConfig.DeletedUsersEmptyListBodyLabel='',i.$emit("autoscrolltotop"),document.getElementById("ShellBodyAndFooterContainer").style.overflow="hidden",i.IsDeletedUserPage)et(),i.RefreshDeletedUsersList();else if($('#userViewsDropdown :selected').attr("filterid")=="0")i.selectedViewFilterId=undefined,i.selectedViewType=undefined,i.$root.refreshList?($('#userViewsDropdown').empty(),e.GetUserViews().then(rt,w),i.$root.refreshList=!1):$('#CustomView').click();else{if(i.$root.refreshFilterView){$('#userViewsDropdown').empty(),e.GetUserViews().then(rt,w);return}i.ActiveUserListConfig.EndOfList=!1,i.ActiveUserListConfig.NoResults=!1,i.ActiveUserListConfig.serverError=!1,n=$('#userViewsDropdown :selected').attr("filterid"),t=$('#userViewsDropdown :selected').attr("viewtype"),i.selectedViewFilterId=n,i.selectedViewType=t,i.ActiveUserData.ListModel=[],i.ActiveUserListConfig.IsGuestUserView=n==i.ActiveUserListConfig.GuestUserFilterViewId?!0:!1,l.IsValid(i.ActiveUserData.SelectedUserId)&&(u=i.ActiveUserData.SelectedUserId,et(),e.GetUserDetails(u).success(ct).error(st),i.ActiveUserData.SelectedUserId=u),r=$("#searchTerm").val(),t==="10"||n==i.ActiveUserListConfig.GuestUserFilterViewId?($("#searchTerm").attr("disabled"),i.ActiveUserListConfig.searchDisabled=!0,r=null):(i.ActiveUserListConfig.searchDisabled=!1,$("#searchTerm").removeAttr("disabled")),i.ActiveUserListConfig.EmptyListViewTitle=l.IsValid(r)||l.IsValid(t)?'No results found':'Nothing here yet.',i.ActiveUserListConfig.EmptyListBodyLabel='',l.IsValid(r)?tt(r):e.RefreshUserList(n,t,i.ActiveUserListConfig.sortDirection,i.ActiveUserListConfig.sortField).then(b,w)}},i.RefreshDeletedUsersList=function(){i.ActiveUserData.ListModel=[],i.IsRestoreDisabled=!0;var n=$("#searchTerm").val();l.IsValid(n)?tt(n):e.GetDefaultDeletedUserList(i.ActiveUserListConfig.sortDirection,i.ActiveUserListConfig.sortField).success(b).error(w)},i.SearchOnClick=function(){var n=$("#searchTerm").val();l.IsValid(n)&&(i.ActiveUserListConfig.searchInitiated=!0,tt(n))},i.SearchKeydown=function(n){if(n.keyCode===13){var t=$("#searchTerm").val();i.ActiveUserListConfig.searchInitiated=!0,tt(t)}else return!1},i.clearLabel=function(){$("#userSearch").children(".sb-label").hide(),$("#userSearch").addClass("is-active"),i.ActiveUserListConfig.searchInitiated=!1},i.searchBoxClose=function(){i.ActiveUserListConfig.searchBoxTracker=!0,i.searchBoxBlur(),i.RefreshList(),i.ActiveUserListConfig.searchInitiated=!1,$("#searchTerm").focus()},i.searchBoxBlur=function(){i.ActiveUserListConfig.searchBoxTracker===!0&&($("#searchTerm").val(""),$("#userSearch").children(".sb-label").show()),$("#userSearch").removeClass("is-active"),$("#searchTerm").val()==""&&$("#searchTerm").val().length===0&&$("#userSearch").children(".sb-label").show(),i.ActiveUserListConfig.searchBoxTracker=!1},i.searchBoxWidth=function(){return i.selectedViewType!=undefined&&i.selectedViewType=='17'?{width:'200px'}:{width:'300px'}},i.AddFilters=function(){if(angular.forEach(i.Filters,function(n){$('#userViewsDropdown').append($("<option>"+n.FilterDisplayName+"</option>").attr("value",n.TrackingID).attr("filterid",n.FilterID).attr("viewType",n.SelectedViewType).text(n.FilterDisplayName))}),r.features.AddUser){var n='Add custom view',t='<option>'+n+'</option >';$('#userViewsDropdown').append($(t).attr("filterid","0").text(n)),$('#userViewsDropdown:first-child').attr("selected","selected")}},i.CloseActionLinks=function(){$(".userlistActions").hide(),$('#actionButton').attr('aria-expanded','false');return},i.displayActionLinks=!1,i.ToggleActionLinks=function(){if(i.displayActionLinks=!i.displayActionLinks,i.displayActionLinks){i.ActiveUserData.SelectedUsers.length===0?$('.userBulkActions0').show():i.ActiveUserData.SelectedUsers.length===1?$('.userBulkActions1').show():$('.userBulkActions2').show(),$('#actionButton').attr('aria-expanded','true');var n='Use up and down arrows to navigate actions.';y.AnnounceText(n)}else{$('.userlistActions').hide(),$('#actionButton').attr('aria-expanded','false');return}},i.ExportUsers=function(n){var t="",r,u,f;if(t=n?'<b>Export deleted users</b>':i.IsGuestUserPage?'<b>Export guest users</b>':'<b>Export active users</b>',r=$('#userViewsDropdown :selected').attr("filterid"),r=="417919e5-65e2-4964-bb74-67b32b2c9fc2")u='We don\x27t yet support exporting licensed users.',f='Close',DialogManager.alertHtml(1,t,u,null,f,null);else{var e='Export could take some time depending on the number of users in the tenant.',o='Continue',s='No',h=function(t){if(t==DialogManager.positiveConfirmation)if(i.IsGuestUserPage){r=i.ActiveUserListConfig.GuestUserFilterViewId;var u="1",f=$("#searchTerm").val(),e={SearchText:f,SelectedView:r,SelectedViewType:u,SortDirection:0,SortPropertyName:"DisplayName"};window.open('../admin/api/csv/users?'+$.param(e))}else if(n)window.open('../admin/api/csv/users/deleted');else{var u=$('#userViewsDropdown :selected').attr("viewtype"),f=$("#searchTerm").val(),e={SearchText:f,SelectedView:r,SelectedViewType:u,SortDirection:0,SortPropertyName:"DisplayName"};window.open('../admin/api/csv/users?'+$.param(e))}};DialogManager.confirmHtml(1,t,e,h,o,s)}},i.initCallbackPanel=function(n){i.panel=n},ut='Bulk actions',g=function(n){var t={};return t=n.length==1?{panelTemplateUrl:"../AdminPortal/Users/UserItemDetailsTemplate",panelType:"bulkactionuser",selecteditem:n[0],unselectonclose:!1,unhighlightonclose:!1}:{panelTemplateUrl:"../AdminPortal/Users/bulkuseractions",panelType:"multiuser",panelHeaderTitle:ut,selecteditem:n,unselectonclose:!0,unhighlightonclose:!0}},i.UpdatedSelectedUsers=function(n){var r,t;i.$root.focusOnPanel=!1,i.CloseActionLinks(),n.isChecked?(i.ActiveUserData.SelectedUsers.length===0&&(i.userLiteDetailsForEditAction=n),i.ActiveUserData.SelectedUsers.push(n),i.objectid=n.ObjectId,t=g(i.ActiveUserData.SelectedUsers),i.panel.invoke(t)):(r=i.ActiveUserData.SelectedUsers.indexOf(n),r!==-1&&i.ActiveUserData.SelectedUsers.splice(r,1),i.ActiveUserData.SelectedUsers.length===1&&(i.userLiteDetailsForEditAction=i.ActiveUserData.SelectedUsers[0],t=g(i.ActiveUserData.SelectedUsers),i.panel.invoke(t)),i.ActiveUserData.SelectedUsers.length===0&&i.$broadcast('closePanel'),i.selectedHeader.isChecked=!1),i.IsRestoreDisabled=i.ActiveUserData.SelectedUsers.length===1?!1:!0,i.$broadcast('ToggleUserAction',i.ActiveUserData.SelectedUsers)},i.ShouldDisable=function(){return l.IsDataValid(i.ActiveUserData)},i.SelectedAllUsers=function(t){if(i.CloseActionLinks(),i.ActiveUserData.SelectedUsers=[],t){i.ActiveUserData.ListModel.forEach(function(n){i.ActiveUserData.SelectedUsers.indexOf(n)==-1&&i.ActiveUserData.SelectedUsers.push(n)}),$(".dataListField").prop('checked',!0),angular.forEach(i.ActiveUserData.ListModel,function(n){n.isChecked=!0});var r=g(i.ActiveUserData.SelectedUsers);i.panel.invoke(r),$(".gridRow").css("background-color",n.gridRowCheckedBgColor),i.ActiveUserData.SelectedUsers.length===1?(i.userLiteDetailsForEditAction=i.ActiveUserData.SelectedUsers[0],i.IsRestoreDisabled=!1):i.IsRestoreDisabled=!0}else i.selectedHeader.isChecked=t,$(".dataListField").prop('checked',!1),angular.forEach(i.ActiveUserData.ListModel,function(n){n.isChecked=!1})},nt=i.$on('resetSelection',function(){i.SelectedAllUsers(!1)}),i.setInputParams=function(n){i.IsDeletedUserPage=n,i.IsGuestUserPage=!1,i.IsRestoreDisabled=!0,ot()},i.setGuestParams=function(){i.IsGuestUserPage=!0,ot()},i.restoreClick=function(){if(i.ActiveUserData.SelectedUsers.length!=1)return i.IsRestoreDisabled=!0,!1},i.ToggleSortOption=function(n){i.ActiveUserListConfig.sortField=n,i.ActiveUserListConfig.sortDirection=i.ActiveUserListConfig.sortDirection===1?0:1,i.RefreshList()},i.setCloseButtonFocus=function(){angular.element(".flyoutClose").focus()},i.UpdateUserStatus=function(n){var t=-1,n;n!=null&&angular.forEach(i.ActiveUserData.ListModel,function(i,r){i.ObjectId===n&&(t=r)}),t>=0&&(n=i.ActiveUserData.ListModel[t].ObjectId,e.GetUserLight(n).then(function(n){i.ActiveUserData.ListModel[t].UserStatus=n.data.UserStatus}))},i.GetMoment=function(n){return v.GetLocalizedDateTime(n,1)};var et=function(){i.ActiveUserListConfig.detailsLoaded=!1,i.ActiveUserListConfig.UpnEqualsSmtp=!0,i.ActiveUserListConfig.serverError=!1,i.ActiveUserData.SyncType=null,i.ActiveUserData.DirSyncEnabled=!1,i.ActiveUserData.SelectedUserId=null,i.ActiveUserData.SelectedUser=null,i.ActiveUserData.UserAlternateEmail=null,i.ActiveUserData.EmailAliases=null,i.ActiveUserData.UserPrincipalName=null,i.ActiveUserData.DisplayName=null,i.ActiveUserData.PhoneNumber=null,i.ActiveUserData.PrimaryEmailAddress=null,i.ActiveUserData.Licenses=[],i.ActiveUserData.UserRoles=[]},tt=function(n){i.ActiveUserData.ListModel=[],i.ActiveUserListConfig.EndOfList=!1,i.ActiveUserListConfig.showContextualHelp=!1,i.ActiveUserListConfig.ItemsCountOnInit=undefined,i.ActiveUserListConfig.EmptyListViewTitle='No results found',i.ActiveUserListConfig.EmptyListBodyLabel='',i.ActiveUserListConfig.DeletedUsersEmptyListViewTitle='No results found',i.ActiveUserListConfig.DeletedUsersEmptyListBodyLabel='';var t=$('#userViewsDropdown :selected').attr("filterid"),r=$('#userViewsDropdown :selected').attr("viewType");e.SearchUser(n,t,r,i.ActiveUserListConfig.sortDirection,i.ActiveUserListConfig.sortField,i.IsDeletedUserPage).success(b).error(w)},ct=function(n){i.ActiveUserListConfig.detailsLoaded=!0,i.ActiveUserListConfig.serverError=!1,i.ActiveUserData.SelectedUserDetails=n,i.ActiveUserData.SelectedUserDetails.UserAlternateEmail=l.IsValid(n.AlternateEmailAddresses)?n.AlternateEmailAddresses:"not available",i.ActiveUserData.SelectedUserDetails.EmailAliases=l.IsValid(n.EmailAliases)?n.EmailAliases:[],i.ActiveUserData.SelectedUserDetails.OfficePhone=l.IsValid(n.OfficePhone)?n.OfficePhone:"n/a",i.ActiveUserData.SelectedUserDetails.Licenses=n.UserProducts,i.ActiveUserData.SelectedUserDetails.UserRoles=n.UserRoles,i.ActiveUserData.SelectedUserDetails.showContextualHelp=!0};i.GetUserPhotos=function(n){i.$root.features&&i.$root.features.EnableUserPhotoInList&&n&&n.forEach(function(n){c.GetPhoto(n.UserPrincipalName,0).then(function(t){t&&n.UserPrincipalName==t.Identity&&l.IsValid(t.PhotoContent)&&(n.PhotoContent=t.PhotoContent)})})};var b=function(n){var t,n;i.ActiveUserData.ListModel=n.Users,t='',t=i.ActiveUserData.ListModel.length==0?'No users found':i.ActiveUserData.ListModel.length==1?'One user loaded successfully':i.ActiveUserData.ListModel.length+" Users loaded successfully",y.AnnounceText(t),angular.isDefined(i.ActiveUserListConfig.ItemsCountOnInit)&&(i.ActiveUserListConfig.ItemsCountOnInit=i.ActiveUserData.ListModel.length),i.SelectedAllUsers(i.selectedHeader.isChecked),i.ActiveUserListConfig.IsDirSyncEnabled=n.IsDirSyncEnabled,i.ActiveUserListConfig.ShowUserStatus=n.ShowUserStatus,i.updateCustomizableColumnCss(),i.updateUpnColumnCss(),i.updateDisplaynameColumnCss(),i.ActiveUserListConfig.ViewForInfiniteScroll=angular.isUndefined($('#userViewsDropdown :selected').attr("filterid"))?i.ActiveUserListConfig.ViewForInfiniteScroll:$('#userViewsDropdown :selected').attr("filterid"),i.ActiveUserListConfig.NoResults=i.ActiveUserData.ListModel.length===0?!0:!1,i.ActiveUserData.ListContext=n.MetaData.ListContext===null||n.MetaData.ListContext===undefined?null:n.MetaData.ListContext,i.ActiveUserListConfig.EndOfList=n.MetaData.IsLastPage,i.ActiveUserListConfig.UserViewsLoaded==!0?(Microsoft.Online.BOX.JS.Insights.RaiseEvent("users.Loaded"),i.ActiveUserListConfig.UserViewsLoaded=!1):i.ActiveUserListConfig.ListUsersLoaded=!0,document.getElementById("ShellBodyAndFooterContainer").style.overflow="auto",i.$emit("autoscrolltotop"),i.GetUserPhotos(i.ActiveUserData.ListModel),n=l.ShowLoadButtonsforListItems(),i.ActiveUserListConfig.showLoad=n.showLoad,i.ActiveUserListConfig.showSpinner=n.showSpinner,i.ActiveUserListConfig.showContextualHelp=!0,i.filterDropdownChanged&&(lt(),i.filterDropdownChanged=!1)},ft=function(n){i.ActiveUserData.ListModel=i.ActiveUserData.ListModel.concat(n.Users),i.ActiveUserData.ListContext=n.MetaData.ListContext===null||n.MetaData.ListContext===undefined?null:n.MetaData.ListContext,i.ActiveUserListConfig.EndOfList=n.MetaData.IsLastPage,i.ActiveUserListConfig.IsPreviousRequestPending=!1,i.GetUserPhotos(n.Users)},at=function(){i.ActiveUserListConfig.EndOfList=!0,i.ActiveUserListConfig.serverError=!0},st=function(){i.ActiveUserListConfig.detailsLoaded=!0,i.ActiveUserListConfig.serverError=!0,i.ActiveUserData.SelectedUserDetails.showContextualHelp=!0},w=function(){document.getElementById("ShellBodyAndFooterContainer").style.overflow="auto",i.ActiveUserListConfig.serverError=!0,i.ActiveUserListConfig.detailsLoaded=!0,i.ActiveUserData.SelectedUserDetails.showContextualHelp=!0},ht=function(n){var t=n.data;i.Filters=t,i.AddFilters(),i.ActiveUserListConfig.ListUsersLoaded==!0?(Microsoft.Online.BOX.JS.Insights.RaiseEvent("users.Loaded"),i.ActiveUserListConfig.ListUsersLoaded=!1):i.ActiveUserListConfig.UserViewsLoaded=!0},rt=function(n){var t=n.data;i.Filters=t,i.AddFilters(),i.ActiveUserListConfig.ListUsersLoaded==!0?(Microsoft.Online.BOX.JS.Insights.RaiseEvent("users.Loaded"),i.ActiveUserListConfig.ListUsersLoaded=!1):i.ActiveUserListConfig.UserViewsLoaded=!0,i.$root.refreshFilterView=!1,i.RefreshList()},it=function(){var r=$("#gridRowsContainer .gridRow:last").offset().top,n=$('#userViewsDropdown :selected').attr("filterid"),t;i.ActiveUserListConfig.ViewForInfiniteScroll=n,!i.ActiveUserListConfig.IsPreviousRequestPending&&r<$(window).height()&&i.ActiveUserListConfig.ViewForInfiniteScroll==n&&(angular.isUndefined(i.ActiveUserListConfig.StateParams.ObjectId)?i.ActiveUserListConfig.EndOfList||(i.IsDeletedUserPage?(n="",t=""):t=$('#userViewsDropdown :selected').attr("viewType"),i.ActiveUserListConfig.IsPreviousRequestPending=!0,e.GetNextListUserPage(i.IsDeletedUserPage,n,t,i.ActiveUserData.ListContext).then(ft,w)):e.GetUserListForSKU(i.ActiveUserListConfig.sortDirection,i.ActiveUserListConfig.sortField,i.ActiveUserListConfig.LicensedUserFilterViewId,i.ActiveUserListConfig.StateParams.ObjectId,1,i.ActiveUserData.ListContext).success(ft).error(w))};i.GetNextUsers=function(){i.ActiveUserListConfig.showSpinner=!0,i.ActiveUserListConfig.showLoad=!1,it()},i.selectedHeader={isChecked:!1},i.initCallbackFlyout=function(n){i.flyout=n},i.OpenAddUserFlyout=function(){var n={flyoutTemplateUrl:"../AdminPortal/Users/Add",flyoutType:"user",waitingIndicatorMessage:'Adding user',selecteditem:{}};i.flyout.invoke(n)},i.ShowContextualHelpCard=function(){return i.ActiveUserListConfig.showContextualHelp&&i.ActiveUserListConfig.ItemsCountOnInit==0},d=i.$on('RefreshList',function(){document.getElementById("ShellBodyAndFooterContainer").style.overflow="hidden",i.RefreshList()}),i.OpenFlyoutOrPanel=function(n){n!=undefined&&(l.IsValid(n.flyoutTemplateUrl)?i.flyout.invoke(n):l.IsValid(n.panelTemplateUrl)&&i.panel.invoke(n))}}return t.prototype.GetActiveUserListConfig=function(){return{IsPreviousRequestPending:!1,IsDirSyncEnabled:!1,ShowUserStatus:!1,EndOfList:!1,NoResults:!1,detailsLoaded:!0,serverError:!1,searchDisabled:!1,searchInitiated:!1,searchBoxTracker:!1,showSpinner:!0,showLoad:!1,UpnEqualsSmtp:!0,sortDirection:0,sortField:"DisplayName",SyncTypeColumnCss:'defaultCustomizableColumn',UserStatusColumnCss:'defaultCustomizableColumn',DisplayNameColumnCss:'defaultDisplayNameColumn',UpnColumnCss:'defaultUpnColumn',ViewForInfiniteScroll:'00000000-0000-0000-0000-000000000000',showContextualHelp:!1,LicensedUserFilterViewId:'417919E5-65E2-4964-BB74-67B32B2C9FC2',GuestUserFilterViewId:'04bb2711-a037-4460-a9f7-14c976060ae5',IsGuestUserView:!1,StateParams:{FilterName:undefined,ObjectId:undefined},ItemsCountOnInit:undefined,EmptyListViewTitle:'Nothing here yet.',EmptyListBodyLabel:'Let\u2019s get you started',ShowContextualHelpItemCount:3,DeletedUsersEmptyListViewTitle:'There\x27s nothing here',DeletedUsersEmptyListBodyLabel:'And that\x27s probably OK.'}},t.$inject=["$rootScope","$scope","$http","$document","UserManagementService","ProfileService","PanelService","SettingsService","PhotoService","HelperService",'$stateParams',"DateTimeService","AccessibilityService","$timeout"],t}();n.UserManagementListViewController=t,n.app.controller("UserManagementListViewController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){function e(){n.IsDeletedUser=n.$root.IsDeletedUserPage,n.selecteditem=n.selectedItem,n.userLiteDetailsForEditAction=n.selectedItem[0],n.$applyAsync()}this.$scope=n,this.$rootScope=t,this.PanelService=i,this.UserManagementService=r,e();var u=n.$on(i.GetBroadCastEventName(),function(t,i){n.selecteditem=i,n.selecteditem.length===1?(n.userLiteDetailsForEditAction=i[0],n.objectId=i[0].ObjectId):n.selecteditem.length>1&&(n.userLiteDetailsForEditAction=i)}),f=n.$on('ToggleUserAction',function(t,i){i.length===0&&n.ClosePanel()});n.$on('$destroy',function(){u&&(u(),u=null),f&&(f(),f=null)}),n.ClosePanel=function(){n.$emit('closePanel'),n.$destroy()}}return n.$inject=["$scope",'$rootScope','PanelService','UserManagementService'],n}();n.app.controller("BulkUserActionsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function r(){n.SelectedGroups=n.$parent.$parent.selectedItem,n.$applyAsync()}this.$scope=n,this.$rootScope=t,this.PanelService=i,r(),n.$on(i.GetBroadCastEventName(),function(t,i){n.SelectedGroups=i}),n.$on('ToggleGroupAction',function(t,i){i.length===0&&n.ClosePanel()}),n.ClosePanel=function(){n.$emit('closePanel')}}return n.$inject=["$scope",'$rootScope','PanelService'],n}();n.app.controller("BulkGroupActionsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function f(){n.SelectedContacts=n.$parent.$parent.selectedItem,n.$applyAsync()}this.$scope=n,this.$rootScope=t,this.PanelService=i,f();var r=n.$on(i.GetBroadCastEventName(),function(t,i){n.SelectedContacts=i}),u=n.$on('ToggleContactAction',function(t,i){i.length===0&&n.ClosePanel()});n.$on('$destroy',function(){r&&(r(),r=null),u&&(u(),u=null)}),n.ClosePanel=function(){n.$emit('closePanel'),n.$destroy()}}return n.$inject=["$scope",'$rootScope','PanelService'],n}();n.app.controller("BulkContactActionsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function f(){n.SelectedSharedMailboxes=n.$parent.$parent.selectedItem,n.$applyAsync()}this.$scope=n,this.$rootScope=t,this.PanelService=i,f();var r=n.$on(i.GetBroadCastEventName(),function(t,i){n.SelectedSharedMailboxes=i}),u=n.$on('ToggleSharedMailboxAction',function(t,i){i.length===0&&n.ClosePanel()});n.$on('$destroy',function(){r&&(r(),r=null),u&&(u(),u=null)}),n.ClosePanel=function(){n.$emit('closePanel'),n.$destroy()}}return n.$inject=["$scope",'$rootScope','PanelService'],n}();n.app.controller("BulkSharedMailboxActionsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var f=function(){function n(n,t){this.$scope=n,this.PanelService=t,n.selecteditem=n.selectedItem,n.$applyAsync(),n.$on(t.GetBroadCastEventName(),function(t,i){n.selecteditem=i})}return n.$inject=["$scope","PanelService"],n}(),t,i,r,u;n.app.controller("BulkMessageCenterActionsController",f),t=function(){function n(n,t,i){this.$scope=n,this.$rootScope=t,this.MessageCenterService=i,n.showSuccessMessage=!1,n.showFailureMessage=!1,n.messageids=[],n.$emit('showWaitingIndicator',!0),angular.forEach(n.selecteditem,function(t){n.messageids.push(t.AnnouncementId)}),i.UpdateMessageReadStatus(n.messageids,!0).then(function(t){n.$emit('showWaitingIndicator',!1),t&&t.data?n.showSuccessMessage=!0:n.showFailureMessage=!0,n.showCloseButton=!0},function(){n.$emit('showWaitingIndicator',!1),n.showFailureMessage=!0,n.showCloseButton=!0}),n.Cancel=function(){n.$emit('closeFlyout'),n.$emit('closePanel'),t.$broadcast('refreshMessageCenter')}}return n.$inject=["$scope","$rootScope","MessageCenterService"],n}(),n.app.controller("BulkMessageMarkAsReadController",t),i=function(){function n(n,t,i){this.$scope=n,this.$rootScope=t,this.MessageCenterService=i,n.showFailureMessage=!1,n.showSuccessMessage=!1,n.$emit('showWaitingIndicator',!0),n.messageids=[],angular.forEach(n.selecteditem,function(t){n.messageids.push(t.AnnouncementId)}),i.UpdateMessageReadStatus(n.messageids,!1).then(function(t){n.$emit('showWaitingIndicator',!1),t&&t.data?n.showSuccessMessage=!0:n.showFailureMessage=!0,n.showCloseButton=!0},function(){n.$emit('showWaitingIndicator',!1),n.showFailureMessage=!0,n.showCloseButton=!0}),n.Cancel=function(){n.$emit('closeFlyout'),n.$emit('closePanel'),t.$broadcast('refreshMessageCenter')}}return n.$inject=["$scope","$rootScope","MessageCenterService"],n}(),n.app.controller("BulkMessageMarkAsUnReadController",i),r=function(){function n(n,t,i){this.$scope=n,this.$rootScope=t,this.MessageCenterService=i,n.showFailureMessage=!1,n.showSuccessMessage=!1,n.$emit('showWaitingIndicator',!0),n.messageids=[],angular.forEach(n.selecteditem,function(t){n.messageids.push(t.AnnouncementId)}),i.UpdateMessageDismissStatus(n.messageids,!0).then(function(t){n.$emit('showWaitingIndicator',!1),t&&t.data?n.showSuccessMessage=!0:n.showFailureMessage=!0,n.showCloseButton=!0},function(){n.$emit('showWaitingIndicator',!1),n.showCloseButton=!0,n.showFailureMessage=!0}),n.Cancel=function(){n.$emit('closeFlyout'),n.$emit('closePanel'),t.$broadcast('refreshMessageCenter')}}return n.$inject=["$scope","$rootScope","MessageCenterService"],n}(),n.app.controller("BulkMessageDismissController",r),u=function(){function n(n,t,i){this.$scope=n,this.$rootScope=t,this.MessageCenterService=i,n.showFailureMessage=!1,n.showSuccessMessage=!1,n.$emit('showWaitingIndicator',!0),n.messageids=[],angular.forEach(n.selecteditem,function(t){n.messageids.push(t.AnnouncementId)}),i.UpdateMessageDismissStatus(n.messageids,!1).then(function(t){n.$emit('showWaitingIndicator',!1),t&&t.data?n.showSuccessMessage=!0:n.showFailureMessage=!0,n.showCloseButton=!0},function(){n.$emit('showWaitingIndicator',!1),n.showCloseButton=!0,n.showFailureMessage=!0}),n.Cancel=function(){n.$emit('closeFlyout'),n.$emit('closePanel'),t.$broadcast('refreshMessageCenter')}}return n.$inject=["$scope","$rootScope","MessageCenterService"],n}(),n.app.controller("BulkMessageRestoreController",u)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function f(){n.SelectedResourceMailboxes=n.$parent.$parent.selectedItem,n.$applyAsync()}this.$scope=n,this.$rootScope=t,this.PanelService=i,f();var r=n.$on(i.GetBroadCastEventName(),function(t,i){n.SelectedResourceMailboxes=i}),u=n.$on('ToggleResourceMailboxAction',function(t,i){i.length===0&&n.ClosePanel()});n.$on('$destroy',function(){r&&(r(),r=null),u&&(u(),u=null)}),n.ClosePanel=function(){n.$emit('closePanel'),n.$destroy()}}return n.$inject=["$scope",'$rootScope','PanelService'],n}();n.app.controller("BulkResourceMailboxController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i){function f(){n.SelectedPartners=n.$parent.$parent.selectedItem,n.$applyAsync()}this.$scope=n,this.$rootScope=t,this.PanelService=i,f();var r=n.$on(i.GetBroadCastEventName(),function(t,i){n.SelectedPartners=i}),u=n.$on('TogglePartnerAction',function(t,i){i.length===0&&n.ClosePanel()});n.$on('$destroy',function(){r&&(r(),r=null),u&&(u(),u=null)}),n.ClosePanel=function(){n.$emit('closePanel'),n.$destroy()}}return n.$inject=["$scope",'$rootScope','PanelService'],n}();n.app.controller("BulkPartnerActionsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(i,r,u,f,e,o,s){function g(){var u,n;i.BillingNotificationsAdmins=[],i.BillingAdminListConfig={},i.ActiveGlobalAdminListConfig=t.prototype.GetActiveUserListConfig(),i.ActiveGlobalAdminListConfig.EndOfList=!1,i.ActiveGlobalAdminListConfig.NoResults=!1,i.ActiveGlobalAdminListConfig.serverError=!1,i.ActiveGlobalAdminData=e.GetActiveUserData(),i.ActiveGlobalAdminData.ListModel=[],i.BillingAdminListConfig.showLoad=!1,i.BillingAdminListConfig.showSpinner=!0,v(),i.ActiveBillingAdminListConfig=t.prototype.GetActiveUserListConfig(),i.ActiveBillingAdminListConfig.EndOfList=!1,i.ActiveBillingAdminListConfig.NoResults=!1,i.ActiveBillingAdminListConfig.serverError=!1,i.ActiveBillingAdminData=e.GetActiveUserData(),i.ActiveBillingAdminData.ListModel=[],nt(),u=document.getElementById('ShellBodyAndFooterContainer'),angular.element(u).bind('scroll',h),n=r.$on('$stateChangeStart',function(t,i,r,u){if(u.name==='billingNotifications'){var e=document.getElementById('ShellBodyAndFooterContainer');angular.element(e).unbind('scroll',h)}n&&(n(),n=null)})}this.$scope=i,this.$rootScope=r,this.$http=u,this.$document=f,this.UserManagementService=e,this.ProfileService=o,this.HelperService=s,i.GlobalAdminRoleString='Global administrator',i.BillingAdminRoleString='Billing administrator',i.ToggleHighlight=function(n){$(".gridRow").css("background-color","transparent"),$("#user_list_"+n).css("background-color","#DDEBF7")},i.GetBackgroundColor=function(n){return o.GetProfileImageColor(n)},i.getRowCss=function(n){if(n.isChecked)return{'background-color':'#DDEBF7'}},i.getRowWidth=function(){return{width:"370px"}},i.getRowWidthDisplayname=function(){return{width:"340px"}};var v=function(){e.GetBillingNotificationsUser(n.UserView.GlobalAdminViewId,n.RoleViewType,i.ActiveGlobalAdminListConfig.sortDirection,i.ActiveGlobalAdminListConfig.sortField).success(y).error(w)},nt=function(){e.GetBillingNotificationsUser(n.UserView.BillingAdminViewId,n.RoleViewType,i.ActiveBillingAdminListConfig.sortDirection,i.ActiveBillingAdminListConfig.sortField).success(p).error(b)},h=function(){var t=$("#gridRowsContainer .gridRow:last").offset().top;!i.ActiveGlobalAdminListConfig.IsPreviousRequestPending&&t<$(window).height()&&(i.ActiveGlobalAdminListConfig.EndOfList||(i.ActiveGlobalAdminListConfig.IsPreviousRequestPending=!0,e.GetNextBillingNotificationsUser(n.UserView.GlobalAdminViewId,n.RoleViewType,i.ActiveGlobalAdminData.ListContext).success(k))),!i.ActiveBillingAdminListConfig.IsPreviousRequestPending&&t<$(window).height()&&(i.ActiveBillingAdminListConfig.EndOfList||(i.ActiveBillingAdminListConfig.IsPreviousRequestPending=!0,e.GetNextBillingNotificationsUser(n.UserView.BillingAdminViewId,n.RoleViewType,i.ActiveBillingAdminData.ListContext).success(d)))};i.GetNextAdminsList=function(){i.BillingAdminListConfig.showSpinner=!0,i.BillingAdminListConfig.showLoad=!1,h()},i.$on('RefreshList',function(n,t){i.RefreshUserRole(t)});var y=function(n){c(n),i.ActiveGlobalAdminListConfig.NoResults=i.ActiveGlobalAdminData.ListModel.length===0?!0:!1,Microsoft.Online.BOX.JS.Insights.RaiseEvent("globaladmins.Loaded"),i.ActiveGlobalAdminListConfig.ListUsersLoaded=!0,i.$emit("autoscrolltotop")},p=function(n){a(n),i.ActiveBillingAdminListConfig.NoResults=i.ActiveBillingAdminData.ListModel.length===0?!0:!1,Microsoft.Online.BOX.JS.Insights.RaiseEvent("billingadmins.Loaded"),i.ActiveBillingAdminListConfig.ListUsersLoaded=!0,i.$emit("autoscrolltotop")},w=function(){i.ActiveGlobalAdminListConfig.EndOfList=!0,i.ActiveGlobalAdminListConfig.serverError=!0},b=function(){i.ActiveBillingAdminListConfig.EndOfList=!0,i.ActiveBillingAdminListConfig.serverError=!0},k=function(n){c(n),i.ActiveGlobalAdminListConfig.IsPreviousRequestPending=!1},d=function(n){a(n),i.ActiveBillingAdminListConfig.IsPreviousRequestPending=!1},c=function(n){i.ActiveGlobalAdminData.ListModel=n.Users,l(i.ActiveGlobalAdminData.ListModel,i.GlobalAdminRoleString),i.ActiveGlobalAdminData.ListContext=n.MetaData.ListContext===null||n.MetaData.ListContext===undefined?null:n.MetaData.ListContext,i.ActiveGlobalAdminListConfig.EndOfList=n.MetaData.IsLastPage},a=function(n){i.ActiveBillingAdminData.ListModel=n.Users,l(i.ActiveBillingAdminData.ListModel,i.BillingAdminRoleString),i.ActiveBillingAdminData.ListContext=n.MetaData.ListContext===null||n.MetaData.ListContext===undefined?null:n.MetaData.ListContext,i.ActiveBillingAdminListConfig.EndOfList=n.MetaData.IsLastPage},l=function(n,t){angular.forEach(n,function(n){n.ObjectId&&(n.Role=t,e.GetUserDetails(n.ObjectId).then(function(t){n.AlternateEmailAddresses=t.data.AlternateEmailAddresses}),i.BillingNotificationsAdmins=i.BillingNotificationsAdmins.concat(n))});var r=s.ShowLoadButtonsforListItems();i.BillingAdminListConfig.showLoad=r.showLoad,i.BillingAdminListConfig.showSpinner=r.showSpinner};i.RefreshUserRole=function(n){var t=!1;angular.forEach(i.BillingNotificationsAdmins,function(r,u){r.ObjectId==n&&e.GetUserDetails(n).then(function(n){var f=n.data.UserRoles;angular.forEach(f,function(n){(n.Name==i.GlobalAdminRoleString||n.Name==i.BillingAdminRoleString)&&(r.Role=n.Name,t=!0)}),t||i.BillingNotificationsAdmins.splice(u,1)})})},g()}return t.prototype.GetActiveUserListConfig=function(){return{IsPreviousRequestPending:!1,IsDirSyncEnabled:!1,EndOfList:!1,NoResults:!1,detailsLoaded:!0,serverError:!1,sortDirection:0,sortField:"DisplayName"}},t.$inject=["$rootScope","$scope","$http","$document","UserManagementService","ProfileService","HelperService"],t}();n.BillingNotificationsController=t,n.app.controller("BillingNotificationsController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(t,i,r,u,f,e,o,s){function p(){t.UserDetailsConfig=n.prototype.GetUserDetailsConfig(),t.UserDetails=f.GetActiveUserData(),t.UserDetails.SelectedUserDetails=f.GetSelectedUserDetails(),t.selectedItem=t.$parent.$parent.selectedItem,t.IsDeletedUser=t.$root.IsDeletedUserPage,t.HasOneDriveOrSpoUICapability=!1,t.userDetailsUpdated=!1,t.userAliasUpdated=!1,t.showMailDetails=!1,t.showOneDriveForBusinessDetails=!1,t.ValidationErrors=[],t.ValidationErrorsToString=null,t.AllGetCallsCompleted=!1,t.GetUserChangePasswordLinkCompleted=!1,t.GetUserDetailsCompleted=!1,t.GetUserPhotoCompleted=!1,t.GetMultiFactorAuthSettingsCompleted=!1,t.GetMailboxConnectivityCompleted=!1,t.GetMailboxAutoReplyConfigurationCompleted=!1,t.GetMailboxInfoDetailsCompleted=!1,t.GetMailboxPermissionDetailsCompleted=!1,t.showDevicesDetails=!1,f.GetUserChangePasswordLink().then(function(n){t.createChangePasswordUrl=n.data,t.GetUserChangePasswordLinkCompleted=!0,h()}),t.IsSelfEditing=f.IsSelfUser(t.selectedItem.UserPrincipalName),t.waitingMemberDataToLoad=!0,t.waitingConnectivityDataToLoad=!0,t.waitingAutoReplyConfigurationDataToLoad=!0,it(t.selectedItem),g(),t.multiFactorAuth={},t.editOrViewDetailsButton='Edit',t.editOrViewScreenReader='Edit product licenses',t.$root.features.EditProducts||(t.editOrViewDetailsButton='View details',t.editOrViewScreenReader='View product licenses'),e.GetMultiFactorAuthSettings().then(function(n){t.$emit('showWaitingIndicator',!1),t.multiFactorAuth.manageUrl=n.data.ManageUrl,t.multiFactorAuth.learnUrl=n.data.LearnUrl,t.GetMultiFactorAuthSettingsCompleted=!0,h()},function(){t.$emit('showWaitingIndicator',!1),t.multiFactorAuth.showErrors=!0,t.multiFactorAuth.error='Unable to retrieve settings',t.GetMultiFactorAuthSettingsCompleted=!0,h()})}var h,v;this.$scope=t,this.$rootScope=i,this.$timeout=r,this.PanelService=u,this.UserManagementService=f,this.SettingsService=e,this.PhotoService=o,this.DateTimeService=s,t.SyndicatedPartnerUrl=i.CurrentUserInfo.SyndicatedPartnerPortalUrl,t.initCallbackFlyout=function(n){t.flyout=n},t.InvokeResetPasswordFlyout=function(){var n='Reset password',i='Saving changes',r="../AdminPortal/Users/userpasswordreset";t.InvokeFlyout(n,i,r)},t.InvokeDeleteUserFlyout=function(){var n='Delete user',i='Restoring user',r="../AdminPortal/Users/deleteusers";t.InvokeFlyout(n,i,r)},t.InvokeEditProductsFlyout=function(){var n='Product licenses',i='Saving changes',r="../AdminPortal/Users/EditProducts";t.InvokeFlyout(n,i,r)},t.InvokeEditAdminRolesFlyout=function(){var n='Edit user roles',i='Saving changes',r="../AdminPortal/Users/EditUserRoles";t.InvokeFlyout(n,i,r)},t.InvokeFlyout=function(n,i,r){if(t.SyndicatedPartnerUrl)parent.open(t.SyndicatedPartnerUrl,"_blank");else{var u,f=n;u={flyoutTemplateUrl:r,flyoutType:"user",entry:"panel",selecteditem:t.selectedItem,objectid:t.selectedItem.ObjectId,flyoutTitle:f,waitingIndicatorMessage:i},t.flyout.invoke(u)}};var a=function(n){t.GetUserDetailsCompleted=!0,h();var n=n.data;t.UserDetailsConfig.detailsLoaded=!0,t.UserDetailsConfig.serverError=!1,t.UserDetails.SelectedUserDetails=n,t.IsDeletedUser&&y(n),t.UserDetails.SelectedUserDetails.SignInStatus=n.SignInStatus,t.HasExchangeSku=n.HasExchangeSku,t.IsProvisioned=n.IsProvisioned,t.IsDirSyncEnabled=n.IsDirSyncEnabled,t.IsPreMigrationMailUser=n.IsPreMigrationMailUser,t.IsCurrentUserManagementAdmin=t.$root.CurrentUserInfo.SetUserEnabled,t.IsCurrentExchangeAdmin=t.$root.CurrentUserInfo.ManageExchangeEnabled,t.IsCurrentGlobalAdmin=t.$root.CurrentUserInfo.ManageUserExchangeEnabled,t.CanManageUserGroups=tt(),t.ShowIntuneDevices=n.ShowIntuneDevices,t.ValidationErrors=n.ValidationErrors,!!t.ValidationErrors&&t.ValidationErrors.length>0&&(t.ValidationErrorsToString=t.ValidationErrors.join("; ")),t.HasExchangeMailboxLicense=n.HasExchangeMailboxLicense,t.IsMailboxPermissionEnabled=n.IsMailboxPermissionEnabled,t.formData.IsProvisioned=n.IsProvisioned,t.formData.HasExchangeMailboxLicense=n.HasExchangeMailboxLicense,t.selectedItem.IsProvisioned=n.IsProvisioned,t.selectedItem.IsDirSyncEnabled=n.IsDirSyncEnabled,t.selectedItem.IsAdminUser=n.IsAdminUser,t.selectedItem.UpnAlias=n.UpnAlias,t.selectedItem.UpnDomain=n.UpnDomain,t.UserDetails.SelectedUserDetails.UserAlternateEmail=c(n.AlternateEmailAddresses)?n.AlternateEmailAddresses:"",t.UserDetails.SelectedUserDetails.OfficePhone=c(n.OfficePhone)?n.OfficePhone:"",t.selectedItem.Department=c(n.Department)?n.Department:"",t.selectedItem.JobTitle=c(n.JobTitle)?n.JobTitle:"",t.IsProvisioned&&t.IsCurrentExchangeAdmin?(t.aliasTitle='Email addresses',t.flyoutAliasTitle='Edit email addresses'):t.IsProvisioned&&t.IsCurrentGlobalAdmin?(t.aliasTitle='Email addresses',t.flyoutAliasTitle='Edit email addresses and user name'):(t.aliasTitle='User name',t.flyoutAliasTitle='Edit user name'),t.IsCurrentUserManagementAdmin&&t.IsProvisioned&&(t.selectedItem.UpnEqualsSmtp=n.UpnEqualsSmtp),t.UserDetails.SelectedUserDetails.Licenses=n.UserProducts,t.UserDetails.SelectedUserDetails.UserRoles=n.UserRoles,t.UserDetails.SelectedUserDetails.ObjectId=n.ObjectId,t.UserDetails.SelectedUserDetails.HasClientDownloadCapabilityForOffice=n.HasClientDownloadCapabilityForOffice,t.HasOneDriveOrSpoUICapability=n.HasOneDriveOrSpoUICapability,t.userDetailsUpdated=!0,t.selectedItem.UserPrincipalName=t.UserDetails.SelectedUserDetails.UserPrincipalName,t.selectedItem.DisplayName=t.UserDetails.SelectedUserDetails.DisplayName,i.$broadcast('UpdatePersonCard',t.selectedItem)},tt=function(){return t.$root.CurrentUserInfo.CanManageGroups&&!t.IsDeletedUser&&t.$root.features.EditGroupMembers},ut=function(n){t.GetMailboxInfoDetailsCompleted=!0,h(),t.UserDetailsConfig.aliasDetailsLoaded=!0,y(n.data)};t.$on('UpdateUserPanelDetails',function(n,i){i&&(t.isRefresh=!0,p())});var y=function(n){t.userAliasUpdated=!0,c(n)&&(t.selectedItem.MailboxForwardingEnabled=n.MailboxForwardingEnabled,t.selectedItem.MailboxForwardingAddress=n.MailboxForwardingAddress,t.selectedItem.MailboxForwardingSmtpAddress=n.MailboxForwardingSmtpAddress,t.selectedItem.MailboxDeliverToMailboxAndForward=n.MailboxDeliverToMailboxAndForward,t.selectedItem.PrimaryEmailAddress=n.MailboxSmtp,t.selectedItem.EmailAddresses=n.MailboxEmailAddresses,t.selectedItem.RecipientTypeDetails=n.RecipientTypeDetails,t.selectedItem.UpnEqualsSmtp=t.selectedItem.UserPrincipalName.toLowerCase()!=t.selectedItem.PrimaryEmailAddress.toLowerCase()?!1:t.selectedItem.DirSyncEnabled?!1:!0,t.selectedItem.UserAliases=c(n.MailboxEmailAliases)?n.MailboxEmailAliases.sort():[])},l=function(){t.UserDetailsConfig.detailsLoaded=!0,t.UserDetailsConfig.serverError=!0,t.GetUserDetailsCompleted=!0,h()},nt=function(){t.UserDetailsConfig.aliasDetailsLoaded=!0,t.UserDetailsConfig.serverExoEmailAliasError=!0,t.GetMailboxInfoDetailsCompleted=!0,h()},c=function(n){return n===null||n===""||n===" "||n===undefined?!1:!0},w=function(n){t.selectedItem&&(t.selectedItem.MailboxMembershipRetrieved?(t.selectedItem.totalMemberCount=t.selectedItem.MailboxFullAccessMembers.length+t.selectedItem.MailboxSendAsMembers.length+t.selectedItem.MailboxSendOnBehalfMembers.length,t.waitingMemberDataToLoad=!1,t.GetMailboxPermissionDetailsCompleted=!0,h()):(t.waitingMemberDataToLoad=!0,f.GetMailboxPermissions(n).then(function(n){n.data&&(t.selectedItem.MailboxFullAccessMembers=n.data.MailboxFullAccessMembers,t.selectedItem.MailboxSendAsMembers=n.data.MailboxSendAsMembers,t.selectedItem.MailboxSendOnBehalfMembers=n.data.MailboxSendOnBehalfMembers,t.selectedItem.totalMemberCount=n.data.MailboxFullAccessMembers.length+n.data.MailboxSendAsMembers.length+n.data.MailboxSendOnBehalfMembers.length,t.waitingMemberDataToLoad=!1),t.GetMailboxPermissionDetailsCompleted=!0,h()})))},it=function(n){n&&(t.IsDeletedUser?(t.GetMailboxConnectivityCompleted=!0,t.GetMailboxAutoReplyConfigurationCompleted=!0,t.GetMailboxInfoDetailsCompleted=!0,t.GetMailboxPermissionDetailsCompleted=!0,f.GetDeletedUserDetails(t.selectedItem.ObjectId).then(a,l)):(f.GetUserDetails(t.selectedItem.ObjectId,t.isRefresh).then(a,l),b(t.selectedItem.ObjectId),k(t.selectedItem.ObjectId),d(t.selectedItem.ObjectId),w(t.selectedItem.ObjectId),rt(t.selectedItem.ObjectId)))},b=function(n){f.GetUserMailboxInfo(n).then(ut,nt)},k=function(n){t.selectedItem.MailboxConnectivityRetrieved?(t.waitingConnectivityDataToLoad=!1,t.GetMailboxConnectivityCompleted=!0,h()):(t.waitingConnectivityDataToLoad=!0,f.GetMailboxConnectivity(n).then(function(n){t.GetMailboxConnectivityCompleted=!0,h(),n.data&&(t.selectedItem.MailboxConnectivity=n.data),t.waitingConnectivityDataToLoad=!1}))},d=function(n){t.selectedItem.MailboxAutoReplyConfigurationRetrieved?(t.waitingAutoReplyConfigurationDataToLoad=!1,t.GetMailboxAutoReplyConfigurationCompleted=!0,h()):(t.waitingAutoReplyConfigurationDataToLoad=!0,f.GetMailboxAutoReplyConfiguration(n).then(function(n){t.GetMailboxAutoReplyConfigurationCompleted=!0,h(),n.data&&(t.selectedItem.MailboxAutoReplyConfiguration=n.data),t.waitingAutoReplyConfigurationDataToLoad=!1}))},rt=function(n){var i=[];i.push(n),f.GetIntuneDevices(i).then(function(n){n.data&&(t.selectedItem.Devices=n.data)})},g=function(){t.selectedItem&&!c(t.selectedItem.PhotoContent)&&t.$root.features&&t.$root.features.ShowPersonPhoto&&o.GetPhoto(t.selectedItem.UserPrincipalName,0).then(function(n){o.BroadcastPhotoEvent("UpdatePersonPhoto",n),t.GetUserPhotoCompleted=!0,h()})};t.OpenChangePasswordPage=function(){window.open(t.createChangePasswordUrl)},h=function(){t.AllGetCallsCompleted=t.GetUserChangePasswordLinkCompleted&&t.GetUserDetailsCompleted&&t.GetUserPhotoCompleted&&t.GetMultiFactorAuthSettingsCompleted&&t.GetMailboxConnectivityCompleted&&t.GetMailboxAutoReplyConfigurationCompleted&&t.GetMailboxInfoDetailsCompleted&&t.GetMailboxPermissionDetailsCompleted},p(),t.$on('panelclosed',function(){v&&(v(),v=null)}),t.$watch('AllGetCallsCompleted',function(){t.AllGetCallsCompleted&&u.SetPanelReady(t.AllGetCallsCompleted)}),v=t.$on(u.GetBroadCastEventName(),function(u,e){t.UserDetails.SelectedUserDetails={},t.UserAliases={},t.UserDetailsConfig=n.prototype.GetUserDetailsConfig(),t.selectedItem=e,i.$broadcast('UpdatePersonCard',t.selectedItem),r(function(){t.$apply(function(){t.IsSelfEditing=f.IsSelfUser(t.selectedItem.UserPrincipalName),t.IsDeletedUser?f.GetDeletedUserDetails(t.selectedItem.ObjectId).then(a,l):(f.GetUserDetails(t.selectedItem.ObjectId).then(a,l),b(t.selectedItem.ObjectId),k(t.selectedItem.ObjectId),d(t.selectedItem.ObjectId),w(t.selectedItem.ObjectId)),g()})})}),t.EditRoles=function(n){return window.flyoutRoot=t.$root,O365.AdminBaseControls.startEditRolesFlyout(n),!1},t.ResetPassword=function(n){return O365.AdminBaseControls.startResetPasswordFlyout(n),!1},t.DeleteUser=function(n){return window.flyoutRoot=t.$root,O365.AdminBaseControls.startDeleteUserFlyout(n),!1},t.ToggleOneDriveForBusinessChevron=function(){t.showOneDriveForBusinessDetails=!t.showOneDriveForBusinessDetails},t.ToggleMailChevron=function(){t.showMailDetails=!t.showMailDetails},t.ToggleDevicesChevron=function(){t.showDevicesDetails=!t.showDevicesDetails},t.GetMoment=function(n){return s.GetLocalizedDateTime(n,4)}}return n.prototype.GetUserDetailsConfig=function(){return{IsPreviousRequestPending:!1,IsDirSyncEnabled:!1,EndOfList:!1,NoResults:!1,detailsLoaded:!1,aliasDetailsLoaded:!1,serverError:!1,serverExoEmailAliasError:!1,searchDisabled:!1,searchInitiated:!1,searchBoxTracker:!1,UpnEqualsSmtp:!0,sortDirection:0,sortField:"DisplayName"}},n.$inject=["$scope",'$rootScope','$timeout','PanelService','UserManagementService','SettingsService','PhotoService',"DateTimeService"],n}();n.app.controller("UserDetailsViewController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r,u,f,e){this.$scope=n,this.$rootScope=t,this.$timeout=i,this.PanelService=r,this.UserManagementService=u,this.PhotoService=f,this.DateTimeService=e}return n.prototype.GetGuestDetailsConfig=function(){return{IsPreviousRequestPending:!1,EndOfList:!1,NoResults:!1,detailsLoaded:!1,serverError:!1,EmailEqualsSmtp:!0,sortDirection:0,sortField:"DisplayName"}},n.$inject=["$scope",'$rootScope','$timeout','PanelService','UserManagementService','PhotoService',"DateTimeService"],n}();n.app.controller("GuestDetailsViewController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function n(n,t,i,r){var e,u,f;this.$scope=n,this.$modalInstance=t,this.uuid=i,this.$window=r,e=function(){(r.navigator.userAgent.indexOf("Chrome")>0||r.navigator.userAgent.indexOf("Firefox")>0||r.navigator.userAgent.indexOf("Safari")>0)&&$("#msnvid").css("margin-top","40%"),MsnVideoUx.render("ocVideo","renderedVideo",{"ocVideo.Width":"640","ocVideo.Height":"360",'ocVideo.AutoPlayVideo':!1,'ocVideo.DefaultVideo':{videoQuery:{videoFilter:{type:'uuid',uuids:[i]}}},'ocVideo.PlayerChannel':'ocvideo','ocVideo.PlayerLocation':'Home','ocVideo.MsnPlayerLeadsWith':'Html'},{csid:"ux-cms-en-us-msoffice"});var n=angular.element("#renderedVideo").find(".amp-high-contrast-border");n.find(".azuremediaplayer").addClass("amp-high-contrast-border"),n.removeClass("amp-high-contrast-border")},u=function(){var n=document.getElementById('renderedVideo');n==null?setTimeout(u,500):n.children.length===0&&e()},setTimeout(u,500),n.Close=function(){f()},n.ESCKeyCode=27,$(document).keydown(function(t){t.which==n.ESCKeyCode&&f()}),f=function(){var n='renderedVideo';Vhs.Player.Services.VhsPlayerService.playerDictionary[n]&&(Vhs.Player.Services.VhsPlayerService.playerDictionary[n].playerConfig.defaultVideo="00000000-0000-0000-0000-000000000000"),t.dismiss()}}return n.$inject=["$scope","$modalInstance","uuid","$window"],n}();n.VideoPlayerController=t,n.app&&n.app.controller("VideoPlayerController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u,f){var e,o,s,h;this.$scope=t,this.findUsService=i,this.companyProfileService=r,this.$rootScope=u,this.$window=f,t.BusinessInfo=new n.FindUsBusinessInfo,t.selectedBusinessCatgory={},t.categoryValidateResult=!1,t.loadingPage=!0,t.operating=!0,t.listingSucceeded=!1,t.listingVerified=!1,t.zipcodePattern=/^(\d{5}(-\d{4})?|[A-Z]\d[A-Z] *\d[A-Z]\d)$/,t.phoneNumberPattern=/^\(?(\d{3})\)?[ .-]?(\d{3})[ .-]?(\d{4})$/,t.urlPattern=/\(?(?:(http|https):\/\/)?(?:((?:[^\W\s]|\.|-|[:]{1})+)@{1})?((?:www.)?(?:[^\W\s]|\.|-)+[\.][^\W\s]{2,4}|!localhost(?=\/)|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::(\d*))?([\/]?[^\s\?]*[\/]{1})*(?:\/?([^\s\n\?\[\]\{\}\#]*(?:(?=\.)){1}|[^\s\n\?\[\]\{\}\.\#]*)?([\.]{1}[^\s\?\#]*)?)?(?:\?{1}([^\s\n\#\[\]]*))?([\#][^\s\n]*)?\)?/i,t.businessTileHeading="",t.businessTileSubHeading="",t.businessTileAction=null,t.businessTileActionTitle="",t.showBusinessTileButtons=!1,t.businessTileLogo="~/Smb/images/bing-logo.svg",t.stepNames=['Add business info','Verify your business','Publish your listing'],t.stepStates=["current","pending","pending"],t.$root.CurrentUserInfo.BingPlacesVerificationStatus!=null&&t.$root.CurrentUserInfo.BingPlacesVerificationStatus!=""&&(t.listingSucceeded=!0,t.listingVerified=t.$root.CurrentUserInfo.BingPlacesVerificationStatus=="VERIFICATION_COMPLETED"?!0:!1),e=function(n,i){t.$emit('findus:message',{message:n,messageType:i})},o=function(n){n.Succeeded||(n.Data&&n.Data.ErrorMessage&&n.Data.MessageType?e(n.Data.ErrorMessage,n.Data.MessageType):e(n.Message,1))},t.createOrUpdatePage=function(){return!t.loadingPage&&!t.listingSucceeded&&t.O365BusinessData},t.successPage=function(){return!t.loadingPage&&t.BusinessInfo&&(t.listingSucceeded||!t.O365BusinessData)},t.$watch("createOrUpdatePage()",function(n){n&&(t.stepStates=["current","pending","pending"],t.businessTileHeading=String.format('Fill in your business information',t.brandName),t.businessTileSubHeading=String.format('Before publishing, we will send you a post card with the verification code to this address to make sure it\x27s you.',t.brandName),t.showBusinessTileButtons=!1)}),t.$watch("successPage()",function(n){n&&(t.showBusinessTileButtons=!0,t.listingVerified?(t.stepStates=["done","done","done"],t.businessTileHeading=String.format('Your \x7b0\x7d listing is complete\x21',t.brandName),t.businessTileSubHeading=String.format('Customers can now find your information on \x7b0\x7d. Visit \x7b1\x7d to add photos and other details to your business profile.',t.brandName,t.bingplaces),t.businessTileLogo="~/Smb/images/success-icon.png",t.businessTileAction=t.gotoBingPlacesForBusiness,t.businessTileActionTitle='Visit Bing Places for Business'):(t.stepStates=["done","current","pending"],t.businessTileHeading='Verification pending',t.businessTileSubHeading='When you receive your verification postcard, select Verify my business below to complete the process.',t.businessTileAction=t.gotoBingPlacesForBusiness,t.businessTileActionTitle='Verify my business'))}),t.gotoBingPlacesForBusiness=function(){f.open(t.bingPlacesLink.url,"_blank")},t.init=function(i,r){t.brandName=i,t.bingplaces=r,c(),l(),n.app?a():v()};var c=function(){i.GetFeatureData().then(function(n){t.FeatureData=n.data.Data})},l=function(){t.bingPlacesLink={},r.GetBingPlacesLink().then(function(n){t.bingPlacesLink=n.data},function(n){t.bingPlacesLink.error=n.data,t.bingPlacesLink.showErrors=!0})},a=function(){i.GetBusinessListings().then(function(n){o(n.data);var i=n.data;i.Data&&(t.O365BusinessData=i.Data.O365BusinessData,t.BusinessInfo=i.Data.BusinessInfos[0]),t.operating=!1,t.loadingPage=!1},function(n){e(n.data.Message,2),t.operating=!1,t.loadingPage=!1})},v=function(){i.GetBusinesses().then(function(n){o(n.data);var i=n.data;i.Data&&(t.O365BusinessData=i.Data.O365BusinessData,t.BusinessInfo=i.Data.Businesses[0].BusinessInfo),t.operating=!1,t.loadingPage=!1},function(n){e(n.data,2),t.operating=!1,t.loadingPage=!1})};t.SetBusinessListing=function(){t.operating||(t.operating=!0,t.BusinessInfo.Categories=new n.FindUsBusinessCategoryInfo,t.BusinessInfo.Categories.PrimaryCategory=new n.FindUsBusinessCategory,t.BusinessInfo.Categories.PrimaryCategory.BPCategoryId=t.selectedBusinessCatgory.Id,t.BusinessInfo.Categories.PrimaryCategory.CategoryName=t.selectedBusinessCatgory.Value,t.BusinessInfo.Categories.BusinessCategories=[],t.BusinessInfo.Categories.BusinessCategories.push(t.BusinessInfo.Categories.PrimaryCategory),i.SetBusinessListings([t.BusinessInfo]).then(function(n){o(n.data);var i=n.data;i.Succeeded?(t.PostValidationErrors=null,t.O365BusinessData&&(t.listingSucceeded=!0),e(n.data.Message,0),u.$broadcast('refershfindusbannerstatus')):i.Data&&(i.Data.Errors&&i.Data.Errors[0]&&(t.PostValidationErrors=i.Data.Errors[0].BusinessErrors),e(n.data.Message,1)),t.operating=!1},function(n){e(n.data.Message,2),t.operating=!1}))},t.CreateOrUpdateListing=function(){t.operating||(t.operating=!0,t.BusinessInfo.CategoryIds=[],t.BusinessInfo.CategoryIds.push(t.selectedBusinessCatgory.Id),t.BusinessInfo.PrimaryCategoryId=t.selectedBusinessCatgory.Id,t.O365BusinessData?s():h())},s=function(){i.CreateNewListing(t.BusinessInfo).then(function(n){o(n.data);var i=n.data;i.Succeeded?(t.PostValidationErrors=null,t.listingSucceeded=!0,u.$broadcast('refershfindusbannerstatus')):i.Data&&(i.Data.Errors&&i.Data.Errors[0]&&(t.PostValidationErrors=i.Data.Errors[0].BusinessErrors),e(n.data.Message,1)),t.operating=!1},function(n){e(n.data.Message,2),t.operating=!1})},h=function(){i.UpdateListing(t.BusinessInfo).then(function(n){o(n.data);var i=n.data;i.Succeeded?(t.PostValidationErrors=null,e(n.data.Message,0),u.$broadcast('refershfindusbannerstatus')):i.Data&&(i.Data.Errors&&i.Data.Errors[0]&&(t.PostValidationErrors=i.Data.Errors[0].BusinessErrors),e(n.data.Message,1)),t.operating=!1},function(n){e(n.data.Message,2),t.operating=!1})},t.$watch("BusinessInfo.Country",function(n){n&&i.GetBusinessStateData(n).then(function(n){t.StateOptions=n.data.Data})}),t.$watch("BusinessInfo.Categories",function(n){n&&(t.selectedBusinessCatgory={Id:n.PrimaryCategory.BPCategoryId,Value:n.PrimaryCategory.CategoryName},t.$applyAsync(),t.categoryValidateHandler())}),t.$on('findus:message',function(n,i){t.message=i.message,t.messageType=Smb.FindUsMessageType[i.messageType].toLowerCase(),$(document.getElementById("flyout")).scrollTop(0)}),t.$on("$destroy",function(){}),t.CloseMessageBar=function(){t.message=null},t.Cancel=function(){t.$emit('closeFlyout'),t.$destroy()},t.CloseFlyout=function(){t.$emit('closeSmbFlyout'),t.$destroy()}}return t.$inject=['$scope','FindUsService',"CompanyProfileService","$rootScope","$window"],t}();n.FindUsInfoDetailController=t,n.app&&n.app.controller("FindUsInfoDetailController",t)})(Admin||(Admin={}));var Admin;(function(n){var t=function(){function n(n,t,i,r,u){var e=this;this.$scope=n,this.$q=t,this.$filter=i,this.findUsService=r,this.companyProfileService=u,n.Processing=!1,n.ShowError=!1,n.Published=!1,n.PublishError=!1;var f=function(){n.ShowError=!0,n.Processing=!1},o=function(t){var i=e.$q.defer();n.ShowRefresh=!1;switch(t.BusinessStatus){case 3:n.Published=!0,n.PublishError=!1,h().then(function(){i.resolve()});break;case 4:case 1:n.Published=!1,n.PublishError=!0,s(t.QualityIssues),i.resolve();break;case 2:case 0:n.Published=!1,n.PublishError=!1;var u=+new Date,f=+new Date(t.PublishDate),r=(f-u)/36e5;n.PublishDate=undefined,r>0&&(n.PublishDate=Math.round(r)),i.resolve()}return i.promise},s=function(t){n.PublishIssue=undefined,t&&t.length&&(n.PublishIssue=t[0].IssueType)},h=function(){return n.AnalyticsData=[],r.GetFindUsAnalyticsData().then(function(t){var u=t.data;if(u&&u.Succeeded){var e=u.Data[0],o=i('orderBy')(e.BusinessStatisticsList,"-BusinessStatStartTime"),r=undefined;angular.forEach(o,function(t){var u=new Date(parseInt(t.BusinessStatStartTime.toString().replace(/\/Date\((.*?)\)\//gi,"$1"))),f;r||(f=new Date,r=new Date(u.getFullYear(),u.getMonth(),u.getDate()+7),r>f&&(r=f)),n.AnalyticsData.push({ImpressionCount:t.ImpressionCount,Start:u.toLocaleDateString(),End:r.toLocaleDateString()}),r=u})}else f()},function(){f()})};n.GetBusinessStatusInfo=function(){n.Processing=!0,r.GetBusinessStatusInfo().then(function(t){var i=t.data;i&&i.Succeeded?o(i.Data[0]).then(function(){n.Processing=!1}):f()},function(){f()})},n.GetBusinessStatusInfo()}return n.$inject=['$scope','$q','$filter','FindUsService','CompanyProfileService'],n}();n.FindUsWidgetController=t,n.app&&n.app.controller("FindUsWidgetController",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return function(n,t,i){if(!n)return'';if((t=parseInt(t,10),!t)||n.length<=t)return n;if(n=n.substr(0,t),i){var r=n.lastIndexOf(' ');r!==-1&&((n.charAt(r-1)==='.'||n.charAt(r-1)===',')&&(r=r-1),n=n.substr(0,r))}return n+'\u2026'}}n.app.filter("cuttext",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return function(n,t,i,r){var u=n||'',f;return r=r||'_self',t=t||'#',i=i||'',f="<a target="+r+" href="+t+" ng-click="+i+">",u=u.replace('<a>',f)}}n.HyperLinkFilterFilter=t,n.app&&n.app.filter('hyperLink',t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return function(n){var i,u,t;console.log(n);var f=10,r=3,o=7,e=undefined;if(!n)return'';if(i=n.toString().trim().replace(/^\+/,''),i.match(/[^0-9]/))return n;i.length>f&&(i=i.substring(0,f)),u=undefined,t=undefined;switch(i.length){case 1:case 2:case 3:u=i;break;default:u=i.slice(0,r),t=i.slice(r)}return t?(t=t.length>r?t.slice(0,r)+'-'+t.slice(r,o):t,(e?e+' ':'')+('('+u+') '+t).trim()):'('+u}}n.TextNumberFilter=t,n.app&&n.app.filter("textNumberFilter",t)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;function t(){return function(n,t){var i=undefined;return n&&angular.forEach(n,function(n){n.ColumnName.toLowerCase()===t.toLowerCase()&&(i=n.ErrorMessage)}),i}}n.FindUsBusinessErrorFilter=t,n.app&&n.app.filter("findusBusinessError",t)})(Admin||(Admin={}));function ToggleSubscriptionDetails(n){$(".selectedNav").removeClass("selectedNav"),$(".selectedSub").removeClass("selectedSub").animate({opacity:"hide",left:"+30"},250,function(){$("#sub_"+n).addClass("selectedSub").animate({opacity:"show",left:"0"},250)}),$("#nav_"+n).addClass("selectedNav")}function SetupCommitmentBar(n,t,i,r,u){var f,p,c,e,l;try{if(f=500,!u)return;ShowHideLegendSections(0,0,0,u);var h=0,s=0,o=0;if(i>=r?(h=r,$("#totalUsers_"+u).html(i),$("#currentOverageLabel_"+u).html("0"),$("#currentOveragePriceTotalLabel_"+u).html("$0"),$("#savingsText_"+u).hide(),i>r&&(o=i-r,$("#currentAvailableLabel_"+u).html(o)),$("#currentCommittedLabel_"+u).html(i)):(h=i,s=r-i,$("#totalUsers_"+u).html(r),$("#currentOverageLabel_"+u).html(s),$("#savingsText_"+u).show(),$("#currentCommittedLabel_"+u).html(i)),$("#newCommitmentTotal_"+u).val()!=""&&(e=Math.round($("#newCommitmentTotal_"+u).val()*100)/100,$("#currentCommitmentPriceTotalLabel_"+u).html("$"+e.toFixed(2))),$("#newOverageTotal_"+u).val()!=""&&(c=Math.round($("#newOverageTotal_"+u).val()*100)/100,$("#currentOveragePriceTotalLabel_"+u).html("$"+c.toFixed(2))),$("#montlyBillTotal_"+u).val()!=""&&$("#newCommitmentTotal_"+u).val()!=""){e=+$("#newCommitmentTotal_"+u).val()+ +$("#newOverageTotal_"+u).val(),l=Math.round(e*100)/100,$("#monthlyBillTotal_"+u).html("$"+l.toFixed(2));var a=$("#withinCommitmentCostPerUser_"+u).val(),v=r*a,y=e-v;$("#savingTotal_"+u).html("$"+y.toFixed(2))}if(ShowHideLegendSections(h,s,o,u),$(n).removeClass(),$(n).css("width",f),$(t).removeClass(),$(t).hide(),i==0&&r==0){$(n).addClass("usageBarEmpty");return}if(i>0&&r==0){$(n).addClass("usageBarAvailable");return}if(i==0&&r>0){$(n).addClass("usageBarOverage");return}i>0&&r>0&&(i>r?($(n).addClass("usageBarAvailable"),$(n).css("width",Math.round((i-r)/i*f)),$(t).addClass("usageBarInUse"),$(t).show(),$(t).css("width",Math.round(r/i*f))):($(n).addClass("usageBarInUse"),$(n).css("width",Math.round(i/r*f)),$(t).addClass("usageBarOverage"),$(t).show(),$(t).css("width",Math.round((r-i)/r*f))))}catch(w){}}function ShowHideLegendSections(n,t,i,r){n>0?($("#usedHeadingDiv_"+r).show(),$("#usedUserTotalDiv_"+r).show(),$("#usedUserPriceDiv_"+r).show(),$("#usedUserCountDiv_"+r).show()):($("#usedHeadingDiv_"+r).hide(),$("#usedUserTotalDiv_"+r).hide(),$("#usedUserPriceDiv_"+r).hide(),$("#usedUserCountDiv_"+r).hide()),t>0?($("#additionalHeadingDiv_"+r).show(),$("#additionalUserTotalDiv_"+r).show(),$("#additionalUserPriceDiv_"+r).show(),$("#additionalUserCountDiv_"+r).show()):($("#additionalHeadingDiv_"+r).hide(),$("#additionalUserTotalDiv_"+r).hide(),$("#additionalUserPriceDiv_"+r).hide(),$("#additionalUserCountDiv_"+r).hide()),i>0?($("#availableHeadingDiv_"+r).show(),$("#availableUserCountDiv_"+r).show()):($("#availableHeadingDiv_"+r).hide(),$("#availableUserCountDiv_"+r).hide())}function GetSubscriptionPrice(n){Microsoft.Online.BOX.Admin.UI.Commerce.CommerceAjax.GetAetherSubscriptionPrice(n,this.GetPriceCallBack,this.GetPriceCallBack)}function GetLineItemPrice(n,t,i){try{Microsoft.Online.BOX.Admin.UI.Commerce.CommerceAjax.GetPrice(n,t,i,this.GetPriceCallBack,this.GetPriceCallBack)}catch(r){}}function GetPriceCallBack(n){try{if(n!=null&&n.length>=2&&n.ErrorType==null){var t=n[0],i=n[1];i!=null&&i!=''&&($("#priceloading_"+t).hide(),$("#price_"+t).prepend(i),$("#priceterm_"+t).show(),n[2]!=null)}}catch(r){}}function ToggleAutoRenew(n,t){(toggleClientId="AutoRenewToggle_"+n,toggleProcessing!=!0&&ToggleSwitch.GetState(toggleClientId)!=ToggleSwitch.WaitingState)&&(toggleProcessing=!0,toggleOldState=ToggleSwitch.GetState(toggleClientId),subVersion=$('#SubVersion_'+n).val(),autoRenewOn=$('#AutoRenewOn_'+n).val(),ToggleSwitch.SetState(toggleClientId,ToggleSwitch.WaitingState),Microsoft.Online.BOX.Admin.UI.Commerce.CommerceAjax.ToggleAutoRenew(autoRenewOn,subVersion,n,t,ToggleAutoRenewCallBack,ToggleAutoRenewCallBack))}function ToggleAutoRenewCallBack(n){toggleProcessing!=!1&&(typeof n!='undefined'&&n!=null&&n.length>0?n.ErrorType==null?(toggleOldState!=ToggleSwitch.OnState?(ToggleSwitch.SetState(toggleClientId,ToggleSwitch.OnState),$('#AutoRenewOn_'+n[0]).val("true")):(ToggleSwitch.SetState(toggleClientId,ToggleSwitch.OffState),$('#AutoRenewOn_'+n[0]).val("false")),$('#SubVersion_'+n[0]).val(n[1]),n.length>=3&&!(typeof n[2]=="undefined"||n[2]==null||n[2]=='')&&$('#statustext_'+n[0]).html(n[2])):(ToggleSwitch.SetState(toggleClientId,toggleOldState),ProcessErrorArgs(n)):(ToggleSwitch.SetState(toggleClientId,toggleOldState),ProcessErrorArgs(n)),toggleProcessing=!1)}function ShowHideAddOns(n){addOnsDivClientId="#addons_"+n,$(addOnsDivClientId).is(":visible")?($("#addonschevron_"+n).removeClass("wf-portal-upchevron").addClass("wf-portal-downchevron"),$(addOnsDivClientId).slideUp("fast")):($("#addonschevron_"+n).removeClass("wf-portal-downchevron").addClass("wf-portal-upchevron"),$(addOnsDivClientId).slideDown("fast",function(){try{ResizeTo($("#sub_"+n).height())}catch(t){}}))}function EditSubDropDown_ClientChange(n,t,i,r){n.value=="POR"?(UpdateLocalPane('EditPartner',!1,t,'&offerIds='+i,r),n.selectedIndex=0):n.value=="SUA"?(UpdateLocalPane('EditServiceUsageAddress',!0,t,'',r),n.selectedIndex=0):n.value=="VAT"?(UpdateLocalPane('EditServiceUsageAddress',!0,t,'',r),n.selectedIndex=0):n.value=="CANCEL"?(top.location.href="/Commerce/Cancel.aspx?subid="+t,n.selectedIndex=0):n.value=="CANCELWARNING"&&(UpdateLocalPane('CancelWarning',!0,t,'&offerIds=',r),n.selectedIndex=0)}function DeleteHardening_ClientClick(n,t){return DialogManager.showUrl("/Commerce/ConfirmDelete.aspx?id="+n+"&accept="+t,"",function(n){n==DialogManager.positiveConfirmation&&window.location.reload()},"width: "+(t?"700px":"550px")),!1}function ResizeIframe(n){var t,r,i;iframeHeight=parent.document.documentElement.clientHeight,t=parent.document.getElementById('ContainerFrame'),t!=null&&(iframeHeight-=t.offsetTop,t.style.height=iframeHeight+"px",r=parent.document.documentElement.clientWidth,r-=t.offsetLeft,n&&(i=parent.document.getElementsByClassName('viewport'),i&&i.length>0&&i[0].style.width!=''&&(r=i[0].style.width)),t.style.width=r+"px")}function ResizeTo(n){parent.document.getElementById('ContainerFrame').style.height=n<iframeHeight?iframeHeight+50+"px":n+50+"px"}function GetBalanceDue(){for(var u=$('span[data-BalanceDue-OrderId]'),n=[],i,f,r,t=0;t<u.length;t++)i=$(u[t]).attr('data-BalanceDue-OrderId'),i&&$.inArray(i,n)<0&&n.push(i);for(f=function(n){n&&n.OrderId&&n.BalanceDue&&$('span[data-BalanceDue-OrderId ="'+n.OrderId+'"]').text(n.BalanceDue)},r=0;r<n.length;r++)$.ajax({url:"/admin/api/billing/balance-due?orderId="+encodeURIComponent(n[r]),success:f,dataType:"json"})}function GetPaymentDetails(){for(var u=$('p[data-PaymentInstrumentDetailsOrderId]'),n=[],i,f,r,t=0;t<u.length;t++)i=$(u[t]).attr('data-PaymentInstrumentDetailsOrderId'),i&&$.inArray(i,n)<0&&n.push(i);for(f=function(n){if(n&&n.OrderId){var r=$('p[data-PaymentInstrumentDetailsOrderId ="'+n.OrderId+'"]');n.CreditCardImageUrl&&$("img",r).attr("src",n.CreditCardImageUrl),n.CreditCardImageTitle&&$("img",r).attr("title",n.CreditCardImageTitle),n.PaymentInstrumentDetails&&$("span",r).text(n.PaymentInstrumentDetails)}},r=0;r<n.length;r++)$.ajax({url:"/admin/api/commerce/order/"+encodeURIComponent(n[r])+"/payment-instrument",success:f,dataType:"json"})}var toggleOldState=null,toggleProcessing=!1,toggleClientId=null,iframeHeight;function SubscriptionQuantityValidation(){var n=$("#licenseQuantityBox"),t;n!=null&&(t=n.val(),VerifyLicenseQuantity(t))}function CommitmentQuantityValidation(){var n=$("#commitmentsBox"),t;n!=null&&(t=n.val(),VerifyCommitmentQuantity(t))}function IsInteger(n){return licenseQuantityValidationContext.test(String(n))&&$.isNumeric(n)&&Math.floor(n)==+n?!0:!1}function IsNumber(n){return floatValidationContext.test(String(n))?!0:!1}function VerifyCommitmentQuantity(n){var c;try{var f=$("#errorMsgLabMaxLimitError"),e=$("#errorMsgLabInvalidQuantity"),o=$("#errorMsgLabMinLimitError"),i=$("#submitButton"),nt=$("#newCommitmentDetails"),k=$("#subCurrentCommitmentQuantity"),b=$("#subMaxCommitmentQuantity"),s=k.val();if(f.hide(),e.hide(),o.hide(),i.removeAttr("disabled"),IsInteger(n)){var h=parseInt(n),g=parseInt(s),y=parseInt(b.val());if(h<s)o.show(),i.attr("disabled","disabled");else if(h>y)f.show();else{var w=$("#unitPriceInCommitment"),p=$("#unitPriceOverCommitment"),d=$("#commitmentSubscriptionId"),a=d.val(),l=w.val(),v=p.val(),t=0,u=0,r=0;n>=a?(t=n*l,u=t):(t=n*l,u=t,r=(a-n)*v,t+=r),$("#newInCommitmentCharge").val(u),$("#newOverCommitmentCharge").val(r),c=$("#newSubTotal"),c.text("$"+t.toFixed(2)),$("#newCommitmentTotal_"+subidValue).val().toFixed(2)}}else e.show(),i.attr("disabled","disabled")}catch(tt){}}function VerifyLicenseQuantity(n){var p=$("#newPriceDetails-loading"),nt=$("#newPriceDetails"),f=$("#errorMsgLabMaxLimitError"),a=$("#errorMsgLabInvalidQuantity"),r=$("#errorMsgLabMinLimitError"),st=$("#purchasedQuantity"),e=$("#reviewPanel"),s=$("#increaseQuantityReviewDetails"),h=$("#decreaseQuantityReviewDetails"),c=$("#submitSuccessMsg"),ot=$("#assignedQuantity"),et=$("#subMinQuantity"),l=$("#subMaxQuantity"),ft=$("#versionid"),ut=$("#vatid"),ct=$("#sua"),it=$("#subid"),t=$("#submitButton"),tt=$("#isQuickStart"),v=tt.val(),ht=it.val(),g=ut.val(),d=ct.val(),k=ft.val(),b=ot.val(),w=st.val(),u;if(f.hide(),a.hide(),r.hide(),t.removeAttr("disabled"),IsInteger(n))if(v.length>0&&v=="True")parseInt(n)>parseInt(l.val())?(f.show(),t.attr("disabled","disabled")):parseInt(n)>0?r.hide():(r.show(),t.attr("disabled","disabled"));else{var i=parseInt(n),o=parseInt(w),lt=parseInt(b),y=parseInt(et.val()),rt=parseInt(l.val());i<y?(r.show(),t.attr("disabled","disabled")):i>rt?(f.show(),t.attr("disabled","disabled")):(i<o?(e.show(),s.hide(),h.show(),u='Done\x21 We updated your total. Any credit related to your reduction in user licenses will show up on your next bill.',c.text(u)):i>o?(e.show(),s.show(),h.hide(),u='Done\x21 We updated your total.',c.text(u)):(e.hide(),t.attr("disabled","disabled")),nt.hide(),p.show(),$.ajax({data:{subId:ht,additionalQuantity:String(i-o),sua:d,vatid:g,subVersionId:k},url:"../LocalPane/UpdateCartPrice",success:function(n){updatePrice(n)}}))}else a.show(),t.attr("disabled","disabled")}function updatePrice(n){var t=$("#newSubTotal"),i=$("#newPriceDetails-loading"),r=$("#newPriceDetails");n!=""&&(t.text(n),i.hide(),r.show())}function EditQuantity_ChangeQuantity(n){var i=$("#licenseQuantityBox");if(i!=null&&i.attr('disabled')!='disabled')if(IsInteger(i.val())){var r=parseInt(i.val()),t=r,u=$("#isQuickStart");u.val().length>0&&u.val()=="True"?VerifyLicenseQuantity(t):(n==0?(t=r-1,t>=0?i.val(t):t=0):n==1&&(t=r+1,i.val(t)),VerifyLicenseQuantity(t))}else VerifyLicenseQuantity(i.val())}function EditQuantity_SubmitChange(){var w=$("#submitRequest-loading"),v=$("#licenseQuantityBox"),a=$("#versionid"),l=$("#vatid"),c=$("#sua"),h=$("#subid"),p=$("#purchasedQuantity"),e=$("#submitButton"),o=e.attr('disabled'),i;if(typeof o!=typeof undefined&&o!==!1)return!1;e.attr("disabled","disabled");var t=h.val(),f=l.val(),u=c.val(),r=a.val(),n=parseInt(v.val()),y=p.val(),s=parseInt(y);w.show(),i=$("#isQuickStart"),i.val().length>0&&i.val()=="True"?$.ajax({data:{subId:t,additionalQuantity:String(n),sua:u,vatid:f,subVersionId:r},url:"../LocalPane/SubmitQuantityChange",success:function(i){submitChangeQuantityCallback(i,t,n)}}):$.ajax({data:{subId:t,additionalQuantity:String(n-s),sua:u,vatid:f,subVersionId:r},url:"../LocalPane/SubmitQuantityChange",success:function(i){submitChangeQuantityCallback(i,t,n)}})}function submitChangeQuantityCallback(n){n==""?($("#submitErrorMsg").hide(),$("#submitSuccessMsg").show(),$("#needReload").val("1")):($("#submitSuccessMsg").hide(),$("#submitErrorMsg").text(n),$("#submitErrorMsg").show(),$("#needReload").val("0")),$("#loadingRow").hide(),$("#upsell-loadingRow").hide(),$("#actionRow").hide(),$("#localPaneReview").hide(),$("#editQuantitySubmitResultRow").show(),$("#closeButtonRow").show()}function InvoiceMatch_SubmitRequest(){var i,f,s;$("#loadingRow").show(),$("#loadingRow").focus(),$("#invoiceMatchSubmitResultRow").hide(),$("#submitErrorMsg").hide();var rt=$("#submitRequest-loading"),y=$("#datepicker"),tt=$("#paymentmethoddropdown"),v=$("#paymentmethoddropdown option:selected"),a=$("#checkNoTextBox"),l=$("#otherTextArea"),c=$("#submitButton"),nt=$("#orderId"),g=$("#checkKeyString"),o=$("#paidAmountTextBox"),e=$("#invoiceNoTextBox"),d=$("#currencydropdown"),b=$("#currencydropdown option:selected"),r=HtmlEncode(o.val()),u=HtmlEncode(y.val()),k=HtmlEncode(v.val()),it=HtmlEncode(a.val()),n,p=g.val(),t,w=b.val(),h=HtmlEncode(e.val());if(v.val()==p?(n=it,t="1"):(n="",t="0"),r.trim()=="")$("#submitSuccessMsg").hide(),$("#loadingRow").hide(),$("#submitErrorMsg").text($("#NoPaidAmountErrorString").val()),$("#submitErrorMsg").show(),$("#invoiceMatchSubmitResultRow").show(),$("#submitErrorMsg").focus();else if(IsNumber(r.trim()))if(u.trim()=="")$("#submitSuccessMsg").hide(),$("#loadingRow").hide(),$("#submitErrorMsg").text($("#NoPaymentDateErrorString").val()),$("#submitErrorMsg").show(),$("#invoiceMatchSubmitResultRow").show(),$("#submitErrorMsg").focus();else if(t=="1"&&n.trim()=="")$("#submitSuccessMsg").hide(),$("#loadingRow").hide(),$("#submitErrorMsg").text($("#NoCheckNoErrorString").val()),$("#submitErrorMsg").show(),$("#invoiceMatchSubmitResultRow").show(),$("#submitErrorMsg").focus();else if(h.trim()=="")$("#submitSuccessMsg").hide(),$("#loadingRow").hide(),$("#submitErrorMsg").text($("#NoInvoiceNoErrorString").val()),$("#submitErrorMsg").show(),$("#invoiceMatchSubmitResultRow").show(),$("#submitErrorMsg").focus();else{if(o.prop('disabled',!0),y.prop('disabled',!0),tt.prop('disabled',!0),a.prop('disabled',!0),d.prop('disabled',!0),e.prop('disabled',!0),l.prop('disabled',!0),i=c.attr('disabled'),typeof i!=typeof undefined&&i!==!1)return!1;c.attr("disabled","disabled"),f=HtmlEncode(l.val()),s=nt.val(),$.ajax({data:{orderId:s,paymentDate:u,paymentMethod:k,isCheck:t,number:n,others:f,paidAmount:r,invoiceNo:h,currency:w},url:"../LocalPane/SubmitInvoiceMatchRequest",success:function(n){submitInvoiceMatchCallback(n)},error:function(){submitInvoiceMatchErrorCallback()}})}else $("#submitSuccessMsg").hide(),$("#loadingRow").hide(),$("#submitErrorMsg").text($("#InvalidPaidAmountErrorString").val()),$("#submitErrorMsg").show(),$("#invoiceMatchSubmitResultRow").show(),$("#submitErrorMsg").focus()}function submitInvoiceMatchCallback(n){if(IsInteger(n)){var t=$("#successMsgTemplate").val();$("#submitSuccessMsg").text(String.format(t,n)),$("#submitErrorMsg").hide(),$("#submitSuccessMsg").show(),$("#submitSuccessMsg").focus()}else $("#submitSuccessMsg").hide(),$("#submitErrorMsg").text(n),$("#submitErrorMsg").show(),$("#submitErrorMsg").focus();$("#loadingRow").hide(),$("#actionRow").hide(),$("#invoiceMatchSubmitResultRow").show(),$("#closeButtonRow").show()}function submitInvoiceMatchErrorCallback(){$("#submitSuccessMsg").hide(),$("#submitErrorMsg").text($("#errorCallbackMsgTemplate").val()),$("#submitErrorMsg").show(),$("#submitErrorMsg").focus(),$("#loadingRow").hide(),$("#actionRow").hide(),$("#invoiceMatchSubmitResultRow").show(),$("#closeButtonRow").show()}function SubscriptionCommitments_SubmitChange(){var r=$("#submitRequest-loading"),u=$("#submitButton"),n=u.attr('disabled');if(typeof n!=typeof undefined&&n!==!1)return!1;var t=$("#subid").val(),f=$("#commitmentsBox"),i=parseInt(f.val());r.show(),$.ajax({data:{subID:t,commitment:i},url:"../LocalPane/SubmitSubscriptionCommitmentsChange",success:function(n){submitSubscriptionCommitmentsCallback(n,i,t)}})}function submitSubscriptionCommitmentsCallback(n,t,i){var u,r,f,e;$("#newCommitmentTotal_"+i).val($("#newInCommitmentCharge").val()),$("#newOverageTotal_"+i).val($("#newOverCommitmentCharge").val()),n==""&&($("#errorMsgLabMinLimitError").hide(),$("#errorMsgLabMaxLimitError").hide(),$("#errorMsgLabInvalidQuantity").hide(),$("#actionButtonRow").hide(),$("#submitRequest-loading").hide(),$("#succeedMsg").show(),$("#closeButtonRow").show()),u="#currentCommitment_",r=$(u+i),typeof r!="undefined"&&r.text()!==null&&r.text()!==""&&r.text(t),$("#newCommitment_"+i).val(t),$("#commitmentChanged_"+i).val("true"),f=$("#currentAssigned_"+i),e=f.val(),SetupCommitmentBar("#statusBarOne_"+i,"#statusBarTwo_"+i,t,e,i)}function UpdatePayment3ds(){Microsoft.Online.BOX.JS.PaymentCollectionSuccess.SaveMtPiid(Microsoft.Online.BOX.JS.Shared.GetSessionCookie("3dsUpdatePaymentAccountId"),Microsoft.Online.BOX.JS.Shared.GetSessionCookie("3dsUpdatePaymentPiid"),!1),Microsoft.Online.BOX.JS.Shared.ClearSessionCookie("3dsUpdatePaymentAccountId"),Microsoft.Online.BOX.JS.Shared.ClearSessionCookie("3dsUpdatePaymentPiid"),Microsoft.Online.BOX.JS.Shared.ClearSessionCookie("3dsUpdatePaymentSubscription"),Microsoft.Online.BOX.JS.Shared.ClearSessionCookie("3dsUpdatePaymentNewPortal");var n=$("#submitButton");PaymentMethodSelector.GetCreditCardEditLinkVisibility()&&($("#submit-loading").show(),$("#CreditCardEditLink").hide(),$("#CreditCardRemoveLink").hide(),submitButtonClicked=!0,SubmitChange())}function PaymentMethodSubmitButton_ClientClick(){var n=$("#Piid"),r=$("#submitButton"),t=$("#PaymentTypeDropDown"),i=$("#CreditCardRemoveLink");if($('#editPaymentMethodNotificationDiv').hide(),submitButtonClicked)return!1;$("#errorPanel").hide(),$("#submit-loading").show(),r.attr("disabled","disabled"),submitButtonClicked=!0,typeof n!="undefined"&&n.val()!==null&&n.val()!==""?(t.length>0&&t.attr("disabled","disabled"),i.length>0&&i.hide(),PaymentMethodSelector.GetCreditCardEditLinkVisibility()?($("#CreditCardEditLink").hide(),SubmitChange()):PaymentMethodSelector.CTPIframeSubmitCreditCard()):SubmitChange()}function SubmitChange(){var ft=$("#orderId"),ut=$("#vatId"),rt=$("#version"),it=$("#subscriptionid"),tt=$("#reactivate"),nt=$("#PurchaseOrder"),d=$("#TenantId"),k=$("#EndDate"),b=$("#isTrial"),w=$("#NewPOTextBoxInvoice"),e="",y=ft.val(),p=ut.val(),o=rt.val(),r=it.val(),l=tt.val(),f=nt.val(),c=d.val(),h=k.val(),g=b.val(),i="",u=$("#isSwitchAll").prop("checked"),t,n,s,a,v;typeof u=='boolean'||(u=!1),t=$("#reactRenew").val()==null?"":$("#reactRenew").val(),n=PaymentMethodSelector.GetSelectedPaymentMethodType(),n&&(n.toLowerCase()=="creditcard"||n.toLowerCase()=="directdebit")&&(i=PaymentMethodSelector.GetOcpPiid()),i==""&&(f=w.val(),s=getSUAEditArgs('NewBillingAddressSheet','Invoice','','','','',''),e=s.address),g=="0"?($("#errorPanel").hide(),a=PaymentMethodSelector.GetOcpPiid(),v=PaymentMethodSelector.GetMtPiid(),$.ajax({data:{subId:r,orderId:y,vatId:p,subVersionId:o,reactive:l,piid:i,purchaseOrderId:f,tenantId:c,endDate:h,serializedAddress:e,reactRenew:t,isSwitchAll:u,selectedOcpPiid:a,selectedMintPiid:v},url:"../LocalPane/SubmitPaymentDetailsChange",success:function(n){submitChangeCallback(n,r)}})):$.ajax({data:{subId:r,orderId:y,vatId:p,subVersionId:o,reactive:l,piid:i,purchaseOrderId:f,tenantId:c,endDate:h,serializedAddress:e,reactRenew:t},url:"../LocalPane/SubmitExtendTrialChange",success:function(n){submitChangeCallback(n,r)}})}function submitChangeCallback(n){if($("#submit-loading").hide(),$("#needReload").val("0"),$("#CreditCardEditLink").hide(),submitButtonClicked=!1,n==""){$("#errorPanel").hide(),$("#actionButtonPanel").hide(),$("#successPanel").show(),$("#successLabel").show(),$("#closeButtonPanel").show(),$("#CreditCardIFrame").length>0&&($("#CreditCardIFrame").hide(),$("#PaymentTypeDropDown").attr("disabled","disabled")),expiringCallback!=undefined&&expiringCallback();var i=$("#deepLinkAction").val();i==""&&$("#needReload").val("1")}else $("#actionButtonPanel").show(),$("#successPanel").hide(),$("#errorLabel").text(n),$("#errorPanel").show(),$("#closeButtonPanel").hide(),$("#submitButton").removeAttr("disabled")}function EditPartner_CheckPartnerId(){var t=$("#partnerIdTextBox"),u=$("#hiddenIsPartnerScenario"),f=$("#hiddenOfferIds"),i=$("#checkIdReuqest-loading"),r=$("#submitButton"),n;if($("#closeButtonRow").hide(),typeof t!="undefined"&&t.val()!==null){if(n=t.val().trim(),n.length==0){$("#partnerIdTextBox").focus();return}i.show(),partnerIdValiddationContext.test(String(n))&&$.isNumeric(n)&&Math.floor(n)==+n?$.ajax({data:{partnerId:n,isPartnerScenario:u.val(),offerIds:f.val()},url:"../LocalPane/PartnerIdServerValidation",success:function(t){EditPartnerCheckIdCallback(t,n)}}):(i.hide(),$("#serverValidationErrorMsg").hide(),$("#actionButtonsRow").hide(),$("#succeedMsg").hide(),$("#jsValidationErrorMsg").show(),$("#closeButtonRow").hide(),r.attr("disabled","disabled"))}else i.hide(),$("#succeedMsg").hide(),$("#serverValidationErrorMsg").hide(),$("#jsValidationErrorMsg").show(),$("#closeButtonRow").hide(),r.attr("disabled","disabled");$("#actionButtonsRow").show()}function EditPartnerCheckIdCallback(n,t){var i="|"+t,r=$("#submitButton");$("#checkIdReuqest-loading").hide(),$("#submitSuccessMsg").hide(),n.indexOf(i)>=0?(n=n.replace(i,""),$("#serverValidationErrorMsg").hide(),$("#jsValidationErrorMsg").hide(),$("#closeButtonRow").hide(),$("#succeedMsg").text(n),$("#succeedMsg").show(),$("#submitButton").removeAttr("disabled")):($("#succeedMsg").hide(),$("#jsValidationErrorMsg").hide(),$("#serverValidationErrorMsg").val(n),$("#serverValidationErrorMsg").show(),$("#closeButtonRow").hide(),r.attr("disabled","disabled")),$("#actionButtonsRow").show()}function EditPartner_SubmitChange(){var t=$("#submitButton"),f=t.attr('disabled'),n;if(typeof f!=typeof undefined&&f!==!1)return!1;$("#submitErrorMsg").hide();var i=$("#partnerIdTextBox"),o=$("#hiddenIsPartnerScenario"),s=$("#hiddenSubId"),h=$("#hiddenVersion"),r=$("#submitReuqest-loading"),e=$("#bulkAddCheckBox"),u=!1;e.length>0&&(u=e.is(':checked')),typeof i!="undefined"&&i.val()!==null?(n=i.val().trim(),r.show(),t.attr("disabled","disabled"),n==""||partnerIdValiddationContext.test(String(n))&&$.isNumeric(n)&&Math.floor(n)==+n?$.ajax({data:{partnerId:n,isPartnerScenario:o.val(),subId:s.val(),version:h.val(),isBulkAdd:u?'1':'0'},url:"../LocalPane/SubmitPartnerChange",success:function(t){EditPartnerSubmitCallback(t,u,n)}}):(r.hide(),$("#serverValidationErrorMsg").hide(),$("#actionButtonsRow").hide(),$("#succeedMsg").hide(),$("#jsValidationErrorMsg").show(),$("#closeButtonRow").hide(),t.attr("disabled","disabled"),$("#actionButtonsRow").show())):(r.hide(),$("#succeedMsg").hide(),$("#serverValidationErrorMsg").hide(),$("#jsValidationErrorMsg").show(),$("#closeButtonRow").hide(),t.attr("disabled","disabled"),$("#actionButtonsRow").show())}function EditPartnerSubmitCallback(n,t,i){if($("#submitReuqest-loading").hide(),$("#serverValidationErrorMsg").hide(),$("#jsValidationErrorMsg").hide(),$("#succeedMsg").hide(),t&&i.trim()!="")$("#containerPanel").hide(),$("#footerPanel").hide(),$("#bulkAddResultPanel").show(),$("#bulkAddResultLable").html(n);else if(n==""){var r=$("#hiddenSubId"),u=r.val();$("#actionButtonsRow").hide(),$("#submitErrorMsg").hide(),$("#submitSuccessMsg").show(),$("#closeButtonRow").show()}else $("#actionButtonsRow").show(),$("#submitButton").removeAttr("disabled"),$("#closeButtonRow").hide(),$("#submitSuccessMsg").hide(),$("#submitErrorMsg").val(n),$("#submitErrorMsg").show()}function EditServiceUsageAddress_SubmitChange(n,t,i,r,u,f){var y=$("#ServiceUsageAddressSheet_ServiceUsagePostalCodeRegexValidator_err_popupTable"),v=$("#ServiceUsageAddressSheet_ServiceUsageVatIDCustomValidator6031_err_popupTable"),a=$("#ServiceUsageAddressSheet_ServiceUsageVatIDCustomValidator6027_err_popupTable"),h,s,l,u,f;if(y.length>0&&y.is(':visible')||v.length>0&&v.is(':visible')||a.length>0&&a.is(':visible')||(h=$("#submitButton"),s=h.attr('disabled'),typeof s!=typeof undefined&&s!==!1))return!1;$("#submit-loading").show(),h.attr("disabled","disabled");var p=$("#hiddenIsEUCountry").val(),e=getSUAEditArgs(n,t,i,r,u,f,p),o=$("#hiddenOrderId"),w=$("#hiddenTaxIdType"),b=$("#"+u),k=$("#"+f),c;c=o.length>0&&o.val()!='undefined'&&o.val()!=''&&w.val()=='True'?e.businessId:e.taxId,l=$('#updateAllOrderCheckBox').attr('checked')?$('#hiddenAllOrderIds').val():$('#hiddenCurrentOrderId').val(),b.length>0&&(u=e.cstINTaxId),k.length>0&&(f=e.vatINTaxId),$.ajax({data:{orderIds:l,sua:e.address,taxId:c,cstINTaxId:u,vatINTaxId:f},url:"../LocalPane/SubmitUpdateSUA",success:function(n){EditSUASubmitCallback(n)}})}function getSUAEditArgs(n,t,i,r,u,f,e){var v=AddressPropertySheet.GetSheet(n).GetAddress(),y=AddressPropertySheet.GetSheet(n).TaxIdIsValid,o={},s,h,c,l,a;return o.addressObj=v,o.address=Sys.Serialization.JavaScriptSerializer.serialize(v),s=$("#"+i),h=$("#hiddenCountryCode").val(),s.length>0&&(o.taxId=s.val().trim().toUpperCase(),o.taxId.length>2&&e==='1'&&o.taxId.toUpperCase().substring(0,2)!=h.toUpperCase()&&(o.taxId=h+o.taxId)),c=$("#"+r),c.length>0&&(o.businessId=c.val().trim()),o.taxIdIsValid=y,l=$("#"+u),l.length>0&&(o.cstINTaxId=l.val().trim()),a=$("#"+f),a.length>0&&(o.vatINTaxId=a.val().trim()),o}function EditSUASubmitCallback(n){if($("#submit-loading").hide(),n==""){var t=$("#hiddenSubId"),i=t.val();$("#errorPanel").hide(),$("#actionButtonPanel").hide(),$("#successLabel").show(),$("#successPanel").show(),$("#closeButtonPanel").show()}else $("#successPanel").hide(),$("#errorLabel").text(n),$("#errorLabel").show(),$("#errorPanel").show(),$("#closeButtonPanel").hide(),$("#submitButton").removeAttr("disabled")}function ClickSwitchPlanButton(n,t){var i=$("#submitButton"),r=i.attr('disabled');if(typeof r!=typeof undefined&&r!==!1)return!1;if(typeof t!="undefined"&&t!=null&&t){$("#upsell-redirect-loading").show();try{Commerce.LogToServer(411824,1,"Product Family Transition - user has chosen the upsell path.")}catch(u){}}else $("#redirect-loading").show();i.attr("disabled","disabled"),$("#upgradeButton").attr("disabled","disabled"),$("#otherUpdateButton").attr("disabled","disabled"),window.top.location=n}function SettleBalanceSubmitButton_ClientClick(){var n=$("#Piid"),i=$("#submitButton"),t=$("#PaymentTypeDropDown");if(submitButtonClicked)return!1;$("#submit-loading").show(),i.attr("disabled","disabled"),submitButtonClicked=!0,n.val()!==null&&n.val()!==""?(t.length>0&&t.attr("disabled","disabled"),PaymentMethodSelector.GetCreditCardEditLinkVisibility()?($("#CreditCardEditLink").hide(),SettleBalance()):PaymentMethodSelector.CTPIframeSubmitCreditCard()):SettleBalance()}function SettleBalance(){var b=$("#orderId"),p=$("#vatId"),y=$("#version"),v=$("#subscriptionid"),a=$("#PurchaseOrder"),l=$("#TenantId"),c=$("#Piid"),h=$("#OMSPiid"),s=b.val(),o=p.val(),e=y.val(),t=v.val(),f=a.val(),u=l.val(),n="",r=c.val(),w=h.val(),i=PaymentMethodSelector.GetSelectedPaymentMethodType();i&&i.toLowerCase()=="creditcard"&&(n=PaymentMethodSelector.GetSelectedMtPiid()),n==""?(result='The pay now feature only supports subscriptions linked to a credit card.',SettleBalanceCallback(result,t)):$.ajax({data:{subId:t,orderId:s,vatId:o,subVersionId:e,piid:n,purchaseOrderId:f,tenantId:u,currentPiid:r,currentOMSPiid:w},url:"../LocalPane/SubmitSettleBalance",success:function(n){SettleBalanceCallback(n,t)}})}function SettleBalanceCallback(n){var i=n.split("|"),u=!1,r="",f;i.length>1&&(u=i[0]=="1",r=i[1]),$("#submit-loading").hide(),$("#needReload").val("0"),submitButtonClicked=!1,u?($("#paymentpane").hide(),$("#partialSettlementPane").hide(),$("#allsettlementpane").show(),$("#closeButtonPanel").show(),r==""?(f=$("#deepLinkAction").val(),f==""&&$("#needReload").val("1")):r=="pi"?($("#allSettledTitleLab").text('Sorry, there is a problem.'),$("#allSettledNotificationRow").hide(),$("#failedNotificationRow").show(),$("#failedActionRow").show(),$("#closeButtonRow").hide(),$("#failedRetryButton").attr("disabled","disabled"),i.length>3&&($("#paymentMethodLab").text(i[2]+i[3]),$("#piType").val(i[2]),$("#cardNumber").val(i[3]),$("#expirationDate").val(i[4]),$("#errorCode").val(i[5]))):($("#allSettledNotificationLab").text(r),$("#allSettledTitleLab").text('Sorry, there is a problem.'))):($("#paymentpane").hide(),$("#allsettlementpane").hide(),$("#partialSettlementNotificationRow").text(r),$("#partialSettlementPane").show())}function ContactedBank(){var i=$("#contactedBankCheckbox").prop("checked"),n=$("#failedRetryButton"),t=$("#retryButtonDiv");i?(t.removeClass("disabledbutton").addClass("actionbutton"),n.removeAttr("disabled")):(n.attr("disabled","disabled"),t.removeClass("actionbutton").addClass("disabledbutton"))}function Retry_ClientClick(){$("#paymentpane").hide(),$("#partialSettlementPane").hide(),$("#retryResultPane").hide(),$("#allsettlementpane").hide(),$("#retryPane").show(),$("#allSettledNotificationRow").show(),$("#failedNotificationRow").hide(),$("#failedActionRow").hide(),$("#failedRetryButton").attr("disabled","disabled"),$("#contactedBankCheckbox").prop('checked',!1)}function RetrySettleBalanceSubmitButton_ClientClick(){$("#retryPane").hide(),$("#paymentpane").hide(),$("#partialSettlementPane").hide(),$("#allsettlementpane").hide(),$("#retryResultPane").show()}function UpdatePaymentMethodForPartial_ClientClick(){$("#paymentpane").hide(),$("#partialSettlementPane").hide(),$("#allsettlementpane").hide(),$("#FlyoutLoadingGif").show();var n=$("#subscriptionid"),t=n.val();$("#LocalPaneHtmlContent").load("/LocalPane?actionString=SettleBalance&subid="+t+"&subscriptionCommitment=0&subscriptionAssignedQuantity=",function(){InitLocalPaneBody("SettleBalance")})}function UnbanPI_SubmitRequest(){$("#retry-loading").show(),$("#retryLoading").focus();var n=$("#retrySubmitButton"),i=$("#piType"),r=$("#cardNumber"),u=$("#expirationDate"),f=$("#errorCode"),e=$("#balanceId"),o=HtmlEncode(i.val()),s=HtmlEncode(r.val()),h=HtmlEncode(u.val()),c=HtmlEncode(f.val()),l=HtmlEncode(e.val()),t=n.attr('disabled');if(typeof t!=typeof undefined&&t!==!1)return!1;n.attr("disabled","disabled"),$.ajax({data:{paymentType:o,errorCode:c,cardNumber:s,expirationDate:h,balanceId:l},url:"../LocalPane/SubmitUnbanPIRequest",success:function(n){submitUnbanPICallback(n)}})}function submitUnbanPICallback(n){IsInteger(n)&&$("#referenceNumber").text(n),$("#retry-loading").hide(),RetrySettleBalanceSubmitButton_ClientClick()}function UpdateLocalPane(n,t,i,r,u,f,e){var s=u,h,c,l,o;expiringCallback=e,h=$("#commitmentChanged_"+i).val(),c=$("#newCommitment_"+i).val(),h=="true"&&(s=c),l="#messagepanel_"+i,o=$(l),o&&(o.text(''),o.hide()),InitializeLocalPane(),$("#LocalPaneHtmlContent").load("/LocalPane?actionString="+n+"&subid="+i+r+"&subscriptionCommitment="+s+"&subscriptionAssignedQuantity="+f,function(){InitLocalPaneBody(n)}),ShowLocalPane(t)}function InitializeLocalPane(){var i=$(window.parent.document),n,t,r;i&&(n=i.find("#ShellBodyAndFooterContainer"),n.length>0&&n.css({overflow:'hidden'})),t=$("#ShellBodyAndFooterContainer"),t.length>0&&t.css({overflow:'hidden'}),r=$("#ShellBodyAndFooterContainer").scrollTop(),$("#FlyoutContainer").css({top:r}),$("#LocalPaneHtmlContent").html("")}function onLocalPaneLoad(){$("#FlyoutLoadingGif").hide(),$("#FlyoutHtmlContent").hide(),$("#LocalPaneHtmlContent").fadeIn(250)}function InitLocalPaneBody(n){var h=$("#subid"),c=h.val(),t,i,e,r,u,f,o,s;onLocalPaneLoad(),n=="EditPaymentMethod"||n=="Reactivate"||n=="ExtendTrial"||n=="SettleBalance"?(t=$("#errorLabel"),t.length!=0&&(t.text()==null||t.text()==="")&&($("#errorPanel").hide(),$("#closeButtonPanel").hide(),i=$("#Piid"),i.length!=0&&i.val()!==null&&i.val()!==""?(e=$("#PaymentMethodSelectorControlSettings").val(),PaymentMethodSelector==null&&(PaymentMethodSelector=new O365.PaymentMethodSelector(Sys.Serialization.JavaScriptSerializer.deserialize(e))),PaymentMethodSelector.RefreshPaymentMethodList(),PaymentMethodSelector.SetCreditCardIFrameHeight(430)):(r=$("#hiddenCountryCode").val(),new AddressPropertySheet('NewBillingAddressSheet','Invoice',r,'false'),$("#ChangePaymentMethodDirectionDiv").hide(),$("#NewInvoiceDiv").show(),$("#NewCreditCardDiv").hide())),(n=="EditPaymentMethod"||n=="SettleBalance")&&Microsoft.Online.BOX.JS.Shared.GetSessionCookie("3dsUpdatePaymentSubscription")&&Microsoft.Online.BOX.JS.Shared.GetSessionCookie("3dsUpdatePaymentAccountId")&&Microsoft.Online.BOX.JS.Shared.GetSessionCookie("3dsUpdatePaymentPiid")&&($("#closeButtonPanel").show(),UpdatePayment3ds())):n=="EditServiceUsageAddress"?(r=$("#hiddenCountryCode").val(),new AddressPropertySheet('ServiceUsageAddressSheet','ServiceUsage',r,'false'),$("#errorPanel").hide(),$("#closeButtonPanel").hide()):n=="EditPartner"?$("#partnerIdTextBox").focus():n=="IncreaseQuantity"&&(u=$("#licenseQuantityBox"),f=$("#purchasedQuantity"),u!=null&&f!=null&&(o=u.val(),s=f.val(),o==s&&($("#reviewPanel").hide(),$("#submitButton").attr("disabled","disabled"))),$("#licenseQuantityBox").focus())}function ShowLocalPane(n){var t="400px";return n&&String(n)=="true"&&(t="640px"),ResetLocalPane(),ShowFlyout(t),!1}function ShowFlyout(n){var t=$("#FlyoutArea");t.length>0&&t.css({"overflow-X":"hidden","overflow-Y":"auto"}),$("#FlyoutArea").width(n),$("#FlyoutContainer").show(),$("#FlyoutArea").show(),$("#FlyoutArea").hasClass("FlyoutAreaStyle-rtl")?$("#FlyoutArea").animate({left:"0",transition:".25s"},400):$("#FlyoutArea").animate({right:"0",transition:".25s"},400),window.scrollTo(0,0)}function ResetLocalPane(){$("#FlyoutLoadingGif").show(),$("#FlyoutTitleLabel").empty(),$("#FlyoutTitleLine").hide()}function HideLocalPane(){return $("#FlyoutArea").hide(),$("#FlyoutContainer").hide(),$("#FlyoutTitleLabel").empty(),$("#FlyoutTitleLine").hide(),!1}function CloseLocalPane(){var n,r,u,f,o,t;submitButtonClicked=!1;var i=$("#deepLinkAction"),s=i.length>0?i.val():"",c=$("#defaultBillingPageUrl").val(),e="-"+$("#FlyoutArea").width(),h=$("#needReload").val();$("#LocalPaneHtmlContent").trigger('LocalPane.Close'),$("#LocalPaneHtmlContent").fadeOut(250),$("#FlyoutArea").hasClass("FlyoutAreaStyle-rtl")?$("#FlyoutArea").animate({left:e,transition:".25s"},400,HideLocalPane()):$("#FlyoutArea").animate({right:e,transition:".25s"},400,HideLocalPane()),$("#LocalPaneHtmlContent").html(""),n=!1,i.length>0&&s!=""&&(n=!0),r=$(window.parent.document),r&&(u=r.find("#ShellBodyAndFooterContainer"),u.length>0?u.css({overflow:'auto'}):(f=$("#ShellBodyAndFooterContainer"),f.length>0&&f.css({overflow:'auto'}))),PaymentMethodSelector!=null&&(PaymentMethodSelector=null),(h==="1"||n)&&($("#AetherLoading").show(),$("#viewportContainer").addClass("disabled"),$("#subscriptionsContainer a").click(function(n){n.preventDefault()}),$("#subscriptionsContainer a").removeAttr("onclick"),$("#subscriptionsContainer a").removeAttr("onkeydown"),o=$("#isNewAdmin").val(),t=$("#aetherUrl").val(),o==="1"?n?location.href="/AdminPortal/Home#"+t:$('#mainContentWrapper').load(t+"?adminportal=1&isReload=1"):location.href=t)}function ShowHideWizardButtons(n){n?EnableForm():DisableForm()}function EnableForm(){submitButtonClicked=!1,$("#submit-loading").hide(),$("#closeButtonPanel").hide(),$("#errorPanel").hide(),$("#actionButtonPanel").show(),$("#submitButton").removeAttr("disabled"),$("#removeCreditCardSubmitButton").removeAttr("disabled"),$("#removeCreditCardActionButtonPanel").hide(),$("#removeCreditCardConfirmlabel").hide();var n=$("#CreditCardUrlTemplate");n.length&&n.val()&&n.val().indexOf("CreditCard.fake")>=0&&$("#actionButtonPanel").hide()}function DisableForm(){submitButtonClicked=!0,$("#closeButtonPanel").hide(),$("#submitButton").attr("disabled","disabled")}function EnterKeyPressed(n,t,i){if(n&&(n.which&&n.which==13||n.keyCode&&n.keyCode==13||n.enterKey))if(i!==null)if(String(i).indexOf(",")>=0){var r=i.split(",");t(r[0],r[1],r[2],r[3],r[4],r[5])}else t(i);else t();return!1}function PopulateMethod(n){var t=$("#SubscriptionPicker_SubscriptionList option:selected");t.length>0&&UpdateLocalPane(n,!0,t.val(),'&showsp=1',0)}function PromptUserToConfirmTheRemoveAction(){return $("#CreditCardEditLink").hide(),$("#CreditCardRemoveLink").hide(),$("#actionButtonPanel").hide(),$("#isSwitchAllCheckBoxDiv").hide(),$("#removeCreditCardConfirmlabel").show(),$("#removeCreditCardActionButtonPanel").show(),$("#errorPanel").hide(),!1}function RemoveCreditCardButton_ClientClick(){$("#removeCreditCardSubmitButton").attr("disabled","disabled"),$("#PaymentTypeDropDown").attr("disabled","disabled"),$("#submit-loading").show(),RemoveCreditCard_SubmitChange()}function RemoveCreditCard_SubmitChange(){$("#errorPanel").hide();var n=$("#TenantId"),t=n.val(),i=PaymentMethodSelector.GetOcpPiid(),r=PaymentMethodSelector.GetMtPiid(),u;$.ajax({data:{tenantId:t,selectedOcpPiid:i,selectedPiid:r},url:"../LocalPane/SubmitRemovePaymentInstrumentChange",success:function(n){sbumitRemoveCreditCardCallback(n)}})}function sbumitRemoveCreditCardCallback(n){n==""?($("#submit-loading").hide(),$("#removeCreditCardNotificationPanel").show(),setTimeout(function(){$("#removeCreditCardNotificationPanel").hide(),$("#PaymentTypeDropDown").removeAttr("disabled"),PaymentMethodSelector.RefreshPaymentMethodList()},2e3)):($("#submit-loading").hide(),$("#errorLabel").html(n),$("#errorPanel").show(),$("#removeCreditCardCloseButtonPanel").show(),$("#removeCreditCardConfirmlabel").hide(),$("#removeCreditCardActionButtonPanel").hide(),$("#removeCreditCardSubmitButton").removeAttr("disabled"))}function RemoveCreditCardCancelButton_ClientClick(){$("#CreditCardEditLink").show(),$("#CreditCardRemoveLink").show(),$("#PaymentTypeDropDown").removeAttr("disabled");var n=PaymentMethodSelector.GetSelectedPaymentMethodType(),t=PaymentMethodSelector.GetIsSwitchAllCheckBoxVisibility();return n&&(n.toLowerCase()=="creditcard"||n.toLowerCase()=="directdebit")&&t&&$("#isSwitchAllCheckBoxDiv").show(),$("#CreditCardUrlTemplate").val().indexOf("CreditCard.fake")>=0?$("#actionButtonPanel").hide():$("#actionButtonPanel").show(),$("#removeCreditCardConfirmlabel").hide(),$("#removeCreditCardActionButtonPanel").hide(),$("#errorPanel").hide(),$("#removeCreditCardCloseButtonPanel").hide(),!1}function SelectPaymentMethod(){var r=$("#paymentmethoddropdown option:selected"),n=$("#checkNoPanel"),t=$("#paymentmethoddropdown").val(),i=$("#checkKeyString").val();t==i?n.length>=1&&n.show():n.length>=1&&n.hide()}function ShowHideProductIcons(n){var i=$("#producticons_"+n),t=$("#anchortext_"+n),r=$("#producticonschevron_"+n);i.is(":visible")?(r.removeClass("wf-portal-upchevron").addClass("wf-portal-downchevron"),i.slideUp("fast"),t.text(t.attr("data-show"))):(r.removeClass("wf-portal-downchevron").addClass("wf-portal-upchevron"),i.slideDown("fast"),t.text(t.attr("data-hide")))}function ShowInvoice(){try{Commerce.LogToServer(425890,1,"Customer skip change invoice to direct debit.")}catch(n){}$("#directDebitPromoPanel").hide(),$("#bodyPanel").show()}var licenseQuantityValidationContext=/^[0-9]+$/,partnerIdValiddationContext=/^\d+$/,floatValidationContext=/^-?\d*(\.\d+)?$/,PaymentMethodSelector,AddressPropertySheet,submitButtonClicked=!1,expiringCallback;jQuery(document).on('keyup',function(n){n.keyCode==27&&CloseLocalPane()});$(document).ready(function(){var n=$("#deepLinkAction"),t=$("#defaultSubId");n.length>0&&n.val()!=""&&(t.length>0&&t.val()!=""?n.val().toLowerCase()==='increasequantity'||n.val().toLowerCase()==='editpartner'?UpdateLocalPane(n.val(),!1,t.val(),'&showsp=0',0):UpdateLocalPane(n.val(),!0,t.val(),'&showsp=0',0):UpdateLocalPane(n.val(),!0,'','&showsp=1',0))});window.O365=window.O365||{},O365.PaymentMethodSelector=function(n){var pt=[None=0,Next=1,Finish=2],a=[],l=!1,rt=!1,h=function(){return $('#'+n.MtPiidClientID).val()},f=function(){return $("#"+n.PaymentMethodTypeClientID).val()},at=function(){var t=$('.PaymentMethodName'),n,r,i;if(t.length)for(n=0,r=t[0].options.length;n<r;n++)if(i=t[0].options[n],i.selected)return i;return null},ct=function(){var i=$('.PaymentMethodName'),n=null,t,r;if(i.length)for(t=0,r=i[0].options.length;t<r;t++)if(n=i[0].options[t],n.selected)break;return n&&(n.method==="enterprise_agreement"||n.method==="Invoice")?$("#EaPurchaseOrderTextBox").val():""},wt=function(){var r=$('#'+n.MtPiidClientID).val(),t,i,f,u;if(!r&&(t=$('.PaymentMethodName'),t.length))for(i=0,f=t[0].options.length;i<f;i++)if(u=t[0].options[i],u.selected){r=u.value;break}return r},st=function(t){return $('#'+n.MtPiidClientID).val(t)},ot=function(t){$('#'+n.OcpPiidClientID).val(t)},gt=function(){return $('#'+n.OcpPiidClientID).val()},it=function(i){var f,u,e,r,o,s,h;try{t("cpm_begin"),n.IsGemini||(f=$('#'+n.PaymentMethodAreaClientID),u=f.find('.PaymentMethodName [lastchecked="checked"]'),i.id=="PaymentMethodRadioButton"&&u.length!=0&&(i=u,i.attr("checked","checked"),i.value=u.attr('value')),u.length!=0&&u.attr("lastchecked",""),e=f.find('.PaymentMethodName input:radio:checked'),e.length!=0&&e.attr("lastchecked","checked")),r=$.data(i,"method"),$('#'+n.MtPiidClientID).val(r.PaymentId),$('#'+n.LightWeightPiidClientID).val(''),$('#'+n.OcpPiidClientID).val(r.OcpPiid),$('#'+n.PaymentMethodTypeClientID).val(r.Method),n.UsePidl||($('#'+n.CreditCardIframeClientID).unbind('load'),o=document.getElementById(n.CreditCardIframeClientID),o&&(o.src='')),i.value=='invoice'?(hi(),ApplyPlaceHolderBehaviour(),$('#PurchaseOrderTextBox_placeholder').css('left','8px')):r.Method=='Invoice'?ai():i.value=='lightweight'?ci(i):(s=!1,n.IsGemini&&n.PCSIframeEditLinkEnabled&&(s=i.value.length>2&&i.value!='inicis'&&(i.ocpGuid!='00000000-0000-0000-0000-000000000000'||n.IsModern)),h=$('#EaDiv'),h&&$('#EaDiv').hide(),p(s)),i.form&&i.form.BillingAddressSheet$InvoiceCountryCodeHidden&&document.getElementById("threedsInfoAlertBar")&&(n.IsGemini&&i.value=='0'&&i.form.BillingAddressSheet$InvoiceCountryCodeHidden.value.toLowerCase()==="in"&&document.getElementById("threedsInfoAlertBar")?document.getElementById("threedsInfoAlertBar").style.display="":n.IsGemini&&i.value!='0'&&i.form.BillingAddressSheet$InvoiceCountryCodeHidden.value.toLowerCase()==="in"&&document.getElementById("threedsInfoAlertBar")&&(document.getElementById("threedsInfoAlertBar").style.display="none")),PageLayout.ResizePanels(),$(window).trigger("resize"),t("cpm_end"),n.IsSwitchAllShown&&(r.Method=="CreditCard"||r.Method=="DirectDebit")?nt(!0):nt(!1)}catch(c){t("cpm_"+(c.message||c));throw c;}},ni=function(n){li(n)},ri=function(){n.CtpIframeSuccessCallback&&new Function(n.CtpIframeSuccessCallback+"();")()},ui=function(){n.CtpIframeGoBackCallback&&new Function(n.CtpIframeGoBackCallback+"();")()},ft=function(){n.CtpIframeCancelCallback&&new Function(n.CtpIframeCancelCallback+"();")()},ut=function(){n.CtpIframeSessionExpiredCallback&&new Function(n.CtpIframeSessionExpiredCallback+"();")()},oi=function(t){AddressPropertySheet.GetSheet(n.BillingAddressSheetClientID).SetAddress(Sys.Serialization.JavaScriptSerializer.deserialize(t))},hi=function(){n.ShowDDPromo&&launchDDPromo(),n.OnShowHideWizardNavigation&&new Function(n.OnShowHideWizardNavigation+"(true);")(),n.OnSelectWizardNavigationButton&&new Function(n.OnSelectWizardNavigationButton+"(PaymentMethodSelector.NavButtonSelection.Next);")(),$('#'+n.CreditCardContainerClientID).hide(),$('#'+n.LightWeightPaymentContainerClientID).hide(),i(!1),$('#'+n.InvoiceContainerClientID).show(),u(!0)},dt=function(){p(!1),n.OnShowHideWizardNavigation&&new Function(n.OnShowHideWizardNavigation+"(true);")(),n.OnSelectWizardNavigationButton&&new Function(n.OnSelectWizardNavigationButton+"(PaymentMethodSelector.NavButtonSelection.Next);")(),$('#'+n.CreditCardContainerClientID).hide(),$('#'+n.LightWeightPaymentContainerClientID).hide(),i(!1),document.getElementById('PaymentTypeLabel')&&(document.getElementById('PaymentTypeLabel').text='Volume licensing agreement'),$('#EaDiv').show()},ai=function(){p(!1),n.OnShowHideWizardNavigation&&new Function(n.OnShowHideWizardNavigation+"(true);")(),n.OnSelectWizardNavigationButton&&new Function(n.OnSelectWizardNavigationButton+"(PaymentMethodSelector.NavButtonSelection.Next);")(),$('#'+n.CreditCardContainerClientID).hide(),$('#'+n.LightWeightPaymentContainerClientID).hide(),i(!1),$('#EaDiv').show(),$('#EaPurchaseOrderTextBox')[0].style.cssText="width: 260px;"},ci=function(t){n.OnShowHideWizardNavigation&&new Function(n.OnShowHideWizardNavigation+"(false);")(),$('#'+n.CreditCardContainerClientID).hide(),$('#'+n.InvoiceContainerClientID).hide(),u(!1),$('#'+n.LightWeightPaymentLoadingClientID).show(),$('#'+n.LightWeightPaymentDetailsLabelClientID).hide(),$('#'+n.LightWeightPaymentContainerClientID).show(),i(!1);var r;r=n.IsGemini?t.attributes['data-lightweightPaymentInstrumentTypeId']:t.getAttribute('data-lightweightPaymentInstrumentTypeId'),r?$('#'+n.LightWeightPiidClientID).val(r):$('#'+n.LightWeightPiidClientID).val(''),Microsoft.Online.BOX.Admin.UI.Commerce.CommerceAjax.GetLightWeightPaymentDetail(r,function(t){$('#'+n.LightWeightPaymentDetailsLabelClientID).text(t),$('#'+n.LightWeightPaymentLoadingClientID).hide(),$('#'+n.LightWeightPaymentDetailsLabelClientID).show(),n.OnShowHideWizardNavigation&&new Function(n.OnShowHideWizardNavigation+"(true);")(),n.OnSelectWizardNavigationButton&&new Function(n.OnSelectWizardNavigationButton+"(PaymentMethodSelector.NavButtonSelection.Finish);")()})},p=function(t){var e=String.format(n.CtpIframeUrl,encodeURIComponent(h()));f().toLowerCase()=="directdebit"&&n.TenantId!=null?(e+=String.format("&tenantid={0}",encodeURIComponent(n.TenantId)),Commerce.LogToServer(424743,0,"Find tenant id for Direct debit payment.")):f().toLowerCase()=="directdebit"&&Commerce.LogToServer(424744,6,"No tenant id in the settings."),$('#'+n.InvoiceContainerClientID).hide(),$('#'+n.LightWeightPaymentContainerClientID).hide(),$('#'+n.CreditCardUrlParam).val(e),r(!1,!1),i(!1),u(!1),$('#'+n.CreditCardContainerClientID).show(),t&&n.IsGemini&&n.PCSIframeEditLinkEnabled?(n.OnShowHideWizardNavigation&&new Function(n.OnShowHideWizardNavigation+"(true);")(),r(!1,!0)):d()},si=function(){r(!0,!1),i(!1),u(!1),$('#'+n.PaymentMethodLoaderClientID).hide(),$('#'+n.CreditCardContainerClientID).show();var e=document.getElementById(n.CreditCardIframeClientID),f=String.format(n.CtpIframeUrl,"0"),t=null;n.GetServiceUsageAddressCallback&&(t=window[n.GetServiceUsageAddressCallback]()),t&&(f+="&"+$("<input name='billingAddress1'>").val(t.Line1||'').add($("<input name='billingAddress2'>").val(t.Line2||'').add($("<input name='billingCity'>").val(t.City||'').add($("<input name='billingState'>").val(t.State||'').add($("<input name='billingZipcode'>").val(t.PostalCode||''))))).serialize()),l=!0,e.src=f},o=function(t){var r=window.location.href.toLowerCase(),i=$("#CreditCardRemoveLink");r.indexOf("subscriptions")>-1&&i.length>0&&(t&&(f().toLowerCase()!="directdebit"||n.PCSIframeDirectDebitRemoveEnabled)?i.show():i.hide(),$("#removeCreditCardCloseButtonPanel").hide())},nt=function(n){var t=$("#isSwitchAllCheckBoxDiv");n?(t.show(),$("#isSwitchAll").prop("checked",!0)):(t.hide(),$("#isSwitchAll").prop("checked",!1))},d=function(){var u,c,f,e,o;if(r(!1,!1),l=!0,n.OnShowHideWizardNavigation&&new Function(n.OnShowHideWizardNavigation+"(false);")(),n.OnSelectWizardNavigationButton&&new Function(n.OnSelectWizardNavigationButton+"(PaymentMethodSelector.NavButtonSelection.None);")(),u=null,n.GetServiceUsageAddressCallback&&(u=new Function("return "+n.GetServiceUsageAddressCallback+"();")()),u&&$('#'+n.CreditCardPostParams).val(Sys.Serialization.JavaScriptSerializer.serialize({billingAddress1:u.Line1?u.Line1:'',billingAddress2:u.Line2?u.Line2:'',billingCity:u.City?u.City:'',billingState:u.State?u.State:'',billingZipcode:u.PostalCode?u.PostalCode:''})),n.UsePidl)pidlControl.ShowSelectedPaymentMethod(h()),r(!0,!1),i(!0),PageLayout.ResizePanels();else{var a=null,y=new Date,v=!1;$('#'+n.CreditCardIframeClientID).load(function(){a=new Date,v||(ht(y,a,"pfrl"),v=!0,setTimeout(function(){rt||(n.IsGemini?Commerce.LogToServer(407104,6,"PCS Iframe failed to fully load in the alloted time.  This may be due to a relogin request."):Commerce.LogToServer(408017,6,"Non-Gemini PCS Iframe failed to fully load in the alloted time"))},n.PCSIframeLoadThreshold)),r(!0,!1),i(!0),PageLayout.ResizePanels()}),c="/Commerce/PaymentCollection.aspx?Url="+n.CreditCardUrlParam+"&Params="+n.CreditCardPostParams,t("cpm_"+c),f=document.getElementById(n.CreditCardIframeClientID),f.src=c;try{e=typeof f.document!="undefined"&&f.document!=null?f.document:typeof f.contentDocument!="undefined"&&f.contentDocument!=null?f.contentDocument:f.contentWindow.document,o=0,function p(){setTimeout(function(){o<10&&(t("cpm_readystate_"+o+"_"+e.readyState),o++,p())},1e3)}()}catch(w){s("cpm_iframeDocAccessErr_"+(w.message||w))}}},ei=function(){var t,i,f,o,r,u;try{n.OnShowHideWizardNavigation&&new Function(n.OnShowHideWizardNavigation+"(false);")(),$('#'+n.PaymentMethodLoaderClientID).show(),$('#'+n.PaymentMethodAreaClientID).hide(),n.IsGemini&&$('#'+n.PaymentMethodTemplateClientID).hide(),PageLayout.ResizePanels(),t=null,n.IsModern&&n.GetModernAPIParamsCallback&&(t=new Function("return "+n.GetModernAPIParamsCallback+"();")()),t?(i=t.country,i||(i=AddressPropertySheet.GetSheet(n.BillingAddressSheetClientID).CountryCode),f=t.amount,o=t.offerid,Microsoft.Online.BOX.Admin.UI.Commerce.CommerceAjax.ListEligiblePaymentInstrumentsModern(i,f,o,e)):n.ListCreditCardsOnly?Microsoft.Online.BOX.Admin.UI.Commerce.CommerceAjax.ListCreditCards(n.PCSIframeDirectDebitEnabled,e):(r=new Function("return "+n.GetCartInformationCallback+"();")(),u=!1,n.HideLightWeightCallBack&&(u=new Function("return "+n.HideLightWeightCallBack+"();")()),Microsoft.Online.BOX.Admin.UI.Commerce.CommerceAjax.ListEligiblePaymentMethods(r.TotalValue,r.Frequency,u,Sys.Serialization.JavaScriptSerializer.serialize(r.OcpCart),n.IWUserId,e))}catch(h){s("rpm_"+(h.message||h));throw h;}},fi=function(n){a=n},u=function(n){for(var i,t=0;t<a.length;t++)i=document.getElementById(a[t]),i&&(n||BaseValidator.HideAllCallouts(!0),i.enabled=n!=!1,ValidatorUpdateDisplay(i))},e=function(i){var e,w,h,u,r,l,a,v,y,p,k;try{if(t("upm_begin"),$('#'+n.PaymentMethodLoaderClientID).hide(),e=$('#'+n.PaymentMethodAreaClientID),w=$('#'+n.PaymentMethodTemplateClientID),n.ListCreditCardsOnly||$('#'+n.CreditCheckRequiredContainerClientID).hide(),n.IsGemini){if(h=$('.PaymentMethodName'),h&&h.length==1&&i&&i.Methods.length>0){var o=0,c=!1,f=h[0].options,b=!1;for(f.length=i.Methods.length,u=0;u<f.length;u++)r=i.Methods[u],f[u].text=r.Name,f[u].value=r.PaymentId,f[u].ocpGuid=r.OcpPiid,$.data(f[u],"method",r),r.Method&&(f[u].method=r.Method),r.Method=="enterprise_agreement"&&(b=!0),!c&&parseInt(r.IsDefault)&&(o=u),r.PaymentId=='invoice'||r.PaymentId=='lightweight'||c?r.PaymentId=='lightweight'&&(f[u].attributes['data-lightweightPaymentInstrumentTypeId']=r.LightWeightPaymentInstrumentTypeId):n.SelectedPiid!=''?(c=!1,$.trim(r.PaymentId)==$.trim(n.SelectedPiid)&&(o=u)):(c=!0,o=u),r.Method==n.InvoiceWithCreditCheck&&$('#'+n.CreditCheckRequiredContainerClientID).show();f[o].selected=!0,it(f[o]),b?dt():(l=document.getElementById('EaPoValidator_val'),l&&(l.enabled=!1))}e.show(),w.show()}else e.show(),e.empty(),p=0,$.each(i.Methods,function(){var t=this,i;p++,i=$("<div>"+function(n){return n('$i'+p,w,[function(n){$(n).find('.PaymentMethodName label').text(t.Name)},function(n){t.LearnMore&&t.LearnMore!="null"&&t.LearnMore!=""?($(n).find('.PaymentMethodLearnMore').attr('href',t.LearnMore),$(n).find('.PaymentMethodLearnMore').show()):$(n).find('.PaymentMethodLearnMore').hide()},function(n){var i=$(n).find('.PaymentMethodName input:radio');i.ocpGuid=t.OcpPiid,i.val(t.PaymentId),t.PaymentId=='lightweight'&&$(n).find('.PaymentMethodName input:radio').attr('data-lightweightPaymentInstrumentTypeId',t.LightWeightPaymentInstrumentTypeId)}])}(function(n,t,i){return $(t).clone(!1).each(function(){$(this).find('*[id]').andSelf().each(function(){$(this).attr('id',$(this).attr('id')+n)}),$(this).find('*[for]').andSelf().each(function(){$(this).attr('for',$(this).attr('for')+n)});var t=this;$.each(i,function(){this(t)})}).html()})+"</div>"),i.find('.PaymentMethodName input:radio').each(function(){$.data(this,"method",t)}),e.append(i),t.Method==n.InvoiceWithCreditCheck&&$('#'+n.CreditCheckRequiredContainerClientID).show(),t.PaymentId==$('#'+n.MtPiidClientID).val()&&(v=e.find('.PaymentMethodName input:radio:last').attr('id')),!parseInt(t.IsDefault)||t.PaymentId=='invoice'||(y=e.find('.PaymentMethodName input:radio:last').attr('id'))}),a=e.find('.PaymentMethodName input:radio:first').attr('id'),v?Button.Click(v):y?Button.Click(y):a&&Button.Click(a),k=e.find('.PaymentMethodName input:radio:checked'),k.attr("lastchecked","checked");PageLayout.ResizePanels(),$(window).trigger("resize"),t("upm_end")}catch(d){s("upm_"+(d.message||d));throw d;}i.AlertMessage&&i.AlertMessage!=''&&DialogManager.alertText(BOX.JS.IconType.info,'',i.AlertMessage,function(){})},ii=function(){return $('#'+n.CreditCardEditLinkClientID).is(':visible')},ti=function(){return n.IsSwitchAllShown},r=function(t,i){t?($('#'+n.CreditCardEditLinkClientID).hide(),o(!1),$('#'+n.CreditCardLoaderClientID).hide(),$('#'+n.CreditCardIframeClientID).show()):i?($('#'+n.CreditCardEditLinkClientID).show(),o(!0),$('#'+n.CreditCardLoaderClientID).hide(),$('#'+n.CreditCardIframeClientID).hide()):($('#'+n.CreditCardEditLinkClientID).hide(),o(!1),$('#'+n.CreditCardIframeClientID).hide(),$('#'+n.CreditCardLoaderClientID).show())},i=function(t){n.EnableCurrencyExchangeNotice&&(t?$('#'+n.CurrencyExchangeNoticeClientID).show():$('#'+n.CurrencyExchangeNoticeClientID).hide())},k=function(t){if(rt=!0,n.CtpIframeUrl.indexOf("CreditCard.fake")>=0)$('#'+n.CreditCardIframeClientID).height(310);else if(n.IsGemini)$('#'+n.CreditCardIframeClientID).height(parseInt(t));else{var i=t.indexOf('height=');t=t.substring(i+7),$('#'+n.CreditCardIframeClientID).height(parseInt(t)+n.CtpIframeHeightBuffer)}typeof PageLayout!='undefined'&&PageLayout.ResizePanels()},kt=function(){$('#'+n.PurchaseOrderNumberOrMemo).val($('#PurchaseOrderTextBox').val())},li=function(t){var i,r;if($('#'+n.MtPiidClientID).val()==='')t(!0);else if($('#'+n.InvoiceContainerClientID).is(':hidden'))t(!0);else{if(i=$('#'+n.CreditCheckRequiredContainerClientID).is(':hidden'),!i&&(r=lt(n.CreditCheckRequiredCheckboxClientID,'Credit check approval required','A credit check is required for an order of this amount. Accept the credit check approval or select a different payment method.'),!r)){t(!1);return}bt().ValidateAddress(function(i){n.OnBillingAddressValidationComplete&&(new Function(n.OnBillingAddressValidationComplete+"("+i+");")(),t(i))})}},bt=function(){return AddressPropertySheet.GetSheet(n.BillingAddressSheetClientID)},lt=function(n,t,i){return document.getElementById(n).checked?!0:(DialogManager.alertText(BOX.JS.IconType.error,t,i),!1)},et=function(t){$('#'+t).appendTo($('#'+n.PaymentMethodTemplateClientID))},t=function(n){O365.recordClientInfo&&O365.recordClientInfo(n)},s=function(n){O365.recordClientError&&O365.recordClientError(n)},ht=function(n,t,i){O365.recordClientTime&&O365.recordClientTime(n,t,i)},w=function(t){var i=t;t==null&&(t='null'),n.IsGemini?t=='20'||t=='60010'?Commerce.LogToServer(302659,1,"Payment collection - relogin required.  This may not actually prompt the user unless they select to view the iframe. :"+t):t=='20'||t=='11'||t.startsWith('80')||Commerce.LogToServer(302655,6,"Error in Payment collection:"+t+" IsGemini: "+n.IsGemini):t=='20'||t=='60010'?Commerce.LogToServer(408073,1,"Error in Payment collection - relogin required:"+t):t=='20'||t=='11'||t.startsWith('80')||Commerce.LogToServer(408074,6,"Error in Payment collection:"+t+" IsGemini: "+n.IsGemini)},y,b,v;if(n.UsePidl)y=function(){pidlControl.Submit()};else if(n.IsGemini){"JSON"in window&&window.JSON||(JSON={}),function(){function i(n){return n<10?"0"+n:n}function o(n){return e.lastIndex=0,e.test(n)?'"'+n.replace(e,function(n){var t=s[n];return typeof t=="string"?t:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+n+'"'}function u(i,f){var c,l,s,a,v=n,h,e=f[i];e&&typeof e=="object"&&typeof e.toJSON=="function"&&(e=e.toJSON(i)),typeof t=="function"&&(e=t.call(f,i,e));switch(typeof e){case"string":return o(e);case"number":return isFinite(e)?String(e):"null";case"boolean":case"null":return String(e);case"object":if(!e)return"null";if(n+=r,h=[],Object.prototype.toString.apply(e)==="[object Array]"){for(a=e.length,c=0;c<a;c+=1)h[c]=u(c,e)||"null";return s=h.length===0?"[]":n?"[\n"+n+h.join(",\n"+n)+"\n"+v+"]":"["+h.join(",")+"]",n=v,s}if(t&&typeof t=="object")for(a=t.length,c=0;c<a;c+=1)l=t[c],typeof l=="string"&&(s=u(l,e),s&&h.push(o(l)+(n?": ":":")+s));else for(l in e)Object.hasOwnProperty.call(e,l)&&(s=u(l,e),s&&h.push(o(l)+(n?": ":":")+s));return s=h.length===0?"{}":n?"{\n"+n+h.join(",\n"+n)+"\n"+v+"}":"{"+h.join(",")+"}",n=v,s}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+i(this.getUTCMonth()+1)+"-"+i(this.getUTCDate())+"T"+i(this.getUTCHours())+":"+i(this.getUTCMinutes())+":"+i(this.getUTCSeconds())+"Z"},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n,r,s={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},t;typeof JSON.stringify!="function"&&(JSON.stringify=function(i,f,e){var o;if(n="",r="",typeof e=="number")for(o=0;o<e;o+=1)r+=" ";else typeof e=="string"&&(r=e);if(t=f,f&&typeof f!="function"&&(typeof f!="object"||typeof f.length!="number"))throw new Error("JSON.stringify");return u("",{"":i})}),typeof JSON.parse!="function"&&(JSON.parse=function(n,t){function r(n,i){var f,e,u=n[i];if(u&&typeof u=="object")for(f in u)Object.hasOwnProperty.call(u,f)&&(e=r(u,f),e!==undefined?u[f]=e:delete u[f]);return t.call(n,i,u)}var i;if(f.lastIndex=0,f.test(n)&&(n=n.replace(f,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(n.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return i=eval("("+n+")"),typeof t=="function"?r({"":i},""):i;throw new SyntaxError("JSON.parse");})}(),$(function(){function n(){window.OnPCSMessage&&window.removeEventListener("message",window.OnPCSMessage),window.addEventListener?window.addEventListener("message",c,!1):window.attachEvent&&window.attachEvent("onmessage",c),window.OnPCSMessage=c}n()});function c(n){var i="";'domain'in n&&(i=n.domain),'origin'in n&&(i=n.origin);var t=$.parseJSON(n.data),r=t.type?t.type:"",u=$.parseJSON(t.data);r=='message'?vt(u):r=='api_return'&&yt(u)}function vt(t){t.method=="pcs_onerror"?tt(t.errorcode):t.method=="pcs_onheightchange"?(k(t.height),$(window).trigger("resize")):t.method=="pcs_onsuccess"?window.Microsoft.Online.BOX.JS.PaymentCollectionSuccess.SaveMtPiid(t.accountid,t.piid,!0):t.method=="pcs_onnavigationrequired"&&(t.redirecturl.toLowerCase().startsWith('https://pmservices.cp.microsoft-int.com')||t.redirecturl.toLowerCase().startsWith('https://pmservices.cp.microsoft.com'))?window.top.location=t.redirecturl:t.method=='pcs_onpagerenderednotify'&&(t.errorcode&&t.errorcode!=""?tt(t.errorcode):n.OnShowHideWizardNavigation&&new Function(n.OnShowHideWizardNavigation+"(true);")())}function yt(n){v[n.method]&&v[n.method](n)}v={ValidateResult:function(){},NextCallback:function(t){n.OnShowHideWizardNavigation&&(t.Result=='invalid'?new Function(n.OnShowHideWizardNavigation+"(true);")():new Function(n.OnShowHideWizardNavigation+"(false);")())}};function g(t){var i=$('#'+n.CreditCardIframeClientID)[0].contentWindow;i.postMessage(t,'*')}b=function(){t("ctpvalidateinput_begin");var n={Method:"ValidateInput",Callback:"ValidateResult",Corelation:0},i=JSON.stringify(n);g(i),t("ctpvalidateinput_end")},y=function(){t("ctpsubmitcreditcard_begin");var n={Method:"Next",Callback:"NextCallback",Parameter:"",Corelation:0},i=JSON.stringify(n);g(i),t("ctpsubmitcreditcard_end")};function tt(t){w(t),n.OnShowHideWizardNavigation&&new Function(n.OnShowHideWizardNavigation+"(true);")(),t=='10'||t=='11'?ft():(t=='20'||t=='60010')&&l&&ut()}}return{GetCreditCardEditLinkVisibility:ii,GetSelectedMtPiid:h,SaveOcpPiid:ot,GetOcpPiid:gt,SaveMtPiid:st,GetMtPiid:wt,GetSelectedPaymentMethodType:f,RefreshPaymentMethodList:ei,ChangeMemoTextBox:kt,ChangePaymentMethod:it,OnPaymentSelectionComplete:ni,CtpIframeSuccessCallback:ri,CtpIframeGoBackCallback:ui,CtpIframeCancelCallback:ft,CtpIframeSessionExpiredCallback:ut,SetCreditCardIFrameHeight:k,SetBillingAddress:oi,SetInvoiceValidatorIds:fi,NavButtonSelection:pt,CTPIframeSubmitCreditCard:y,CTPIframeValidateInput:b,AppendToPaymentMethodTemplate:et,LoadCreditCardIframe:d,LogIFrameError:w,GetSelectedDropDownOption:at,GetEAPurchaseOrderNumber:ct,GetIsSwitchAllCheckBoxVisibility:ti,SMBLoadCreditCardIframe:si}};var ValidationRequest=function(){this.Data=null,this.Result=null,this.RequestId=0,this.IsActive=!1},AddressPropertySheet=function(n,t,i,r){var e={CountryCode:'CountryCode',FirstName:'FirstName',LastName:'LastName',Phone:'PhoneNumber',StreetAddressLine1:'Line1',StreetAddressLine2:'Line2',StreetAddressLine3:'Line3',StreetAddressLine4:'Line4',State:'State',City:'City',PostalCode:'PostalCode'},o=['TextBox','DropDownList','Hidden'],f=new ValidationRequest,u=new ValidationRequest,s=!0,y,p=function(){window.resizeTopDialogManagerInstance&&window.resizeTopDialogManagerInstance(),typeof PageLayout!='undefined'&&typeof PageLayout.ResizePanels=='function'&&PageLayout.ResizePanels()},w=function(i,r,u,f,e){var o=r(n),s,h;return!o.IsActive&&o.Result!=null&&o.Data===i?!0:((!o.IsActive||o.IsActive&&o.Data!==i)&&(s=n,o.Data=i,o.Result=null,h=++o.RequestId,o.IsActive=!0,typeof u!="undefined"&&u!=null?f(o.Data,u,function(i){var u=r(s),f,o;h==u.RequestId&&(u.Result=i,u.IsActive=!1,i&&i.Result&&i.Errors&&i.Errors.length&&(i.Errors.length>0&&i.Errors[0]==='6098'&&(f=n+'_'+t+"VatIDTextBox",o=$('#'+f),o[0].value='',$('#'+n+"_VatServiceUnavailableAlertBar").show()),i.Errors.length==0&&i.Result=='0'&&(i.Result='1')),e(i.Result))}):f(o.Data,function(i){var u=r(s),f,o;h==u.RequestId&&(u.Result=i,u.IsActive=!1,i&&i.Result&&i.Errors&&i.Errors.length&&(i.Errors.length>0&&i.Errors[0]==='6098'&&(f=n+'_'+t+"VatIDTextBox",o=$('#'+f),o[0].value='',$('#'+n+"_VatServiceUnavailableAlertBar").show()),i.Errors.length==0&&i.Result=='0'&&(i.Result='1')),e(i.Result))})),!1)},st=function(n){var t=!1,i=!1,r=!0;return function(n){return t=v(function(i){t=!0,n(i)}),i=a(function(t){t==='0'?WebTracking.TrackValidateVatFailure():s?WebTracking.TrackValidateVatSuccess():WebTracking.TrackValidateVatIndeterminate(),i=!0,n(t)}),t&&i}(function(u){r=r&&u&&u!="0",t&&i&&n(r)})},tt=function(t){var i=$('#'+n+"_ValidateTaxLoader");t?i.show():i.hide(),p()},ht=function(t){var i=$('#'+n+"_SaveTaxLoader");t?i.show():i.hide(),p()},v=function(n){return w(Sys.Serialization.JavaScriptSerializer.serialize(c()),function(){return f},null,Microsoft.Online.BOX.Admin.UI.Commerce.WebControls.AddressPropertySheet.ValidateAddress,n)},a=function(r){var c=n+'_'+t+"VatIDTextBox",f=$('#'+c),h,e,o;return f.length<=0||f.is(':hidden')||$.trim(f.val())===''?(u&&(u.Result=null),!0):(h=s,s=!0,e=f.val(),y=e,o=w(e,function(){return u},i,Microsoft.Online.BOX.Admin.UI.Commerce.WebControls.AddressPropertySheet.ValidateTaxIdentifier,r),o&&(s=h),o)},l=function(){var n=[];return u.Result&&u.Result.Errors&&(n=n.concat(u.Result.Errors)),f.Result&&f.Result.Errors&&(n=n.concat(f.Result.Errors)),n},k=function(){var n=!0,t;return(u.Result&&u.Result.Result&&(n=n&&u.Result.Result!="0"),f.Result&&f.Result.Result&&(n=n&&f.Result.Result!="0"),!n)?!1:(t=l(),t.length===0)},c=function(){var r={},u,f,s;for(u in e)for(r[e[u]]='',f=0;f<o.length;f++)s=$('#'+n+'_'+t+u+o[f]),$(s).length>0&&$(s).val()&&(r[e[u]]=$(s).val());return r.CountryCode=i,r},g=function(i){var u,f,s;for(u in e)for(f=0;f<o.length;f++)i[e[u]]&&($('#'+n+'_'+t+u+o[f]).val(i[e[u]]),r&&(s=$('#'+n+'_'+t+u+o[f]+'_placeholder'),s&&s.length>0&&s.text('')))},nt=function(){var n=h();y!==n&&u&&(u.Result=null)},h=function(){var i=n+'_'+t+'VatIDTextBox',r=$('#'+i);return r.val()},it=function(i){var r=n+'_'+t+'VatIDTextBox',u=$('#'+r);u.val(i)},rt=function(){var i=n+'_'+t+'BusinessIDTextBox',r=$('#'+i);return r.val()},ut=function(i){var r=n+'_'+t+'BusinessIDTextBox',u=$('#'+r);u.val(i)},ft=function(){var i=n+'_'+t+'CstINTaxIdTextBox',r=$('#'+i);return r.val()},et=function(i){var r=n+'_'+t+'CstINTaxIdTextBox',u=$('#'+r);u.val(i)},ot=function(){var i=n+'_'+t+'VatINTaxIdTextBox',r=$('#'+i);return r.val()},d=function(i){var r=n+'_'+t+'VatINTaxIdTextBox',u=$('#'+r);u.val(i)},b={ID:n,AddressType:t,CountryCode:i,TaxIdIsValid:s,ValidateSheet:st,SetVatIdLoaderVisibility:tt,SetVatIdSaverVisibility:ht,ValidateAddress:v,ValidateTaxId:a,GetErrors:l,GetResult:k,GetAddress:c,SetAddress:g,ResetTaxIdValidators:nt,GetTaxId:h,SetTaxId:it,GetBusinessId:rt,SetBusinessId:ut,GetCstINTaxID:ft,SetCstINTaxId:et,GetVatINTaxID:ot,SetVatINTaxId:d};return AddressPropertySheet.Sheets.push(b),b};AddressPropertySheet.Sheets=[],AddressPropertySheet.GetSheet=function(n){for(var t=0;t<AddressPropertySheet.Sheets.length;t++)if(AddressPropertySheet.Sheets[t].ID==n)return AddressPropertySheet.Sheets[t];return null};function SaveField(n,t){var i=document.getElementById(n);i!=null&&(i.value=t)}function GetQueryParam(n){n=n.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)","i"),t=i.exec(window.location.href);return t!=null?t[1]:null}function IsEmpty(n){var t=/^\s{1,}$/g;return n.value.length==0||n.value==null||n.value.search(t)>-1?!0:!1}function ShowOfferDetails(n,t){var i='width:550';DialogManager.showHtmlFromElement(n,t,null,i)}function CheckFastTrackEligiblility(n,t,i){var r=Number(t);return n.BaseOffers&&n.BaseOffers.foreach(function(n){n.IsEligibleForFastTrack=='1'&&(r=r+Number(n.AdditionalQuantity)),n.AddOns&&n.AddOns.foreach(function(n){n.IsEligibleForFastTrack=='1'&&(r=r+Number(n.AdditionalQuantity))})}),r>=Number(i)}function ValidatePromoCode(){var i,t,r,u,n;try{i=document.getElementById('PromoCodeTextBox'),i&&(t=$.trim(i.value),r=CartManager.Current.cart,t&&r&&t.length>0?Microsoft.Online.BOX.Admin.UI.Commerce.CommerceAjax.ValidatePromotionCode(Sys.Serialization.JavaScriptSerializer.serialize(r),HtmlEncode(t),ValidatePromotionCodeCallBack,ValidatePromotionCodeCallBack):(n=document.getElementById('PromosResultsLabel'),n&&(n.setAttribute("class","AssistiveTextAlert"),n.innerHTML='Promo code not valid',u=document.getElementById('LearnMoreHyperLinkDiv'),u&&(u.style.display='inline'))))}catch(f){n=document.getElementById('PromosResultsLabel'),n&&(n.setAttribute("class","AssistiveTextAlert"),n.innerHTML='Sorry, we can\x27t process your request right now.')}return!1}function AddCallingPlans(){var i=document.getElementById('AddCallingPlansCheckBox'),t,n;i&&i.checked?$('#callingDiv').show():(t=CartManager.Current.cart,n=1,t.BaseOffers&&$('#CallingPlans')&&$('#CallingPlans')[0].value.split(',').foreach(function(t){var i=CartManager.Current.FindBaseOffer(t);i&&(i.AdditionalQuantity=0,CartManager.Current.SetCartItem(i),$('#CallingOfferRepeater_ctl0'+n+'_CallingOfferQuantity')[0].value=0,EditCart.GetCart('GeminiPurchase').UpdateFields(),CartManager.Current._RaiseChangeEvent()),n++}),$('#callingDiv').hide(),$('#callingPlansCountWarning').hide())}function CheckCallingTotals(){var n;if($('#callingDiv')){var r=document.getElementById("callingDiv"),t=r.getElementsByTagName("input"),u=CartManager.Current.FindBaseOffer(document.getElementById("BaseCallingPlan").value).AdditionalQuantity,i=0;for(n=0;n<t.length;n++)t[n].name.search(/CallingOfferRepeater\$ctl0[0-9]\$CallingOfferQuantity$/)===0&&parseInt(t[n].value)&&(i+=parseInt(t[n].value));i>u?(DisableForm(),$('#callingPlansCountWarning').show()):(priceCalculated&&EnableForm(),$('#callingPlansCountWarning').hide())}}function AddAutoTopPlans(){var n=document.getElementById('SkypeAutoTopCheck');n&&n.checked?$('#autoTopDiv').show():$('#autoTopDiv').hide()}function RemovePromoCode(){var r=document.getElementById('RemoveHyperLink'),n,t,i;if(r&&(n=document.getElementById('PromoCodeTextBox'),n)){n.value="",n.disabled=!1,document.getElementById('ApplyPromoCodeButton').style.display='inline-block',r.style.display='none',document.getElementById('PromosResultsLabel').innerHTML="",CartManager.Current.cart.PromotionCodes=null,CartManager.Current._RaiseChangeEvent(),CartManager.Current._UpdateCartDetails(),t=document.getElementById('TieredDiscountRow'),t&&(t.style.display='none'),i=document.getElementById('TieredDiscountTotalRow'),i&&(i.style.display='none');var u=document.getElementById('DiscountRowTd1'),f=document.getElementById('DiscountRowTd2'),e=document.getElementById('TotalRowTd1'),o=document.getElementById('TotalRowTd2');u&&(u.style.paddingBottom='60px'),f&&(f.style.paddingBottom='60px'),e&&(e.style.paddingBottom='25px'),o&&(o.style.paddingBottom='25px')}}function SetupDynamicsLegalInfo(n,t){var i=n.toLowerCase().split(',');$(t).show(),CartManager.Current.AddListener(function(n){var r=!1;if(n.BaseOffers&&(n.BaseOffers.foreach(function(n){if(jQuery.inArray(n.OfferId.toLowerCase(),i)>=0){r=!0;return}}),r)){$(t).show();return}$(t).hide()})}function ShowLoadingControl(n,t){var i=$("#"+n);i&&i.show(),t&&window.top.DialogManager.getTopDialogInstance().resizeContentFrame()}var Commerce=function(){var n=function(){},t=!1;return n.CancelWizardWarning=function(n,i,r,u,f){return t?!0:(DialogManager.confirmHtml(BOX.JS.IconType.warn,i,r,function(i){i&&Object.getType(i)==Object.getType(DialogManager.positiveConfirmation)&&i==DialogManager.positiveConfirmation?(t=!0,Button.Click(n)):typeof RecoverFromCancel!='undefined'&&RecoverFromCancel()},u,f,!0),Button.DefaultButton=null,!1)},n.CancelWizardWarningWithRedirect=function(n,i,r,u,f){if(t)document.setTimeout(function(){document.location.assign(returnUrl)},0);else return DialogManager.confirmHtml(BOX.JS.IconType.warn,i,r,function(i){i&&Object.getType(i)==Object.getType(DialogManager.positiveConfirmation)&&i==DialogManager.positiveConfirmation?(t=!0,document.location=n):typeof RecoverFromCancel!='undefined'&&RecoverFromCancel()},u,f,!1),!1},n.SkipCancelWizardWarning=function(){t=!0},n.LogToServer=function(n,t,i){O365.Log&&Microsoft.Online.BOX.UI.ClientLogging.ClientLogService.LogToServerWithTagId(n,t,i,null,Microsoft.Online.BOX.JS.ClientLogService.ErrorCallback)},n.SetBillOverviewCookiesAndRedirect=function(n,t,i){n!=null&&n!=''&&Microsoft.Online.BOX.JS.Shared.SetSessionCookie("OrderDetails",n,"/"),t!=null&&t!=''&&Microsoft.Online.BOX.JS.Shared.SetSessionCookie("OrderId",t,"/"),window.top.location=i},n}();ValidatePromotionCodeCallBack=function(n){var y,t,v,a,l,i,u,r,p,w,c;if(n.ErrorType==null&&(y=document.getElementById('TieredDiscountPaymentHelp'),y&&(y.title=n.TieredDiscountPaymentHelp),t=document.getElementById('PromosResultsLabel'),t))if(t.innerHTML=n.PromoCodeValidationMessage,n.PromoCodeValid=='0')t.setAttribute("class","AssistiveTextAlert"),i=document.getElementById('LearnMoreHyperLinkDiv'),i&&(i.style.display='inline');else if(n.PromoCodeValid=='1'){v=[],v[0]=document.getElementById('PromoCodeTextBox').value,CartManager.Current.cart.PromotionCodes=v,CartManager.Current._RaiseChangeEvent(),CartManager.Current._UpdateCartDetails(),t.setAttribute("class",""),a=document.getElementById('PromoCodeTextBox'),a&&(a.disabled=!0),l=document.getElementById('RemoveHyperLink'),l&&(l.style.display='inline',document.getElementById('ApplyPromoCodeButton').style.display='none',i=document.getElementById('LearnMoreHyperLinkDiv'),i&&(i.style.display='none')),t.style.color='#24b24b';var h=document.getElementById('DiscountRowTd1'),s=document.getElementById('DiscountRowTd2'),o=document.getElementById('TotalRowTd1'),e=document.getElementById('TotalRowTd2'),f=document.getElementById('PaymentFrequencyAnnualRadioButton'),b=document.getElementById('TieredDiscountPaymentHelpDiv');n.IsTieredDiscount=='1'?(f&&(f.disabled='true',O365.Log.WriteLog(424777,O365.LogLevel.Info,O365.LogArea.Commerce,"Purchase offer with tiered discount promo code.")),b&&(b.style.display='table-caption'),h&&(h.style.paddingBottom='0px'),s&&(s.style.paddingBottom='0px'),o&&(o.style.paddingBottom='0px'),e&&(e.style.paddingBottom='0px'),u=document.getElementById('TieredDiscountLabel'),u&&(u.innerHTML=n.DiscountDetailMessage,u.style.display='inline'),r=document.getElementById('TieredDiscountOfferTermLabel'),r&&(r.innerHTML=n.OfferTerm,r.style.display='inline'),p=document.getElementById('TieredDiscountRow'),p&&(p.style.display='table-row'),w=document.getElementById('TieredDiscountTotalRow'),w&&(w.style.display='table-row'),c=document.getElementById('TieredDiscountTotalLabel'),c&&(c.innerHTML=n.DiscountSummaryMessage,c.style.display='inline')):(f&&(f.disabled='false',O365.Log.WriteLog(424778,O365.LogLevel.Info,O365.LogArea.Commerce,"Purchase offer without tiered discount promo code (user may remove tiered discount promo code before place order).")),h&&(h.style.paddingBottom='60px'),s&&(s.style.paddingBottom='60px'),o&&(o.style.paddingBottom='25px'),e&&(e.style.paddingBottom='25px'))}};var Utils;(function(n){var r,u,t,i;(function(n){n[n.PC=0]="PC",n[n.Mac=1]="Mac",n[n.WindowsPhone=2]="WindowsPhone",n[n.iPad=3]="iPad",n[n.iPhone=4]="iPhone",n[n.Android=5]="Android",n[n.Other=6]="Other"})(n.PlatformType||(n.PlatformType={})),r=n.PlatformType,function(n){n[n.IE=0]="IE",n[n.Edge=1]="Edge",n[n.Chrome=2]="Chrome",n[n.Firefox=3]="Firefox",n[n.Safari=4]="Safari",n[n.Other=5]="Other"}(n.BrowserType||(n.BrowserType={})),u=n.BrowserType,t=function(){function n(n,t,i){this.major=this.normalize(n),this.minor=this.normalize(t),this.build=this.normalize(i)}return n.prototype.compareTo=function(n){return this.major===n.major&&this.minor===n.minor&&this.build===n.build?0:this.major>n.major?1:this.major===n.major&&this.minor>n.minor?1:this.major===n.major&&this.minor===n.minor&&this.build>n.build?1:-1},n.prototype.toString=function(){return""+this.major+"_"+this.minor+"_"+this.build},n.prototype.normalize=function(n){if(typeof n=="number")return n;if(typeof n=="string"){var t=parseInt(n);return isNaN(t)?0:t}return 0},n}(),n.PlatformVersion=t,i=function(){function n(){this.platforms=[{keyword:"Windows NT",platformType:0},{keyword:"Windows XP",platformType:0},{keyword:"Macintosh",platformType:1},{keyword:"Windows Phone",platformType:2,pageName:"windows-phone"},{keyword:"iPad",platformType:3,pageName:"ipad"},{keyword:"iPhone",platformType:4,pageName:"iphone"},{keyword:"Android",platformType:5,pageName:"android-phone"}],this.browsers=[{keyword:"Edge",browserType:1},{keyword:"MSIE",browserType:0},{keyword:"Chrome",browserType:2},{keyword:"CriOS",browserType:2},{keyword:"Firefox",browserType:3},{keyword:"Safari",browserType:4}]}return n.prototype.getDeviceInfo=function(n){var e=n.toLowerCase(),r=this.platforms[0],u,i,f;return this.platforms.some(function(n){return e.indexOf(n.keyword.toLowerCase())!==-1?(r=n,!0):!1}),u=new t(0,0,0),r.platformType===1&&(i=/Mac OS X (\d+)(_|\.)(\d+)([_\.]?)(\d*)/i.exec(n),u=new t(i[1],i[3],i[5])),f=this.browsers[0],this.browsers.some(function(n){return e.indexOf(n.keyword.toLowerCase())!==-1?(f=n,!0):!1}),{platform:r,platformVersion:u,browser:f}},n}(),n.OfficeDeviceDetector=i})(Utils||(Utils={}));typeof Namespace!="undefined"&&Namespace!=null?Namespace.Register("Microsoft.Online.BOX.JS.PaymentCollectionSuccess"):(Microsoft=window.Microsoft||{},Microsoft.Online=Microsoft.Online||{},Microsoft.Online.BOX=Microsoft.Online.BOX||{},Microsoft.Online.BOX.JS=Microsoft.Online.BOX.JS||{},Microsoft.Online.BOX.JS.PaymentCollectionSuccess=Microsoft.Online.BOX.JS.PaymentCollectionSuccess||{}),Microsoft.Online.BOX.JS.PaymentCollectionSuccess=new function(){this.SaveMtPiid=function(n,t,i){SaveField&&n&&SaveField('AccountId',n),typeof PaymentMethodSelector!='undefined'&&t?PaymentMethodSelector.SaveMtPiid(t):SaveField&&t&&SaveField('MtPiid',t),Commerce.LogToServer(411079,0,"calling SavePaymentInstrument with response from PCS. AccountId: "+n+", mtPiid: "+t+", isGeminiPurchase: "+i),typeof i!="undefined"&&i!=null?Microsoft.Online.BOX.Admin.UI.Commerce.CommerceAjax.SavePaymentInstrument(n,t,i,this.SavePaymentInstrumentCallback,this.SavePaymentInstrumentCallback):Microsoft.Online.BOX.Admin.UI.Commerce.CommerceAjax.SavePaymentInstrument(n,t,this.SavePaymentInstrumentCallback,this.SavePaymentInstrumentCallback)},this.SavePaymentInstrumentCallback=function(n){if(Commerce.LogToServer(410168,0,"entered SavePaymentInstrumentCallback with piid: "+(n==null?"null":JSON.stringify(n))),n==null||typeof n!="string"){location=location.protocol+"//"+location.host+"/boxerror.aspx?ErrorCode=FailedToAddPaymentInstrument";return}var t=typeof PaymentMethodSelector!='undefined';t&&PaymentMethodSelector.SaveOcpPiid&&n?PaymentMethodSelector.SaveOcpPiid(n):SaveField&&n&&SaveField('Piid',n),t&&PaymentMethodSelector.CtpIframeSuccessCallback?PaymentMethodSelector.CtpIframeSuccessCallback():WizardNextClick&&WizardNextClick()}};var ToggleSwitch=function(){function n(){}return n.GetState=function(t){var u=document.getElementById(t+"_On"),i,r;return u!=null&&u.style.display!="none"?n.OnState:(i=document.getElementById(t+"_Off"),i!=null&&i.style.display!="none")?n.OffState:(r=document.getElementById(t+"_Waiting"),r!=null&&r.style.display!="none")?n.WaitingState:""},n.SetState=function(t,i,r){var u,f,e;r===undefined&&(r=!1),u=document.getElementById(t+"_On"),u!=null&&(i==n.OnState?(u.style.display="inline",r||u.getElementsByTagName("a")[0].focus()):u.style.display="none"),f=document.getElementById(t+"_Off"),f!=null&&(i==n.OffState?(f.style.display="inline",r||f.getElementsByTagName("a")[0].focus()):f.style.display="none"),e=document.getElementById(t+"_Waiting"),e!=null&&(e.style.display=i==n.WaitingState?"inline":"none")},n.OnKeyDown=function(){n.waitingForKey=!0},n.CheckKeyUp=function(t){return(n.waitingForKey=!1,t&&(t.which==13||t.keyCode==13)&&n.waitingForKey)?!0:!1},n.OnState="on",n.OffState="off",n.WaitingState="waiting",n.waitingForKey=!1,n}();var BOX;(function(n){var t;(function(t){var i=window.Button,f=function(){function n(n,t,i,r){this.x=n,this.y=t,this.width=i,this.height=r}return n}(),r,s,h,o,e,u;t.Bounds=f,r=function(n){return n+'px'},function(n){n[n.none=0]="none",n[n.info=1]="info",n[n.warn=2]="warn",n[n.error=3]="error",n[n.custom=4]="custom"}(t.IconType||(t.IconType={})),s=t.IconType,function(n){n[n.alert=0]="alert",n[n.confirm=1]="confirm",n[n.freeFormUrl=2]="freeFormUrl",n[n.freeFormHtml=3]="freeFormHtml"}(t.DialogType||(t.DialogType={})),h=t.DialogType,o=function(){function t(n,t,i,r,u){var f=this;this._dialogID=0,this._dialogType=0,this._zIndex=0,this._ignoredEventHandler=null,this._startDragDropHandler=null,this._dragMoveHandler=null,this._endDragDropHandler=null,this._isIFrameMode=!1,this._learnMoreEnabled=!1,this._footerEnabled=!1,this._previousElementInFocus=null,this._originalDefaultButton=null,this._originalCancelButton=null,this._isDragging=!1,this._dragStartX=0,this._dragStartY=0,this._originalHtmlOverflowValue='',this._originalBodyOverflowValue='',this._parent=null,this._settings=null,this._element=null,this._shieldElement=null,this._frameElement=null,this._foregroundElement=null,this._topRegionElement=null,this._dialogBodyElement=null,this._dialogContentAreaElement=null,this._acceptButtonElement=null,this._dismissButtonElement=null,this._dismissAction=null,this._freezerDiv=null,this.set_parent(n),this._dialogID=t,this._dialogType=u,this._zIndex=1e4+t*3,this.set_settings(i),this.set_dismissAction(r),this._ignoredEventHandler=function(){f._ignoreEvent()},this._startDragDropHandler=function(){f._startDragDrop()},this._dragMoveHandler=function(){f._onDragMove()},this._endDragDropHandler=function(){f._endDragDrop()},this._initialize()}return t.prototype.get_originalDefaultButton=function(){return this._originalDefaultButton},t.prototype.get_originalCancelButton=function(){return this._originalCancelButton},t.prototype.get_parent=function(){return this._parent},t.prototype.set_parent=function(n){return this._parent=n,n},t.prototype.get_settings=function(){return this._settings},t.prototype.set_settings=function(n){return this._settings=n,n},t.prototype.get_element=function(){return this._element},t.prototype.set_element=function(n){return this._element=n,n},t.prototype.get_shieldElement=function(){return this._shieldElement==null&&(this._shieldElement=t._findElement(this.get_element(),this.get_parent().get_dialogShieldID())),this._shieldElement},t.prototype.get_frameElement=function(){return this._frameElement==null&&(this._frameElement=n.JS.DialogInstance._findElement(this.get_element(),this.get_parent().get_dialogFrameID())),this._frameElement},t.prototype.get_foregroundElement=function(){return this._foregroundElement==null&&(this._foregroundElement=n.JS.DialogInstance._findElement(this.get_element(),this.get_parent().get_dialogForegroundID())),this._foregroundElement},t.prototype.get_topRegionElement=function(){return this._topRegionElement==null&&(this._topRegionElement=n.JS.DialogInstance._findElement(this.get_element(),this.get_parent().get_dialogTopRegionID())),this._topRegionElement},t.prototype.get_dialogBodyElement=function(){return this._dialogBodyElement==null&&(this._dialogBodyElement=n.JS.DialogInstance._findElement(this.get_element(),this.get_parent().get_dialogBodyAreaID())),this._dialogBodyElement},t.prototype.get_dialogContentAreaElement=function(){return this._dialogContentAreaElement==null&&(this._dialogContentAreaElement=n.JS.DialogInstance._findElement(this.get_element(),this.get_parent().get_dialogContentAreaID())),this._dialogContentAreaElement},t.prototype.get_acceptButtonElement=function(){return this._acceptButtonElement==null&&(this._acceptButtonElement=n.JS.DialogInstance._findElement(this.get_element(),this._getClonedAcceptButtonID())),this._acceptButtonElement},t.prototype.get_dismissButtonElement=function(){return this._dismissButtonElement==null&&(this._dismissButtonElement=n.JS.DialogInstance._findElement(this.get_element(),this._getClonedDismissButtonID())),this._dismissButtonElement},t.prototype.get_dismissAction=function(){return this._dismissAction},t.prototype.set_dismissAction=function(n){return this._dismissAction=n,n},t.prototype.updateHeader=function(t,i,u,f){var o=n.JS.DialogInstance._findElement(this.get_element(),this.get_parent().get_dialogIconAreaID()),k,b,w,d,e,p,a,c,g;if(o!=null){o.style.display='inline';switch(t){case 1:k=document.getElementById(this.get_parent().get_infoIconAreaID()),k!=null&&(o.innerHTML=k.innerHTML);break;case 2:b=document.getElementById(this.get_parent().get_warningIconAreaID()),b!=null&&(o.innerHTML=b.innerHTML);break;case 3:w=document.getElementById(this.get_parent().get_errorIconAreaID()),w!=null&&(o.innerHTML=w.innerHTML);break;case 4:d=document.createElement('img'),d.setAttribute('src',f),o.innerHTML='',o.appendChild(d);break;default:o.style.display='none'}}e=n.JS.DialogInstance._findElement(this.get_element(),this.get_parent().get_dialogTitleAreaID()),p='DialogManager-FreeFormTitle',(this._dialogType===3||this._dialogType===2)&&(e.className=e.className+' '+p,t!==0&&(e.className=e.className.replace(new RegExp(p+'.*'),''))),i!=null&&i.length>0?(e.style.display='block',e.innerHTML=i):e.style.display='none',a=n.JS.DialogInstance._findElement(this.get_element(),this.get_parent().get_dialogSubTitleAreaID()),u!=null&&u.length>0?(a.style.display='block',a.innerHTML=u):a.style.display='none',this.get_settings().get_isFullScreen()||(this.get_settings().get_width()>0&&this.setDialogWidth(),this.get_settings().get_height()>0&&this.setDialogHeight());var h=n.JS.DialogInstance._findElement(this.get_element(),this.get_parent().get_dialogHeaderAreaID()),y=0,v=0,s;if(s=h.currentStyle!=null?h.currentStyle:window.getComputedStyle(h,null),s!=null&&(y=s.paddingLeft.substr(0,s.paddingLeft.length-2),v=s.paddingRight.substr(0,s.paddingRight.length-2)),c=h.getElementsByTagName('table'),c.length>0){var nt=c[0].offsetWidth+y+v,tt=c[0].offsetWidth-e.offsetWidth,l=h.offsetWidth;l>this.get_settings().get_width()&&(l=this.get_settings().get_width()),nt>l&&(g=l-y-v-tt,e.style.width=g<0?"":r(g))}},t.prototype.freezeUserInteraction=function(){this.get_frameElement().disabled=!0,this._freezerDiv=document.createElement('div'),this._freezerDiv.className='DialogManager-ForegroundFreezer',this.get_frameElement().appendChild(this._freezerDiv),this._freezerDiv.style.zIndex=(this._zIndex+2).toString()},t.prototype.thawUserInteraction=function(){this.get_frameElement().disabled=!1,this._freezerDiv!=null&&(this._freezerDiv.parentNode.removeChild(this._freezerDiv),this._freezerDiv=null)},t.prototype._setContentHtml=function(t,r,u){var e,f,o;this.get_dialogBodyElement().innerHTML=t,e=n.JS.DialogInstance._findElement(this.get_element(),this._getClonedAcceptButtonID()),f=n.JS.DialogInstance._findElement(this.get_element(),this._getClonedDismissButtonID()),(r!=null||u!=null)&&(o=n.JS.DialogInstance._findElement(this.get_element(),this.get_parent().get_dialogFooterAreaID()),o.style.display='block',this._footerEnabled=!0),r!=null&&u==null?(i.SetText(e.id,r),f.parentNode.removeChild(f)):r!=null&&u!=null&&(i.SetText(e.id,r),i.SetText(f.id,u))},t.prototype._setDialogHtml=function(n){this.get_dialogContentAreaElement().innerHTML=n},t.prototype._setContentUrl=function(t,i){var l=this,u,s,h,c,r,e,o,f;this._isIFrameMode=!0,u=this._createIFrame(),s=document.createAttribute('src'),s.value=i,u.attributes.setNamedItem(s),u.style.height='0px',u.style.width='100%',h=!0,(!1==n.JS.DialogManager.get_isBrowserIE()||n.JS.DialogManager.get_isBrowserIE9PlusDocumentMode())&&(h=!1,c=document.createAttribute('onload'),c.value='BOX.JS.DialogInstance.onIFrameReady(\"'+this.get_element().id+'", \"'+this.get_frameElement().id+'\", \"'+this.getContentIFrameID()+'\");',u.attributes.setNamedItem(c)),r=document.createElement('div'),r.setAttribute('id','waitSpinner'),r.setAttribute('class','Loading-Horizontal AdminWait'),r.setAttribute('style','top: 30%; left: 50%;'),e=document.createElement('img'),e.setAttribute('style','border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; vertical-align: middle; border-left-width: 0px'),e.setAttribute('src',this.get_parent().get_spinnerIconUrl()),r.appendChild(e),o=document.createElement('div'),o.setAttribute('id','frameContainer'),o.appendChild(u),r.style.display='block',f=this.get_dialogBodyElement(),f.style.paddingLeft='0px',f.style.paddingRight='0px',f.setAttribute("tabIndex","-1"),f.appendChild(r),f.appendChild(o),n.JS.DialogManager.get_isBrowserIE()&&h&&window.setTimeout(function(){l._resizeContentFrameOnIEReady()},0)},t.prototype._resizeContentFrameOnIEReady=function(){var i=this,t,r;try{if(t=document.getElementById(this.getContentIFrameID()),t!=null&&t.contentWindow!=null&&t.contentWindow.document!=null&&t.contentWindow.document.body!=null)if(r=t.contentWindow.document.readyState,r==='complete')n.JS.DialogInstance.onIFrameReady(this.get_element().id,this.get_parent().get_dialogFrameID(),t.id);else window.setTimeout(function(){i._resizeContentFrameOnIEReady()},5);else window.setTimeout(function(){i._resizeContentFrameOnIEReady()},5)}catch(u){window.setTimeout(function(){i._resizeContentFrameOnIEReady()},5)}},t.prototype.resizeContentFrame=function(n){t.resizeByVisibiltyRestrictions(this.get_element().id,this.get_parent().get_dialogFrameID(),this.getContentIFrameID(),n)},t.prototype._createIFrame=function(){var n=document.createElement('iframe'),t,i;return n.id=this.getContentIFrameID(),n.frameBorder='0',t=document.createAttribute('allowTransparency'),t.value='false',n.attributes.setNamedItem(t),i='no',this.get_settings()!=null&&this.get_settings().get_scrollContent()&&(i='yes'),n.scrolling=i,n},t.prototype.dismiss=function(n){var t=this;this.get_settings().get_isFullScreen()&&(document.body.style.overflow=this._originalBodyOverflowValue,document.body.parentNode.style.overflow=this._originalHtmlOverflowValue),Microsoft.Online.BOX.JS.Shared.RemoveEventListener(window,'resize',function(){t.repositionAndResizeDialog()}),this.get_settings().get_canDrag()&&(Microsoft.Online.BOX.JS.Shared.RemoveEventListener(document.body,'selectstart',this._ignoredEventHandler),Microsoft.Online.BOX.JS.Shared.RemoveEventListener(document.body,'dragstart',this._ignoredEventHandler)),this.get_settings().get_hasShield()&&this._tabSaver.RestoreTab(),this.get_dismissAction()!=null&&this.get_dismissAction().call(this,n),i.DefaultButton=this._originalDefaultButton,i.CancelButton=this._originalCancelButton,this._previousElementInFocus!=null&&this._previousElementInFocus.length>0&&(u.get_isBrowserIE7Compatible()?window.setTimeout(function(){t._focusPreviousElement()},0):this._focusPreviousElement())},t.prototype.center=function(){u.centerDialog(this.get_element(),this.get_frameElement(),this._isIFrameMode)},t.prototype.repositionAndResizeDialog=function(){this.get_settings().get_isFullScreen()?(this._setDialogFrameToFullScreen(),this.center()):(this.setDialogWidth(),this.setDialogHeight(),this.center(),this.setDialogWidth(),this.setDialogHeight())},t.prototype._initialize=function(){var o=this,t,r,u,e,f;if(document.activeElement!=null)try{this._previousElementInFocus=document.activeElement.id}catch(s){}this._cloneDialog(),t=document.body.getElementsByTagName('form'),t!=null&&t.length===1&&t[0].name!="adminFeedbackForm"?t[0].appendChild(this.get_element()):document.body.appendChild(this.get_element()),this.get_settings()!=null&&(this.get_settings().get_helpUrl()!=null&&this.get_settings().get_helpUrl().length>0&&(r=n.JS.DialogInstance._findElement(this.get_element(),this._getClonedHelpButtonID()),r!=null?(r.style.display='inline',r.setAttribute('href',this.get_settings().get_helpUrl())):(u=n.JS.DialogInstance._findElement(this.get_element(),this._getClonedLearnMoreLinkID()),e=n.JS.DialogInstance._findElement(this.get_element(),this._getClonedLearnMoreAreaID()),u!=null&&(e.style.display='block',u.setAttribute('href',this.get_settings().get_helpUrl()),this._learnMoreEnabled=!0))),this.get_settings().get_showX()||(f=n.JS.DialogInstance._findElement(this.get_element(),this._getClonedCloseButtonID()),f!=null&&(f.style.visibility='hidden')),(!this.get_settings().get_showDecoration()||this.get_settings().get_isFullScreen())&&this._hideDecoration(),this._originalDefaultButton=i.DefaultButton,this._originalCancelButton=i.CancelButton,this.get_settings().get_hasShield()?(this._tabSaver=new O365.TabSaver(this.get_element()),this._tabSaver.DisableTab(),i.DefaultButton=this.get_settings().get_defaultActionControlID(),i.CancelButton=this.get_settings().get_cancelActionControlID()):this._hideShield(),this.get_settings().get_isFullScreen()?(this._originalBodyOverflowValue=document.body.style.overflow,this._originalHtmlOverflowValue=document.body.parentNode.style.overflow,document.body.style.overflow='hidden',document.body.parentNode.style.overflow='hidden',this._setDialogFrameToFullScreen()):(this.get_settings().get_width()>0&&this.setDialogWidth(),this.get_settings().get_height()>0&&this.setDialogHeight()),Microsoft.Online.BOX.JS.Shared.AddEventListener(window,'resize',function(){o.repositionAndResizeDialog()}),this.get_settings().get_canDrag()&&(this.get_topRegionElement().style.cursor='move',Microsoft.Online.BOX.JS.Shared.AddEventListener(document.body,'selectstart',this._ignoredEventHandler),Microsoft.Online.BOX.JS.Shared.AddEventListener(document.body,'dragstart',this._ignoredEventHandler),Microsoft.Online.BOX.JS.Shared.AddEventListener(this.get_topRegionElement(),'mousedown',this._startDragDropHandler)))},t.prototype._cloneDialog=function(){var h=document.getElementById(this.get_parent().get_dialogAreaID()),r,t,u,i,f,e,o,s,c,l,a,v;this.set_element(h.cloneNode(!0)),this.get_element().id=this._getClonedControlID(this.get_parent().get_dialogAreaID()),this.get_element().style.zIndex=this._zIndex.toString(),r=new RegExp(this.get_parent().get_acceptButtonID(),'gi'),t=this._getClonedAcceptButtonID(),this.get_element().innerHTML=this.get_element().innerHTML.replace(r,t),u=new RegExp(this.get_parent().get_dismissButtonID(),'gi'),i=this._getClonedDismissButtonID(),O365&&O365.Button&&O365.Button.Initialize&&(O365.Button.Initialize(t),O365.Button.Initialize(i)),this.get_element().innerHTML=this.get_element().innerHTML.replace(u,i),f=new RegExp(this.get_parent().get_helpLinkID(),'gi'),e=this._getClonedHelpButtonID(),this.get_element().innerHTML=this.get_element().innerHTML.replace(f,e),o=new RegExp(this.get_parent().get_closeIconID(),'gi'),s=this._getClonedCloseButtonID(),this.get_element().innerHTML=this.get_element().innerHTML.replace(o,s),c=new RegExp(this.get_parent().get_learnMoreLinkID(),'gi'),l=this._getClonedLearnMoreLinkID(),this.get_element().innerHTML=this.get_element().innerHTML.replace(c,l),a=new RegExp(this.get_parent().get_learnMoreAreaID(),'gi'),v=this._getClonedLearnMoreAreaID(),this.get_element().innerHTML=this.get_element().innerHTML.replace(a,v),this.get_shieldElement().style.zIndex=this._zIndex.toString(),this.get_foregroundElement().style.zIndex=(this._zIndex+1).toString(),n.JS.DialogInstance._evaluateClonedScriptTags(h,this.get_element(),[r,u,f,o],[t,i,e,s])},t.prototype._getClonedControlID=function(n){return n+'_'+this._dialogID},t.prototype._getClonedAcceptButtonID=function(){return this._getClonedControlID(this.get_parent().get_acceptButtonID())},t.prototype._getClonedDismissButtonID=function(){return this._getClonedControlID(this.get_parent().get_dismissButtonID())},t.prototype._getClonedHelpButtonID=function(){return this._getClonedControlID(this.get_parent().get_helpLinkID())},t.prototype._getClonedLearnMoreLinkID=function(){return this._getClonedControlID(this.get_parent().get_learnMoreLinkID())},t.prototype._getClonedLearnMoreAreaID=function(){return this._getClonedControlID(this.get_parent().get_learnMoreAreaID())},t.prototype._getClonedCloseButtonID=function(){return this._getClonedControlID(this.get_parent().get_closeIconID())},t.prototype.getContentIFrameID=function(){return this._getClonedControlID('ContentIFrame')},t.prototype._hideDecoration=function(){var t,i,r,u;this.get_topRegionElement().style.display='none',t=n.JS.DialogInstance._findElement(this.get_element(),this.get_parent().get_dialogBottomRegionID()),t.style.display='none',i=n.JS.DialogInstance._findElement(this.get_element(),this.get_parent().get_dialogMiddleRegionID()),i.style.borderWidth='0px',r=n.JS.DialogInstance._findElement(this.get_element(),this.get_parent().get_dialogHeaderAreaID()),r.style.display='none',u=n.JS.DialogInstance._findElement(this.get_element(),this.get_parent().get_dialogFooterAreaID()),u.style.display='none'},t.prototype._hideShield=function(){this.get_shieldElement().style.display='none'},t.prototype._setDialogFrameToFullScreen=function(){var t=this.get_frameElement(),i,f,e;t.style.left='0px',t.style.top='0px',t.style.position='fixed',i=u.getBrowserDimensions(),t.style.width=r(i.width),t.style.height=r(i.height),f=n.JS.DialogInstance._findElement(this.get_element(),this.get_parent().get_dialogMiddleRegionID()),f.style.width='100%',f.style.height='100%',this.get_dialogContentAreaElement().style.width='100%',this.get_dialogContentAreaElement().style.height='100%',e=this.get_dialogBodyElement(),e.style.width=r(i.width-20),e.style.height='100%'},t.prototype._startDragDrop=function(){var t=window.event,n=t.srcElement;if(!this._isDragging&&n.tagName.toLowerCase()!="img"){for(this._isDragging=!0,this._dragStartX=t.offsetX,this._dragStartY=t.offsetY;n.id!==this.get_parent().get_dialogFrameID()&&n!=null;)this._dragStartX+=n.offsetLeft,this._dragStartY+=n.offsetTop,n=n.offsetParent;Microsoft.Online.BOX.JS.Shared.RemoveEventListener(this.get_topRegionElement(),'mousedown',this._startDragDropHandler),Microsoft.Online.BOX.JS.Shared.AddEventListener(document,'mousemove',this._dragMoveHandler),Microsoft.Online.BOX.JS.Shared.AddEventListener(document,'mouseup',this._endDragDropHandler)}},t.prototype._endDragDrop=function(){var n=window.event,t,i;this._isDragging&&(this._isDragging=!1,t=n.clientX,i=n.clientY,this.get_element().style.left=r(t-this._dragStartX),this.get_element().style.top=r(i-this._dragStartY),Microsoft.Online.BOX.JS.Shared.RemoveEventListener(document,'mousemove',this._dragMoveHandler),Microsoft.Online.BOX.JS.Shared.RemoveEventListener(document,'mouseup',this._endDragDropHandler),Microsoft.Online.BOX.JS.Shared.AddEventListener(this.get_topRegionElement(),'mousedown',this._startDragDropHandler))},t.prototype._onDragMove=function(){var t=window.event,i,u,n;this._isDragging&&(i=t.clientX,u=t.clientY,this.get_element().style.left=r(i-this._dragStartX),this.get_element().style.top=r(u-this._dragStartY),document.selection?document.selection.clear():document.getSelection&&(n=document.getSelection(),n.empty?n.empty():n.removeAllRanges&&n.removeAllRanges()))},t.prototype.setDialogWidth=function(t){var f=typeof t=='undefined'||t==-1,u,i;f?t=this.get_settings().get_width():this.get_settings().set_width(t),u=n.JS.DialogManager.getBrowserDimensions(),i=n.JS.DialogInstance._findElement(this.get_frameElement(),this.get_parent().get_dialogBodyAreaID()),i&&(t>u.width?(t=u.width-20,i.style.overflowX='auto'):i.style.overflowX='hidden'),this.get_frameElement().style.width=r(t)},t.prototype.setDialogHeight=function(t){var f=typeof t=='undefined'||t==-1;f?t=this.get_settings().get_height():this.get_settings().set_height(t);var e=this.get_topRegionElement().offsetHeight,o=n.JS.DialogInstance._findElement(this.get_frameElement(),this.get_parent().get_dialogBottomRegionID()).offsetHeight,s=n.JS.DialogInstance._findElement(this.get_frameElement(),this.get_parent().get_dialogHeaderAreaID()).offsetHeight,h=this._learnMoreEnabled?n.JS.DialogInstance._findElement(this.get_element(),this._getClonedLearnMoreLinkID()).offsetHeight:0,c=this._footerEnabled?n.JS.DialogInstance._findElement(this.get_element(),this.get_parent().get_dialogFooterAreaID()).offsetHeight:0,i=n.JS.DialogManager.getBrowserDimensions(),u=e+o+s+h+c,l=this.get_dialogContentAreaElement();u+l.scrollHeight>i.height?(this.get_dialogContentAreaElement().style.height=r(i.height-u),this.get_dialogContentAreaElement().style.overflowY='auto'):(this.get_dialogContentAreaElement().style.height='',this.get_dialogContentAreaElement().style.overflowY='hidden')},t.prototype._getElementBounds=function(n){for(var t=new f(n.offsetLeft,n.offsetTop,n.offsetWidth,n.offsetHeight);n.parentNode!=null;)t.x+=n.parentNode.offsetLeft,t.y+=n.parentNode.offsetTop,n=n.parentNode;return t},t.prototype._ignoreEvent=function(){var n=window.event;n.returnValue=!1,n.cancelBubble=!0},t.prototype._focusPreviousElement=function(){var n=document.getElementById(this._previousElementInFocus);if(n!=null)try{n.focus()}catch(t){}},t.onIFrameReady=function(t,i,r){var e=document.getElementById('waitSpinner'),u,f;e!=null&&(e.style.display='none'),n.JS.DialogInstance.resizeByVisibiltyRestrictions(t,i,r,null);try{u=document.getElementById(r),f=null,u!=null&&(n.JS.DialogManager.get_isBrowserIE()?u.contentWindow!=null&&(f=u.contentWindow.document):f=u.contentDocument,f!=null&&f.body!=null&&(u.contentWindow.Button.ResizeButtons(),f.body.focus()))}catch(o){}},t.resizeByVisibiltyRestrictions=function(i,u,f,e){var h=document.getElementById(f),o,s,c,l;h!=null&&(h.style.height='0px',!1==n.JS.DialogManager.get_isBrowserIE()?(o=h.contentDocument,o!=null&&o.body!=null&&o.body.style.height!=='auto'&&(o.body.style.height='auto')):o=h.contentWindow.document,s=o.body.scrollHeight,e!=null&&(s=Math.max(s,e.y+e.height)),s=s+t._iFrameBodyMarginCompensation,h.style.height=r(s),c=document.getElementById(i),l=n.JS.DialogInstance._findElement(c,u),n.JS.DialogManager.centerDialog(c,l,!0))},t._findElement=function(n,i){var f=null,r,u;if(n!=null)if(n.id!=null&&n.id.localeCompare(i)===0)f=n;else{for(r=null,u=0;u<n.childNodes.length;u++)if(r=t._findElement(n.childNodes[u],i),r!=null)break;f=r}return f},t._evaluateClonedScriptTags=function(n,t,i,r){var e=n.getElementsByTagName('script'),o=t.getElementsByTagName('script'),u,f;if(o!=null&&e!=null&&o.length===e.length)for(u=0;u<e.length;u++){var h=o[u],c=e[u],s=c.text;if(i!=null&&r!=null&&i.length===r.length)for(f=0;f<i.length;f++)s=s.replace(i[f],r[f]);try{eval(s),h.text=''}catch(l){}}},t._iFrameBodyMarginCompensation=10,t}(),t.DialogInstance=o,e=function(){function n(n){var i,r,t;if(this._dialogTemplateID=null,this._isFullSceen=!1,this._width=0,this._height=0,this._scrollContent=!1,this._canDrag=!1,this._hasShield=!1,this._showDecoration=!1,this._helpUrl=null,this._defaultActionControlID=null,this._cancelActionControlID=null,this._showX=!1,this._reloadElement=!1,this._dialogIconType=0,this.set_isFullScreen(!1),this.set_height(-1),this.set_width(u.get_isModernUI()?666:400),this.set_scrollContent(!1),this.set_helpUrl(''),this.set_canDrag(!0),this.set_hasShield(!0),this.set_showDecoration(!0),this.set_defaultActionControlID(null),this.set_cancelActionControlID(null),this.set_showX(u.get_isModernUI()?!1:!0),n!=null&&(i=n.split(','),i!=null))for(r=0;r<i.length;r++)if(t=i[r].split(':'),t!=null&&t.length>=2)switch(t[0].toLowerCase()){case'fullscreen':this.set_isFullScreen(t[1].trim().toLowerCase()==="true");break;case'width':this.set_width(parseInt(t[1].trim().toLowerCase()));break;case'height':this.set_height(parseInt(t[1].trim().toLowerCase()));break;case'scrolling':this.set_scrollContent(t[1].trim().toLowerCase()==="true");break;case'drag':this.set_canDrag(t[1].trim().toLowerCase()==="true");break;case'hasshield':this.set_hasShield(t[1].trim().toLowerCase()==="true");break;case'showdecoration':this.set_showDecoration(t[1].trim().toLowerCase()==="true");break;case'helpurl':this.set_helpUrl(i[r].substr(t[0].length+1));break;case'defaultaction':this.set_defaultActionControlID(t[1]);break;case'cancelaction':this.set_cancelActionControlID(t[1]);break;case'showx':this.set_showX(t[1].trim().toLowerCase()==="true");break;case'reloadelement':this.set_reloadElement(t[1].trim().toLowerCase()==="true");break;case'dialogicontype':this.set_dialogIconType(parseInt(t[1]))}}return n.prototype.get_isFullScreen=function(){return this._isFullSceen},n.prototype.set_isFullScreen=function(n){return this._isFullSceen=n,n},n.prototype.get_width=function(){return this._width},n.prototype.set_width=function(n){return this._width=n,n},n.prototype.get_height=function(){return this._height},n.prototype.set_height=function(n){return this._height=n,n},n.prototype.get_scrollContent=function(){return this._scrollContent},n.prototype.set_scrollContent=function(n){return this._scrollContent=n,n},n.prototype.get_canDrag=function(){return this._canDrag},n.prototype.set_canDrag=function(n){return this._canDrag=n,n},n.prototype.get_hasShield=function(){return this._hasShield},n.prototype.set_hasShield=function(n){return this._hasShield=n,n},n.prototype.get_showDecoration=function(){return this._showDecoration},n.prototype.set_showDecoration=function(n){return this._showDecoration=n,n},n.prototype.get_helpUrl=function(){return this._helpUrl},n.prototype.set_helpUrl=function(n){return this._helpUrl=n,n},n.prototype.get_defaultActionControlID=function(){return this._defaultActionControlID},n.prototype.set_defaultActionControlID=function(n){return this._defaultActionControlID=n,n},n.prototype.get_cancelActionControlID=function(){return this._cancelActionControlID},n.prototype.set_cancelActionControlID=function(n){return this._cancelActionControlID=n,n},n.prototype.get_showX=function(){return this._showX},n.prototype.set_showX=function(n){return this._showX=n,n},n.prototype.get_reloadElement=function(){return this._reloadElement},n.prototype.set_reloadElement=function(n){return this._reloadElement=n,n},n.prototype.get_dialogIconType=function(){return this._dialogIconType},n.prototype.set_dialogIconType=function(n){return this._dialogIconType=n,n},n}(),t.DialogSettings=e,u=function(){function t(n){this._dialogTemplateID=null,this._dialogStack=null,this.positiveConfirmation='YES',this.negativeConfirmation='NO',this._acceptButtonID=null,this._dismissButtonID=null,this._dialogAreaID=null,this._dialogShieldID=null,this._dialogForegroundID=null,this._dialogFrameID=null,this._dialogTopRegionID=null,this._dialogMiddleRegionID=null,this._dialogBottomRegionID=null,this._dialogContentAreaID=null,this._dialogHeaderAreaID=null,this._dialogIconAreaID=null,this._dialogTitleAreaID=null,this._dialogSubTitleAreaID=null,this._dialogBodyAreaID=null,this._dialogFooterAreaID=null,this._helpLinkID=null,this._learnMoreLinkID=null,this._learnMoreAreaID=null,this._closeIconID=null,this._acceptButtonDefaultText=null,this._declineButtonDefaultText=null,this._dismissButtonDefaultText=null,this._infoIconAltText=null,this._infoIconUrl=null,this._warningIconAltText=null,this._warningIconUrl=null,this._errorIconAltText=null,this._errorIconUrl=null,this._spinnerIconUrl=null,this._infoIconID=null,this._warningIconID=null,this._errorIconID=null,this._infoIconAreaID=null,this._warningIconAreaID=null,this._errorIconAreaID=null,this._contentCache={},n&&(i=O365.Button)}return t.prototype.get_isDialogShown=function(){return this._dialogStack!=null?this._dialogStack.length>0:!1},t.prototype.get_dialogTemplateID=function(){return this._dialogTemplateID},t.prototype.set_dialogTemplateID=function(n){return this._dialogTemplateID=n,n},t.prototype.get_acceptButtonID=function(){return this._acceptButtonID},t.prototype.set_acceptButtonID=function(n){return this._acceptButtonID=n,n},t.prototype.get_dismissButtonID=function(){return this._dismissButtonID},t.prototype.set_dismissButtonID=function(n){return this._dismissButtonID=n,n},t.prototype.get_dialogAreaID=function(){return this._dialogAreaID},t.prototype.set_dialogAreaID=function(n){return this._dialogAreaID=n,n},t.prototype.get_dialogShieldID=function(){return this._dialogShieldID},t.prototype.set_dialogShieldID=function(n){return this._dialogShieldID=n,n},t.prototype.get_dialogForegroundID=function(){return this._dialogForegroundID},t.prototype.set_dialogForegroundID=function(n){return this._dialogForegroundID=n,n},t.prototype.get_dialogFrameID=function(){return this._dialogFrameID},t.prototype.set_dialogFrameID=function(n){return this._dialogFrameID=n,n},t.prototype.get_dialogTopRegionID=function(){return this._dialogTopRegionID},t.prototype.set_dialogTopRegionID=function(n){return this._dialogTopRegionID=n,n},t.prototype.get_dialogMiddleRegionID=function(){return this._dialogMiddleRegionID},t.prototype.set_dialogMiddleRegionID=function(n){return this._dialogMiddleRegionID=n,n},t.prototype.get_dialogBottomRegionID=function(){return this._dialogBottomRegionID},t.prototype.set_dialogBottomRegionID=function(n){return this._dialogBottomRegionID=n,n},t.prototype.get_dialogContentAreaID=function(){return this._dialogContentAreaID},t.prototype.set_dialogContentAreaID=function(n){return this._dialogContentAreaID=n,n},t.prototype.get_dialogHeaderAreaID=function(){return this._dialogHeaderAreaID},t.prototype.set_dialogHeaderAreaID=function(n){return this._dialogHeaderAreaID=n,n},t.prototype.get_dialogIconAreaID=function(){return this._dialogIconAreaID},t.prototype.set_dialogIconAreaID=function(n){return this._dialogIconAreaID=n,n},t.prototype.get_dialogTitleAreaID=function(){return this._dialogTitleAreaID},t.prototype.set_dialogTitleAreaID=function(n){return this._dialogTitleAreaID=n,n},t.prototype.get_dialogSubTitleAreaID=function(){return this._dialogSubTitleAreaID},t.prototype.set_dialogSubTitleAreaID=function(n){return this._dialogSubTitleAreaID=n,n},t.prototype.get_dialogBodyAreaID=function(){return this._dialogBodyAreaID},t.prototype.set_dialogBodyAreaID=function(n){return this._dialogBodyAreaID=n,n},t.prototype.get_dialogFooterAreaID=function(){return this._dialogFooterAreaID},t.prototype.set_dialogFooterAreaID=function(n){return this._dialogFooterAreaID=n,n},t.prototype.get_helpLinkID=function(){return this._helpLinkID},t.prototype.set_helpLinkID=function(n){return this._helpLinkID=n,n},t.prototype.get_learnMoreLinkID=function(){return this._learnMoreLinkID},t.prototype.set_learnMoreLinkID=function(n){return this._learnMoreLinkID=n,n},t.prototype.get_learnMoreAreaID=function(){return this._learnMoreAreaID},t.prototype.set_learnMoreAreaID=function(n){return this._learnMoreAreaID=n,n},t.prototype.get_closeIconID=function(){return this._closeIconID},t.prototype.set_closeIconID=function(n){return this._closeIconID=n,n},t.prototype.get_acceptButtonDefaultText=function(){return this._acceptButtonDefaultText},t.prototype.set_acceptButtonDefaultText=function(n){return this._acceptButtonDefaultText=n,n},t.prototype.get_declineButtonDefaultText=function(){return this._declineButtonDefaultText},t.prototype.set_declineButtonDefaultText=function(n){return this._declineButtonDefaultText=n,n},t.prototype.get_dismissButtonDefaultText=function(){return this._dismissButtonDefaultText},t.prototype.set_dismissButtonDefaultText=function(n){return this._dismissButtonDefaultText=n,n},t.prototype.get_infoIconAltText=function(){return this._infoIconAltText},t.prototype.set_infoIconAltText=function(n){return this._infoIconAltText=n,n},t.prototype.get_infoIconUrl=function(){return this._infoIconUrl},t.prototype.set_infoIconUrl=function(n){return this._infoIconUrl=n,n},t.prototype.get_warningIconAltText=function(){return this._warningIconAltText},t.prototype.set_warningIconAltText=function(n){return this._warningIconAltText=n,n},t.prototype.get_warningIconUrl=function(){return this._warningIconUrl},t.prototype.set_warningIconUrl=function(n){return this._warningIconUrl=n,n},t.prototype.get_errorIconAltText=function(){return this._errorIconAltText},t.prototype.set_errorIconAltText=function(n){return this._errorIconAltText=n,n},t.prototype.get_errorIconUrl=function(){return this._errorIconUrl},t.prototype.set_errorIconUrl=function(n){return this._errorIconUrl=n,n},t.prototype.get_spinnerIconUrl=function(){return this._spinnerIconUrl},t.prototype.set_spinnerIconUrl=function(n){return this._spinnerIconUrl=n,n},t.prototype.get_infoIconID=function(){return this._infoIconID},t.prototype.set_infoIconID=function(n){return this._infoIconID=n,n},t.prototype.get_warningIconID=function(){return this._warningIconID},t.prototype.set_warningIconID=function(n){return this._warningIconID=n,n},t.prototype.get_errorIconID=function(){return this._errorIconID},t.prototype.set_errorIconID=function(n){return this._errorIconID=n,n},t.prototype.get_infoIconAreaID=function(){return this._infoIconAreaID},t.prototype.set_infoIconAreaID=function(n){return this._infoIconAreaID=n,n},t.prototype.get_warningIconAreaID=function(){return this._warningIconAreaID},t.prototype.set_warningIconAreaID=function(n){return this._warningIconAreaID=n,n},t.prototype.get_errorIconAreaID=function(){return this._errorIconAreaID},t.prototype.set_errorIconAreaID=function(n){return this._errorIconAreaID=n,n},t.prototype.alertText=function(n,t,i,r,u){if(!1==this.get_isDialogShown()){var f=HtmlEncode(i);this.alertHtml(n,t,f,r,u,null,null)}},t.prototype.alertHtml=function(t,r,u,f,e,o,s){var c,l,h,a;!1==this.get_isDialogShown()&&((e==null||e.length===0)&&(e=this.get_dismissButtonDefaultText()),c=this._getStandardModalSettings(),l=typeof o!='undefined',l=l&&o!=null,l&&(c=typeof o=='string'?new n.JS.DialogSettings(o):o),h=this._createInstance(c,f,0),h._setContentHtml(u,e,null),i.SetCancelButton(h.get_acceptButtonElement().id),i.SetDefaultButton(h.get_acceptButtonElement().id),h.updateHeader(t,r,null,s),h.repositionAndResizeDialog(),a=document.getElementById(h.get_acceptButtonElement().id),a!=null&&a.focus(),i.AttachDefaultButtonHandlers())},t.prototype.confirmText=function(n,t,i,r,u,f,e){if(!1==this.get_isDialogShown()){var o=HtmlEncode(i);this.confirmHtml(n,t,o,r,u,f,e,null)}},t.prototype.confirmHtml=function(t,r,u,f,e,o,s,h){var l,a,c,v,y;!1==this.get_isDialogShown()&&((e==null||e.length===0)&&(e=this.get_acceptButtonDefaultText()),(o==null||o.length===0)&&(o=this.get_declineButtonDefaultText()),l=this._getStandardModalSettings(),a=typeof h!='undefined',a=a&&h!=null,a&&(l=typeof h=='string'?new n.JS.DialogSettings(h):h),c=this._createInstance(l,f,1),c._setContentHtml(u,e,o),i.SetCancelButton(c.get_dismissButtonElement().id),v=c.get_dismissButtonElement().id,s&&(v=c.get_acceptButtonElement().id),i.SetDefaultButton(v),c.updateHeader(t,r,null,null),c.repositionAndResizeDialog(),y=document.getElementById(v),y!=null&&y.focus(),i.ResizeButtons(),i.AttachDefaultButtonHandlers())},t.prototype.showUrl=function(t,i,r,u){if(!1==this.get_isDialogShown()){var f=this._getStandardModalSettings();f=typeof u=='string'?new n.JS.DialogSettings(u):u,this._showUrlInternal(t,i,r,f)}},t.prototype._showUrlInternal=function(n,t,i,r){var u=this._createInstance(r,i,2);u._setContentUrl(t,n),u.updateHeader(0,t,null,null),u.repositionAndResizeDialog()},t.prototype.showHtmlFromElement=function(n,t,r,u){if(!1==this.get_isDialogShown()){var f=this._contentCache[n],e=this._getDialogSettings(u);(f==null||e.get_reloadElement())&&(f=this.calcCachedElement(n)),this._showHtmlInternal(f.innerHTML,t,r,e),i.ResizeButtons()}},t.prototype.calcCachedElement=function(n){var t=this._getElementByIdRecursively(n),i;if(t==null)throw Error.create('cannot find element "'+n+'"');return i=t.cloneNode(!0),this._contentCache[n]=i,t.innerHTML='',i},t.prototype.showHtml=function(n,t,i,r){var u=this._getDialogSettings(r);this._showHtmlInternal(n,t,i,u)},t.prototype._getElementByIdRecursively=function(n){for(var i=null,r=window.frames,t=0;t<r.length;t++){try{i=r[t].document.getElementById(n)}catch(u){}if(i)return i}return document.getElementById(n)},t.prototype._getDialogSettings=function(t){var i=this._getStandardModalSettings();return i=typeof t=='string'?new n.JS.DialogSettings(t):t},t.prototype._showHtmlInternal=function(n,t,r,u){var f=this._createInstance(u,r,3),e;f._setDialogHtml(n),f.updateHeader(u.get_dialogIconType(),t,null,null),f.repositionAndResizeDialog(),u.get_defaultActionControlID()!=null&&u.get_defaultActionControlID().length>0&&(e=document.getElementById(u.get_defaultActionControlID()),e!=null&&e.focus()),i.AttachDefaultButtonHandlers()},t.prototype.dismiss=function(t){var i,r,u;this.get_isDialogShown()&&(i=this._dialogStack.pop(),r=document.getElementById(i.getContentIFrameID()),(n.JS.DialogManager.get_isBrowserIE()||n.JS.DialogManager.get_isBrowserIE11())&&r!=null&&(u=document.body.createTextRange(),u.moveToElementText(i.get_frameElement()),u.select()),n.JS.DialogManager.get_isBrowserIE9PlusDocumentMode()&&r!=null?(i.get_element().style.display='none',window.setTimeout(function(){i.get_element().parentNode.removeChild(i.get_element()),i.dismiss(t),i=null},300)):(i.get_element().parentNode.removeChild(i.get_element()),i.dismiss(t),i=null))},t.prototype.getTopDialogInstance=function(){var n=null;return this.get_isDialogShown()&&(n=this._dialogStack.pop(),this._dialogStack.push(n)),n},t.prototype._getStandardModalSettings=function(){return new e(null)},t.prototype._createInstance=function(t,i,r){var u,e,o,f;return this._dialogStack==null&&(this._dialogStack=[]),u=window.BaseValidator,e=window.Sys,typeof u!="undefined"&&typeof e!="undefined"&&u.HideAllCallouts(!1),o=this._dialogStack.length,f=new n.JS.DialogInstance(this,o,t,i,r),this._dialogStack.push(f),f},t.prototype.isCacheAccessible=function(n){var i=this._contentCache[n],t=!0;try{i.innerHTML.toString()}catch(r){t=!1}return t},t.get_isRightToLeft=function(){var n=document.getElementsByTagName('html');return n.length>0&&n[0].dir==='rtl'},t.get_isModernUI=function(){return document.getElementById('ShellBodyAndFooterContainer')?!0:!1},t.centerDialog=function(t,i){var o=n.JS.DialogManager.getBrowserDimensions(),e,f;t.style.display='',e=(o.width-i.clientWidth)/2,f=(o.height-i.clientHeight)/2,t.style.position='absolute',n.JS.DialogManager.get_isRightToLeft()?t.style.right=r(e):t.style.left=r(e),f=f<0?0:f,t.style.top=r(f),n.JS.DialogManager.forceRedraw(t)},t.forceRedraw=function(t){n.JS.DialogManager._tempTextNode!=null&&n.JS.DialogManager._redrawCallback(),n.JS.DialogManager._tempTextNode=document.createTextNode(' '),t.appendChild(n.JS.DialogManager._tempTextNode),window.setTimeout(function(){n.JS.DialogManager._redrawCallback()},0)},t.get_isBrowserIE=function(){return navigator.userAgent.indexOf("MSIE")!=-1},t.get_isBrowserIE11=function(){return navigator.userAgent.indexOf("Trident/7.0")!=-1},t.get_isBrowserIE9PlusDocumentMode=function(){return t.get_isBrowserIE()&&document.documentMode&&document.documentMode>=9},t.get_isBrowserIE7Compatible=function(){return navigator.userAgent.indexOf("MSIE 7.0")!=-1},t._redrawCallback=function(){n.JS.DialogManager._tempTextNode!=null&&(n.JS.DialogManager._tempTextNode.parentNode!=null&&n.JS.DialogManager._tempTextNode.parentNode.removeChild(n.JS.DialogManager._tempTextNode),n.JS.DialogManager._tempTextNode=null)},t.getBrowserDimensions=function(){return new f(0,0,document.documentElement.clientWidth,document.documentElement.clientHeight)},t._tempTextNode=null,t}(),t.DialogManager=u})(t=n.JS||(n.JS={}))})(BOX||(BOX={}));AdminOverlay=new function(){this.element='undefined',this.elementHeight=0,this.getElementTop=function(){if(AdminOverlay.element!=='undefined')return($(window.top).height()-AdminOverlay.elementHeight)/2},this.show=function(n,t){t==undefined&&(t="100%"),AdminOverlay.element=$(n,top.document),AdminOverlay.elementHeight=AdminOverlay.element.height(),AdminOverlay.element!=='undefined'&&($('#admin-overlay-shade',top.document).length==0&&$('body',top.document).prepend('<div id="admin-overlay-shade"></div>'),$('#admin-overlay-shade',top.document).fadeTo(300,.5,function(){$(this).css('display','block');var n=AdminOverlay.elementHeight,i=AdminOverlay.elementHeight*.1;AdminOverlay.element.css({display:'block',opacity:0,top:AdminOverlay.getElementTop()+'px',left:'50%',width:t,transform:'translate(-50%, 0%)',height:i+'px'}).animate({width:t,height:n+'px',opacity:1},700),$(window.top).resize(function(){AdminOverlay.element!=='undefined'&&AdminOverlay.element.css({top:AdminOverlay.getElementTop()+'px'})})}))},this.dismiss=function(){$('.admin-overlay',top.document).animate({width:'0px',height:'0px',opacity:0},400,function(){$('#admin-overlay-shade',top.document).fadeOut(400),$(this).css('display','none')})}};function ShowHideMigrationTypes(n){migrationTypesDivClientId="#migrationTypes_"+n,$(migrationTypesDivClientId).is(":visible")?($("#migrationtypeschevron_"+n).removeClass("wf-portal-upchevron").addClass("wf-portal-downchevron"),$(migrationTypesDivClientId).slideUp("fast")):($("#migrationtypeschevron_"+n).removeClass("wf-portal-downchevron").addClass("wf-portal-upchevron"),$(migrationTypesDivClientId).slideDown("fast",function(){try{ResizeTo($("#sub_"+n).height())}catch(t){}}))};var Admin;(function(n){'use strict';;var r=function(){function n(){}return n}(),i,t;n.SmbCampaign=r,i=function(){function n(){}return n}(),n.SmbCampaignUserAction=i,t=function(){function n(n,t){this.$q=n,this.HttpService=t}return n.prototype.GetSmbCampaign=function(){var n=this.$q.defer(),t="/admin/api/smbCampaign",i=[];return this.HttpService.Get(t,i,!1).success(function(t){n.resolve(t)}).error(function(t){n.reject(t)}),n.promise},n.prototype.SetSmbCampaignUserAction=function(n){var t="/admin/api/smbCampaign/action",i=JSON.stringify(n);this.HttpService.Post(t,i,null)},n.$inject=["$q","HttpService"],n}(),n.SmbCampaignService=t,AdminApp.service("SmbCampaignService",t)})(Admin||(Admin={}));var Admin;(function(n){var i=function(){function n(n,t,i,r){var f,u;this.$scope=n,this.$window=t,this.$uibModal=i,this.SmbCampaignService=r,f=this,n.OpenBanner=function(){var t=i.open({animation:!0,controller:'SmbCampaignInstanceController',controllerAs:'$ctrl',templateUrl:'SmbCampaignBannerTemplate.html',backdrop:'static',scope:n}).rendered.then(function(){var t=document.querySelector('.well'),n=$('#smbAdoptionBnr');n.css({position:'absolute',top:$(window).height()/2-350+'px'})})},u=function(){n.Campaign=null,r.GetSmbCampaign().then(function(t){t&&(n.Campaign=t,n.OpenBanner())})},u()}return n.$inject=["$scope","$window","$uibModal","SmbCampaignService"],n}(),t;n.SmbCampaignController=i,t=function(){function t(t,i,r,u){this.$uibModalInstance=t,this.$scope=i,this.$window=r,this.SmbCampaignService=u;var f=this;i.GoSmbHome=function(){r.open("/BusinessCenter/Home","_blank"),t.dismiss('cancel');var f=new n.SmbCampaignUserAction;f.Campaign=i.Campaign,f.UserAction="clicked",u.SetSmbCampaignUserAction(f)},i.RemindLater=function(){var r=new n.SmbCampaignUserAction;t.dismiss('cancel'),r.Campaign=i.Campaign,r.UserAction="remindme",u.SetSmbCampaignUserAction(r)}}return t.$inject=["$uibModalInstance","$scope","$window","SmbCampaignService"],t}(),n.SmbCampaignInstanceController=t,n.app.controller("SmbCampaignInstanceController",t),n.app.controller("SmbCampaignController",i)})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var r=function(){function n(n,t){this.$rootScope=n,this.$http=t,this.IwWizardTdsSessionId=new i,this.MailTemplates={OutlookMobileApp:{name:"OutlookMobileApp",imagePath:"/Admin/images/IwWizard/OutlookMobileApp.png",altText:'https\x3a\x2f\x2faka.ms\x2foutlookapptemplate'},ProductivityLibrary:{name:"ProductivityLibrary",imagePath:"/Admin/images/IwWizard/ProductivityLibrary.png",altText:'https\x3a\x2f\x2faka.ms\x2fproductivitylibrarytemplate'}}}return n.prototype.ShowMessage=function(n,i){var r=new t;r.ErrorMessage=n,r.MessageType=i,this.ShowErrorModelMessage(r)},n.prototype.ShowLoading=function(n){this.$rootScope.$broadcast('wizard:showloading',n)},n.prototype.GetUsers=function(){return this.Get("GetUsers")},n.prototype.GetUsersForInitialPageLoad=function(){return this.Get("GetUsersForInitialPageLoad")},n.prototype.GetDistributionGroups=function(){return this.Get("GetDistributionGroups")},n.prototype.GetCurrentTdsSession=function(){return this.Get("GetCurrentTdsSession")},n.prototype.GetSearchedUsers=function(n){return this.SearchUser(n,0,"DisplayName")},n.prototype.UpdateUsers=function(n){this.$rootScope.$broadcast('UpdateUsers',n)},n.prototype.SendIwWizardEmails=function(n,t){return this.Post("SendIwWizardsEmails?emailTemplateId="+t,n)},n.prototype.ShowErrorModelMessage=function(n){this.$rootScope.$broadcast('wizard:message',n)},n.prototype.Get=function(n){var i="/admin/api/iwwizard/"+n,t=this;return this.$http({method:'GET',url:i,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),WizardSessionId:this.IwWizardTdsSessionId.StoreSessionId}}).then(function(n){return t.PostProcess(n,t)},function(n){return t.PostProcess(n,t)})},n.prototype.SearchUser=function(n,t,i){var u="/admin/api/iwwizard/SearchUsers",r=this;return this.$http({method:'POST',url:u,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),WizardSessionId:this.IwWizardTdsSessionId.StoreSessionId},data:{ListAction:-1,ListContext:null,SearchText:n,SortDirection:t,SortPropertyName:i}}).then(function(n){return r.PostProcess(n,r)},function(n){return r.PostProcess(n,r)})},n.prototype.Post=function(n,t){var r="/admin/api/iwwizard/"+n,i=this;return this.$http({method:'POST',url:r,data:t,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'),WizardSessionId:this.IwWizardTdsSessionId.StoreSessionId}}).then(function(n){return i.PostProcess(n,i)},function(n){return i.PostProcess(n,i)})},n.prototype.PostProcess=function(n,i){var r,u,f;return n.status>=400?(i.ShowMessage(n.data,2),console.error("Failure in api call: "+n.config.url),null):(r=n.data,r===null)?null:r.Succeeded?r.Data:(u=new t,r.Data!==null&&r.Data.ErrorMessage!==undefined&&r.Data.ErrorMessage!==null?(u.ErrorMessage=r.Data.ErrorMessage,u.MessageType=r.Data.MessageType,i.ShowErrorModelMessage(u)):(f=r.message,f||(f=r.Message),i.ShowMessage(f,2)),console.warn("Error in api call: "+n.config.url),null)},n.$inject=["$rootScope","$http"],n}(),u,t,f,i;n.IwWizardService=r,AdminApp.service("IwWizardService",r),function(n){n[n.Info=0]="Info",n[n.Warning=1]="Warning",n[n.Error=2]="Error",n[n.Critical=3]="Critical",n[n.Success=4]="Success"}(n.IwWizardMessageType||(n.IwWizardMessageType={})),u=n.IwWizardMessageType,t=function(){function n(){}return n}(),n.IwWizardErrorModel=t,function(n){n[n.NotSent=0]="NotSent",n[n.Sent=1]="Sent",n[n.Failed=2]="Failed"}(n.IwWizardEmailSentStatus||(n.IwWizardEmailSentStatus={})),f=n.IwWizardEmailSentStatus,i=function(){function n(){}return n}(),n.IwWizardTdsSessionId=i})(Admin||(Admin={}));var Admin;(function(n){'use strict';;var t=function(){function t(t,i,r,u){this.$scope=t,this.IwWizardService=i,this.$location=r,this.$window=u,t.initializing=!0,t.init=function(r){t.stringTable=r,t.messageType=null,t.message=null,t.showLoading=!1,t.emailTemplateSelected=i.MailTemplates.ProductivityLibrary,t.users=[],t.IwWizardEmailSentStatus=n.IwWizardEmailSentStatus,t.searchKeyword='',t.sendingEmails=!1,t.MailTemplates=i.MailTemplates,t.NoSearchedUsers=!1,t.loading=!1,i.GetUsersForInitialPageLoad().then(function(n){t.users=n,angular.forEach(n,function(n){n.EmailSentStatusForTheSelectedTemplateInUI=n.EmailSentStatus[t.emailTemplateSelected.name]})}),typeof i.IwWizardTdsSessionId.StoreSessionId!="undefined"&&i.IwWizardTdsSessionId.StoreSessionId.length||i.GetCurrentTdsSession().then(function(t){i.IwWizardTdsSessionId=new n.IwWizardTdsSessionId,i.IwWizardTdsSessionId.StoreSessionId=t}),t.allUsersChecked=!1,t.ToggleAllUsers(),t.initializing=!1},t.$on('UpdateUsers',function(n,i){t.users=i}),t.GetUsers=function(){t.ClearTheGrid(),t.searchKeyword='',t.loading=!0,t.NoSearchedUsers=!1,i.GetUsers().then(function(n){t.allUsersChecked=!1,t.ToggleAllUsers(),angular.forEach(n,function(n){n.EmailSentStatusForTheSelectedTemplateInUI=n.EmailSentStatus[t.emailTemplateSelected.name]}),t.loading=!1,i.UpdateUsers(n)})},t.GetDistributionGroups=function(){t.ClearTheGrid(),t.searchKeyword='',t.NoSearchedUsers=!1,t.loading=!0,i.GetDistributionGroups().then(function(n){t.allUsersChecked=!1,t.ToggleAllUsers(),angular.forEach(n,function(n){n.EmailSentStatusForTheSelectedTemplateInUI=n.EmailSentStatus[t.emailTemplateSelected.name]}),t.loading=!1,i.UpdateUsers(n)})},t.GetSearchedUsers=function(){t.loading=!0,t.NoSearchedUsers=!1,i.GetSearchedUsers(t.searchKeyword).then(function(n){t.allUsersChecked=!1,t.ToggleAllUsers(),angular.forEach(n,function(n){n.EmailSentStatusForTheSelectedTemplateInUI=n.EmailSentStatus[t.emailTemplateSelected.name]}),t.loading=!1,i.UpdateUsers(n),(n===null||n.length<1)&&(t.NoSearchedUsers=!0)})},t.ClearTheGrid=function(){t.searchKeyword='',t.loading=!1,t.NoSearchedUsers=!1,i.UpdateUsers(null)},t.CheckboxClicked=function(){t.allUsersChecked=!1},t.ToggleAllUsers=function(){angular.forEach(t.users,function(n){n.checked=t.allUsersChecked})},t.HandleChangeTemplateSelection=function(){t.allUsersChecked=!1,t.ToggleAllUsers(),angular.forEach(t.users,function(n){n.EmailSentStatusForTheSelectedTemplateInUI=n.EmailSentStatus[t.emailTemplateSelected.name]}),i.UpdateUsers(t.users)},t.$on('wizard:message',function(i,r){var u=r.ErrorMessage;u||r.MessageType===0||(u=t.stringTable.GenericError),t.message=u,t.messageType=n.IwWizardMessageType[r.MessageType].toLowerCase()}),t.$on('wizard:showloading',function(n,i){t.showLoading=i}),t.CloseMessagePanel=function(){t.message=null},t.SendEmailButtonEnabled=function(){if(t.sendingEmails)return!1;var n=!1,i=!1;return angular.forEach(t.users,function(t){t.UserName!==undefined&&t.UserName!==null&&t.Domain!==undefined&&t.Domain!==null&&(n=!0),t.checked&&(i=!0)}),n&&i},t.Email=function(){var n=[];(angular.forEach(t.users,function(t){t.UserName!==undefined&&t.UserName!==null&&t.Domain!==undefined&&t.Domain!==null&&t.checked&&(t.IsEmailNeedstoBeSentToTheUser=!0,n.push(t))}),n.length!=0)&&(t.sendingEmails=!0,i.SendIwWizardEmails(n,t.emailTemplateSelected.name).then(function(r){var u,f;r.success?(u='Email successfully sent to \x7b0\x7d users. '.replace("{0}",n.length.toString()),i.ShowMessage(u,4)):(f='Failed to send email due to a technical error.',i.ShowMessage(f,1)),r.users&&angular.forEach(t.users,function(n){n.IsEmailNeedstoBeSentToTheUser&&angular.forEach(r.users,function(i){n.IsEmailNeedstoBeSentToTheUser&&n.UserName===i.UserName&&(n.EmailSentStatus[t.emailTemplateSelected.name]=i.EmailSentStatus[t.emailTemplateSelected.name],n.EmailSentStatusForTheSelectedTemplateInUI=i.EmailSentStatus[t.emailTemplateSelected.name])})}),t.sendingEmails=!1}))}}return t.$inject=["$scope","IwWizardService","$location","$window","$timeout"],t}();n.app.controller("IwWizardController",t)})(Admin||(Admin={}));