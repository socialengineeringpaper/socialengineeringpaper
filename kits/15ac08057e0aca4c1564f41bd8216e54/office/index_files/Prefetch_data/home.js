var SearchControl,TwoColumnControl,EnterpriseHome;Namespace.Register("Microsoft.Online.BOX.JS.Home"),Microsoft.Online.BOX.JS.Home=new function(){this.ShowGetStartedDialog=function(){BOX.JS.DialogManager.get_isBrowserIE7Compatible()?DialogManager.showUrl("/IWGetStarted.aspx","",null,"height:530,width:800"):DialogManager.showUrl("/IWGetStarted.aspx","",null,"height:500,width:800")},this.ShowDate=function(){var n=new Date,t=n.getMonth(),i=n.getDate(),r=n.getDay(),u,f,e;typeof LocalizedMonths!="undefined"&&typeof LocalizedMonths=="object"&&(t=LocalizedMonths[t]),typeof LocalizedDayNumbers!="undefined"&&typeof LocalizedDayNumbers=="object"&&(i=LocalizedDayNumbers[i-1]),typeof LocalizedDays!="undefined"&&typeof LocalizedDays=="object"&&(r=LocalizedDays[r]),u=document.getElementById("todayMonth"),u!=null&&(u.innerHTML=t),f=document.getElementById("todayDate"),f!=null&&(f.innerHTML=i),e=document.getElementById("todayDay"),e!=null&&(e.innerHTML=r)},this.SetupCheckForProvisioning=function(n,t,i){checkForProvisioning=function(){var t=[];$(".service.inactive").each(function(){t.push($(this).attr('id'))}),t.length>0&&($.ajax({url:n,data:{service:t},success:function(n){activeServicesReturned=0,$('.service',$(n)).each(function(){var n=$('#'+$(this).attr('id'));n.html($(this).html()),n.removeClass('inactive'),activeServicesReturned++}),activeServicesReturned>0&&typeof PageLayout!="undefined"&&PageLayout.ResizePanels()}}),setTimeout(checkForProvisioning,i*1e3))},t>0&&setTimeout(checkForProvisioning,i*1e3)},this.SetupToggleContent=function(n,t,i,r,u){toggleVisibility=function(){$("#"+n).toggle(),$("#"+t).toggle(),$("#"+i).toggle(),Microsoft.Online.BOX.JS.Shared.SetPersistentCookie(r,!$("#"+i).is(":visible"),u,"/"),typeof PageLayout!="undefined"&&PageLayout.ResizePanels()},$("#"+n).click(function(){return toggleVisibility(),!1}),$("#"+t).click(function(){return toggleVisibility(),!1})}},SearchControl=new function(){this.Initialize=function(t,i){var r=$("#"+t),u,e;r.data("CommunityUrl",i.CommunityUrl),r.data("SearchControlTextBoxId",i.SearchControlTextBoxId),r.data("HiddenDivId",i.HiddenDivId),r.data("ItalicizeTextBox",i.ItalicizeTextBox);var o=$('#'+i.SearchControlTextBoxId),s=$('#'+i.HiddenDivId),f=o.outerWidth();if(s.html('<span id="'+t+'_tmpSpan" style="white-space:nowrap;">'+i.SearchWatermarkText+'</span>'),u=$('#'+t+'_tmpSpan'),u.outerWidth()>f){for(e=1,u.html(''),f=f-10;u.outerWidth()<f&&e<i.SearchWatermarkText.length;)u.html(i.SearchWatermarkText.substr(0,e)+'...'),e++;i.SearchWatermarkText=u.html()}r.data("SearchWatermarkText",i.SearchWatermarkText),o.val(i.SearchWatermarkText),s.css('display','none'),$('.SearchControlTextBox',r).keypress(function(t){var i=t.which?t.which:t.keyCode;return i==13?(n(r),t.cancelBubble=!0,t.stopPropagation(),!1):!0}).blur(function(){var i=r.data("SearchWatermarkText"),t;typeof i!="undefined"&&(t=$('#'+r.data("SearchControlTextBoxId")),t.length!=0&&t.val()==''&&(t.val(i),r.data("ItalicizeTextBox")&&t.css('fontStyle','italic'))),$(".Home-SearchControl-Table").removeClass("ms-bcl-ts")}).focus(function(){var i=r.data("SearchWatermarkText"),t;typeof i!="undefined"&&(t=$('#'+r.data("SearchControlTextBoxId")),t.length!=0&&i==t.val()&&(t.val(''),t.css('fontStyle','normal'),t.select())),$(".Home-SearchControl-Table").addClass("ms-bcl-ts")}),$('.SearchControlSearchButton',r).click(function(){return n(r),!1}).keypress(function(t){return t.which==13?(n(r),t.cancelBubble=!0,t.stopPropagation(),!1):!0})};var n=function(n){var i=n.data("CommunityUrl"),r=n.data("SearchWatermarkText"),t,u;typeof i!="undefined"&&typeof r!="undefined"&&(t=$('#'+n.data("SearchControlTextBoxId")),t.length!=0&&r!=t.val()&&(u=i.Format(encodeURIComponent(t.val())),window.open(u,'_blank')))}},TwoColumnControl={},TwoColumnControl.SelectItem=function(n){var u=$("#TwoColumnControlCategoryTD"),t=$("#TwoColumnControlDetailsTD"),i=$(n),r=i.attr("boxdata-LoadStatus");u.children().each(function(i,u){var f=t.find("[boxdata-tab='"+$(u).attr("boxdata-tab")+"']"),e;f.hide(),f.attr("aria-expanded","false"),n==u?(r==EnterpriseHome.StatusLoaded||r==EnterpriseHome.StatusStatic)&&(f.show(),f.attr("aria-expanded","true")):(e=$(u),u.className="TwoColumnControlCategory ms-bgc-nl-h",e.find(".BOX-HeaderTertiary").addClass("ms-fcl-np"),e.find(".BOX-HeaderTertiary").removeClass("ms-fcl-td"),e.find("a").attr("aria-selected","false"))}),typeof n!="undefined"&&(n.className="TwoColumnControlCategorySelected ms-bgc-nl",i.find(".BOX-HeaderTertiary").addClass("ms-fcl-td"),i.find(".BOX-HeaderTertiary").removeClass("ms-fcl-np"),i.find("a").attr("aria-selected","true")),$(t).find("#DetailsGettingDataLoading").hide(),$(t).find("#DetailsErrorAlertMessage").hide(),r==EnterpriseHome.StatusInError?$(t).find("#DetailsErrorAlertMessage").show():r==EnterpriseHome.StatusLoading&&$(t).find("#DetailsGettingDataLoading").show(),PageLayout.ResizePanels()},TwoColumnControl.ReSelectItem=function(){TwoColumnControl.SelectItem($("#TwoColumnControlTable").find(".TwoColumnControlCategorySelected")[0])},TwoColumnControl.Initialize=function(){$(".TwoColumnControlCategory").each(function(){var i=$(this),r=$("span[boxdata-tab='"+i.attr("boxdata-tab")+"']");i.find("a").attr({role:"tab","aria-selected":"false","aria-controls":r.attr("id")}),r.attr({role:"tabpanel","aria-expanded":"false"})}),$(".TwoColumnControlCategorySelected").each(function(){var i=$(this),r=$("span[boxdata-tab='"+i.attr("boxdata-tab")+"']");i.find("a").attr({role:"tab","aria-selected":"true","aria-controls":r.attr("id")}),r.attr({role:"tabpanel","aria-expanded":"true"})})},EnterpriseHome={},EnterpriseHome.StatusStatic=-1,EnterpriseHome.StatusUnknown=0,EnterpriseHome.StatusLoading=1,EnterpriseHome.StatusLoaded=2,EnterpriseHome.StatusInError=3,EnterpriseHome.GetDataForTab=function(n,t,i,r){$("#"+n+" #Overview").html($("#GettingDataLabel").html()),$("#"+n).attr("boxdata-LoadStatus",EnterpriseHome.StatusLoading),ViewModel.MakeRequest("Admin.UI.Admin.EnterpriseHomeUtils."+t,function(t){EnterpriseHome.OnGetDataSuccess(n,t,i)},function(t){EnterpriseHome.OnGetDataError(n,t,r)})},EnterpriseHome.OnGetDataSuccess=function(n,t,i){$("#"+n+" #Overview").text(t.Summary),$("#"+n).attr("boxdata-LoadStatus",EnterpriseHome.StatusLoaded),i&&i(t),PageLayout.ResizePanels(),TwoColumnControl.ReSelectItem()},EnterpriseHome.OnGetDataError=function(n,t,i){$("#"+n+" #Overview").html($("#GetDataErrorLabel").html()),$("#"+n).attr("boxdata-LoadStatus",EnterpriseHome.StatusInError),i&&i(t),TwoColumnControl.ReSelectItem()},EnterpriseHome.GetServiceHealthSucceeded=function(n){var y=$("#ServiceHealthDetails > table")[0],k=y.children[1],tt=!1,c=n.ServiceHealth,g,nt,v,u,f,i,t,o;for($(y).children("tbody[ServiceId]").each(function(){for(var i=$(this).attr("ServiceId"),t=!1,n=0;n<c.length;n++)if(c[n].ServiceId==i){t=!0;break}t||$(this).remove()}),i=0;i<c.length;i++){var r=c[i],d=r.ServiceId,rt=r.ServiceNameText,s=r.ServiceStatusText,it=r.SeverityText,e=r.DegradationMessages,p=r.HasProvisioning,b=r.HasProvisioningError,l=r.HasProvisioned,a=!0,t=$(y).children("tbody[ServiceId='"+d+"']");for(t.length==0?(t=k.cloneNode(!0),y.appendChild(t)):((t.attr("HasProvisioning")!=""+p||t.attr("HasProvisioningError")!=""+b||t.attr("HasProvisioned")!=""+l||t.attr("DegradationMessagesIsNull")!=""+(e==null))&&t.html($(k).html()),t=t[0]),$(t).attr("ServiceId",d),$(t).attr("HasProvisioning",p),$(t).attr("HasProvisioningError",b),$(t).attr("HasProvisioned",l),$(t).attr("DegradationMessagesIsNull",e==null),$(t).find("#Name").text(rt),$(t).find("#Icon").css("background-color",EnterpriseHome.GetIconColor(it)).attr("title",s);$(t).find("#IncidentDetails").length>1;)$(t).find("#IncidentDetails:last").remove();if($(t).find("#ProvisioningFailureLink").hide(),$(t).find("#ProvisioningFailureNewSubscriptionDiv").hide(),$(t).find("#DegradationMessageLink").hide(),$(t).find("#StatusLabel").hide(),p&&!l&&(a=!1),b&&!l&&(a=!1),a){if(e!=null){for(g=$(t).find("#IncidentDetailsTD")[0],nt=$(t).find("#IncidentDetails")[0],v=0;v<e.length;v++)u=nt.cloneNode(!0),g.appendChild(u),f=e[v],$(u).find("#DegradationMessage").text(EnterpriseHome.GetEllipsizedText(f.Text)),$(u).find("#DegradationMessage").attr("title",f.Text),$(u).find("#DegradationDate").text(f.Date),$(u).find("#DegradationViewDetailsSpan").html(f.ViewDetailsLink),$(u).show();$(t).find("#DegradationMessageLinkText").text(s),$(t).find("#DegradationMessageLink").attr("title",s),$(t).find("#DegradationMessageLink").show()}else a&&($(t).find("#StatusLabel").text(s),$(t).find("#StatusLabel").show());$(t).show()}}tt&&window.setTimeout(function(){EnterpriseHome.GetDataForTab("ServiceHealthDiv","GetServiceHealth",EnterpriseHome.GetServiceHealthSucceeded,EnterpriseHome.GetServiceHealthFailed)},EnterpriseHome.PollIntervalForProvisioningInMilliSeconds);for(var h=$get("PlannedMaintenanceDetailsDiv"),k=h.children[0],w=n.PlannedMaintenance;h.children.length>1;)$(h.children[1]).remove();if(w.length==0)$("#PlannedMaintenanceEmptyMessage").show(),$("#ViewPlannedMaintenanceDetailsLink").hide();else for($("#PlannedMaintenanceEmptyMessage").hide(),$("#ViewPlannedMaintenanceDetailsLink").show(),i=0;i<w.length;i++)t=k.cloneNode(!0),h.appendChild(t),o=w[i],$(t).find("#ServiceName").text(o.ServiceName),$(t).find("#Message").text(EnterpriseHome.GetEllipsizedText(o.Message)),$(t).find("#MaintenanceDate").text(o.MaintenanceDate),$(t).find("#ViewDetailsSpan").html(o.ViewDetailsLink),$(t).show()},EnterpriseHome.GetServiceHealthFailed=function(){},EnterpriseHome.GetMessagesSucceeded=function(n){for(var r=$("#MessageCenterDetails > table")[0],e=r.children[1],f=n.Messages,u,t,i;r.children.length>1;)$(r.children[1]).remove();if(f.length==0)$("#MessageCenterEmptyMessage").show(),$("#MessageCenterDetailsTable").hide(),$("#ViewMessageCenterDetailsLink").hide();else for($("#MessageCenterEmptyMessage").hide(),$("#MessageCenterDetailsTable").show(),$("#ViewMessageCenterDetailsLink").show(),u=0;u<f.length;u++)t=e.cloneNode(!0),r.appendChild(t),i=f[u],$(t).find("#ActionRequiredDate").text(i.ActionRequiredDate),$(t).find("#MessageTitle").text(EnterpriseHome.GetEllipsizedText(i.Title)),$(t).find("#ViewMessageDetailsSpan").html(i.ViewDetailsLink),i.IsActionRequired?$(t).find("#ActionRequiredImage").show():$(t).find("#ActionRequiredImage").hide(),$(t).show()},EnterpriseHome.GetMessagesFailed=function(){},EnterpriseHome.GetServiceRequestsSucceeded=function(n){EnterpriseHome.BindSRs($get("ServiceRequestsDetailsAllDiv"),n.ServiceRequestsOpen),EnterpriseHome.BindSRs($get("ServiceRequestsDetailsActionRequiredDiv"),n.ServiceRequestsActionRequired),n.ServiceRequestsOpen.length==0&&$("#AllSRsEmptyMessage").show(),n.ServiceRequestsActionRequired.length==0&&$("#ActionRequiredSRsEmptyMessage").show()},EnterpriseHome.BindSRs=function(n,t){for(var f=n.children[0],u,i,r;n.children.length>3;)$(n.children[3]).remove();for(u=0;u<t.length;u++)i=f.cloneNode(!0),n.insertBefore(i,n.children[n.children.length-1]),r=t[u],$(i).find("#Title").text(EnterpriseHome.GetEllipsizedText(r.Title)),$(i).find("#Title").attr("title",r.Title),$(i).find("#Id").text(r.Id),$(i).find("#LastUpdated").text(r.LastUpdated),$(i).find("#ViewDetailsSpan").html(r.ViewDetailsLink),$(i).show()},EnterpriseHome.ShowActionRequiredSRs=function(){$("#ServiceRequestsDetailsActionRequiredDiv").show(),$("#ServiceRequestsDetailsAllDiv").hide(),$("#ActionRequiredSRsLink").addClass("selected ms-fcl-np"),$("#ActionRequiredSRsLink").removeClass("ms-fcl-ns"),$("#AllSRsLink").removeClass("selected ms-fcl-np"),$("#AllSRsLink").addClass("ms-fcl-ns")},EnterpriseHome.ShowAllSRs=function(){$("#ServiceRequestsDetailsActionRequiredDiv").hide(),$("#ServiceRequestsDetailsAllDiv").show(),$("#ActionRequiredSRsLink").removeClass("selected ms-fcl-np"),$("#ActionRequiredSRsLink").addClass("ms-fcl-ns"),$("#AllSRsLink").addClass("selected ms-fcl-np"),$("#AllSRsLink").removeClass("ms-fcl-ns")},EnterpriseHome.GetServiceRequestsFailed=function(){},EnterpriseHome.ShowHideStatusDetails=function(n,t){var r=arguments[2]?arguments[2]:"tbody",i=$(n).closest(r).find("#"+t);i[0].style.display=="none"?(i.show(),$(n).find("#CollapseControl").show(),$(n).find("#ExpandControl").hide()):(i.hide(),$(n).find("#CollapseControl").hide(),$(n).find("#ExpandControl").show()),PageLayout.ResizePanels()},EnterpriseHome.GetEllipsizedText=function(n){var t=n;return t.length>EnterpriseHome.MaxDisplayedMessageLength&&(t=t.substr(0,EnterpriseHome.MaxDisplayedMessageLength)+"â€¦"),t},EnterpriseHome.GetReportData=function(n,t,i,r,u,f){$("#"+n+" #Overview").html($("#GettingDataLabel").html()),$("#"+n).attr("boxdata-LoadStatus",EnterpriseHome.StatusLoading),ViewModel.MakeRequest("Admin.UI.Admin.EnterpriseHomeUtils."+t,function(t){var i=$('#'+r);i&&(i.bind('load',function(){return EnterpriseHome.OnGetDataSuccess(n,t),!1}),i.bind('error',function(t){return EnterpriseHome.OnGetDataError(n,t),!1}),i.attr('src',u))},function(){$('#'+i).hide(),$('#'+n).hide()},undefined,{cid:f})},EnterpriseHome.GetIconColor=function(n){return n=="Operational"?'#3AB449':n=="Investigating"?'#98A3A5':n=="Warning"?'#FFC23F':n=="Critical"?'#A80F22':void 0},EnterpriseHome.GetDataForTabSMB=function(n,t,i,r){ViewModel.MakeRequest("Admin.UI.Admin.EnterpriseHomeUtils."+t,function(t){EnterpriseHome.OnGetDataSuccessSMB(n,t,i)},function(t){EnterpriseHome.OnGetDataErrorSMB(n,t,r)})},EnterpriseHome.OnGetDataSuccessSMB=function(n,t,i){i&&i(t),PageLayout.ResizePanels()},EnterpriseHome.OnGetDataErrorSMB=function(n,t,i){i&&i(t)},EnterpriseHome.GetOfficeStoreApps=function(){ViewModel.MakeRequest("Admin.UI.Admin.EnterpriseHomeUtils.GetOfficeStoreApps",function(n){EnterpriseHome.GetOfficeStoreAppsSucceeded(n)},function(n){EnterpriseHome.GetOfficeStoreAppsFailed(n)})},EnterpriseHome.GetOfficeStoreAppsSucceeded=function(n){var r=$("#O365DashboardOfficeStoreLinks > div")[0],o=r.children[0],i,f,t,u,e;for($(r).children("div").each(function(){for(var r=$(this).attr("AppId"),i=!1,t=0;t<n.length;t++)if(n[t].Id==r){i=!0;break}i||$(this).remove()}),i=0;i<n.length;i++)f=n[i].Id,t=$(r).children("div[AppId='"+f+"']"),t.length==0&&(t=o.cloneNode(!0),r.appendChild(t)),$(t).attr("id","App"+i),$(t).attr("AppId",f),$(t).attr("Visibility","visible"),u=$(t).find('a'),$(u).attr("id","AppLink"+i),$(u).attr("href",n[i].AppUrl),$(u).attr("onclick","Microsoft.Online.BOX.JS.Insights.LogEvent('officeAppStoreLink');"),e=$(t).find('img'),e.attr('src',n[i].IconUrl),$(t).find('span').text(n[i].LocalizedShortDescription),$(t).show();n.length>0&&$("#O365DashboardOfficeStoreLinks").attr("style","display:block")},EnterpriseHome.GetOfficeStoreAppsFailed=function(){},EnterpriseHome.TextAdminMobileAppDownLink=function(){var i,n,r;Microsoft.Online.BOX.JS.Insights.LogEvent('TextMobileAppDownloadLinkClicked'),n=$("#smsStatusLabel"),n.text('');var u='/admin/api/message/textAppDownloadLink',f=$("#toPhoneNumber"),t=f.val(),e=/^\+(?:[0-9] ?){6,14}[0-9]$/;t.length<=0||e.test(t)==!1?(Microsoft.Online.BOX.JS.Insights.LogEvent('TextMobileAppDownloadLinkInvalidPhoneEntered'),i='Please enter a valid phone number in format \x2bx xxx xxx xxxx',n=$("#smsStatusLabel"),n.text(i)):(r=JSON.stringify({toPhoneNumber:t}),$.ajax({url:u,type:'POST',contentType:'application/json',dataType:'json',data:r,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},success:EnterpriseHome.TextAdminMobileAppDownLinkSuccess,error:EnterpriseHome.TextAdminMobileAppDownLinkError}))},EnterpriseHome.TextAdminMobileAppDownLinkSuccess=function(n){if(Microsoft.Online.BOX.JS.Insights.LogEvent('TextMobileAppDownloadLinkSuccess'),n==!0){var t='Mobile App Download link successfully sent\x21',i=$("#smsStatusLabel");i.text(t)}else EnterpriseHome.TextAdminMobileAppDownLinkError(!1)},EnterpriseHome.TextAdminMobileAppDownLinkError=function(){Microsoft.Online.BOX.JS.Insights.LogEvent('TextMobileAppDownloadLinkFailed');var t='Failed to send app download link. Please enter a valid mobile number. If error persists, click on the image link below to install app.',i=$("#smsStatusLabel");i.text(t)},EnterpriseHome.ResetMobileAdsClickCounter=0,EnterpriseHome.ResetMobileAdsClickCounterHit=10,EnterpriseHome.ClickResetMobileAds=function(){EnterpriseHome.ResetMobileAdsClickCounter++,EnterpriseHome.ResetMobileAdsClickCounter==EnterpriseHome.ResetMobileAdsClickCounterHit&&($.ajax({url:'/admin/api/mobileappads/preference',type:'DELETE',headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},success:EnterpriseHome.ResetMobileAdsSuccess,error:EnterpriseHome.ResetMobileAdsError}),EnterpriseHome.ResetMobileAdsClickCounter=0)},EnterpriseHome.ResetMobileAdsSuccess=function(){top.DialogManager.alertText(BOX.JS.IconType.info,'Reset Mobile Ads','Successfully reset admin mobile ads preferences!')},EnterpriseHome.ResetMobileAdsError=function(){top.DialogManager.alertText(BOX.JS.IconType.error,'Reset Mobile Ads','Failed to reset admin mobile ads preferences!')}