var Reporting={};Reporting.MainChartImgId=null,Reporting.AlertErrorMessageDivId=null,Reporting.DivMoreReportsLinkId=null,Reporting.GeneralChartErrorMessage=null,Reporting.ServiceId=null,Reporting.CategoryId=null,Reporting.ReportIds=[],Reporting.Titles=[],Reporting.Descriptions=[],Reporting.CurrentSelectedThumbnailId=null,Reporting.ThumbnailImgIDs=null,Reporting.TableViewContainerDivId=null,Reporting.DataItemNotAvailableTexts=null,Reporting.Loading=function(){Reporting.MainChartAreaLoading(),Reporting.LoadedAdvanceFilter(Reporting.ServiceId,Reporting.CategoryId,Reporting.MainChartImgId),Reporting.LoadedTable(Reporting.ServiceId,Reporting.CategoryId,Reporting.MainChartImgId),Reporting.SideChartsAreaLoading(null)},Reporting.HandleLoaded=function(n,t,i,r){$('#'+t).show(),r=="1"?($('#'+n).attr('status','complete').attr('error','false'),Reporting.MainChartAreaLoaded(i)):($('#'+n).attr('status','complete').hide(),$('#divSpinner_'+i).show(),Reporting.SideChartsAreaLoaded()),PageLayout.ResizePanels()},Reporting.HandleError=function(n,t,i,r){$('#'+n).attr('status','complete').attr('error','true').show(),$('#divError_'+i).html(Reporting.GeneralChartErrorMessage).show(),$('#divSpinner_'+i).hide(),r=="1"?Reporting.MainChartAreaLoaded(i):Reporting.SideChartsAreaLoaded(),$('#'+t).hide()},Reporting.SelectChart=function(n,t){var u;Reporting.UpdateHeader('divHeader_'+Reporting.MainChartImgId,'divHeader_'+Reporting.MainChartImgId+'_title','divHeader_mainchart_desc',n,t),Reporting.UpdateHeader('divHeader_'+n,'divHeader_'+n+'_title',null,Reporting.MainChartImgId,t),Reporting.SwapHtmlContent('#topFilterDiv_'+Reporting.MainChartImgId,'#topFilterDiv_'+n);var i=$('#topFilterDiv_'+Reporting.MainChartImgId).find('.DomainFilter').attr('filterId'),r=i==undefined?null:$('#domainFilterID_'+i),o=i==undefined?null:$('#advanceFilterID_'+i),s=Reporting.GetQueryParam($('#'+n).attr('src'),'df');r&&s!=-1&&r.val(r.find('option')[s].text),u=decodeURIComponent(Reporting.GetQueryParam($('#'+n).attr('src'),'af')),o&&u&&o.val(u),Reporting.SwapHtmlContent('#timeFilterDiv_'+Reporting.MainChartImgId,'#timeFilterDiv_'+n),Reporting.SwapHtmlContent('#reportTableDiv_'+Reporting.MainChartImgId,'#reportTableDiv_'+n),Reporting.CurrentSelectedThumbnailId=n,Reporting.LoadedAdvanceFilter(Reporting.ServiceId,Reporting.CategoryId,n),Reporting.LoadedTable(Reporting.ServiceId,Reporting.CategoryId,n),Reporting.MainChartAreaLoading(),Reporting.SideChartsAreaLoading(n),$('#divSpinner_'+Reporting.MainChartImgId).show(),$('#divImg_'+Reporting.MainChartImgId).hide(),$('#divImgCover_'+Reporting.MainChartImgId).show(),$('#divImgCover_'+n).show(),$('#divImg_'+n).hide(),$('#divError_'+Reporting.MainChartImgId).hide();var h=new RegExp('\w*dt=(.*)&size.*?report=(.*)'),c=$('#'+Reporting.MainChartImgId).attr('src'),f=h.exec(c),l=+new Date,a=$('#'+n).attr('src'),e=h.exec(a),v=l+1,y=c.replace(f[1],l).replace(f[2],e[2]),p=a.replace(e[1],v).replace(e[2],f[2]);$('#'+Reporting.MainChartImgId).attr('src',y),$('#'+n).attr('src',p)},Reporting.UpdateHeader=function(n,t,i,r,u){var e=document.getElementById(n),o,f;e&&(o=Reporting.GetQueryParam($('#'+r).attr('src'),'report'),f=Reporting.GetReportMetdataIndex(o),f!=null&&($('#'+t).html(Reporting.Titles[f]),$('#'+i).find('span').find('span').html(Reporting.Descriptions[f]),$('#'+r).attr('alt',Reporting.Titles[f]),$('#'+u).attr('title',Reporting.Titles[f]),e.style.display='block'))},Reporting.MainChartAreaLoading=function(){$('#'+Reporting.AlertErrorMessageDivId).hide(),$('#divHeader_'+Reporting.MainChartImgId).addClass('ReportGrayout'),$('#'+Reporting.MainChartImgId).hide(),$('#topFilterDiv_'+Reporting.MainChartImgId).addClass('ReportGrayout'),$('#timeFilterDiv_'+Reporting.MainChartImgId).addClass('ReportGrayout'),$('#reportTableDiv_'+Reporting.MainChartImgId).addClass('ReportGrayout'),$('#topFilterDiv_'+Reporting.MainChartImgId+' select').attr('disabled','disabled'),$('#timeFilterDiv_'+Reporting.MainChartImgId+' span a').attr('disabled','disabled')},Reporting.MainChartAreaLoaded=function(n){var t,i;$('#divImgCover_'+n).attr('status')=='complete'&&($('#divImgCover_'+n).attr('error')!='true'?($('#topFilterDiv_'+Reporting.MainChartImgId+' select').removeAttr("disabled"),$('#timeFilterDiv_'+Reporting.MainChartImgId+' span a').removeAttr('disabled'),$('#divImgCover_'+n).hide(),$('#'+n).show()):$('#timeFilterDiv_'+Reporting.MainChartImgId+' span a').removeClass('ReportTimeFilterSelected ms-fcl-tp'),t=$('#reportTableDiv_'+Reporting.MainChartImgId).attr('status'),t==undefined||t=='complete')&&(i=$('#topFilterDiv_'+Reporting.MainChartImgId).attr('status'),i==undefined||i=='complete')&&($('#divHeader_'+Reporting.MainChartImgId).removeClass('ReportGrayout'),$('#topFilterDiv_'+Reporting.MainChartImgId).removeClass('ReportGrayout'),$('#timeFilterDiv_'+Reporting.MainChartImgId).removeClass('ReportGrayout'),$('#reportTableDiv_'+Reporting.MainChartImgId).removeClass('ReportGrayout'),Reporting.ThumbnailImgIDs&&$.each(Reporting.ThumbnailImgIDs,function(n,t){var i=$('#'+t);i.attr('delaySrc')&&(i.attr('src',i.attr('delaySrc')),i.removeAttr('delaySrc'))}),$('#divImgCover_'+n).attr('status',''),$('#reportTableDiv_'+Reporting.MainChartImgId).attr('status',''),PageLayout.ResizePanels())},Reporting.SideChartsAreaLoading=function(n){var i,t;if(n==null)$('#sideChartsAreaDiv').find('.ReportingThumbnChartTitle').addClass('ReportGrayout');else for($('#divHeader_'+n).addClass('ReportGrayout'),i=$('#sideChartsAreaDiv').find('.ReportingImgCover'),t=0;t<i.length;t++)i[t].getAttribute('id')!='#divImgCover_'+n&&i[t].setAttribute('status','complete')},Reporting.SideChartsAreaLoaded=function(){for(var n=$('#sideChartsAreaDiv').find('.ReportingImgCover'),i,t=0;t<n.length;t++)if(n[t].getAttribute('status')!='complete')return;for($('#sideChartsAreaDiv').find('.BOX-HeaderTertiary.ReportGrayout').removeClass('ReportGrayout'),$('#sideChartsAreaDiv').find('.ReportingThumbnChartTitle.ReportGrayout').removeClass('ReportGrayout'),$('#sideSpinnerDiv').hide(),Reporting.DivMoreReportsLinkId.length&&$('#'+Reporting.DivMoreReportsLinkId).show(),i=0;i<n.length;i++)n[i].setAttribute('status','')},Reporting.GetReportMetdataIndex=function(n){for(var i,t=0;t<Reporting.ReportIds.length;t++)if(Reporting.ReportIds[t]==n){i=t;break}return i},Reporting.FilterSelectionChanged=function(n,t){var i,u,r,f;Reporting.LoadFilter(Reporting.MainChartImgId),i=$('select#'+n).get(0).selectedIndex,(i==null||i==undefined||i==0)&&(i=-1),u=$('#divImg_'+Reporting.MainChartImgId+' img').attr('src'),r=null,t=='af'?(f=i==-1?'':Reporting.HtmlDecode($('select#'+n+' option')[i].value),r=Reporting.SetQueryParam(u,t,encodeURIComponent(f))):r=Reporting.SetQueryParam(u,t,i),$('#divImg_'+Reporting.MainChartImgId+' img').attr('src',r),Reporting.LoadedTable(Reporting.ServiceId,Reporting.CategoryId,Reporting.MainChartImgId)},Reporting.HtmlDecode=function(n){return $('<div/>').html(n).text()},Reporting.SwapHtmlContent=function(n,t){var i=$(n),r=$(t),u=i.html();i.html(r.html()),r.html(u)},Reporting.TimeFilterSelectionChanged=function(n,t,i){if($('#'+n).attr('disabled')!='disabled'){$('#timeFilterDiv_'+Reporting.MainChartImgId+' span a').removeClass('ReportTimeFilterSelected ms-fcl-tp'),$('#'+n).addClass('ReportTimeFilterSelected ms-fcl-tp'),Reporting.LoadFilter(Reporting.MainChartImgId);var r=$('#divImg_'+Reporting.MainChartImgId+' img').attr('src'),u=Reporting.SetQueryParam(r,t,i);$('#divImg_'+Reporting.MainChartImgId+' img').attr('src',u),Reporting.LoadedTable(Reporting.ServiceId,Reporting.CategoryId,Reporting.MainChartImgId)}},Reporting.LoadFilter=function(n){$('#divImg_'+n).hide(),$('#divImgCover_'+n).show(),Reporting.MainChartAreaLoading(n)},Reporting.SetQueryParam=function(n,t,i){var r,u=new RegExp("([?|&])"+t+"=.*?(&|$)","i"),f=n.indexOf('?')!==-1?"&":"?";return r=n.match(u)?n.replace(u,'$1'+t+"="+i+'$2'):n+f+t+"="+i},Reporting.GetQueryParam=function(n,t){var u=escape(unescape(t)),f=new RegExp("[?&]"+u+"(?:=([^&]*))?","i"),i=f.exec(n),r=-1;return i!=null&&(r=i[1]),r},Reporting._advanceFilterRequest={serviceid:'',categoryid:'',report:''},Reporting._tableRequest={serviceid:'',categoryid:'',report:'',df:'',tf:'',af:''},Reporting.LoadedTable=function(n,t,i){var r,u,f;$('#reportTableDiv_'+Reporting.MainChartImgId).length!=0&&(r=Reporting._tableRequest,r.serviceid=n,r.categoryid=t,r.report=Reporting.GetQueryParam($('#'+i).attr('src'),'report'),r.df=Reporting.GetQueryParam($('#'+i).attr('src'),'df'),r.tf=Reporting.GetQueryParam($('#'+i).attr('src'),'tf'),Reporting.GetQueryParam($('#'+i).attr('src'),'af')!=-1&&(r.af=decodeURIComponent(Reporting.GetQueryParam($('#'+i).attr('src'),'af'))),u="CsvDownload.chart?serviceId="+n+"&categoryId="+t+"&report="+r.report+"&df="+r.df+"&tf="+r.tf+"&af="+r.af,$('#downloadCsvLink').attr('href',u),$('#csrTechnetArticleLink').unbind('click').click(function(){return ClientLogService.WriteLog(ClientLogService.Destinations.Server,ClientLogService.LogLevel.Info,"Opening technet article for CSR detail report. ",6869),!0}),f=Sys.Serialization.JavaScriptSerializer.serialize(r),$('#reportTableDiv_'+Reporting.MainChartImgId).attr('status',''),$('#reportTableDiv_'+Reporting.MainChartImgId+' tbody tr:gt(0)').remove(),PageLayout.ResizePanels(),Microsoft.Online.BOX.Admin.UI.WebControls.ReportingTableControl.GetTableDatasource(f,Reporting.LoadedTableCallback))},Reporting.LoadedTableCallback=function(n){var t='#reportTableDiv_'+Reporting.MainChartImgId,u=$(t+' span:first table:first thead tr th').length,i,f,r,e;if($(t+' span:first table:first tbody').html(''),n.Status!="0"){Reporting.ShowTableErrorMessage(n.ErrorMessage,t,u);return}if(n.Rows)for(i=0;i<n.Rows.length;i++){if(f=$('<tr>').addClass('ReportTableDataRow'),u!=n.Rows[i].RowItem.length){Reporting.ShowTableErrorMessage(Reporting.GeneralChartErrorMessage,t,u);return}for(r=0;r<n.Rows[i].RowItem.length;r++)e=n.Rows[i].RowItem[r],f.append($('<td>').text(e).attr('title',e).addClass('ReportTableDataCell'));$(t+' span:first table:first tbody').append(f)}$(t).attr('status','complete'),Reporting.MainChartAreaLoaded(Reporting.MainChartImgId)},Reporting.ShowTableErrorMessage=function(n,t,i){$(t+' span:first table:first tbody').append($('<tr>').append($('<td>').attr('colspan',i).text(n))),$(t).attr('status','complete'),Reporting.MainChartAreaLoaded(Reporting.MainChartImgId)},Reporting.LoadedAdvanceFilter=function(n,t,i){var r,u;if($('#topFilterDiv_'+Reporting.MainChartImgId).find('#advanceFilterID_'+i).length==0){$('#topFilterDiv_'+Reporting.MainChartImgId).attr('status','complete');return}if($('#topFilterDiv_'+Reporting.MainChartImgId).find('#advanceFilterID_'+i+' option').length!=1){$('#topFilterDiv_'+Reporting.MainChartImgId).attr('status','complete');return}r=Reporting._advanceFilterRequest,r.serviceid=n,r.categoryid=t,r.report=Reporting.GetQueryParam($('#'+i).attr('src'),'report'),u=Sys.Serialization.JavaScriptSerializer.serialize(r),$('#topFilterDiv_'+Reporting.MainChartImgId).attr('status',''),Microsoft.Online.BOX.Admin.UI.WebControls.ReportingFilterControl.GetAdvanceFilterDatasource(u,Reporting.LoadedAdvanceFilterCallback)},Reporting.LoadedAdvanceFilterCallback=function(n){var r='#topFilterDiv_'+Reporting.MainChartImgId,t,i,u;if(n.Status!="0"){$(r).attr('status','complete'),n.Status=="1"&&($('#'+Reporting.AlertErrorMessageDivId+'_Content').html(n.ErrorMessage),$('#'+Reporting.AlertErrorMessageDivId).show()),Reporting.MainChartAreaLoaded(Reporting.MainChartImgId);return}if(n.Items)for(t=0;t<n.Items.length;t++)i=$('<option>'),i.attr('value',n.Items[t].Key),i.html(n.Items[t].Value),u=Reporting.CurrentSelectedThumbnailId==undefined?Reporting.MainChartImgId:Reporting.CurrentSelectedThumbnailId,$('#advanceFilterID_'+u).append(i);$(r).attr('status','complete'),Reporting.MainChartAreaLoaded(Reporting.MainChartImgId)},Reporting.GetReportTableView=function(){var n,t;$('#'+Reporting.TableViewContainerDivId+'_content').html(''),n=$('#divHeader_'+Reporting.MainChartImgId+'_title').text(),DialogManager.showHtmlFromElement(Reporting.TableViewContainerDivId,n,function(){},'height:600,showX:true,canDrag:true',!0),t=Reporting.SetQueryParam($('#'+Reporting.MainChartImgId).attr("src"),'vm','Table'),$.ajax({type:"GET",url:t,dataType:'xml',data:{},success:Reporting.GetReportTableViewSuccessCallback,error:Reporting.GetReportTableViewErrorCallback})},Reporting.GetReportTableViewSuccessCallback=function(n){var s=$('#divHeader_mainchart_desc').find('span > span').text(),h=n.xml?n.xml:(new XMLSerializer).serializeToString(n),c=$.parseXML(h),r=$(c),u=r.find('Chart > Series > Series:first-child'),l=u.attr('XValueType'),f=l=='DateTime',e=[],a=f?'XValue':'AxisLabel',o,t,i;u.find('Points > DataPoint').each(function(){e.push($(this).attr(a))}),o=r.find('Chart > Series > Series'),t=[],f?t.push('Date'):t.push('Item'),i=[],o.each(function(){t.push($(this).attr("Name"));var n=[];$(this).find('Points > DataPoint').each(function(){n.push($(this).attr('YValues'))}),i.push(n),Reporting.CreateTableViewHtml(t,e,i,'reportTableViewId','Table',s)})},Reporting.GetReportTableViewErrorCallback=function(){$('#'+Reporting.TableViewContainerDivId+'_spinner').hide(),$('#'+Reporting.TableViewContainerDivId+'_content').text(Reporting.GeneralChartErrorMessage),PageLayout.ResizePanels()},Reporting.CreateTableViewHtml=function(n,t,i,r,u,f){var c=$('<table></table>').attr('id',r).attr('class',u).attr('summary',f),v=$('<thead class="ReportTableHeaderRow"><tr><th scope="col"></th></tr></thead>'),y=$('<tbody><tr class="ReportTableDataRow"><td class="ReportTableDataCell"></td></tr></tbody>'),l=v.find('th:last'),s,e,p,o,h,a;for($(n).each(function(){l.clone(!1).text(this).insertBefore(l)}),$(l).remove(),s=y.find('tr:last'),e=0;e<t.length;e++){for(p=s.clone(!1).insertBefore(s),o=$(p).find('td:last'),o.clone(!1).text(t[e]).attr('title',t[e]).insertBefore(o),h=0;h<i.length;h++)a=i[h],o.clone(!1).text(a[e]).attr('title',a[e]).insertBefore(o);$(o).remove()}$(s).remove(),c.append(v.outerHtml()),c.append(y.outerHtml()),$('#'+Reporting.TableViewContainerDivId+'_spinner').hide(),$('#'+Reporting.TableViewContainerDivId+'_content').html(c.outerHtml()),PageLayout.ResizePanels()},jQuery.fn.outerHtml=function(){return jQuery('<div />').append(this.eq(0).clone()).html()}